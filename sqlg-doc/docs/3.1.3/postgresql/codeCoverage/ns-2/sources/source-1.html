


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > TestBatch</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">org.umlg.sqlg.test.batch</a>
</div>

<h1>Coverage Summary for Class: TestBatch (org.umlg.sqlg.test.batch)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">TestBatch</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (104/104)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    73.8%
  </span>
  <span class="absValue">
    (118/160)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    99.6%
  </span>
  <span class="absValue">
    (1072/1076)
  </span>
</td>
</tr>
  <tr>
    <td class="name">TestBatch$1</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (4/4)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestBatch$10</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (3/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestBatch$11</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (3/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestBatch$12</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (3/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestBatch$13</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (3/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestBatch$14</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (4/4)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestBatch$15</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (3/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestBatch$2</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (4/4)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestBatch$3</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (4/4)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestBatch$4</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (4/4)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestBatch$5</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (4/4)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestBatch$6</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (3/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestBatch$7</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (3/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestBatch$8</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (3/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestBatch$9</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (3/3)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (119/119)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    73.8%
  </span>
  <span class="absValue">
    (118/160)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    99.6%
  </span>
  <span class="absValue">
    (1123/1127)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package org.umlg.sqlg.test.batch;
&nbsp;
&nbsp;import org.apache.commons.collections4.set.ListOrderedSet;
&nbsp;import org.apache.commons.lang3.time.StopWatch;
&nbsp;import org.apache.tinkerpop.gremlin.structure.Direction;
&nbsp;import org.apache.tinkerpop.gremlin.structure.Edge;
&nbsp;import org.apache.tinkerpop.gremlin.structure.T;
&nbsp;import org.apache.tinkerpop.gremlin.structure.Vertex;
&nbsp;import org.apache.tinkerpop.gremlin.util.iterator.IteratorUtils;
&nbsp;import org.junit.*;
&nbsp;import org.umlg.sqlg.structure.PropertyDefinition;
&nbsp;import org.umlg.sqlg.structure.PropertyType;
&nbsp;import org.umlg.sqlg.structure.SqlgGraph;
&nbsp;import org.umlg.sqlg.structure.topology.VertexLabel;
&nbsp;import org.umlg.sqlg.test.BaseTest;
&nbsp;
&nbsp;import java.time.Duration;
&nbsp;import java.time.Period;
&nbsp;import java.time.ZonedDateTime;
&nbsp;import java.time.temporal.ChronoUnit;
&nbsp;import java.util.*;
&nbsp;import java.util.concurrent.CountDownLatch;
&nbsp;import java.util.concurrent.atomic.AtomicLong;
&nbsp;
&nbsp;/**
&nbsp; * Date: 2014/09/12
&nbsp; * Time: 5:14 PM
&nbsp; */
&nbsp;@SuppressWarnings({&quot;UnnecessaryBoxing&quot;, &quot;JavaDoc&quot;})
<b class="fc">&nbsp;public class TestBatch extends BaseTest {</b>
&nbsp;
&nbsp;    @BeforeClass
&nbsp;    public static void beforeClass() {
<b class="fc">&nbsp;        BaseTest.beforeClass();</b>
<b class="pc">&nbsp;        if (isPostgres()) {</b>
<b class="fc">&nbsp;            configuration.addProperty(&quot;distributed&quot;, true);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Before
&nbsp;    public void beforeTest() {
<b class="fc">&nbsp;        Assume.assumeTrue(this.sqlgGraph.getSqlDialect().supportsBatchMode());</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testBatchNormalModeEdgeMultiColumnProperties() {
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        ZonedDateTime now = ZonedDateTime.now();</b>
<b class="fc">&nbsp;        now = now.truncatedTo(ChronoUnit.MILLIS);</b>
<b class="fc">&nbsp;        Vertex a1 = this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;t&quot;, now);</b>
<b class="fc">&nbsp;        Vertex a2 = this.sqlgGraph.addVertex(T.label, &quot;A&quot;);</b>
<b class="fc">&nbsp;        a1.addEdge(&quot;ab&quot;, a2, &quot;t&quot;, now);</b>
<b class="fc">&nbsp;        a1.addEdge(&quot;ab&quot;, a2);</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        Assert.assertEquals(2, this.sqlgGraph.traversal().V().hasLabel(&quot;A&quot;).count().next(), 0);</b>
<b class="fc">&nbsp;        Assert.assertEquals(1, this.sqlgGraph.traversal().V().hasLabel(&quot;A&quot;).has(&quot;t&quot;, now).count().next(), 0);</b>
<b class="fc">&nbsp;        Assert.assertEquals(1, this.sqlgGraph.traversal().V().hasLabel(&quot;A&quot;).hasNot(&quot;t&quot;).count().next(), 0);</b>
<b class="fc">&nbsp;        Assert.assertEquals(2, this.sqlgGraph.traversal().E().hasLabel(&quot;ab&quot;).count().next(), 0);</b>
<b class="fc">&nbsp;        Assert.assertEquals(1, this.sqlgGraph.traversal().E().hasLabel(&quot;ab&quot;).has(&quot;t&quot;, now).count().next(), 0);</b>
<b class="fc">&nbsp;        Assert.assertEquals(1, this.sqlgGraph.traversal().E().hasLabel(&quot;ab&quot;).hasNot(&quot;t&quot;).count().next(), 0);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testBatchNormalModeMultiColumnProperties() {
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        ZonedDateTime now = ZonedDateTime.now();</b>
<b class="fc">&nbsp;        now = now.truncatedTo(ChronoUnit.MILLIS);</b>
<b class="fc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;t&quot;, now);</b>
<b class="fc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;A&quot;);</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        Assert.assertEquals(2, this.sqlgGraph.traversal().V().hasLabel(&quot;A&quot;).count().next(), 0);</b>
<b class="fc">&nbsp;        Assert.assertEquals(1, this.sqlgGraph.traversal().V().hasLabel(&quot;A&quot;).has(&quot;t&quot;, now).count().next(), 0);</b>
<b class="fc">&nbsp;        Assert.assertEquals(1, this.sqlgGraph.traversal().V().hasLabel(&quot;A&quot;).hasNot(&quot;t&quot;).count().next(), 0);</b>
&nbsp;
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;d&quot;, Duration.ofHours(1));</b>
<b class="fc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;A&quot;);</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        Assert.assertEquals(4, this.sqlgGraph.traversal().V().hasLabel(&quot;A&quot;).count().next(), 0);</b>
<b class="fc">&nbsp;        Assert.assertEquals(1, this.sqlgGraph.traversal().V().hasLabel(&quot;A&quot;).has(&quot;d&quot;, Duration.ofHours(1)).count().next(), 0);</b>
<b class="fc">&nbsp;        Assert.assertEquals(3, this.sqlgGraph.traversal().V().hasLabel(&quot;A&quot;).hasNot(&quot;d&quot;).count().next(), 0);</b>
&nbsp;
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;p&quot;, Period.of(1, 1, 1));</b>
<b class="fc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;A&quot;);</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        Assert.assertEquals(6, this.sqlgGraph.traversal().V().hasLabel(&quot;A&quot;).count().next(), 0);</b>
<b class="fc">&nbsp;        Assert.assertEquals(1, this.sqlgGraph.traversal().V().hasLabel(&quot;A&quot;).has(&quot;p&quot;, Period.of(1, 1, 1)).count().next(), 0);</b>
<b class="fc">&nbsp;        Assert.assertEquals(5, this.sqlgGraph.traversal().V().hasLabel(&quot;A&quot;).hasNot(&quot;p&quot;).count().next(), 0);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testBatchNormalModeFlushWrapsInQuotes() {
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        String vertexLabel = &quot;schem\&quot;a.tabl\&quot;e&quot;;</b>
<b class="fc">&nbsp;        String edgeLabel = &quot;edg\&quot;e&quot;;</b>
<b class="fc">&nbsp;        Vertex vertex1 = this.sqlgGraph.addVertex(T.label, vertexLabel, &quot;name&quot;, &quot;test1&quot;);</b>
<b class="fc">&nbsp;        Vertex vertex2 = this.sqlgGraph.addVertex(T.label, vertexLabel, &quot;name&quot;, &quot;test2&quot;);</b>
<b class="fc">&nbsp;        Edge edge = vertex1.addEdge(edgeLabel, vertex2);</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().flush();</b>
<b class="fc">&nbsp;        Assert.assertNotNull(vertex1.id());</b>
<b class="fc">&nbsp;        Assert.assertNotNull(vertex2.id());</b>
<b class="fc">&nbsp;        Assert.assertNotNull(edge.id());</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testBatchNormalModeFlushWrapsInQuotesSimple() {
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        String vertexLabel = &quot;B\&quot;B.B\&quot;B&quot;;</b>
<b class="fc">&nbsp;        Vertex vertex1 = this.sqlgGraph.addVertex(T.label, vertexLabel, &quot;name&quot;, &quot;test1&quot;);</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        Assert.assertNotNull(vertex1.id());</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testBatchNonUTF8Chars() {
<b class="fc">&nbsp;        Vertex v = sqlgGraph.addVertex(T.label, &quot;A&quot;);</b>
<b class="fc">&nbsp;        v.property(&quot;name&quot;, &quot;&lt;NULL&gt;&quot;);</b>
<b class="fc">&nbsp;        v.property(&quot;value&quot;, &quot;Rio’s Supermarket&quot;);</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        for (int i = 0; i &lt; 1000; i++) {</b>
<b class="fc">&nbsp;            v = sqlgGraph.addVertex(T.label, &quot;A&quot;);</b>
<b class="fc">&nbsp;            v.property(&quot;name&quot;, &quot;&lt;NULL&gt;&quot;);</b>
<b class="fc">&nbsp;            v.property(&quot;value&quot;, &quot;Rio’s Supermarket&quot;);</b>
&nbsp;        }
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        Assert.assertEquals(1001, this.sqlgGraph.traversal().V().hasLabel(&quot;A&quot;).has(&quot;value&quot;, &quot;Rio’s Supermarket&quot;).count().next(), 0);</b>
<b class="fc">&nbsp;        Assert.assertEquals(1001, this.sqlgGraph.traversal().V().hasLabel(&quot;A&quot;).has(&quot;name&quot;, &quot;&lt;NULL&gt;&quot;).count().next(), 0);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testNullProperties() throws InterruptedException {
<b class="fc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;John&quot;, &quot;surname&quot;, &quot;Smith&quot;);</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        Vertex v1 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;John1&quot;);</b>
<b class="fc">&nbsp;        Vertex v2 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;surname&quot;, &quot;Smith2&quot;);</b>
<b class="fc">&nbsp;        Vertex v3 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;&quot;);</b>
<b class="fc">&nbsp;        Vertex v4 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;\&quot;\&quot;&quot;);</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        testNullProperties_assert(this.sqlgGraph, v1, v2, v3, v4);</b>
<b class="pc">&nbsp;        if (this.sqlgGraph1 != null) {</b>
<b class="fc">&nbsp;            Thread.sleep(1000);</b>
<b class="fc">&nbsp;            testNullProperties_assert(this.sqlgGraph1, v1, v2, v3, v4);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void testNullProperties_assert(SqlgGraph sqlgGraph, Vertex v1, Vertex v2, Vertex v3, Vertex v4) {
<b class="fc">&nbsp;        Assert.assertNull(sqlgGraph.traversal().V(v1.id()).next().property(&quot;surname&quot;).value());</b>
<b class="fc">&nbsp;        Assert.assertNull(sqlgGraph.traversal().V(v2.id()).next().property(&quot;name&quot;).value());</b>
<b class="fc">&nbsp;        Assert.assertEquals(&quot;&quot;, sqlgGraph.traversal().V(v3.id()).next().property(&quot;name&quot;).value());</b>
<b class="fc">&nbsp;        Assert.assertEquals(&quot;\&quot;\&quot;&quot;, sqlgGraph.traversal().V(v4.id()).next().property(&quot;name&quot;).value());</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testQueryWhileInserting() throws InterruptedException {
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        for (int i = 1; i &lt; 101; i++) {</b>
<b class="fc">&nbsp;            Vertex a = this.sqlgGraph.addVertex(T.label, &quot;A&quot;);</b>
<b class="fc">&nbsp;            Vertex b1 = this.sqlgGraph.addVertex(T.label, &quot;B&quot;);</b>
<b class="fc">&nbsp;            Vertex b2 = this.sqlgGraph.addVertex(T.label, &quot;B&quot;);</b>
<b class="fc">&nbsp;            a.addEdge(&quot;ab&quot;, b1);</b>
<b class="fc">&nbsp;            a.addEdge(&quot;ab&quot;, b2);</b>
<b class="fc">&nbsp;            if (i % 10 == 0) {</b>
<b class="fc">&nbsp;                Assert.assertEquals(2, IteratorUtils.count(a.edges(Direction.OUT, &quot;ab&quot;)));</b>
<b class="fc">&nbsp;                Assert.assertEquals(2, IteratorUtils.count(a.vertices(Direction.OUT, &quot;ab&quot;)));</b>
&nbsp;            }
&nbsp;        }
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        testQueryWhileInserting_assert(this.sqlgGraph);</b>
<b class="pc">&nbsp;        if (this.sqlgGraph1 != null) {</b>
<b class="fc">&nbsp;            Thread.sleep(1000);</b>
<b class="fc">&nbsp;            testQueryWhileInserting_assert(this.sqlgGraph1);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void testQueryWhileInserting_assert(SqlgGraph sqlgGraph) {
<b class="fc">&nbsp;        Assert.assertEquals(100, sqlgGraph.traversal().V().hasLabel(&quot;A&quot;).count().next().intValue());</b>
<b class="fc">&nbsp;        Assert.assertEquals(200, sqlgGraph.traversal().V().hasLabel(&quot;B&quot;).count().next().intValue());</b>
<b class="fc">&nbsp;        Assert.assertEquals(200, sqlgGraph.traversal().E().hasLabel(&quot;ab&quot;).count().next().intValue());</b>
<b class="fc">&nbsp;        sqlgGraph.traversal().V().hasLabel(&quot;A&quot;).forEachRemaining(v -&gt; Assert.assertEquals(2, sqlgGraph.traversal().V(v).out(&quot;ab&quot;).count().next().intValue()));</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testRemoveWhileInserting() throws InterruptedException {
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        Set&lt;Vertex&gt; toRemove = new HashSet&lt;&gt;();</b>
<b class="fc">&nbsp;        for (int i = 1; i &lt; 101; i++) {</b>
<b class="fc">&nbsp;            Vertex a = this.sqlgGraph.addVertex(T.label, &quot;A&quot;);</b>
<b class="fc">&nbsp;            Vertex b1 = this.sqlgGraph.addVertex(T.label, &quot;B&quot;);</b>
<b class="fc">&nbsp;            Vertex b2 = this.sqlgGraph.addVertex(T.label, &quot;B&quot;);</b>
<b class="fc">&nbsp;            a.addEdge(&quot;ab&quot;, b1);</b>
<b class="fc">&nbsp;            a.addEdge(&quot;ab&quot;, b2);</b>
<b class="fc">&nbsp;            if (i % 10 == 0) {</b>
<b class="fc">&nbsp;                toRemove.add(a);</b>
&nbsp;            }
&nbsp;        }
<b class="fc">&nbsp;        for (Vertex vertex : toRemove) {</b>
<b class="fc">&nbsp;            vertex.remove();</b>
&nbsp;        }
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        testRemovalWhileInserting_assert(this.sqlgGraph);</b>
<b class="pc">&nbsp;        if (this.sqlgGraph1 != null) {</b>
<b class="fc">&nbsp;            Thread.sleep(1000);</b>
<b class="fc">&nbsp;            testRemovalWhileInserting_assert(this.sqlgGraph1);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void testRemovalWhileInserting_assert(SqlgGraph sqlgGraph) {
<b class="fc">&nbsp;        Assert.assertEquals(90, sqlgGraph.traversal().V().hasLabel(&quot;A&quot;).count().next().intValue());</b>
<b class="fc">&nbsp;        Assert.assertEquals(200, sqlgGraph.traversal().V().hasLabel(&quot;B&quot;).count().next().intValue());</b>
<b class="fc">&nbsp;        Assert.assertEquals(180, sqlgGraph.traversal().E().hasLabel(&quot;ab&quot;).count().next().intValue());</b>
<b class="fc">&nbsp;        sqlgGraph.traversal().V().hasLabel(&quot;A&quot;).forEachRemaining(v -&gt; Assert.assertEquals(2, sqlgGraph.traversal().V(v).out(&quot;ab&quot;).count().next().intValue()));</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testEscapingCharacters() throws InterruptedException {
<b class="fc">&nbsp;        StopWatch stopWatch = new StopWatch();</b>
<b class="fc">&nbsp;        stopWatch.start();</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        for (int i = 0; i &lt; 10000; i++) {</b>
<b class="fc">&nbsp;            Vertex v1 = this.sqlgGraph.addVertex(T.label, &quot;MO1&quot;, &quot;name&quot;, &quot;marko&quot; + i, &quot;test1&quot;, &quot;\\&quot;, &quot;test2&quot;, &quot;\nhalo&quot;, &quot;test3&quot;, &quot;\rhalo&quot;, &quot;test4&quot;, &quot;\thalo&quot;);</b>
<b class="fc">&nbsp;            Vertex v2 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;marko&quot; + i, &quot;test1&quot;, &quot;\\&quot;, &quot;test2&quot;, &quot;\nhalo&quot;, &quot;test3&quot;, &quot;\rhalo&quot;, &quot;test4&quot;, &quot;\thalo&quot;);</b>
<b class="fc">&nbsp;            v1.addEdge(&quot;Friend&quot;, v2, &quot;name&quot;, &quot;xxx&quot;);</b>
&nbsp;        }
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        stopWatch.stop();</b>
<b class="fc">&nbsp;        testEscapingCharacters_assert(this.sqlgGraph);</b>
<b class="pc">&nbsp;        if (this.sqlgGraph1 != null) {</b>
<b class="fc">&nbsp;            Thread.sleep(1000);</b>
<b class="fc">&nbsp;            testEscapingCharacters_assert(this.sqlgGraph1);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void testEscapingCharacters_assert(SqlgGraph sqlgGraph) {
<b class="fc">&nbsp;        Assert.assertEquals(20000, sqlgGraph.traversal().V().count().next(), 0);</b>
<b class="fc">&nbsp;        Assert.assertEquals(10000, sqlgGraph.traversal().E().count().next(), 0);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testVerticesBatchOn() throws InterruptedException {
<b class="fc">&nbsp;        StopWatch stopWatch = new StopWatch();</b>
<b class="fc">&nbsp;        stopWatch.start();</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        for (int i = 0; i &lt; 10000; i++) {</b>
<b class="fc">&nbsp;            Vertex v1 = this.sqlgGraph.addVertex(T.label, &quot;MO1&quot;, &quot;name&quot;, &quot;marko&quot; + i);</b>
<b class="fc">&nbsp;            Vertex v2 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;marko&quot; + i);</b>
<b class="fc">&nbsp;            v1.addEdge(&quot;Friend&quot;, v2, &quot;name&quot;, &quot;xxx&quot;);</b>
&nbsp;        }
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        stopWatch.stop();</b>
<b class="fc">&nbsp;        testVerticesBatchOn_assert(this.sqlgGraph);</b>
<b class="pc">&nbsp;        if (this.sqlgGraph1 != null) {</b>
<b class="fc">&nbsp;            Thread.sleep(1000);</b>
<b class="fc">&nbsp;            testVerticesBatchOn_assert(this.sqlgGraph1);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void testVerticesBatchOn_assert(SqlgGraph sqlgGraph) {
<b class="fc">&nbsp;        Assert.assertEquals(20000, sqlgGraph.traversal().V().count().next(), 0);</b>
<b class="fc">&nbsp;        Assert.assertEquals(10000, sqlgGraph.traversal().E().count().next(), 0);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testBatchEdgesManyProperties() throws InterruptedException {
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        Vertex v1 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;marko&quot;);</b>
<b class="fc">&nbsp;        Vertex v2 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;peter&quot;);</b>
<b class="fc">&nbsp;        Vertex v3 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;john&quot;);</b>
<b class="fc">&nbsp;        v1.addEdge(&quot;Friend&quot;, v2, &quot;weight&quot;, 1, &quot;test&quot;, &quot;a&quot;);</b>
<b class="fc">&nbsp;        v1.addEdge(&quot;Friend&quot;, v3, &quot;weight&quot;, 2, &quot;test&quot;, &quot;b&quot;);</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        testBatchEdgesManyProperties_assert(this.sqlgGraph, v1, v2, v3);</b>
<b class="pc">&nbsp;        if (this.sqlgGraph1 != null) {</b>
<b class="fc">&nbsp;            Thread.sleep(1000);</b>
<b class="fc">&nbsp;            testBatchEdgesManyProperties_assert(this.sqlgGraph1, v1, v2, v3);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void testBatchEdgesManyProperties_assert(SqlgGraph sqlgGraph, Vertex v1, Vertex v2, Vertex v3) {
<b class="fc">&nbsp;        Assert.assertEquals(3, sqlgGraph.traversal().V().count().next(), 0);</b>
<b class="fc">&nbsp;        Assert.assertEquals(2, sqlgGraph.traversal().V(v1.id()).out(&quot;Friend&quot;).count().next(), 0);</b>
<b class="fc">&nbsp;        Assert.assertTrue(sqlgGraph.traversal().V(v1.id()).out(&quot;Friend&quot;).toList().contains(v2));</b>
<b class="fc">&nbsp;        Assert.assertTrue(sqlgGraph.traversal().V(v1.id()).out(&quot;Friend&quot;).toList().contains(v3));</b>
<b class="fc">&nbsp;        Assert.assertTrue(sqlgGraph.traversal().V(v2.id()).in(&quot;Friend&quot;).toList().contains(v1));</b>
<b class="fc">&nbsp;        Assert.assertTrue(sqlgGraph.traversal().V(v3.id()).in(&quot;Friend&quot;).toList().contains(v1));</b>
<b class="fc">&nbsp;        Assert.assertEquals(1, sqlgGraph.traversal().E().hasLabel(&quot;Friend&quot;).has(&quot;test&quot;, &quot;a&quot;).count().next(), 0);</b>
<b class="fc">&nbsp;        Assert.assertEquals(1, sqlgGraph.traversal().E().hasLabel(&quot;Friend&quot;).has(&quot;test&quot;, &quot;b&quot;).count().next(), 0);</b>
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;    @Test
&nbsp;    public void testBatchEdgesDifferentProperties() {
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        Vertex v1 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;marko&quot;);</b>
<b class="fc">&nbsp;        Vertex v2 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;peter&quot;);</b>
<b class="fc">&nbsp;        Vertex v3 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;john&quot;);</b>
<b class="fc">&nbsp;        v1.addEdge(&quot;Friend&quot;, v2, &quot;weight&quot;, 1, &quot;test1&quot;, &quot;a&quot;);</b>
<b class="fc">&nbsp;        v1.addEdge(&quot;Friend&quot;, v3, &quot;weight&quot;, 2, &quot;test1&quot;, &quot;a&quot;, &quot;test2&quot;, &quot;b&quot;);</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testBatchVertexDifferentProperties() throws InterruptedException {
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        Vertex v1 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;marko&quot;, &quot;test1&quot;, &quot;a&quot;);</b>
<b class="fc">&nbsp;        Vertex v2 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;peter&quot;, &quot;test2&quot;, &quot;b&quot;);</b>
<b class="fc">&nbsp;        Vertex v3 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;john&quot;, &quot;test3&quot;, &quot;c&quot;, &quot;test4&quot;, &quot;d&quot;);</b>
<b class="fc">&nbsp;        v1.addEdge(&quot;Friend&quot;, v2, &quot;weight&quot;, 1);</b>
<b class="fc">&nbsp;        v1.addEdge(&quot;Friend&quot;, v3, &quot;weight&quot;, 2);</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        testBatchVertexDifferentProperties_assert(this.sqlgGraph);</b>
<b class="pc">&nbsp;        if (this.sqlgGraph1 != null) {</b>
<b class="fc">&nbsp;            Thread.sleep(1000);</b>
<b class="fc">&nbsp;            testBatchVertexDifferentProperties_assert(this.sqlgGraph1);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void testBatchVertexDifferentProperties_assert(SqlgGraph sqlgGraph) {
<b class="fc">&nbsp;        Vertex marko = sqlgGraph.traversal().V().hasLabel(&quot;Person&quot;).has(&quot;name&quot;, &quot;marko&quot;).next();</b>
<b class="fc">&nbsp;        Assert.assertEquals(&quot;a&quot;, marko.value(&quot;test1&quot;));</b>
<b class="fc">&nbsp;        Assert.assertNull(marko.property(&quot;test2&quot;).value());</b>
<b class="fc">&nbsp;        Assert.assertNull(marko.property(&quot;test3&quot;).value());</b>
<b class="fc">&nbsp;        Vertex peter = sqlgGraph.traversal().V().hasLabel(&quot;Person&quot;).has(&quot;name&quot;, &quot;peter&quot;).next();</b>
<b class="fc">&nbsp;        Assert.assertEquals(&quot;b&quot;, peter.value(&quot;test2&quot;));</b>
<b class="fc">&nbsp;        Assert.assertNull(peter.property(&quot;test1&quot;).value());</b>
<b class="fc">&nbsp;        Assert.assertNull(peter.property(&quot;test3&quot;).value());</b>
<b class="fc">&nbsp;        Vertex john = sqlgGraph.traversal().V().hasLabel(&quot;Person&quot;).has(&quot;name&quot;, &quot;john&quot;).next();</b>
<b class="fc">&nbsp;        Assert.assertEquals(&quot;c&quot;, john.value(&quot;test3&quot;));</b>
<b class="fc">&nbsp;        Assert.assertNull(john.property(&quot;test1&quot;).value());</b>
<b class="fc">&nbsp;        Assert.assertNull(john.property(&quot;test2&quot;).value());</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testBatchVertices() throws InterruptedException {
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        Vertex v1 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;marko&quot;);</b>
<b class="fc">&nbsp;        Vertex v2 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;peter&quot;);</b>
<b class="fc">&nbsp;        Vertex v3 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;john&quot;);</b>
<b class="fc">&nbsp;        v1.addEdge(&quot;Friend&quot;, v2, &quot;weight&quot;, 1);</b>
<b class="fc">&nbsp;        v1.addEdge(&quot;Friend&quot;, v3, &quot;weight&quot;, 2);</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        testBatchVertices_assert(this.sqlgGraph, v1, v2, v3);</b>
<b class="pc">&nbsp;        if (this.sqlgGraph1 != null) {</b>
<b class="fc">&nbsp;            Thread.sleep(1000);</b>
<b class="fc">&nbsp;            testBatchVertices_assert(this.sqlgGraph1, v1, v2, v3);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void testBatchVertices_assert(SqlgGraph sqlgGraph, Vertex v1, Vertex v2, Vertex v3) {
<b class="fc">&nbsp;        Assert.assertEquals(3, sqlgGraph.traversal().V().count().next(), 0);</b>
<b class="fc">&nbsp;        Assert.assertEquals(2, sqlgGraph.traversal().V(v1.id()).out(&quot;Friend&quot;).count().next(), 0);</b>
<b class="fc">&nbsp;        Assert.assertTrue(sqlgGraph.traversal().V(v1.id()).out(&quot;Friend&quot;).toList().contains(v2));</b>
<b class="fc">&nbsp;        Assert.assertTrue(sqlgGraph.traversal().V(v1.id()).out(&quot;Friend&quot;).toList().contains(v3));</b>
<b class="fc">&nbsp;        Assert.assertTrue(sqlgGraph.traversal().V(v2.id()).in(&quot;Friend&quot;).toList().contains(v1));</b>
<b class="fc">&nbsp;        Assert.assertTrue(sqlgGraph.traversal().V(v3.id()).in(&quot;Friend&quot;).toList().contains(v1));</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testBatchModeNeedsCleanTransactionPass() throws InterruptedException {
<b class="fc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;dummy&quot;, &quot;a&quot;);</b>
<b class="fc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;dummy&quot;, &quot;a&quot;);</b>
<b class="fc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;dummy&quot;, &quot;a&quot;);</b>
<b class="fc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;dummy&quot;, &quot;a&quot;);</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().rollback();</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;dummy&quot;, &quot;a&quot;);</b>
<b class="fc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;dummy&quot;, &quot;a&quot;);</b>
<b class="fc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;dummy&quot;, &quot;a&quot;);</b>
<b class="fc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;dummy&quot;, &quot;a&quot;);</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        Assert.assertEquals(4, this.sqlgGraph.traversal().V().count().next(), 0);</b>
<b class="pc">&nbsp;        if (this.sqlgGraph1 != null) {</b>
<b class="fc">&nbsp;            Thread.sleep(1000);</b>
<b class="fc">&nbsp;            Assert.assertEquals(4, this.sqlgGraph1.traversal().V().count().next(), 0);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    //this test a &#39;contains&#39; bug in the update of labels batch logic
&nbsp;    @Test
&nbsp;    public void testBatchUpdateOfLabels() {
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        Vertex v1 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;mike&quot;);</b>
<b class="fc">&nbsp;        Vertex v2 = this.sqlgGraph.addVertex(T.label, &quot;Car&quot;, &quot;name&quot;, &quot;bmw&quot;);</b>
<b class="fc">&nbsp;        Vertex v3 = this.sqlgGraph.addVertex(T.label, &quot;Car&quot;, &quot;name&quot;, &quot;bmw&quot;);</b>
<b class="fc">&nbsp;        Vertex v4 = this.sqlgGraph.addVertex(T.label, &quot;Bike&quot;, &quot;name&quot;, &quot;ktm&quot;);</b>
<b class="fc">&nbsp;        v1.addEdge(&quot;bts_aaaaaa&quot;, v2);</b>
<b class="fc">&nbsp;        v1.addEdge(&quot;bts_btsalmtos&quot;, v4);</b>
<b class="fc">&nbsp;        v1.addEdge(&quot;bts_btsalm&quot;, v3);</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        this.sqlgGraph.close();</b>
<b class="fc">&nbsp;        try (SqlgGraph sqlgGraph = SqlgGraph.open(configuration)) {</b>
<b class="fc">&nbsp;            v1 = sqlgGraph.traversal().V(v1.id()).next();</b>
<b class="fc">&nbsp;            Assert.assertEquals(1, sqlgGraph.traversal().V(v1.id()).out(&quot;bts_btsalm&quot;).count().next().intValue());</b>
<b class="fc">&nbsp;            Assert.assertEquals(1, sqlgGraph.traversal().V(v1.id()).out(&quot;bts_btsalmtos&quot;).count().next().intValue());</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * The copy command locks the copy to table.
&nbsp;     * This is great as there is no need to worry about the elements not having sequential ids generated.
&nbsp;     * This test that this is indeed the case.
&nbsp;     * Cars only go in after Persons
&nbsp;     *
&nbsp;     * @throws InterruptedException
&nbsp;     */
&nbsp;    @Test
&nbsp;    public void testEdgeCopyHappensInIsolation() throws InterruptedException {
&nbsp;
&nbsp;        //This is needed else the schema manager lock on creating schemas
<b class="fc">&nbsp;        this.sqlgGraph.addVertex();</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        AtomicLong lastPerson = new AtomicLong();</b>
<b class="fc">&nbsp;        AtomicLong lastCar = new AtomicLong();</b>
&nbsp;
&nbsp;
<b class="fc">&nbsp;        CountDownLatch firstLatch = new CountDownLatch(1);</b>
<b class="fc">&nbsp;        final Thread thread1 = new Thread(() -&gt; {</b>
&nbsp;            try {
<b class="fc">&nbsp;                sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;                for (int i = 0; i &lt; 100000; i++) {</b>
<b class="fc">&nbsp;                    Vertex v1 = sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;dummy&quot;, &quot;a&quot;);</b>
<b class="fc">&nbsp;                    Vertex v2 = sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;dummy&quot;, &quot;a&quot;);</b>
<b class="fc">&nbsp;                    v1.addEdge(&quot;Friend&quot;, v2);</b>
&nbsp;                }
<b class="fc">&nbsp;                firstLatch.countDown();</b>
<b class="fc">&nbsp;                sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;                List&lt;Vertex&gt; persons = sqlgGraph.traversal().V().has(T.label, &quot;Person&quot;).toList();</b>
<b class="fc">&nbsp;                lastPerson.set(persons.size());</b>
&nbsp;            } catch (Exception e) {
<b class="nc">&nbsp;                e.printStackTrace();</b>
<b class="nc">&nbsp;                Assert.fail(e.getMessage());</b>
&nbsp;            } finally {
<b class="fc">&nbsp;                sqlgGraph.tx().rollback();</b>
&nbsp;            }
&nbsp;
&nbsp;        });
<b class="fc">&nbsp;        thread1.start();</b>
<b class="fc">&nbsp;        final Thread thread2 = new Thread(() -&gt; {</b>
&nbsp;            try {
<b class="fc">&nbsp;                firstLatch.await();</b>
&nbsp;            } catch (InterruptedException e) {
<b class="nc">&nbsp;                e.printStackTrace();</b>
<b class="nc">&nbsp;                Assert.fail(e.getMessage());</b>
&nbsp;            }
<b class="fc">&nbsp;            Vertex v1 = sqlgGraph.addVertex(T.label, &quot;Car&quot;, &quot;dummy&quot;, &quot;a&quot;);</b>
<b class="fc">&nbsp;            Vertex v2 = sqlgGraph.addVertex(T.label, &quot;Car&quot;, &quot;dummy&quot;, &quot;a&quot;);</b>
<b class="fc">&nbsp;            v1.addEdge(&quot;Same&quot;, v2);</b>
<b class="fc">&nbsp;            sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;            List&lt;Vertex&gt; cars = sqlgGraph.traversal().V().has(T.label, &quot;Car&quot;).toList();</b>
<b class="fc">&nbsp;            lastCar.set(cars.size());</b>
&nbsp;        });
<b class="fc">&nbsp;        thread2.start();</b>
<b class="fc">&nbsp;        thread1.join();</b>
<b class="fc">&nbsp;        thread2.join();</b>
<b class="fc">&nbsp;        Assert.assertEquals(200000, lastPerson.get());</b>
<b class="fc">&nbsp;        Assert.assertEquals(2, lastCar.get());</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testVertexProperties() {
<b class="fc">&nbsp;        List&lt;Short&gt; shortList = new ArrayList&lt;&gt;();</b>
<b class="fc">&nbsp;        List&lt;Integer&gt; integerList = new ArrayList&lt;&gt;();</b>
<b class="fc">&nbsp;        List&lt;Long&gt; longList = new ArrayList&lt;&gt;();</b>
<b class="fc">&nbsp;        List&lt;Double&gt; doubleList = new ArrayList&lt;&gt;();</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        for (int i = 0; i &lt; 100; i++) {</b>
<b class="fc">&nbsp;            this.sqlgGraph.addVertex(T.label, &quot;Person&quot;,</b>
<b class="fc">&nbsp;                    &quot;age2&quot;, (short) i,</b>
<b class="fc">&nbsp;                    &quot;age3&quot;, i,</b>
<b class="fc">&nbsp;                    &quot;age4&quot;, Long.valueOf(i),</b>
<b class="fc">&nbsp;                    &quot;age6&quot;, Double.valueOf(i)</b>
&nbsp;            );
<b class="fc">&nbsp;            shortList.add((short) i);</b>
<b class="fc">&nbsp;            integerList.add(Integer.valueOf(i));</b>
<b class="fc">&nbsp;            longList.add(Long.valueOf(i));</b>
<b class="fc">&nbsp;            doubleList.add(Double.valueOf(i));</b>
&nbsp;        }
<b class="fc">&nbsp;        Assert.assertEquals(100, shortList.size());</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        List&lt;Vertex&gt; vertices = this.sqlgGraph.traversal().V().toList();</b>
<b class="fc">&nbsp;        for (Vertex v : vertices) {</b>
<b class="fc">&nbsp;            shortList.remove(v.&lt;Short&gt;value(&quot;age2&quot;));</b>
<b class="fc">&nbsp;            integerList.remove(v.&lt;Integer&gt;value(&quot;age3&quot;));</b>
<b class="fc">&nbsp;            longList.remove(v.&lt;Long&gt;value(&quot;age4&quot;));</b>
<b class="fc">&nbsp;            doubleList.remove(v.&lt;Double&gt;value(&quot;age6&quot;));</b>
&nbsp;        }
<b class="fc">&nbsp;        Assert.assertTrue(shortList.isEmpty());</b>
<b class="fc">&nbsp;        Assert.assertTrue(integerList.isEmpty());</b>
<b class="fc">&nbsp;        Assert.assertTrue(longList.isEmpty());</b>
<b class="fc">&nbsp;        Assert.assertTrue(doubleList.isEmpty());</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testEdgeProperties() throws InterruptedException {
<b class="fc">&nbsp;        List&lt;Short&gt; shortList = new ArrayList&lt;&gt;();</b>
<b class="fc">&nbsp;        List&lt;Integer&gt; integerList = new ArrayList&lt;&gt;();</b>
<b class="fc">&nbsp;        List&lt;Long&gt; longList = new ArrayList&lt;&gt;();</b>
<b class="fc">&nbsp;        List&lt;Double&gt; doubleList = new ArrayList&lt;&gt;();</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        for (int i = 0; i &lt; 100; i++) {</b>
<b class="fc">&nbsp;            Vertex v1 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;marko&quot;);</b>
<b class="fc">&nbsp;            Vertex v2 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;john&quot;);</b>
<b class="fc">&nbsp;            v1.addEdge(&quot;Friend&quot;, v2,</b>
<b class="fc">&nbsp;                    &quot;age2&quot;, (short) i,</b>
<b class="fc">&nbsp;                    &quot;age3&quot;, i,</b>
<b class="fc">&nbsp;                    &quot;age4&quot;, Long.valueOf(i),</b>
<b class="fc">&nbsp;                    &quot;age6&quot;, Double.valueOf(i)</b>
&nbsp;            );
<b class="fc">&nbsp;            shortList.add((short) i);</b>
<b class="fc">&nbsp;            integerList.add(Integer.valueOf(i));</b>
<b class="fc">&nbsp;            longList.add(Long.valueOf(i));</b>
<b class="fc">&nbsp;            doubleList.add(Double.valueOf(i));</b>
&nbsp;        }
<b class="fc">&nbsp;        Assert.assertEquals(100, shortList.size());</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        testEdgeProperties_assert(this.sqlgGraph, shortList, integerList, longList, doubleList);</b>
<b class="pc">&nbsp;        if (this.sqlgGraph1 != null) {</b>
<b class="fc">&nbsp;            Thread.sleep(1000);</b>
<b class="fc">&nbsp;            testEdgeProperties_assert(this.sqlgGraph1, shortList, integerList, longList, doubleList);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void testEdgeProperties_assert(SqlgGraph sqlgGraph, List&lt;Short&gt; shortList, List&lt;Integer&gt; integerList, List&lt;Long&gt; longList, List&lt;Double&gt; doubleList) {
<b class="fc">&nbsp;        List&lt;Edge&gt; edges = sqlgGraph.traversal().E().toList();</b>
<b class="fc">&nbsp;        for (Edge e : edges) {</b>
<b class="fc">&nbsp;            shortList.remove(e.&lt;Short&gt;value(&quot;age2&quot;));</b>
<b class="fc">&nbsp;            integerList.remove(e.&lt;Integer&gt;value(&quot;age3&quot;));</b>
<b class="fc">&nbsp;            longList.remove(e.&lt;Long&gt;value(&quot;age4&quot;));</b>
<b class="fc">&nbsp;            doubleList.remove(e.&lt;Double&gt;value(&quot;age6&quot;));</b>
&nbsp;        }
<b class="fc">&nbsp;        Assert.assertTrue(shortList.isEmpty());</b>
<b class="fc">&nbsp;        Assert.assertTrue(integerList.isEmpty());</b>
<b class="fc">&nbsp;        Assert.assertTrue(longList.isEmpty());</b>
<b class="fc">&nbsp;        Assert.assertTrue(doubleList.isEmpty());</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testUpdateInsertedVertexProperty() throws InterruptedException {
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        Vertex v1 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;marko&quot;);</b>
<b class="fc">&nbsp;        v1.property(&quot;name&quot;, &quot;john&quot;);</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        testUpdateInsertedVertexProperty_assert(this.sqlgGraph, v1);</b>
<b class="pc">&nbsp;        if (this.sqlgGraph1 != null) {</b>
<b class="fc">&nbsp;            Thread.sleep(1000);</b>
<b class="fc">&nbsp;            testUpdateInsertedVertexProperty_assert(this.sqlgGraph1, v1);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void testUpdateInsertedVertexProperty_assert(SqlgGraph sqlgGraph, Vertex v1) {
<b class="fc">&nbsp;        Assert.assertEquals(&quot;john&quot;, v1.value(&quot;name&quot;));</b>
<b class="fc">&nbsp;        Assert.assertEquals(&quot;john&quot;, sqlgGraph.traversal().V().next().value(&quot;name&quot;));</b>
<b class="fc">&nbsp;        v1 = sqlgGraph.traversal().V(v1.id()).next();</b>
<b class="fc">&nbsp;        Assert.assertEquals(&quot;john&quot;, v1.value(&quot;name&quot;));</b>
<b class="fc">&nbsp;        Assert.assertEquals(&quot;john&quot;, sqlgGraph.traversal().V().next().value(&quot;name&quot;));</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testAddPropertyToInsertedVertexProperty() throws InterruptedException {
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        Vertex v1 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;marko&quot;);</b>
<b class="fc">&nbsp;        v1.property(&quot;name&quot;, &quot;john&quot;);</b>
<b class="fc">&nbsp;        v1.property(&quot;surname&quot;, &quot;aaaa&quot;);</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        testAddPropertyToInsertVertexProperty_assert(this.sqlgGraph, v1);</b>
<b class="pc">&nbsp;        if (this.sqlgGraph1 != null) {</b>
<b class="fc">&nbsp;            Thread.sleep(1000);</b>
<b class="fc">&nbsp;            testAddPropertyToInsertVertexProperty_assert(this.sqlgGraph1, v1);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void testAddPropertyToInsertVertexProperty_assert(SqlgGraph sqlgGraph, Vertex v1) {
<b class="fc">&nbsp;        v1 = sqlgGraph.traversal().V(v1.id()).next();</b>
<b class="fc">&nbsp;        Assert.assertEquals(&quot;john&quot;, v1.value(&quot;name&quot;));</b>
<b class="fc">&nbsp;        Assert.assertEquals(&quot;aaaa&quot;, v1.value(&quot;surname&quot;));</b>
<b class="fc">&nbsp;        Assert.assertEquals(&quot;john&quot;, sqlgGraph.traversal().V().next().value(&quot;name&quot;));</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testUpdateInsertedEdgeProperty() throws InterruptedException {
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        Vertex v1 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;marko&quot;);</b>
<b class="fc">&nbsp;        Vertex v2 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;john&quot;);</b>
<b class="fc">&nbsp;        Edge edge = v1.addEdge(&quot;Friend&quot;, v2, &quot;weight&quot;, 1);</b>
<b class="fc">&nbsp;        edge.property(&quot;weight&quot;, 2);</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        testUpdateInsertedEdgeProperty_assert(this.sqlgGraph, edge);</b>
<b class="pc">&nbsp;        if (this.sqlgGraph1 != null) {</b>
<b class="fc">&nbsp;            Thread.sleep(1000);</b>
<b class="fc">&nbsp;            testUpdateInsertedEdgeProperty_assert(this.sqlgGraph1, edge);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void testUpdateInsertedEdgeProperty_assert(SqlgGraph sqlgGraph, Edge edge) {
<b class="fc">&nbsp;        Assert.assertEquals(2, edge.&lt;Integer&gt;value(&quot;weight&quot;), 0);</b>
<b class="fc">&nbsp;        Assert.assertEquals(2, sqlgGraph.traversal().E().next().&lt;Integer&gt;value(&quot;weight&quot;), 0);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    //TODO need to deal with missing properties, set them to null
&nbsp;    public void testRemoveProperty() throws InterruptedException {
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        Vertex marko = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;marko&quot;);</b>
<b class="fc">&nbsp;        Vertex john = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;john&quot;);</b>
<b class="fc">&nbsp;        marko.addEdge(&quot;Friend&quot;, john, &quot;weight&quot;, 1);</b>
<b class="fc">&nbsp;        Edge colleague = marko.addEdge(&quot;Colleague&quot;, john, &quot;toRemove&quot;, &quot;a&quot;);</b>
<b class="fc">&nbsp;        marko.property(&quot;name&quot;).remove();</b>
<b class="fc">&nbsp;        colleague.property(&quot;toRemove&quot;).remove();</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;
<b class="fc">&nbsp;        testRemoveProperty_assert(this.sqlgGraph, marko);</b>
<b class="pc">&nbsp;        if (this.sqlgGraph1 != null) {</b>
<b class="fc">&nbsp;            Thread.sleep(1000);</b>
<b class="fc">&nbsp;            testRemoveProperty_assert(this.sqlgGraph1, marko);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    //TODO need to deal with missing properties, set them to null
&nbsp;    public void testRemovePropertyUserSuppliedPK() throws InterruptedException {
<b class="fc">&nbsp;        VertexLabel personVertexLabel = this.sqlgGraph.getTopology().getPublicSchema()</b>
<b class="fc">&nbsp;                .ensureVertexLabelExist(</b>
&nbsp;                        &quot;Person&quot;,
<b class="fc">&nbsp;                        new HashMap&lt;&gt;() {{</b>
<b class="fc">&nbsp;                            put(&quot;uid1&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="fc">&nbsp;                            put(&quot;uid2&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="fc">&nbsp;                            put(&quot;name&quot;, PropertyDefinition.of(PropertyType.STRING));</b>
&nbsp;                        }},
<b class="fc">&nbsp;                        ListOrderedSet.listOrderedSet(Arrays.asList(&quot;uid1&quot;, &quot;uid2&quot;))</b>
&nbsp;                );
<b class="fc">&nbsp;        personVertexLabel.ensureEdgeLabelExist(</b>
&nbsp;                &quot;Friend&quot;,
&nbsp;                personVertexLabel,
<b class="fc">&nbsp;                new HashMap&lt;&gt;() {{</b>
<b class="fc">&nbsp;                    put(&quot;uid1&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="fc">&nbsp;                    put(&quot;uid2&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="fc">&nbsp;                    put(&quot;weight&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                }}
&nbsp;        );
<b class="fc">&nbsp;        personVertexLabel.ensureEdgeLabelExist(</b>
&nbsp;                &quot;Colleague&quot;,
&nbsp;                personVertexLabel,
<b class="fc">&nbsp;                new HashMap&lt;&gt;() {{</b>
<b class="fc">&nbsp;                    put(&quot;uid1&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="fc">&nbsp;                    put(&quot;uid2&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="fc">&nbsp;                    put(&quot;toRemove&quot;, PropertyDefinition.of(PropertyType.STRING));</b>
&nbsp;                }}
&nbsp;        );
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        Vertex marko = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;marko&quot;, &quot;uid1&quot;, UUID.randomUUID().toString(), &quot;uid2&quot;, UUID.randomUUID().toString());</b>
<b class="fc">&nbsp;        Vertex john = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;john&quot;, &quot;uid1&quot;, UUID.randomUUID().toString(), &quot;uid2&quot;, UUID.randomUUID().toString());</b>
<b class="fc">&nbsp;        marko.addEdge(&quot;Friend&quot;, john, &quot;weight&quot;, 1, &quot;uid1&quot;, UUID.randomUUID().toString(), &quot;uid2&quot;, UUID.randomUUID().toString());</b>
<b class="fc">&nbsp;        Edge colleague = marko.addEdge(&quot;Colleague&quot;, john, &quot;toRemove&quot;, &quot;a&quot;, &quot;uid1&quot;, UUID.randomUUID().toString(), &quot;uid2&quot;, UUID.randomUUID().toString());</b>
<b class="fc">&nbsp;        marko.property(&quot;name&quot;).remove();</b>
<b class="fc">&nbsp;        colleague.property(&quot;toRemove&quot;).remove();</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;
<b class="fc">&nbsp;        testRemoveProperty_assert(this.sqlgGraph, marko);</b>
<b class="pc">&nbsp;        if (this.sqlgGraph1 != null) {</b>
<b class="fc">&nbsp;            Thread.sleep(1000);</b>
<b class="fc">&nbsp;            testRemoveProperty_assert(this.sqlgGraph1, marko);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void testRemoveProperty_assert(SqlgGraph sqlgGraph, Vertex marko) {
<b class="fc">&nbsp;        marko = sqlgGraph.traversal().V(marko.id()).next();</b>
<b class="fc">&nbsp;        Assert.assertNull(marko.property(&quot;name&quot;).value());</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testInOutOnEdges() {
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        Vertex root = this.sqlgGraph.addVertex(T.label, &quot;ROOT&quot;, &quot;dummy&quot;, &quot;a&quot;);</b>
<b class="fc">&nbsp;        Vertex god = this.sqlgGraph.addVertex(T.label, &quot;God&quot;, &quot;dummy&quot;, &quot;a&quot;);</b>
<b class="fc">&nbsp;        root.addEdge(&quot;rootGod&quot;, god);</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testGetEdges() {
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        Vertex root = this.sqlgGraph.addVertex(T.label, &quot;ROOT&quot;, &quot;dummy&quot;, &quot;a&quot;);</b>
<b class="fc">&nbsp;        Vertex god = this.sqlgGraph.addVertex(T.label, &quot;God&quot;, &quot;dummy&quot;, &quot;a&quot;);</b>
<b class="fc">&nbsp;        Edge sqlgEdge = root.addEdge(&quot;rootGod&quot;, god);</b>
<b class="fc">&nbsp;        Assert.assertNull(sqlgEdge.id());</b>
<b class="fc">&nbsp;        Edge rootGodEdge = vertexTraversal(this.sqlgGraph, root).outE(&quot;rootGod&quot;).next();</b>
&nbsp;        //Querying triggers the cache to be flushed, so the result will have an id
<b class="fc">&nbsp;        Assert.assertNotNull(rootGodEdge);</b>
<b class="fc">&nbsp;        Assert.assertNotNull(rootGodEdge.id());</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testGetEdgesUserSuppliedPK() {
<b class="fc">&nbsp;        VertexLabel rootVertexLabel = this.sqlgGraph.getTopology().getPublicSchema()</b>
<b class="fc">&nbsp;                .ensureVertexLabelExist(</b>
&nbsp;                        &quot;ROOT&quot;,
<b class="fc">&nbsp;                        new HashMap&lt;&gt;() {{</b>
<b class="fc">&nbsp;                            put(&quot;uid1&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="fc">&nbsp;                            put(&quot;uid2&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="fc">&nbsp;                            put(&quot;dummy&quot;, PropertyDefinition.of(PropertyType.STRING));</b>
&nbsp;                        }},
<b class="fc">&nbsp;                        ListOrderedSet.listOrderedSet(Arrays.asList(&quot;uid1&quot;, &quot;uid2&quot;))</b>
&nbsp;                );
<b class="fc">&nbsp;        VertexLabel godVertexLabel = this.sqlgGraph.getTopology().getPublicSchema()</b>
<b class="fc">&nbsp;                .ensureVertexLabelExist(</b>
&nbsp;                        &quot;God&quot;,
<b class="fc">&nbsp;                        new HashMap&lt;&gt;() {{</b>
<b class="fc">&nbsp;                            put(&quot;uid1&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="fc">&nbsp;                            put(&quot;uid2&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="fc">&nbsp;                            put(&quot;dummy&quot;, PropertyDefinition.of(PropertyType.STRING));</b>
&nbsp;                        }},
<b class="fc">&nbsp;                        ListOrderedSet.listOrderedSet(Arrays.asList(&quot;uid1&quot;, &quot;uid2&quot;))</b>
&nbsp;                );
<b class="fc">&nbsp;        rootVertexLabel.ensureEdgeLabelExist(</b>
&nbsp;                &quot;rootGod&quot;,
&nbsp;                godVertexLabel,
<b class="fc">&nbsp;                new HashMap&lt;&gt;() {{</b>
<b class="fc">&nbsp;                    put(&quot;uid1&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="fc">&nbsp;                    put(&quot;uid2&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
&nbsp;                }},
<b class="fc">&nbsp;                ListOrderedSet.listOrderedSet(Arrays.asList(&quot;uid1&quot;, &quot;uid2&quot;))</b>
&nbsp;        );
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        Vertex root = this.sqlgGraph.addVertex(T.label, &quot;ROOT&quot;, &quot;dummy&quot;, &quot;a&quot;, &quot;uid1&quot;, &quot;root111&quot;, &quot;uid2&quot;, &quot;root222&quot;);</b>
<b class="fc">&nbsp;        Vertex god = this.sqlgGraph.addVertex(T.label, &quot;God&quot;, &quot;dummy&quot;, &quot;a&quot;, &quot;uid1&quot;, &quot;god111&quot;, &quot;uid2&quot;, &quot;god222&quot;);</b>
<b class="fc">&nbsp;        Edge sqlgEdge = root.addEdge(&quot;rootGod&quot;, god, &quot;uid1&quot;, &quot;edge111&quot;, &quot;uid2&quot;, &quot;edge222&quot;);</b>
<b class="fc">&nbsp;        Assert.assertNull(sqlgEdge.id());</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        Edge rootGodEdge = vertexTraversal(this.sqlgGraph, root).outE(&quot;rootGod&quot;).next();</b>
&nbsp;        //Querying triggers the cache to be flushed, so the result will have an id
<b class="fc">&nbsp;        Assert.assertNotNull(rootGodEdge);</b>
<b class="fc">&nbsp;        Assert.assertNotNull(rootGodEdge.id());</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testGetVertices() {
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        Vertex root = this.sqlgGraph.addVertex(T.label, &quot;ROOT&quot;, &quot;dummy&quot;, &quot;a&quot;);</b>
<b class="fc">&nbsp;        Vertex god = this.sqlgGraph.addVertex(T.label, &quot;God&quot;, &quot;dummy&quot;, &quot;a&quot;);</b>
<b class="fc">&nbsp;        Vertex human = this.sqlgGraph.addVertex(T.label, &quot;Human&quot;, &quot;dummy&quot;, &quot;a&quot;);</b>
<b class="fc">&nbsp;        root.addEdge(&quot;rootGod&quot;, god);</b>
<b class="fc">&nbsp;        root.addEdge(&quot;rootHuman&quot;, human);</b>
<b class="fc">&nbsp;        god.addEdge(&quot;rootROOT&quot;, root);</b>
<b class="fc">&nbsp;        Assert.assertEquals(god, vertexTraversal(this.sqlgGraph, root).out(&quot;rootGod&quot;).next());</b>
<b class="fc">&nbsp;        Assert.assertEquals(human, vertexTraversal(this.sqlgGraph, root).out(&quot;rootHuman&quot;).next());</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testPerformance() throws InterruptedException {
<b class="fc">&nbsp;        StopWatch stopWatch = new StopWatch();</b>
<b class="fc">&nbsp;        stopWatch.start();</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        for (int i = 0; i &lt; 10000; i++) {</b>
<b class="fc">&nbsp;            Vertex person = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;marko&quot; + i);</b>
<b class="fc">&nbsp;            Vertex spaceTime = this.sqlgGraph.addVertex(T.label, &quot;SpaceTime&quot;, &quot;name&quot;, &quot;marko&quot; + i);</b>
<b class="fc">&nbsp;            Vertex space = this.sqlgGraph.addVertex(T.label, &quot;Space&quot;, &quot;name&quot;, &quot;marko&quot; + i);</b>
<b class="fc">&nbsp;            Vertex time = this.sqlgGraph.addVertex(T.label, &quot;Time&quot;, &quot;name&quot;, &quot;marko&quot; + i);</b>
<b class="fc">&nbsp;            person.addEdge(&quot;spaceTime&quot;, spaceTime, &quot;context&quot;, 1);</b>
<b class="fc">&nbsp;            spaceTime.addEdge(&quot;space&quot;, space, &quot;dimension&quot;, 3);</b>
<b class="fc">&nbsp;            spaceTime.addEdge(&quot;time&quot;, time, &quot;dimension&quot;, 1);</b>
<b class="fc">&nbsp;            if (i != 0 &amp;&amp; i % 1000 == 0) {</b>
<b class="fc">&nbsp;                this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;                this.sqlgGraph.tx().normalBatchModeOn();</b>
&nbsp;            }
&nbsp;        }
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        stopWatch.stop();</b>
<b class="fc">&nbsp;        stopWatch.reset();</b>
<b class="fc">&nbsp;        stopWatch.start();</b>
<b class="fc">&nbsp;        testPerformance_assert(this.sqlgGraph);</b>
<b class="pc">&nbsp;        if (this.sqlgGraph1 != null) {</b>
<b class="fc">&nbsp;            Thread.sleep(1000);</b>
<b class="fc">&nbsp;            testPerformance_assert(this.sqlgGraph1);</b>
&nbsp;        }
<b class="fc">&nbsp;        stopWatch.stop();</b>
&nbsp;    }
&nbsp;
&nbsp;    private void testPerformance_assert(SqlgGraph sqlgGraph) {
<b class="fc">&nbsp;        Assert.assertEquals(10000, sqlgGraph.traversal().V().has(T.label, &quot;Person&quot;).count().next(), 0);</b>
<b class="fc">&nbsp;        Assert.assertEquals(10000, sqlgGraph.traversal().V().has(T.label, &quot;SpaceTime&quot;).count().next(), 0);</b>
<b class="fc">&nbsp;        Assert.assertEquals(10000, sqlgGraph.traversal().V().has(T.label, &quot;Space&quot;).count().next(), 0);</b>
<b class="fc">&nbsp;        Assert.assertEquals(10000, sqlgGraph.traversal().V().has(T.label, &quot;Time&quot;).count().next(), 0);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testGetVerticesWithHas() {
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        Vertex root = this.sqlgGraph.addVertex(T.label, &quot;ROOT&quot;, &quot;dummy&quot;, &quot;a&quot;);</b>
<b class="fc">&nbsp;        Vertex jah = this.sqlgGraph.addVertex(T.label, &quot;God&quot;, &quot;name&quot;, &quot;Jah&quot;);</b>
<b class="fc">&nbsp;        Vertex jehova = this.sqlgGraph.addVertex(T.label, &quot;God&quot;, &quot;name&quot;, &quot;Jehova&quot;);</b>
<b class="fc">&nbsp;        root.addEdge(&quot;rootGod&quot;, jah);</b>
<b class="fc">&nbsp;        root.addEdge(&quot;rootGod&quot;, jehova);</b>
<b class="fc">&nbsp;        List&lt;Vertex&gt; vertices = vertexTraversal(this.sqlgGraph, root).out(&quot;rootGod&quot;).toList();</b>
<b class="fc">&nbsp;        Assert.assertTrue(vertices.contains(jah));</b>
<b class="fc">&nbsp;        Assert.assertTrue(vertices.contains(jehova));</b>
<b class="fc">&nbsp;        Assert.assertEquals(jah, vertexTraversal(this.sqlgGraph, root).out(&quot;rootGod&quot;).has(&quot;name&quot;, &quot;Jah&quot;).next());</b>
<b class="fc">&nbsp;        Assert.assertEquals(jehova, vertexTraversal(this.sqlgGraph, root).out(&quot;rootGod&quot;).has(&quot;name&quot;, &quot;Jehova&quot;).next());</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testVertexLabelCache() throws InterruptedException {
<b class="fc">&nbsp;        Vertex root = this.sqlgGraph.addVertex(T.label, &quot;ROOT&quot;);</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        Vertex jah = this.sqlgGraph.addVertex(T.label, &quot;God&quot;, &quot;name&quot;, &quot;Jah&quot;);</b>
<b class="fc">&nbsp;        Vertex jehova = this.sqlgGraph.addVertex(T.label, &quot;God&quot;, &quot;name&quot;, &quot;Jehova&quot;);</b>
<b class="fc">&nbsp;        root.addEdge(&quot;rootGod&quot;, jah);</b>
<b class="fc">&nbsp;        root.addEdge(&quot;rootGod&quot;, jehova);</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        testVertexLabelCache_assert(this.sqlgGraph, root, jah, jehova);</b>
<b class="pc">&nbsp;        if (this.sqlgGraph1 != null) {</b>
<b class="fc">&nbsp;            Thread.sleep(1000);</b>
<b class="fc">&nbsp;            testVertexLabelCache_assert(this.sqlgGraph1, root, jah, jehova);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void testVertexLabelCache_assert(SqlgGraph sqlgGraph, Vertex root, Vertex jah, Vertex jehova) {
<b class="fc">&nbsp;        List&lt;Vertex&gt; vertices = vertexTraversal(sqlgGraph, root).out(&quot;rootGod&quot;).toList();</b>
<b class="fc">&nbsp;        Assert.assertTrue(vertices.contains(jah));</b>
<b class="fc">&nbsp;        Assert.assertTrue(vertices.contains(jehova));</b>
<b class="fc">&nbsp;        Assert.assertEquals(jah, vertexTraversal(sqlgGraph, root).out(&quot;rootGod&quot;).has(&quot;name&quot;, &quot;Jah&quot;).next());</b>
<b class="fc">&nbsp;        Assert.assertEquals(jehova, vertexTraversal(sqlgGraph, root).out(&quot;rootGod&quot;).has(&quot;name&quot;, &quot;Jehova&quot;).next());</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testVertexMultipleEdgesLabels() throws InterruptedException {
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        Vertex person = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;a&quot;);</b>
<b class="fc">&nbsp;        Vertex car = this.sqlgGraph.addVertex(T.label, &quot;Car&quot;, &quot;name&quot;, &quot;b&quot;);</b>
<b class="fc">&nbsp;        Vertex bike = this.sqlgGraph.addVertex(T.label, &quot;Bike&quot;, &quot;name&quot;, &quot;c&quot;);</b>
<b class="fc">&nbsp;        person.addEdge(&quot;car&quot;, car);</b>
<b class="fc">&nbsp;        person.addEdge(&quot;bike&quot;, bike);</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        testVertexMulitpleEdgesLabels_assert(this.sqlgGraph, person);</b>
<b class="pc">&nbsp;        if (this.sqlgGraph1 != null) {</b>
<b class="fc">&nbsp;            Thread.sleep(1000);</b>
<b class="fc">&nbsp;            testVertexMulitpleEdgesLabels_assert(this.sqlgGraph1, person);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void testVertexMulitpleEdgesLabels_assert(SqlgGraph sqlgGraph, Vertex person) {
<b class="fc">&nbsp;        Assert.assertEquals(Long.valueOf(2), sqlgGraph.traversal().V(person).out().count().next());</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testAddEdgeAccrossSchema() throws InterruptedException {
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        Vertex person = this.sqlgGraph.addVertex(T.label, &quot;Schema1.Person&quot;, &quot;name&quot;, &quot;a&quot;);</b>
<b class="fc">&nbsp;        Vertex car = this.sqlgGraph.addVertex(T.label, &quot;Schema2.Car&quot;, &quot;name&quot;, &quot;b&quot;);</b>
<b class="fc">&nbsp;        Vertex bike = this.sqlgGraph.addVertex(T.label, &quot;Schema2.Bike&quot;, &quot;name&quot;, &quot;c&quot;);</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        person.addEdge(&quot;car&quot;, car);</b>
<b class="fc">&nbsp;        person.addEdge(&quot;bike&quot;, bike);</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        testAddEdgeAccrossSchema_assert(this.sqlgGraph, person);</b>
<b class="pc">&nbsp;        if (this.sqlgGraph1 != null) {</b>
<b class="fc">&nbsp;            Thread.sleep(1000);</b>
<b class="fc">&nbsp;            testAddEdgeAccrossSchema_assert(this.sqlgGraph1, person);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void testAddEdgeAccrossSchema_assert(SqlgGraph sqlgGraph, Vertex person) {
<b class="fc">&nbsp;        Assert.assertEquals(Long.valueOf(2), sqlgGraph.traversal().V(person).out().count().next());</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testCacheAndUpdateVERTICESLabels() throws InterruptedException {
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        Vertex person1 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;person&quot;);</b>
<b class="fc">&nbsp;        List&lt;Vertex&gt; cache = new ArrayList&lt;&gt;();</b>
<b class="fc">&nbsp;        for (int i = 0; i &lt; 10000; i++) {</b>
<b class="fc">&nbsp;            cache.add(this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;person&quot; + i));</b>
&nbsp;        }
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        for (Vertex person2 : cache) {</b>
<b class="fc">&nbsp;            person1.addEdge(&quot;Friend&quot;, person2);</b>
&nbsp;        }
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        testCacheAndUpdateVERTICESLabels_assert(this.sqlgGraph, person1);</b>
<b class="pc">&nbsp;        if (this.sqlgGraph1 != null) {</b>
<b class="fc">&nbsp;            Thread.sleep(1000);</b>
<b class="fc">&nbsp;            testCacheAndUpdateVERTICESLabels_assert(this.sqlgGraph1, person1);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void testCacheAndUpdateVERTICESLabels_assert(SqlgGraph sqlgGraph, Vertex person1) {
<b class="fc">&nbsp;        person1 = sqlgGraph.traversal().V(person1.id()).next();</b>
<b class="fc">&nbsp;        Assert.assertTrue(vertexTraversal(sqlgGraph, person1).out(&quot;Friend&quot;).hasNext());</b>
<b class="fc">&nbsp;        Assert.assertEquals(Long.valueOf(10000), vertexTraversal(sqlgGraph, person1).out(&quot;Friend&quot;).count().next());</b>
<b class="fc">&nbsp;        List&lt;Vertex&gt; friends = vertexTraversal(sqlgGraph, person1).out(&quot;Friend&quot;).toList();</b>
<b class="fc">&nbsp;        List&lt;String&gt; names = friends.stream().map(v -&gt; v.&lt;String&gt;value(&quot;name&quot;)).toList();</b>
<b class="fc">&nbsp;        Assert.assertEquals(10000, names.size(), 0);</b>
<b class="fc">&nbsp;        for (int i = 0; i &lt; 10000; i++) {</b>
<b class="fc">&nbsp;            Assert.assertTrue(names.contains(&quot;person&quot; + i));</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testBatchInsertDifferentKeys() throws InterruptedException {
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;a&quot;);</b>
<b class="fc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;surname&quot;, &quot;b&quot;);</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;
<b class="fc">&nbsp;        testBatchInsertDifferentKeys_assert(this.sqlgGraph);</b>
<b class="pc">&nbsp;        if (this.sqlgGraph1 != null) {</b>
<b class="fc">&nbsp;            Thread.sleep(1000);</b>
<b class="fc">&nbsp;            testBatchInsertDifferentKeys_assert(this.sqlgGraph1);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void testBatchInsertDifferentKeys_assert(SqlgGraph sqlgGraph) {
<b class="fc">&nbsp;        List&lt;Vertex&gt; persons = sqlgGraph.traversal().V().has(T.label, &quot;Person&quot;).has(&quot;name&quot;, &quot;a&quot;).toList();</b>
<b class="fc">&nbsp;        Assert.assertEquals(1, persons.size());</b>
<b class="fc">&nbsp;        Assert.assertNull(persons.get(0).property(&quot;surname&quot;).value());</b>
&nbsp;
<b class="fc">&nbsp;        persons = sqlgGraph.traversal().V().has(T.label, &quot;Person&quot;).has(&quot;surname&quot;, &quot;b&quot;).toList();</b>
<b class="fc">&nbsp;        Assert.assertEquals(1, persons.size());</b>
<b class="fc">&nbsp;        Assert.assertNull(persons.get(0).property(&quot;name&quot;).value());</b>
&nbsp;
<b class="fc">&nbsp;        persons = sqlgGraph.traversal().V().has(T.label, &quot;Person&quot;).has(&quot;surname&quot;, &quot;b&quot;).has(&quot;name&quot;, &quot;a&quot;).toList();</b>
<b class="fc">&nbsp;        Assert.assertEquals(0, persons.size());</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testVerticesOutLabelsForPersistentVertices() throws InterruptedException {
<b class="fc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;RealWorkspace&quot;, &quot;name&quot;, &quot;realWorkspace1&quot;);</b>
<b class="fc">&nbsp;        Vertex softwareVersion = this.sqlgGraph.addVertex(T.label, &quot;SoftwareVersion&quot;, &quot;name&quot;, &quot;R15&quot;);</b>
<b class="fc">&nbsp;        Vertex vendorTechnology = this.sqlgGraph.addVertex(T.label, &quot;VendorTechnology&quot;, &quot;name&quot;, &quot;Huawei_Gsm&quot;);</b>
<b class="fc">&nbsp;        vendorTechnology.addEdge(&quot;vendorTechnology_softwareVersion&quot;, softwareVersion);</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;
<b class="fc">&nbsp;        Assert.assertEquals(&quot;Huawei_Gsm&quot;, vertexTraversal(this.sqlgGraph, softwareVersion).in(&quot;vendorTechnology_softwareVersion&quot;).next().value(&quot;name&quot;));</b>
&nbsp;
<b class="fc">&nbsp;        this.sqlgGraph.tx().rollback();</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        Vertex rwe1 = this.sqlgGraph.addVertex(T.label, &quot;RWE&quot;, &quot;name&quot;, &quot;cell1&quot;);</b>
<b class="fc">&nbsp;        rwe1.addEdge(&quot;workspaceElement_softwareVersion&quot;, softwareVersion);</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;
<b class="fc">&nbsp;        testVerticesOutLabelsForPersistentVertices_assert(this.sqlgGraph, softwareVersion);</b>
<b class="pc">&nbsp;        if (this.sqlgGraph1 != null) {</b>
<b class="fc">&nbsp;            Thread.sleep(1000);</b>
<b class="fc">&nbsp;            testVerticesOutLabelsForPersistentVertices_assert(this.sqlgGraph1, softwareVersion);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void testVerticesOutLabelsForPersistentVertices_assert(SqlgGraph sqlgGraph, Vertex softwareVersion) {
<b class="fc">&nbsp;        softwareVersion = sqlgGraph.traversal().V(softwareVersion.id()).next();</b>
<b class="fc">&nbsp;        Assert.assertEquals(&quot;Huawei_Gsm&quot;, vertexTraversal(sqlgGraph, softwareVersion).in(&quot;vendorTechnology_softwareVersion&quot;).next().value(&quot;name&quot;));</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testVerticesInLabelsForPersistentVertices() throws InterruptedException {
<b class="fc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;RealWorkspace&quot;, &quot;name&quot;, &quot;realWorkspace1&quot;);</b>
<b class="fc">&nbsp;        Vertex softwareVersion = this.sqlgGraph.addVertex(T.label, &quot;SoftwareVersion&quot;, &quot;name&quot;, &quot;R15&quot;);</b>
<b class="fc">&nbsp;        Vertex vendorTechnology = this.sqlgGraph.addVertex(T.label, &quot;VendorTechnology&quot;, &quot;name&quot;, &quot;Huawei_Gsm&quot;);</b>
<b class="fc">&nbsp;        softwareVersion.addEdge(&quot;softwareVersion_vendorTechnology&quot;, vendorTechnology);</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;
<b class="fc">&nbsp;        Assert.assertEquals(&quot;Huawei_Gsm&quot;, vertexTraversal(this.sqlgGraph, softwareVersion).out(&quot;softwareVersion_vendorTechnology&quot;).next().value(&quot;name&quot;));</b>
&nbsp;
<b class="fc">&nbsp;        this.sqlgGraph.tx().rollback();</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        Vertex rwe1 = this.sqlgGraph.addVertex(T.label, &quot;RWE&quot;, &quot;name&quot;, &quot;cell1&quot;);</b>
<b class="fc">&nbsp;        rwe1.addEdge(&quot;workspaceElement_softwareVersion&quot;, softwareVersion);</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;
<b class="fc">&nbsp;        testVerticesInLabelsForPersistentVertices_assert(this.sqlgGraph, softwareVersion);</b>
<b class="pc">&nbsp;        if (this.sqlgGraph1 != null) {</b>
<b class="fc">&nbsp;            Thread.sleep(1000);</b>
<b class="fc">&nbsp;            testVerticesInLabelsForPersistentVertices_assert(this.sqlgGraph1, softwareVersion);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void testVerticesInLabelsForPersistentVertices_assert(SqlgGraph sqlgGraph, Vertex softwareVersion) {
<b class="fc">&nbsp;        softwareVersion = sqlgGraph.traversal().V(softwareVersion.id()).next();</b>
<b class="fc">&nbsp;        Assert.assertEquals(&quot;Huawei_Gsm&quot;, vertexTraversal(sqlgGraph, softwareVersion).out(&quot;softwareVersion_vendorTechnology&quot;).next().value(&quot;name&quot;));</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testBatchUpdatePersistentVertices() throws InterruptedException {
<b class="fc">&nbsp;        Vertex v1 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;a&quot;);</b>
<b class="fc">&nbsp;        Vertex v2 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;surname&quot;, &quot;b&quot;);</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        Assert.assertEquals(&quot;a&quot;, this.sqlgGraph.traversal().V(v1.id()).next().value(&quot;name&quot;));</b>
<b class="fc">&nbsp;        Assert.assertEquals(&quot;b&quot;, this.sqlgGraph.traversal().V(v2.id()).next().value(&quot;surname&quot;));</b>
&nbsp;
<b class="fc">&nbsp;        this.sqlgGraph.tx().rollback();</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        v1.property(&quot;name&quot;, &quot;aa&quot;);</b>
<b class="fc">&nbsp;        v2.property(&quot;surname&quot;, &quot;bb&quot;);</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;
<b class="fc">&nbsp;        testBatchUpdatePersistentVertices_assert(this.sqlgGraph, v1, v2);</b>
<b class="pc">&nbsp;        if (this.sqlgGraph1 != null) {</b>
<b class="fc">&nbsp;            Thread.sleep(1000);</b>
<b class="fc">&nbsp;            testBatchUpdatePersistentVertices_assert(this.sqlgGraph1, v1, v2);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void testBatchUpdatePersistentVertices_assert(SqlgGraph sqlgGraph, Vertex v1, Vertex v2) {
<b class="fc">&nbsp;        Assert.assertEquals(&quot;aa&quot;, sqlgGraph.traversal().V(v1.id()).next().value(&quot;name&quot;));</b>
<b class="fc">&nbsp;        Assert.assertEquals(&quot;bb&quot;, sqlgGraph.traversal().V(v2.id()).next().value(&quot;surname&quot;));</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testBatchUpdatePersistentVerticesAllTypes() throws InterruptedException {
&nbsp;
<b class="fc">&nbsp;        Assume.assumeTrue(this.sqlgGraph.features().vertex().properties().supportsFloatValues());</b>
&nbsp;
<b class="fc">&nbsp;        Vertex v1 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;a&quot;);</b>
<b class="fc">&nbsp;        Vertex v2 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;surname&quot;, &quot;b&quot;);</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        Assert.assertEquals(&quot;a&quot;, this.sqlgGraph.traversal().V(v1.id()).next().value(&quot;name&quot;));</b>
<b class="fc">&nbsp;        Assert.assertEquals(&quot;b&quot;, this.sqlgGraph.traversal().V(v2.id()).next().value(&quot;surname&quot;));</b>
&nbsp;
<b class="fc">&nbsp;        this.sqlgGraph.tx().rollback();</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        v1.property(&quot;name&quot;, &quot;aa&quot;);</b>
<b class="fc">&nbsp;        v1.property(&quot;boolean&quot;, true);</b>
<b class="fc">&nbsp;        v1.property(&quot;short&quot;, (short) 1);</b>
<b class="fc">&nbsp;        v1.property(&quot;integer&quot;, 1);</b>
<b class="fc">&nbsp;        v1.property(&quot;long&quot;, 1L);</b>
<b class="fc">&nbsp;        v1.property(&quot;float&quot;, 1F);</b>
<b class="fc">&nbsp;        v1.property(&quot;double&quot;, 1D);</b>
&nbsp;
<b class="fc">&nbsp;        v2.property(&quot;surname&quot;, &quot;bb&quot;);</b>
<b class="fc">&nbsp;        v2.property(&quot;boolean&quot;, false);</b>
<b class="fc">&nbsp;        v2.property(&quot;short&quot;, (short) 2);</b>
<b class="fc">&nbsp;        v2.property(&quot;integer&quot;, 2);</b>
<b class="fc">&nbsp;        v2.property(&quot;long&quot;, 2L);</b>
<b class="fc">&nbsp;        v2.property(&quot;float&quot;, 2F);</b>
<b class="fc">&nbsp;        v2.property(&quot;double&quot;, 2D);</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;
<b class="fc">&nbsp;        testBatchUpdatePersistentVerticesAllTypes_assert(this.sqlgGraph, v1, v2);</b>
<b class="pc">&nbsp;        if (this.sqlgGraph1 != null) {</b>
<b class="fc">&nbsp;            Thread.sleep(1000);</b>
<b class="fc">&nbsp;            testBatchUpdatePersistentVerticesAllTypes_assert(this.sqlgGraph1, v1, v2);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void testBatchUpdatePersistentVerticesAllTypes_assert(SqlgGraph sqlgGraph, Vertex v1, Vertex v2) {
<b class="fc">&nbsp;        Assert.assertEquals(&quot;aa&quot;, sqlgGraph.traversal().V(v1.id()).next().value(&quot;name&quot;));</b>
<b class="fc">&nbsp;        Assert.assertEquals(true, sqlgGraph.traversal().V(v1.id()).next().value(&quot;boolean&quot;));</b>
<b class="fc">&nbsp;        Assert.assertEquals((short) 1, sqlgGraph.traversal().V(v1.id()).next().&lt;Short&gt;value(&quot;short&quot;).shortValue());</b>
<b class="fc">&nbsp;        Assert.assertEquals(1, sqlgGraph.traversal().V(v1.id()).next().&lt;Integer&gt;value(&quot;integer&quot;).intValue());</b>
<b class="fc">&nbsp;        Assert.assertEquals(1L, sqlgGraph.traversal().V(v1.id()).next().&lt;Long&gt;value(&quot;long&quot;), 0);</b>
<b class="fc">&nbsp;        Assert.assertEquals(1F, sqlgGraph.traversal().V(v1.id()).next().&lt;Float&gt;value(&quot;float&quot;), 0);</b>
<b class="fc">&nbsp;        Assert.assertEquals(1D, sqlgGraph.traversal().V(v1.id()).next().&lt;Double&gt;value(&quot;double&quot;), 0);</b>
&nbsp;
<b class="fc">&nbsp;        Assert.assertEquals(&quot;bb&quot;, sqlgGraph.traversal().V(v2.id()).next().value(&quot;surname&quot;));</b>
<b class="fc">&nbsp;        Assert.assertEquals(false, sqlgGraph.traversal().V(v2.id()).next().value(&quot;boolean&quot;));</b>
<b class="fc">&nbsp;        Assert.assertEquals((short) 2, sqlgGraph.traversal().V(v2.id()).next().&lt;Short&gt;value(&quot;short&quot;).shortValue());</b>
<b class="fc">&nbsp;        Assert.assertEquals(2, sqlgGraph.traversal().V(v2.id()).next().&lt;Integer&gt;value(&quot;integer&quot;).intValue());</b>
<b class="fc">&nbsp;        Assert.assertEquals(2L, sqlgGraph.traversal().V(v2.id()).next().&lt;Long&gt;value(&quot;long&quot;), 0);</b>
<b class="fc">&nbsp;        Assert.assertEquals(2F, sqlgGraph.traversal().V(v2.id()).next().&lt;Float&gt;value(&quot;float&quot;), 0);</b>
<b class="fc">&nbsp;        Assert.assertEquals(2D, sqlgGraph.traversal().V(v2.id()).next().&lt;Double&gt;value(&quot;double&quot;), 0);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testInsertUpdateQuotedStrings() {
<b class="fc">&nbsp;        StopWatch stopWatch = new StopWatch();</b>
<b class="fc">&nbsp;        stopWatch.start();</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        for (int i = 0; i &lt; 100; i++) {</b>
<b class="fc">&nbsp;            this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;&#39;a&#39;&quot;);</b>
&nbsp;        }
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        stopWatch.stop();</b>
<b class="fc">&nbsp;        stopWatch.reset();</b>
<b class="fc">&nbsp;        stopWatch.start();</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        List&lt;Vertex&gt; vertices = this.sqlgGraph.traversal().V().toList();</b>
<b class="fc">&nbsp;        for (Vertex v : vertices) {</b>
<b class="fc">&nbsp;            v.property(&quot;name&quot;, &quot;&#39;b&#39;&quot;);</b>
&nbsp;        }
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        stopWatch.stop();</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testBatchRemoveVertex() {
<b class="fc">&nbsp;        Vertex v1 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;);</b>
<b class="fc">&nbsp;        Vertex v2 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;);</b>
<b class="fc">&nbsp;        Vertex v3 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;);</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        v1.remove();</b>
<b class="fc">&nbsp;        v2.remove();</b>
<b class="fc">&nbsp;        v3.remove();</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        testBatchRemoveVertex_assert();</b>
&nbsp;    }
&nbsp;
&nbsp;    private void testBatchRemoveVertex_assert() {
<b class="fc">&nbsp;        Assert.assertEquals(0, this.sqlgGraph.traversal().V().count().next().intValue());</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testBatchRemoveVertexUsersSuppliedPK() {
<b class="fc">&nbsp;        this.sqlgGraph.getTopology().getPublicSchema()</b>
<b class="fc">&nbsp;                .ensureVertexLabelExist(</b>
&nbsp;                        &quot;Person&quot;,
<b class="fc">&nbsp;                        new HashMap&lt;&gt;() {{</b>
<b class="fc">&nbsp;                            put(&quot;uid1&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="fc">&nbsp;                            put(&quot;uid2&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
&nbsp;                        }},
<b class="fc">&nbsp;                        ListOrderedSet.listOrderedSet(Arrays.asList(&quot;uid1&quot;, &quot;uid2&quot;))</b>
&nbsp;                );
<b class="fc">&nbsp;        Vertex v1 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;uid1&quot;, UUID.randomUUID().toString(), &quot;uid2&quot;, UUID.randomUUID().toString());</b>
<b class="fc">&nbsp;        Vertex v2 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;uid1&quot;, UUID.randomUUID().toString(), &quot;uid2&quot;, UUID.randomUUID().toString());</b>
<b class="fc">&nbsp;        Vertex v3 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;uid1&quot;, UUID.randomUUID().toString(), &quot;uid2&quot;, UUID.randomUUID().toString());</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        v1.remove();</b>
<b class="fc">&nbsp;        v2.remove();</b>
<b class="fc">&nbsp;        v3.remove();</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        testBatchRemoveVertex_assert();</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testBatchRemoveEdges_UserSuppliedPK() throws InterruptedException {
<b class="fc">&nbsp;        VertexLabel personVertexLabel = this.sqlgGraph.getTopology().getPublicSchema()</b>
<b class="fc">&nbsp;                .ensureVertexLabelExist(</b>
&nbsp;                        &quot;Person&quot;,
<b class="fc">&nbsp;                        new HashMap&lt;&gt;() {{</b>
<b class="fc">&nbsp;                            put(&quot;uid1&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="fc">&nbsp;                            put(&quot;uid2&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
&nbsp;                        }},
<b class="fc">&nbsp;                        ListOrderedSet.listOrderedSet(Arrays.asList(&quot;uid1&quot;, &quot;uid2&quot;))</b>
&nbsp;                );
<b class="fc">&nbsp;        personVertexLabel.ensureEdgeLabelExist(</b>
&nbsp;                &quot;test&quot;,
&nbsp;                personVertexLabel,
<b class="fc">&nbsp;                new HashMap&lt;&gt;() {{</b>
<b class="fc">&nbsp;                    put(&quot;uid1&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="fc">&nbsp;                    put(&quot;uid2&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
&nbsp;                }},
<b class="fc">&nbsp;                ListOrderedSet.listOrderedSet(Arrays.asList(&quot;uid1&quot;, &quot;uid2&quot;))</b>
&nbsp;        );
<b class="fc">&nbsp;        Vertex v1 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;uid1&quot;, UUID.randomUUID().toString(), &quot;uid2&quot;, UUID.randomUUID().toString());</b>
<b class="fc">&nbsp;        Vertex v2 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;uid1&quot;, UUID.randomUUID().toString(), &quot;uid2&quot;, UUID.randomUUID().toString());</b>
<b class="fc">&nbsp;        Vertex v3 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;uid1&quot;, UUID.randomUUID().toString(), &quot;uid2&quot;, UUID.randomUUID().toString());</b>
<b class="fc">&nbsp;        Edge edge1 = v1.addEdge(&quot;test&quot;, v2, &quot;uid1&quot;, UUID.randomUUID().toString(), &quot;uid2&quot;, UUID.randomUUID().toString());</b>
<b class="fc">&nbsp;        Edge edge2 = v1.addEdge(&quot;test&quot;, v3, &quot;uid1&quot;, UUID.randomUUID().toString(), &quot;uid2&quot;, UUID.randomUUID().toString());</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        edge1.remove();</b>
<b class="fc">&nbsp;        edge2.remove();</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        testBatchRemoveEdges_assert(this.sqlgGraph);</b>
<b class="pc">&nbsp;        if (this.sqlgGraph1 != null) {</b>
<b class="fc">&nbsp;            Thread.sleep(1000);</b>
<b class="fc">&nbsp;            testBatchRemoveEdges_assert(this.sqlgGraph1);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void testBatchRemoveEdges_assert(SqlgGraph sqlgGraph) {
<b class="fc">&nbsp;        Assert.assertEquals(3, sqlgGraph.traversal().V().count().next().intValue());</b>
<b class="fc">&nbsp;        Assert.assertEquals(0, sqlgGraph.traversal().E().count().next().intValue());</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testBatchRemoveEdges() throws InterruptedException {
<b class="fc">&nbsp;        Vertex v1 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;);</b>
<b class="fc">&nbsp;        Vertex v2 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;);</b>
<b class="fc">&nbsp;        Vertex v3 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;);</b>
<b class="fc">&nbsp;        Edge edge1 = v1.addEdge(&quot;test&quot;, v2);</b>
<b class="fc">&nbsp;        Edge edge2 = v1.addEdge(&quot;test&quot;, v3);</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        edge1.remove();</b>
<b class="fc">&nbsp;        edge2.remove();</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        testBatchRemoveEdges_assert(this.sqlgGraph);</b>
<b class="pc">&nbsp;        if (this.sqlgGraph1 != null) {</b>
<b class="fc">&nbsp;            Thread.sleep(1000);</b>
<b class="fc">&nbsp;            testBatchRemoveEdges_assert(this.sqlgGraph1);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testBatchRemoveVerticesAndEdgesUserSuppliedPK() throws InterruptedException {
<b class="fc">&nbsp;        VertexLabel personVertexLabel = this.sqlgGraph.getTopology().getPublicSchema()</b>
<b class="fc">&nbsp;                .ensureVertexLabelExist(</b>
&nbsp;                        &quot;Person&quot;,
<b class="fc">&nbsp;                        new HashMap&lt;&gt;() {{</b>
<b class="fc">&nbsp;                            put(&quot;uid1&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="fc">&nbsp;                            put(&quot;uid2&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
&nbsp;                        }},
<b class="fc">&nbsp;                        ListOrderedSet.listOrderedSet(Arrays.asList(&quot;uid1&quot;, &quot;uid2&quot;))</b>
&nbsp;                );
<b class="fc">&nbsp;        personVertexLabel.ensureEdgeLabelExist(</b>
&nbsp;                &quot;test&quot;,
&nbsp;                personVertexLabel,
<b class="fc">&nbsp;                new HashMap&lt;&gt;() {{</b>
<b class="fc">&nbsp;                    put(&quot;uid1&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="fc">&nbsp;                    put(&quot;uid2&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
&nbsp;                }},
<b class="fc">&nbsp;                ListOrderedSet.listOrderedSet(Arrays.asList(&quot;uid1&quot;, &quot;uid2&quot;))</b>
&nbsp;        );
<b class="fc">&nbsp;        Vertex v1 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;uid1&quot;, UUID.randomUUID().toString(), &quot;uid2&quot;, UUID.randomUUID().toString());</b>
<b class="fc">&nbsp;        Vertex v2 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;uid1&quot;, UUID.randomUUID().toString(), &quot;uid2&quot;, UUID.randomUUID().toString());</b>
<b class="fc">&nbsp;        Vertex v3 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;uid1&quot;, UUID.randomUUID().toString(), &quot;uid2&quot;, UUID.randomUUID().toString());</b>
<b class="fc">&nbsp;        Edge edge1 = v1.addEdge(&quot;test&quot;, v2, &quot;uid1&quot;, UUID.randomUUID().toString(), &quot;uid2&quot;, UUID.randomUUID().toString());</b>
<b class="fc">&nbsp;        Edge edge2 = v1.addEdge(&quot;test&quot;, v3, &quot;uid1&quot;, UUID.randomUUID().toString(), &quot;uid2&quot;, UUID.randomUUID().toString());</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        edge1.remove();</b>
<b class="fc">&nbsp;        edge2.remove();</b>
<b class="fc">&nbsp;        v1.remove();</b>
<b class="fc">&nbsp;        v2.remove();</b>
<b class="fc">&nbsp;        v3.remove();</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        testBatchRemoveVerticesAndEdges_assert(this.sqlgGraph);</b>
<b class="pc">&nbsp;        if (this.sqlgGraph1 != null) {</b>
<b class="fc">&nbsp;            Thread.sleep(1000);</b>
<b class="fc">&nbsp;            testBatchRemoveVerticesAndEdges_assert(this.sqlgGraph1);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testBatchRemoveVerticesAndEdges() throws InterruptedException {
<b class="fc">&nbsp;        Vertex v1 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;);</b>
<b class="fc">&nbsp;        Vertex v2 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;);</b>
<b class="fc">&nbsp;        Vertex v3 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;);</b>
<b class="fc">&nbsp;        Edge edge1 = v1.addEdge(&quot;test&quot;, v2);</b>
<b class="fc">&nbsp;        Edge edge2 = v1.addEdge(&quot;test&quot;, v3);</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        edge1.remove();</b>
<b class="fc">&nbsp;        edge2.remove();</b>
<b class="fc">&nbsp;        v1.remove();</b>
<b class="fc">&nbsp;        v2.remove();</b>
<b class="fc">&nbsp;        v3.remove();</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        testBatchRemoveVerticesAndEdges_assert(this.sqlgGraph);</b>
<b class="pc">&nbsp;        if (this.sqlgGraph1 != null) {</b>
<b class="fc">&nbsp;            Thread.sleep(1000);</b>
<b class="fc">&nbsp;            testBatchRemoveVerticesAndEdges_assert(this.sqlgGraph1);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void testBatchRemoveVerticesAndEdges_assert(SqlgGraph sqlgGraph) {
<b class="fc">&nbsp;        Assert.assertEquals(0, sqlgGraph.traversal().V().count().next().intValue());</b>
<b class="fc">&nbsp;        Assert.assertEquals(0, sqlgGraph.traversal().E().count().next().intValue());</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testBatchRemoveVerticesEdgesMustBeGone() throws InterruptedException {
<b class="fc">&nbsp;        Vertex v1 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;);</b>
<b class="fc">&nbsp;        Vertex v2 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;);</b>
<b class="fc">&nbsp;        Vertex v3 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;);</b>
<b class="fc">&nbsp;        v1.addEdge(&quot;test&quot;, v2);</b>
<b class="fc">&nbsp;        v1.addEdge(&quot;test&quot;, v3);</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        v1.remove();</b>
<b class="fc">&nbsp;        v2.remove();</b>
<b class="fc">&nbsp;        v3.remove();</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        testBatchRemoveVerticesEdgesMustBeGone_assert(this.sqlgGraph);</b>
<b class="pc">&nbsp;        if (this.sqlgGraph1 != null) {</b>
<b class="fc">&nbsp;            Thread.sleep(1000);</b>
<b class="fc">&nbsp;            testBatchRemoveVerticesEdgesMustBeGone_assert(this.sqlgGraph1);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testBatchRemoveVerticesEdgesMustBeGoneUserSuppliedPK() throws InterruptedException {
<b class="fc">&nbsp;        VertexLabel personVertexLabel = this.sqlgGraph.getTopology().getPublicSchema()</b>
<b class="fc">&nbsp;                .ensureVertexLabelExist(</b>
&nbsp;                        &quot;Person&quot;,
<b class="fc">&nbsp;                        new HashMap&lt;&gt;() {{</b>
<b class="fc">&nbsp;                            put(&quot;uid1&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="fc">&nbsp;                            put(&quot;uid2&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
&nbsp;                        }},
<b class="fc">&nbsp;                        ListOrderedSet.listOrderedSet(Arrays.asList(&quot;uid1&quot;, &quot;uid2&quot;))</b>
&nbsp;                );
<b class="fc">&nbsp;        personVertexLabel.ensureEdgeLabelExist(</b>
&nbsp;                &quot;test&quot;,
&nbsp;                personVertexLabel,
<b class="fc">&nbsp;                new HashMap&lt;&gt;() {{</b>
<b class="fc">&nbsp;                    put(&quot;uid1&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="fc">&nbsp;                    put(&quot;uid2&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
&nbsp;                }},
<b class="fc">&nbsp;                ListOrderedSet.listOrderedSet(Arrays.asList(&quot;uid1&quot;, &quot;uid2&quot;))</b>
&nbsp;        );
<b class="fc">&nbsp;        Vertex v1 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;uid1&quot;, UUID.randomUUID().toString(), &quot;uid2&quot;, UUID.randomUUID().toString());</b>
<b class="fc">&nbsp;        Vertex v2 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;uid1&quot;, UUID.randomUUID().toString(), &quot;uid2&quot;, UUID.randomUUID().toString());</b>
<b class="fc">&nbsp;        Vertex v3 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;uid1&quot;, UUID.randomUUID().toString(), &quot;uid2&quot;, UUID.randomUUID().toString());</b>
<b class="fc">&nbsp;        v1.addEdge(&quot;test&quot;, v2, &quot;uid1&quot;, UUID.randomUUID().toString(), &quot;uid2&quot;, UUID.randomUUID().toString());</b>
<b class="fc">&nbsp;        v1.addEdge(&quot;test&quot;, v3, &quot;uid1&quot;, UUID.randomUUID().toString(), &quot;uid2&quot;, UUID.randomUUID().toString());</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        v1.remove();</b>
<b class="fc">&nbsp;        v2.remove();</b>
<b class="fc">&nbsp;        v3.remove();</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        testBatchRemoveVerticesEdgesMustBeGone_assert(this.sqlgGraph);</b>
<b class="pc">&nbsp;        if (this.sqlgGraph1 != null) {</b>
<b class="fc">&nbsp;            Thread.sleep(1000);</b>
<b class="fc">&nbsp;            testBatchRemoveVerticesEdgesMustBeGone_assert(this.sqlgGraph1);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void testBatchRemoveVerticesEdgesMustBeGone_assert(SqlgGraph sqlgGraph) {
<b class="fc">&nbsp;        Assert.assertEquals(0, sqlgGraph.traversal().V().count().next().intValue());</b>
<b class="fc">&nbsp;        Assert.assertEquals(0, sqlgGraph.traversal().E().count().next().intValue());</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testDeletePerformance() throws InterruptedException {
<b class="fc">&nbsp;        StopWatch stopWatch = new StopWatch();</b>
<b class="fc">&nbsp;        stopWatch.start();</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
&nbsp;        //32767
<b class="fc">&nbsp;        int j = 1;</b>
&nbsp;        //createVertexLabel 280 foreign keys
<b class="fc">&nbsp;        for (int i = 0; i &lt; 2810; i++) {</b>
<b class="fc">&nbsp;            Vertex v1 = this.sqlgGraph.addVertex(T.label, this.sqlgGraph.getSqlDialect().getPublicSchema() + &quot;.WorkspaceElement&quot;, &quot;name&quot;, &quot;workspaceElement&quot; + i);</b>
<b class="fc">&nbsp;            if (j == 281) {</b>
<b class="fc">&nbsp;                j = 1;</b>
&nbsp;            }
<b class="fc">&nbsp;            Vertex v2 = this.sqlgGraph.addVertex(T.label, &quot;huawei.NetworkElement&quot;, &quot;name&quot;, &quot;networkElement&quot; + i + &quot;_&quot; + j);</b>
<b class="fc">&nbsp;            v2.addEdge(&quot;WorkspaceElement_NetworkElement&quot; + j, v1);</b>
<b class="fc">&nbsp;            j++;</b>
&nbsp;        }
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        stopWatch.stop();</b>
<b class="fc">&nbsp;        stopWatch.reset();</b>
<b class="fc">&nbsp;        stopWatch.start();</b>
<b class="fc">&nbsp;        List&lt;Vertex&gt; vertexes = this.sqlgGraph.traversal().V().has(T.label, this.sqlgGraph.getSqlDialect().getPublicSchema() + &quot;.WorkspaceElement&quot;).toList();</b>
<b class="fc">&nbsp;        for (Vertex sqlgVertex : vertexes) {</b>
<b class="fc">&nbsp;            sqlgVertex.remove();</b>
&nbsp;        }
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        Assert.assertEquals(0, this.sqlgGraph.traversal().E().count().next().intValue());</b>
<b class="fc">&nbsp;        vertexes = this.sqlgGraph.traversal().V().has(T.label, &quot;huawei.NetworkElement&quot;).toList();</b>
<b class="fc">&nbsp;        for (Vertex sqlgVertex : vertexes) {</b>
<b class="fc">&nbsp;            sqlgVertex.remove();</b>
&nbsp;        }
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        stopWatch.stop();</b>
<b class="fc">&nbsp;        testDeletePerformance_assert(this.sqlgGraph);</b>
<b class="pc">&nbsp;        if (this.sqlgGraph1 != null) {</b>
<b class="fc">&nbsp;            Thread.sleep(1000);</b>
<b class="fc">&nbsp;            testDeletePerformance_assert(this.sqlgGraph1);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void testDeletePerformance_assert(SqlgGraph sqlgGraph) {
<b class="fc">&nbsp;        Assert.assertEquals(0, sqlgGraph.traversal().V().count().next().intValue());</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testDropForeignKeys() {
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        Vertex workspaceElementBsc = this.sqlgGraph.addVertex(T.label, &quot;WorkspaceElement&quot;, &quot;name&quot;, &quot;bsc1&quot;);</b>
<b class="fc">&nbsp;        Vertex networkElementBsc = this.sqlgGraph.addVertex(T.label, &quot;bsc&quot;, &quot;name&quot;, &quot;bsc1&quot;);</b>
<b class="fc">&nbsp;        Vertex workspaceElementCell1 = this.sqlgGraph.addVertex(T.label, &quot;WorkspaceElement&quot;, &quot;name&quot;, &quot;cell1&quot;);</b>
<b class="fc">&nbsp;        Vertex networkElementCell1 = this.sqlgGraph.addVertex(T.label, &quot;cell&quot;, &quot;name&quot;, &quot;cell1&quot;);</b>
<b class="fc">&nbsp;        Vertex workspaceElementCell2 = this.sqlgGraph.addVertex(T.label, &quot;WorkspaceElement&quot;, &quot;name&quot;, &quot;cell2&quot;);</b>
<b class="fc">&nbsp;        Vertex networkElementCell2 = this.sqlgGraph.addVertex(T.label, &quot;cell&quot;, &quot;name&quot;, &quot;cell2&quot;);</b>
<b class="fc">&nbsp;        Vertex workspaceElementBsctmr1 = this.sqlgGraph.addVertex(T.label, &quot;WorkspaceElement&quot;, &quot;name&quot;, &quot;bsctmr1&quot;);</b>
<b class="fc">&nbsp;        Vertex networkElementBsctmr1 = this.sqlgGraph.addVertex(T.label, &quot;bsctmr&quot;, &quot;name&quot;, &quot;bsctms1&quot;);</b>
&nbsp;        //add edges to workspaceelement
<b class="fc">&nbsp;        networkElementBsc.addEdge(&quot;bsc_workspaceElement&quot;, workspaceElementBsc);</b>
<b class="fc">&nbsp;        networkElementCell1.addEdge(&quot;cell_workspaceElement&quot;, workspaceElementCell1);</b>
<b class="fc">&nbsp;        networkElementCell2.addEdge(&quot;cell_workspaceElement&quot;, workspaceElementCell2);</b>
<b class="fc">&nbsp;        networkElementBsctmr1.addEdge(&quot;bsctmr_workspaceElement&quot;, workspaceElementBsctmr1);</b>
&nbsp;
&nbsp;        //add edges to between elements
<b class="fc">&nbsp;        networkElementBsc.addEdge(&quot;bsc_cell&quot;, networkElementCell1);</b>
<b class="fc">&nbsp;        networkElementBsc.addEdge(&quot;bsc_cell&quot;, networkElementCell2);</b>
<b class="fc">&nbsp;        networkElementBsc.addEdge(&quot;bsc_bsctmr&quot;, networkElementBsctmr1);</b>
&nbsp;
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
&nbsp;
<b class="fc">&nbsp;        List&lt;Vertex&gt; vertexes = this.sqlgGraph.traversal().V().has(T.label, &quot;WorkspaceElement&quot;).toList();</b>
<b class="fc">&nbsp;        for (Vertex sqlgVertex : vertexes) {</b>
<b class="fc">&nbsp;            sqlgVertex.remove();</b>
&nbsp;        }
<b class="fc">&nbsp;        vertexes = this.sqlgGraph.traversal().V().has(T.label, &quot;bsc&quot;).toList();</b>
<b class="fc">&nbsp;        for (Vertex sqlgVertex : vertexes) {</b>
<b class="fc">&nbsp;            sqlgVertex.remove();</b>
&nbsp;        }
<b class="fc">&nbsp;        vertexes = this.sqlgGraph.traversal().V().has(T.label, &quot;cell&quot;).toList();</b>
<b class="fc">&nbsp;        for (Vertex sqlgVertex : vertexes) {</b>
<b class="fc">&nbsp;            sqlgVertex.remove();</b>
&nbsp;        }
<b class="fc">&nbsp;        vertexes = this.sqlgGraph.traversal().V().has(T.label, &quot;bsctmr&quot;).toList();</b>
<b class="fc">&nbsp;        for (Vertex sqlgVertex : vertexes) {</b>
<b class="fc">&nbsp;            sqlgVertex.remove();</b>
&nbsp;        }
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testBatchDeleteVertexNewlyAdded() throws InterruptedException {
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        Vertex v1 = this.sqlgGraph.addVertex(T.label, &quot;test1.Person&quot;, &quot;name&quot;, &quot;john&quot;);</b>
<b class="fc">&nbsp;        for (int i = 0; i &lt; 100; i++) {</b>
<b class="fc">&nbsp;            Vertex v2 = this.sqlgGraph.addVertex(T.label, &quot;test2.Car&quot;, &quot;model&quot;, &quot;vw&quot;);</b>
<b class="fc">&nbsp;            v1.addEdge(&quot;car&quot;, v2, &quot;bought&quot;, 1);</b>
&nbsp;        }
<b class="fc">&nbsp;        List&lt;Vertex&gt; cars = vertexTraversal(this.sqlgGraph, v1).out(&quot;car&quot;).toList();</b>
<b class="fc">&nbsp;        for (int i = 0; i &lt; 50; i++) {</b>
<b class="fc">&nbsp;            cars.get(i).remove();</b>
&nbsp;        }
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        testBatchDeleteVertexNewlyAdded_assert(this.sqlgGraph);</b>
<b class="pc">&nbsp;        if (this.sqlgGraph1 != null) {</b>
<b class="fc">&nbsp;            Thread.sleep(1000);</b>
<b class="fc">&nbsp;            testBatchDeleteVertexNewlyAdded_assert(this.sqlgGraph1);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void testBatchDeleteVertexNewlyAdded_assert(SqlgGraph sqlgGraph) {
<b class="fc">&nbsp;        Assert.assertEquals(51, sqlgGraph.traversal().V().count().next().intValue());</b>
<b class="fc">&nbsp;        Assert.assertEquals(50, sqlgGraph.traversal().E().count().next().intValue());</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testBatchDeleteEdgeNewlyAdded() throws InterruptedException {
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        Vertex v1 = this.sqlgGraph.addVertex(T.label, &quot;test1.Person&quot;, &quot;name&quot;, &quot;john&quot;);</b>
<b class="fc">&nbsp;        for (int i = 0; i &lt; 100; i++) {</b>
<b class="fc">&nbsp;            Vertex v2 = this.sqlgGraph.addVertex(T.label, &quot;test2.Car&quot;, &quot;model&quot;, &quot;vw&quot;);</b>
<b class="fc">&nbsp;            v1.addEdge(&quot;car&quot;, v2, &quot;bought&quot;, 1);</b>
&nbsp;        }
<b class="fc">&nbsp;        List&lt;Edge&gt; cars = vertexTraversal(this.sqlgGraph, v1).outE(&quot;car&quot;).toList();</b>
<b class="fc">&nbsp;        for (int i = 0; i &lt; 50; i++) {</b>
<b class="fc">&nbsp;            cars.get(i).remove();</b>
&nbsp;        }
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        testBatchDeleteEdgeNewlyAdded_assert(this.sqlgGraph);</b>
<b class="pc">&nbsp;        if (this.sqlgGraph1 != null) {</b>
<b class="fc">&nbsp;            Thread.sleep(1000);</b>
<b class="fc">&nbsp;            testBatchDeleteEdgeNewlyAdded_assert(this.sqlgGraph1);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void testBatchDeleteEdgeNewlyAdded_assert(SqlgGraph sqlgGraph) {
<b class="fc">&nbsp;        Assert.assertEquals(101, sqlgGraph.traversal().V().count().next().intValue());</b>
<b class="fc">&nbsp;        Assert.assertEquals(50, sqlgGraph.traversal().E().count().next().intValue());</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testNullEdge() throws InterruptedException {
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        Vertex v1 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;dummy&quot;, &quot;a&quot;);</b>
<b class="fc">&nbsp;        Assert.assertEquals(0, vertexTraversal(this.sqlgGraph, v1).out(&quot;cars&quot;).count().next().intValue());</b>
<b class="fc">&nbsp;        Vertex v2 = this.sqlgGraph.addVertex(T.label, &quot;Car&quot;, &quot;dummy&quot;, &quot;a&quot;);</b>
<b class="fc">&nbsp;        v1.addEdge(&quot;cars&quot;, v2);</b>
<b class="fc">&nbsp;        Assert.assertEquals(1, vertexTraversal(this.sqlgGraph, v1).out(&quot;cars&quot;).count().next().intValue());</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        testNullEdge_assert(this.sqlgGraph, v1);</b>
<b class="pc">&nbsp;        if (this.sqlgGraph1 != null) {</b>
<b class="fc">&nbsp;            Thread.sleep(1000);</b>
<b class="fc">&nbsp;            testNullEdge_assert(this.sqlgGraph1, v1);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void testNullEdge_assert(SqlgGraph sqlgGraph, Vertex v1) {
<b class="fc">&nbsp;        Assert.assertEquals(1, sqlgGraph.traversal().V(v1).out(&quot;cars&quot;).count().next().intValue());</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testBatchModeStuffsUpProperties() {
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        Vertex v1 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;a&quot;);</b>
<b class="fc">&nbsp;        Vertex v2 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;b&quot;);</b>
<b class="fc">&nbsp;        Assert.assertEquals(&quot;a&quot;, v1.value(&quot;name&quot;));</b>
<b class="fc">&nbsp;        Assert.assertEquals(&quot;b&quot;, v2.value(&quot;name&quot;));</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testBatchUpdateDifferentPropertiesDifferentRows() throws InterruptedException {
&nbsp;
<b class="fc">&nbsp;        Vertex sqlgVertex1 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;property1&quot;, &quot;a1&quot;, &quot;property2&quot;, &quot;b1&quot;, &quot;property3&quot;, &quot;c1&quot;);</b>
<b class="fc">&nbsp;        Vertex sqlgVertex2 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;property1&quot;, &quot;a2&quot;, &quot;property2&quot;, &quot;b2&quot;, &quot;property3&quot;, &quot;c2&quot;);</b>
<b class="fc">&nbsp;        Vertex sqlgVertex3 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;property1&quot;, &quot;a3&quot;, &quot;property2&quot;, &quot;b3&quot;, &quot;property3&quot;, &quot;c3&quot;);</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;
<b class="fc">&nbsp;        sqlgVertex1 = this.sqlgGraph.traversal().V(sqlgVertex1.id()).next();</b>
<b class="fc">&nbsp;        Assert.assertEquals(&quot;a1&quot;, sqlgVertex1.value(&quot;property1&quot;));</b>
<b class="fc">&nbsp;        Assert.assertEquals(&quot;b1&quot;, sqlgVertex1.value(&quot;property2&quot;));</b>
<b class="fc">&nbsp;        Assert.assertEquals(&quot;c1&quot;, sqlgVertex1.value(&quot;property3&quot;));</b>
&nbsp;
<b class="fc">&nbsp;        this.sqlgGraph.tx().rollback();</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        sqlgVertex1 = this.sqlgGraph.traversal().V(sqlgVertex1.id()).next();</b>
<b class="fc">&nbsp;        sqlgVertex1.property(&quot;property1&quot;, &quot;a11&quot;);</b>
<b class="fc">&nbsp;        sqlgVertex2.property(&quot;property2&quot;, &quot;b22&quot;);</b>
<b class="fc">&nbsp;        sqlgVertex3.property(&quot;property3&quot;, &quot;c33&quot;);</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;
<b class="fc">&nbsp;        Assert.assertEquals(&quot;a11&quot;, sqlgVertex1.value(&quot;property1&quot;));</b>
<b class="fc">&nbsp;        Assert.assertEquals(&quot;b1&quot;, sqlgVertex1.value(&quot;property2&quot;));</b>
<b class="fc">&nbsp;        Assert.assertEquals(&quot;c1&quot;, sqlgVertex1.value(&quot;property3&quot;));</b>
&nbsp;
<b class="fc">&nbsp;        testBatchUpdateDifferentPropertiesDifferentRows_assert(this.sqlgGraph, sqlgVertex1, sqlgVertex2, sqlgVertex3);</b>
<b class="pc">&nbsp;        if (this.sqlgGraph1 != null) {</b>
<b class="fc">&nbsp;            Thread.sleep(1000);</b>
<b class="fc">&nbsp;            testBatchUpdateDifferentPropertiesDifferentRows_assert(this.sqlgGraph1, sqlgVertex1, sqlgVertex2, sqlgVertex3);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void testBatchUpdateDifferentPropertiesDifferentRows_assert(SqlgGraph sqlgGraph, Vertex sqlgVertex1, Vertex sqlgVertex2, Vertex sqlgVertex3) {
<b class="fc">&nbsp;        sqlgVertex1 = sqlgGraph.traversal().V(sqlgVertex1).next();</b>
<b class="fc">&nbsp;        sqlgVertex2 = sqlgGraph.traversal().V(sqlgVertex2).next();</b>
<b class="fc">&nbsp;        sqlgVertex3 = sqlgGraph.traversal().V(sqlgVertex3).next();</b>
&nbsp;
<b class="fc">&nbsp;        Assert.assertEquals(&quot;a11&quot;, sqlgVertex1.value(&quot;property1&quot;));</b>
<b class="fc">&nbsp;        Assert.assertEquals(&quot;b1&quot;, sqlgVertex1.value(&quot;property2&quot;));</b>
<b class="fc">&nbsp;        Assert.assertEquals(&quot;c1&quot;, sqlgVertex1.value(&quot;property3&quot;));</b>
&nbsp;
<b class="fc">&nbsp;        sqlgVertex1 = sqlgGraph.traversal().V(sqlgVertex1.id()).next();</b>
<b class="fc">&nbsp;        Assert.assertEquals(&quot;a11&quot;, sqlgVertex1.value(&quot;property1&quot;));</b>
<b class="fc">&nbsp;        Assert.assertEquals(&quot;b1&quot;, sqlgVertex1.value(&quot;property2&quot;));</b>
<b class="fc">&nbsp;        Assert.assertEquals(&quot;c1&quot;, sqlgVertex1.value(&quot;property3&quot;));</b>
&nbsp;
<b class="fc">&nbsp;        sqlgVertex2 = sqlgGraph.traversal().V(sqlgVertex2.id()).next();</b>
<b class="fc">&nbsp;        Assert.assertEquals(&quot;a2&quot;, sqlgVertex2.value(&quot;property1&quot;));</b>
<b class="fc">&nbsp;        Assert.assertEquals(&quot;b22&quot;, sqlgVertex2.value(&quot;property2&quot;));</b>
<b class="fc">&nbsp;        Assert.assertEquals(&quot;c2&quot;, sqlgVertex2.value(&quot;property3&quot;));</b>
&nbsp;
<b class="fc">&nbsp;        sqlgVertex3 = sqlgGraph.traversal().V(sqlgVertex3.id()).next();</b>
<b class="fc">&nbsp;        Assert.assertEquals(&quot;a3&quot;, sqlgVertex3.value(&quot;property1&quot;));</b>
<b class="fc">&nbsp;        Assert.assertEquals(&quot;b3&quot;, sqlgVertex3.value(&quot;property2&quot;));</b>
<b class="fc">&nbsp;        Assert.assertEquals(&quot;c33&quot;, sqlgVertex3.value(&quot;property3&quot;));</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testBatchUpdateNewVertex() throws InterruptedException {
<b class="fc">&nbsp;        Vertex v1 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;property1&quot;, &quot;a&quot;);</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        Vertex v2 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;);</b>
<b class="fc">&nbsp;        v2.property(&quot;property2&quot;, &quot;bb&quot;);</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        Assert.assertEquals(&quot;a&quot;, v1.value(&quot;property1&quot;));</b>
<b class="fc">&nbsp;        Assert.assertNull(v1.property(&quot;property2&quot;).value());</b>
<b class="fc">&nbsp;        Assert.assertNull(v2.property(&quot;property1&quot;).value());</b>
<b class="fc">&nbsp;        Assert.assertEquals(&quot;bb&quot;, v2.value(&quot;property2&quot;));</b>
<b class="fc">&nbsp;        testBatchUpdateNewVertex_assert(this.sqlgGraph, v1, v2);</b>
<b class="pc">&nbsp;        if (this.sqlgGraph1 != null) {</b>
<b class="fc">&nbsp;            Thread.sleep(1000);</b>
<b class="fc">&nbsp;            testBatchUpdateNewVertex_assert(this.sqlgGraph1, v1, v2);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void testBatchUpdateNewVertex_assert(SqlgGraph sqlgGraph, Vertex v1, Vertex v2) {
<b class="fc">&nbsp;        v1 = sqlgGraph.traversal().V(v1).next();</b>
<b class="fc">&nbsp;        v2 = sqlgGraph.traversal().V(v2).next();</b>
<b class="fc">&nbsp;        Assert.assertEquals(&quot;a&quot;, v1.value(&quot;property1&quot;));</b>
<b class="fc">&nbsp;        Assert.assertNull(v1.property(&quot;property2&quot;).value());</b>
<b class="fc">&nbsp;        Assert.assertNull(v2.property(&quot;property1&quot;).value());</b>
<b class="fc">&nbsp;        Assert.assertEquals(&quot;bb&quot;, v2.value(&quot;property2&quot;));</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testBatchRemoveManyEdgesTestPostgresLimit() throws InterruptedException {
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        Vertex v1 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;dummy&quot;, &quot;a&quot;);</b>
<b class="fc">&nbsp;        for (int i = 0; i &lt; 100000; i++) {</b>
<b class="fc">&nbsp;            Vertex v2 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;dummy&quot;, &quot;a&quot;);</b>
<b class="fc">&nbsp;            v1.addEdge(&quot;test&quot;, v2);</b>
&nbsp;        }
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        Assert.assertEquals(100001, this.sqlgGraph.traversal().V().count().next().intValue());</b>
<b class="fc">&nbsp;        Assert.assertEquals(100000, this.sqlgGraph.traversal().E().count().next().intValue());</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().rollback();</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        vertexTraversal(this.sqlgGraph, v1).outE(&quot;test&quot;).forEachRemaining(Edge::remove);</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        testBatchRemoveManyEdgesTestPostgresLimit_assert(this.sqlgGraph);</b>
<b class="pc">&nbsp;        if (this.sqlgGraph1 != null) {</b>
<b class="fc">&nbsp;            Thread.sleep(1000);</b>
<b class="fc">&nbsp;            testBatchRemoveManyEdgesTestPostgresLimit_assert(this.sqlgGraph1);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testBatchRemoveManyEdgesTestPostgresLimitUserSuppliedPK() throws InterruptedException {
<b class="fc">&nbsp;        Assume.assumeTrue(!isMsSqlServer());</b>
<b class="fc">&nbsp;        VertexLabel personVertexLabel = this.sqlgGraph.getTopology().getPublicSchema()</b>
<b class="fc">&nbsp;                .ensureVertexLabelExist(</b>
&nbsp;                        &quot;Person&quot;,
<b class="fc">&nbsp;                        new HashMap&lt;&gt;() {{</b>
<b class="fc">&nbsp;                            put(&quot;uid1&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="fc">&nbsp;                            put(&quot;uid2&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="fc">&nbsp;                            put(&quot;dummy&quot;, PropertyDefinition.of(PropertyType.STRING));</b>
&nbsp;                        }},
<b class="fc">&nbsp;                        ListOrderedSet.listOrderedSet(Arrays.asList(&quot;uid1&quot;, &quot;uid2&quot;))</b>
&nbsp;                );
<b class="fc">&nbsp;        personVertexLabel.ensureEdgeLabelExist(</b>
&nbsp;                &quot;test&quot;,
&nbsp;                personVertexLabel,
<b class="fc">&nbsp;                new HashMap&lt;&gt;() {{</b>
<b class="fc">&nbsp;                    put(&quot;uid1&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="fc">&nbsp;                    put(&quot;uid2&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
&nbsp;                }},
<b class="fc">&nbsp;                ListOrderedSet.listOrderedSet(Arrays.asList(&quot;uid1&quot;, &quot;uid2&quot;))</b>
&nbsp;        );
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        Vertex v1 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;dummy&quot;, &quot;a&quot;, &quot;uid1&quot;, UUID.randomUUID().toString(), &quot;uid2&quot;, UUID.randomUUID().toString());</b>
<b class="fc">&nbsp;        for (int i = 0; i &lt; 100000; i++) {</b>
<b class="fc">&nbsp;            Vertex v2 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;dummy&quot;, &quot;a&quot;, &quot;uid1&quot;, UUID.randomUUID().toString(), &quot;uid2&quot;, UUID.randomUUID().toString());</b>
<b class="fc">&nbsp;            v1.addEdge(&quot;test&quot;, v2, &quot;uid1&quot;, UUID.randomUUID().toString(), &quot;uid2&quot;, UUID.randomUUID().toString());</b>
&nbsp;        }
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        Assert.assertEquals(100001, this.sqlgGraph.traversal().V().count().next().intValue());</b>
<b class="fc">&nbsp;        Assert.assertEquals(100000, this.sqlgGraph.traversal().E().count().next().intValue());</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().rollback();</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        vertexTraversal(this.sqlgGraph, v1).outE(&quot;test&quot;).forEachRemaining(Edge::remove);</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        testBatchRemoveManyEdgesTestPostgresLimit_assert(this.sqlgGraph);</b>
<b class="pc">&nbsp;        if (this.sqlgGraph1 != null) {</b>
<b class="fc">&nbsp;            Thread.sleep(1000);</b>
<b class="fc">&nbsp;            testBatchRemoveManyEdgesTestPostgresLimit_assert(this.sqlgGraph1);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void testBatchRemoveManyEdgesTestPostgresLimit_assert(SqlgGraph sqlgGraph) {
<b class="fc">&nbsp;        Assert.assertEquals(100001, sqlgGraph.traversal().V().count().next().intValue());</b>
<b class="fc">&nbsp;        Assert.assertEquals(0, sqlgGraph.traversal().E().count().next().intValue());</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testNoProperties() {
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        for (int i = 0; i &lt; 100; i++) {</b>
<b class="fc">&nbsp;            Vertex person1 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;);</b>
<b class="fc">&nbsp;            Vertex person2 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;);</b>
<b class="fc">&nbsp;            person1.addEdge(&quot;friend&quot;, person2);</b>
<b class="fc">&nbsp;            if (i != 0 &amp;&amp; i % 10 == 0) {</b>
<b class="fc">&nbsp;                this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;                this.sqlgGraph.tx().normalBatchModeOn();</b>
&nbsp;            }
&nbsp;        }
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testBatchEdgeLoadProperty() {
<b class="fc">&nbsp;        Vertex root = this.sqlgGraph.addVertex(T.label, &quot;ROOT&quot;);</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        Vertex god = this.sqlgGraph.addVertex(T.label, &quot;GOD&quot;);</b>
<b class="fc">&nbsp;        Edge edgeToRoot = root.addEdge(&quot;edgeToRoot&quot;, god);</b>
<b class="fc">&nbsp;        edgeToRoot.property(&quot;className&quot;, &quot;thisthatandanother&quot;);</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        Assert.assertEquals(1, this.sqlgGraph.traversal().V().hasLabel(&quot;GOD&quot;).count().next(), 0);</b>
<b class="fc">&nbsp;        Assert.assertEquals(god, this.sqlgGraph.traversal().V().hasLabel(&quot;GOD&quot;).next());</b>
<b class="fc">&nbsp;        Assert.assertEquals(1, this.sqlgGraph.traversal().E().hasLabel(&quot;edgeToRoot&quot;).count().next(), 0);</b>
<b class="fc">&nbsp;        Assert.assertEquals(edgeToRoot, this.sqlgGraph.traversal().E().hasLabel(&quot;edgeToRoot&quot;).next());</b>
<b class="fc">&nbsp;        Assert.assertEquals(&quot;thisthatandanother&quot;, this.sqlgGraph.traversal().E().hasLabel(&quot;edgeToRoot&quot;).next().value(&quot;className&quot;));</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testEmptyEdge() {
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        Vertex v1 = this.sqlgGraph.addVertex(T.label, &quot;A&quot;);</b>
<b class="fc">&nbsp;        Vertex v2 = this.sqlgGraph.addVertex(T.label, &quot;B&quot;);</b>
<b class="fc">&nbsp;        v1.addEdge(&quot;ab&quot;, v2);</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        Assert.assertEquals(2, this.sqlgGraph.traversal().V().count().next(), 0);</b>
<b class="fc">&nbsp;        Assert.assertEquals(1, this.sqlgGraph.traversal().E().count().next(), 0);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testEmpty() throws InterruptedException {
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        Vertex person1 = this.sqlgGraph.addVertex(T.label, &quot;Empty&quot;, &quot;empty&quot;, &quot;&quot;);</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        testEmpty_assert(this.sqlgGraph, person1);</b>
<b class="pc">&nbsp;        if (this.sqlgGraph1 != null) {</b>
<b class="fc">&nbsp;            Thread.sleep(1000);</b>
<b class="fc">&nbsp;            testEmpty_assert(this.sqlgGraph1, person1);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void testEmpty_assert(SqlgGraph sqlgGraph, Vertex person1) {
<b class="fc">&nbsp;        Assert.assertNotNull(person1.id());</b>
<b class="fc">&nbsp;        Object o = sqlgGraph.traversal().V().hasLabel(&quot;Empty&quot;).values(&quot;empty&quot;).next();</b>
<b class="fc">&nbsp;        Assert.assertEquals(&quot;&quot;, o);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testEmpty106() throws InterruptedException {
<b class="fc">&nbsp;        this.sqlgGraph.tx().normalBatchModeOn();</b>
<b class="fc">&nbsp;        this.sqlgGraph.addVertex(&quot;A&quot;, Collections.singletonMap(&quot;emptyProperty&quot;, &quot;&quot;));</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        testEmpty106_assert(this.sqlgGraph);</b>
<b class="pc">&nbsp;        if (this.sqlgGraph1 != null) {</b>
<b class="fc">&nbsp;            Thread.sleep(1000);</b>
<b class="fc">&nbsp;            testEmpty106_assert(this.sqlgGraph1);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void testEmpty106_assert(SqlgGraph sqlgGraph) {
<b class="fc">&nbsp;        Vertex a = sqlgGraph.traversal().V().hasLabel(&quot;A&quot;).next();</b>
<b class="fc">&nbsp;        Assert.assertEquals(&quot;&quot;, a.property(&quot;emptyProperty&quot;).value());</b>
&nbsp;    }
&nbsp;
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2025-06-23 10:13</div>
</div>
</body>
</html>
