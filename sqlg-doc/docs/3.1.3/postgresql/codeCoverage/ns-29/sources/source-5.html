


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > TestReducingUserSuppliedIds</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">org.umlg.sqlg.test.reducing</a>
</div>

<h1>Coverage Summary for Class: TestReducingUserSuppliedIds (org.umlg.sqlg.test.reducing)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">TestReducingUserSuppliedIds</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/54)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/118)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1242)
  </span>
</td>
</tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$10</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$100</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$101</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$102</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$103</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$104</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$105</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$106</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$107</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$108</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$109</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$11</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$12</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$13</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$14</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$15</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$16</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$17</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/6)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$18</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/6)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$19</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$2</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$20</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$21</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$22</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$23</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$24</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$25</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$26</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$27</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$28</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$29</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$3</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$30</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$31</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$32</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$33</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$34</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$35</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$36</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$37</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$38</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$39</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$4</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$40</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$41</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$42</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$43</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$44</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$45</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$46</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$47</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$48</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$49</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$5</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$50</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$51</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$52</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$53</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$54</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$55</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$56</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$57</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$58</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$59</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$6</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$60</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$61</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$62</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$63</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$64</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$65</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$66</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$67</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$68</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$69</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$7</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$70</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$71</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$72</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$73</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$74</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$75</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$76</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$77</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$78</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$79</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$8</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$80</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$81</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$82</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$83</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$84</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$85</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$86</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$87</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$88</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$89</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$9</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$90</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$91</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$92</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$93</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$94</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$95</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$96</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$97</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$98</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestReducingUserSuppliedIds$99</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/163)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/118)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1574)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package org.umlg.sqlg.test.reducing;
&nbsp;
&nbsp;import org.apache.commons.collections4.set.ListOrderedSet;
&nbsp;import org.apache.tinkerpop.gremlin.process.traversal.Traversal;
&nbsp;import org.apache.tinkerpop.gremlin.process.traversal.dsl.graph.__;
&nbsp;import org.apache.tinkerpop.gremlin.process.traversal.step.map.GroupStep;
&nbsp;import org.apache.tinkerpop.gremlin.process.traversal.util.DefaultTraversal;
&nbsp;import org.apache.tinkerpop.gremlin.structure.T;
&nbsp;import org.apache.tinkerpop.gremlin.structure.Vertex;
&nbsp;import org.junit.Assert;
&nbsp;import org.junit.Before;
&nbsp;import org.junit.Test;
&nbsp;import org.umlg.sqlg.step.SqlgGraphStep;
&nbsp;import org.umlg.sqlg.step.SqlgGroupStep;
&nbsp;import org.umlg.sqlg.step.SqlgPropertiesStep;
&nbsp;import org.umlg.sqlg.step.barrier.*;
&nbsp;import org.umlg.sqlg.structure.PropertyDefinition;
&nbsp;import org.umlg.sqlg.structure.PropertyType;
&nbsp;import org.umlg.sqlg.structure.topology.VertexLabel;
&nbsp;import org.umlg.sqlg.test.BaseTest;
&nbsp;
&nbsp;import java.sql.Connection;
&nbsp;import java.sql.Statement;
&nbsp;import java.util.*;
&nbsp;
&nbsp;/**
&nbsp; * @author &lt;a href=&quot;https://github.com/pietermartin&quot;&gt;Pieter Martin&lt;/a&gt;
&nbsp; * Date: 2018/11/17
&nbsp; */
&nbsp;@SuppressWarnings({&quot;Duplicates&quot;, &quot;unchecked&quot;, &quot;rawtypes&quot;})
<b class="nc">&nbsp;public class TestReducingUserSuppliedIds extends BaseTest {</b>
&nbsp;
&nbsp;    @Before
&nbsp;    public void before() throws Exception {
<b class="nc">&nbsp;        super.before();</b>
<b class="nc">&nbsp;        if (isHsqldb()) {</b>
<b class="nc">&nbsp;            Connection connection = this.sqlgGraph.tx().getConnection();</b>
<b class="nc">&nbsp;            Statement statement = connection.createStatement();</b>
<b class="nc">&nbsp;            statement.execute(&quot;SET DATABASE SQL AVG SCALE 2&quot;);</b>
<b class="nc">&nbsp;            this.sqlgGraph.tx().commit();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testGroupCountNoBySomething() {
<b class="nc">&nbsp;        for (String s : List.of(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;)) {</b>
<b class="nc">&nbsp;            this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                    s,
<b class="nc">&nbsp;                    new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                        put(&quot;uid&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                        put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                        put(&quot;age&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                    }},
<b class="nc">&nbsp;                    ListOrderedSet.listOrderedSet(List.of(&quot;uid&quot;))</b>
&nbsp;            );
&nbsp;        }
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;uid&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;a&quot;, &quot;age&quot;, 1);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;uid&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;a&quot;, &quot;age&quot;, 2);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;uid&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;b&quot;, &quot;age&quot;, 3);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;B&quot;, &quot;uid&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;b&quot;, &quot;age&quot;, 3);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;B&quot;, &quot;uid&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;b&quot;, &quot;age&quot;, 3);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;C&quot;, &quot;uid&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;b&quot;, &quot;age&quot;, 3);</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        DefaultTraversal&lt;Vertex, Map&lt;Long, Long&gt;&gt; traversal = (DefaultTraversal&lt;Vertex, Map&lt;Long, Long&gt;&gt;) this.sqlgGraph.traversal().V().&lt;Long&gt;groupCount().by(__.bothE().count());</b>
<b class="nc">&nbsp;        printTraversalForm(traversal);</b>
<b class="nc">&nbsp;        List&lt;Map&lt;Long, Long&gt;&gt; result = traversal.toList();</b>
<b class="nc">&nbsp;        Assert.assertEquals(1, result.size());</b>
<b class="nc">&nbsp;        Assert.assertEquals(1, result.get(0).size());</b>
<b class="nc">&nbsp;        Assert.assertTrue(result.get(0).values().stream().allMatch(a -&gt; a == 6L));</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testGroupCountNoBy() {
<b class="nc">&nbsp;        for (String s : List.of(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;)) {</b>
<b class="nc">&nbsp;            this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                    s,
<b class="nc">&nbsp;                    new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                        put(&quot;uid&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                        put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                        put(&quot;age&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                    }},
<b class="nc">&nbsp;                    ListOrderedSet.listOrderedSet(List.of(&quot;uid&quot;))</b>
&nbsp;            );
&nbsp;        }
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;uid&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;a&quot;, &quot;age&quot;, 1);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;uid&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;a&quot;, &quot;age&quot;, 2);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;uid&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;b&quot;, &quot;age&quot;, 3);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;B&quot;, &quot;uid&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;b&quot;, &quot;age&quot;, 3);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;B&quot;, &quot;uid&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;b&quot;, &quot;age&quot;, 3);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;C&quot;, &quot;uid&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;b&quot;, &quot;age&quot;, 3);</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        DefaultTraversal&lt;Vertex, Map&lt;Object, Long&gt;&gt; traversal = (DefaultTraversal&lt;Vertex, Map&lt;Object, Long&gt;&gt;) sqlgGraph.traversal().V()</b>
<b class="nc">&nbsp;                .groupCount();</b>
<b class="nc">&nbsp;        printTraversalForm(traversal);</b>
<b class="nc">&nbsp;        List&lt;Map&lt;Object, Long&gt;&gt; result = traversal.toList();</b>
<b class="nc">&nbsp;        Assert.assertEquals(1, result.size());</b>
<b class="nc">&nbsp;        Assert.assertEquals(6, result.get(0).size());</b>
<b class="nc">&nbsp;        Assert.assertTrue(result.get(0).values().stream().allMatch(a -&gt; a == 1L));</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testGroupCount() {
<b class="nc">&nbsp;        this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;A&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;uid&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;age&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;uid&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;uid&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;a&quot;, &quot;age&quot;, 1);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;uid&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;a&quot;, &quot;age&quot;, 2);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;uid&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;b&quot;, &quot;age&quot;, 3);</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        DefaultTraversal&lt;Vertex, Map&lt;Object, Long&gt;&gt; traversal = (DefaultTraversal&lt;Vertex, Map&lt;Object, Long&gt;&gt;) this.sqlgGraph.traversal().V().hasLabel(&quot;A&quot;).groupCount().by(&quot;name&quot;);</b>
<b class="nc">&nbsp;        printTraversalForm(traversal);</b>
<b class="nc">&nbsp;        List&lt;Map&lt;Object, Long&gt;&gt; result = traversal.toList();</b>
<b class="nc">&nbsp;        Assert.assertEquals(1, result.size());</b>
<b class="nc">&nbsp;        Assert.assertEquals(2, result.get(0).get(&quot;a&quot;), 0);</b>
<b class="nc">&nbsp;        Assert.assertEquals(1, result.get(0).get(&quot;b&quot;), 0);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testGroupCountByLabel() {
<b class="nc">&nbsp;        for (String s : List.of(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;)) {</b>
<b class="nc">&nbsp;            this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                    s,
<b class="nc">&nbsp;                    new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                        put(&quot;uid1&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                        put(&quot;uid2&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                        put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                        put(&quot;age&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                    }},
<b class="nc">&nbsp;                    ListOrderedSet.listOrderedSet(List.of(&quot;uid1&quot;, &quot;uid2&quot;))</b>
&nbsp;            );
&nbsp;        }
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;uid1&quot;, UUID.randomUUID().toString(), &quot;uid2&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;a&quot;, &quot;age&quot;, 1);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;uid1&quot;, UUID.randomUUID().toString(), &quot;uid2&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;a&quot;, &quot;age&quot;, 2);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;uid1&quot;, UUID.randomUUID().toString(), &quot;uid2&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;b&quot;, &quot;age&quot;, 3);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;B&quot;, &quot;uid1&quot;, UUID.randomUUID().toString(), &quot;uid2&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;b&quot;, &quot;age&quot;, 3);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;B&quot;, &quot;uid1&quot;, UUID.randomUUID().toString(), &quot;uid2&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;b&quot;, &quot;age&quot;, 3);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;C&quot;, &quot;uid1&quot;, UUID.randomUUID().toString(), &quot;uid2&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;b&quot;, &quot;age&quot;, 3);</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        DefaultTraversal&lt;Vertex, Map&lt;Object, Long&gt;&gt; traversal = (DefaultTraversal&lt;Vertex, Map&lt;Object, Long&gt;&gt;) this.sqlgGraph.traversal().V().groupCount().by(T.label);</b>
<b class="nc">&nbsp;        String sql = getSQL(traversal);</b>
<b class="nc">&nbsp;        if (isPostgres()) {</b>
<b class="nc">&nbsp;            Assert.assertEquals(&quot;\n&quot; +</b>
&nbsp;                    &quot;SELECT\n&quot; +
&nbsp;                    &quot;\tCOUNT(1) AS \&quot;count\&quot;\n&quot; +
&nbsp;                    &quot;FROM\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_C\&quot;&quot;, sql);
&nbsp;        }
<b class="nc">&nbsp;        List&lt;Map&lt;Object, Long&gt;&gt; result = traversal.toList();</b>
<b class="nc">&nbsp;        Assert.assertEquals(1, result.size());</b>
<b class="nc">&nbsp;        Assert.assertEquals(3, result.get(0).size());</b>
<b class="nc">&nbsp;        Assert.assertTrue(result.get(0).containsKey(&quot;A&quot;));</b>
<b class="nc">&nbsp;        Assert.assertTrue(result.get(0).containsKey(&quot;B&quot;));</b>
<b class="nc">&nbsp;        Assert.assertTrue(result.get(0).containsKey(&quot;C&quot;));</b>
<b class="nc">&nbsp;        Assert.assertEquals(3L, result.get(0).get(&quot;A&quot;), 0);</b>
<b class="nc">&nbsp;        Assert.assertEquals(2L, result.get(0).get(&quot;B&quot;), 0);</b>
<b class="nc">&nbsp;        Assert.assertEquals(1L, result.get(0).get(&quot;C&quot;), 0);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testGroupByCountLabel() {
<b class="nc">&nbsp;        for (String s : List.of(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;)) {</b>
<b class="nc">&nbsp;            this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                    s,
<b class="nc">&nbsp;                    new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                        put(&quot;uid1&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                        put(&quot;uid2&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                        put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                        put(&quot;age&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                    }},
<b class="nc">&nbsp;                    ListOrderedSet.listOrderedSet(List.of(&quot;uid1&quot;, &quot;uid2&quot;))</b>
&nbsp;            );
&nbsp;        }
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;uid1&quot;, UUID.randomUUID().toString(), &quot;uid2&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;a&quot;, &quot;age&quot;, 1);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;uid1&quot;, UUID.randomUUID().toString(), &quot;uid2&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;a&quot;, &quot;age&quot;, 2);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;uid1&quot;, UUID.randomUUID().toString(), &quot;uid2&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;b&quot;, &quot;age&quot;, 3);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;B&quot;, &quot;uid1&quot;, UUID.randomUUID().toString(), &quot;uid2&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;b&quot;, &quot;age&quot;, 3);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;B&quot;, &quot;uid1&quot;, UUID.randomUUID().toString(), &quot;uid2&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;b&quot;, &quot;age&quot;, 3);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;C&quot;, &quot;uid1&quot;, UUID.randomUUID().toString(), &quot;uid2&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;b&quot;, &quot;age&quot;, 3);</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        DefaultTraversal&lt;Vertex, Map&lt;Object, Long&gt;&gt; traversal = (DefaultTraversal&lt;Vertex, Map&lt;Object, Long&gt;&gt;) this.sqlgGraph.traversal().V()</b>
<b class="nc">&nbsp;                .&lt;Object, Long&gt;group().by(T.label).by(__.count());</b>
<b class="nc">&nbsp;        String sql = getSQL(traversal);</b>
<b class="nc">&nbsp;        if (isPostgres()) {</b>
<b class="nc">&nbsp;            Assert.assertEquals(&quot;\n&quot; +</b>
&nbsp;                    &quot;SELECT\n&quot; +
&nbsp;                    &quot;\tCOUNT(1) AS \&quot;count\&quot;\n&quot; +
&nbsp;                    &quot;FROM\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_C\&quot;&quot;, sql);
&nbsp;        }
<b class="nc">&nbsp;        List&lt;Map&lt;Object, Long&gt;&gt; result = traversal.toList();</b>
<b class="nc">&nbsp;        Assert.assertEquals(1, result.size());</b>
<b class="nc">&nbsp;        Assert.assertEquals(3, result.get(0).size());</b>
<b class="nc">&nbsp;        Assert.assertTrue(result.get(0).containsKey(&quot;A&quot;));</b>
<b class="nc">&nbsp;        Assert.assertTrue(result.get(0).containsKey(&quot;B&quot;));</b>
<b class="nc">&nbsp;        Assert.assertTrue(result.get(0).containsKey(&quot;C&quot;));</b>
<b class="nc">&nbsp;        Assert.assertEquals(3L, result.get(0).get(&quot;A&quot;), 0);</b>
<b class="nc">&nbsp;        Assert.assertEquals(2L, result.get(0).get(&quot;B&quot;), 0);</b>
<b class="nc">&nbsp;        Assert.assertEquals(1L, result.get(0).get(&quot;C&quot;), 0);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testGroupByCount() {
<b class="nc">&nbsp;        this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;A&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;uid1&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;uid2&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;age&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;uid1&quot;, &quot;uid2&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;uid1&quot;, UUID.randomUUID().toString(), &quot;uid2&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;a&quot;, &quot;age&quot;, 1);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;uid1&quot;, UUID.randomUUID().toString(), &quot;uid2&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;a&quot;, &quot;age&quot;, 2);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;uid1&quot;, UUID.randomUUID().toString(), &quot;uid2&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;b&quot;, &quot;age&quot;, 3);</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        DefaultTraversal&lt;Vertex, Map&lt;Object, Long&gt;&gt; traversal = (DefaultTraversal&lt;Vertex, Map&lt;Object, Long&gt;&gt;) this.sqlgGraph.traversal().V().hasLabel(&quot;A&quot;)</b>
<b class="nc">&nbsp;                .&lt;Object, Long&gt;group().by(&quot;name&quot;).by(__.count());</b>
<b class="nc">&nbsp;        String sql = getSQL(traversal);</b>
<b class="nc">&nbsp;        if (isPostgres()) {</b>
<b class="nc">&nbsp;            Assert.assertEquals(&quot;\n&quot; +</b>
&nbsp;                    &quot;SELECT\n&quot; +
&nbsp;                    &quot;\tCOUNT(1) AS \&quot;count\&quot;,\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;name\&quot; AS \&quot;alias1\&quot;\n&quot; +
&nbsp;                    &quot;FROM\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot;\n&quot; +
&nbsp;                    &quot;GROUP BY\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;name\&quot;&quot;, sql);
&nbsp;        }
<b class="nc">&nbsp;        List&lt;Map&lt;Object, Long&gt;&gt; result = traversal.toList();</b>
<b class="nc">&nbsp;        Assert.assertEquals(1, result.size());</b>
<b class="nc">&nbsp;        Assert.assertTrue(result.get(0).containsKey(&quot;a&quot;));</b>
<b class="nc">&nbsp;        Assert.assertTrue(result.get(0).containsKey(&quot;b&quot;));</b>
<b class="nc">&nbsp;        Assert.assertEquals(2L, result.get(0).get(&quot;a&quot;), 0);</b>
<b class="nc">&nbsp;        Assert.assertEquals(1L, result.get(0).get(&quot;b&quot;), 0);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testMax() {
<b class="nc">&nbsp;        this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;Person&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;age&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
<b class="nc">&nbsp;                    put(&quot;x&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;name&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;a1&quot;, &quot;age&quot;, 1, &quot;x&quot;, 1);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;a2&quot;, &quot;age&quot;, 2, &quot;x&quot;, 1);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;a3&quot;, &quot;age&quot;, 3, &quot;x&quot;, 1);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;a4&quot;, &quot;age&quot;, 0, &quot;x&quot;, 1);</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;
<b class="nc">&nbsp;        DefaultTraversal&lt;Vertex, Integer&gt; traversal = (DefaultTraversal) this.sqlgGraph.traversal().V().hasLabel(&quot;Person&quot;).values(&quot;age&quot;).max();</b>
<b class="nc">&nbsp;        String sql = getSQL(traversal);</b>
<b class="nc">&nbsp;        if (isPostgres()) {</b>
<b class="nc">&nbsp;            Assert.assertEquals(&quot;\n&quot; +</b>
&nbsp;                    &quot;SELECT\n&quot; +
&nbsp;                    &quot;\tMAX(\&quot;public\&quot;.\&quot;V_Person\&quot;.\&quot;age\&quot;) AS \&quot;alias1\&quot;\n&quot; +
&nbsp;                    &quot;FROM\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_Person\&quot;&quot;, sql);
&nbsp;        }
<b class="nc">&nbsp;        Assert.assertEquals(3, traversal.getSteps().size());</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(0) instanceof SqlgGraphStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(1) instanceof SqlgPropertiesStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(2) instanceof SqlgMaxGlobalStep);</b>
<b class="nc">&nbsp;        Assert.assertEquals(3, traversal.next(), 0);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testGroupOverOnePropertyMax() {
<b class="nc">&nbsp;        this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;Person&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;uid&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;age&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;uid&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;uid&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;A&quot;, &quot;age&quot;, 1);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;uid&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;B&quot;, &quot;age&quot;, 2);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;uid&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;A&quot;, &quot;age&quot;, 3);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;uid&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;B&quot;, &quot;age&quot;, 4);</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;
<b class="nc">&nbsp;        DefaultTraversal&lt;Vertex, Map&lt;String, Integer&gt;&gt; traversal = (DefaultTraversal) sqlgGraph.traversal()</b>
<b class="nc">&nbsp;                .V().hasLabel(&quot;Person&quot;)</b>
<b class="nc">&nbsp;                .&lt;String, Integer&gt;group().by(&quot;name&quot;).by(__.values(&quot;age&quot;).max());</b>
<b class="nc">&nbsp;        String sql = getSQL(traversal);</b>
<b class="nc">&nbsp;        if (isPostgres()) {</b>
<b class="nc">&nbsp;            Assert.assertEquals(&quot;\n&quot; +</b>
&nbsp;                    &quot;SELECT\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_Person\&quot;.\&quot;name\&quot; AS \&quot;alias1\&quot;,\n&quot; +
&nbsp;                    &quot;\tMAX(\&quot;public\&quot;.\&quot;V_Person\&quot;.\&quot;age\&quot;) AS \&quot;alias2\&quot;\n&quot; +
&nbsp;                    &quot;FROM\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_Person\&quot;\n&quot; +
&nbsp;                    &quot;GROUP BY\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_Person\&quot;.\&quot;name\&quot;&quot;, sql);
&nbsp;        }
<b class="nc">&nbsp;        Assert.assertEquals(2, traversal.getSteps().size());</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(0) instanceof SqlgGraphStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(1) instanceof SqlgGroupStep);</b>
<b class="nc">&nbsp;        Map&lt;String, Integer&gt; result = traversal.next();</b>
<b class="nc">&nbsp;        Assert.assertFalse(traversal.hasNext());</b>
<b class="nc">&nbsp;        Assert.assertTrue(result.containsKey(&quot;A&quot;));</b>
<b class="nc">&nbsp;        Assert.assertTrue(result.containsKey(&quot;B&quot;));</b>
<b class="nc">&nbsp;        Assert.assertEquals(3, result.get(&quot;A&quot;), 0);</b>
<b class="nc">&nbsp;        Assert.assertEquals(4, result.get(&quot;B&quot;), 0);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testMaxOnString() {
<b class="nc">&nbsp;        this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;Person&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;age&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;name&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;a1&quot;, &quot;age&quot;, &quot;a&quot;);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;a2&quot;, &quot;age&quot;, &quot;b&quot;);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;a3&quot;, &quot;age&quot;, &quot;d&quot;);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;a4&quot;, &quot;age&quot;, &quot;c&quot;);</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;
<b class="nc">&nbsp;        DefaultTraversal&lt;Vertex, String&gt; traversal = (DefaultTraversal) this.sqlgGraph.traversal().V().hasLabel(&quot;Person&quot;).values(&quot;age&quot;).max();</b>
<b class="nc">&nbsp;        String sql = getSQL(traversal);</b>
<b class="nc">&nbsp;        if (isPostgres()) {</b>
<b class="nc">&nbsp;            Assert.assertEquals(&quot;\n&quot; +</b>
&nbsp;                    &quot;SELECT\n&quot; +
&nbsp;                    &quot;\tMAX(\&quot;public\&quot;.\&quot;V_Person\&quot;.\&quot;age\&quot;) AS \&quot;alias1\&quot;\n&quot; +
&nbsp;                    &quot;FROM\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_Person\&quot;&quot;, sql);
&nbsp;        }
<b class="nc">&nbsp;        Assert.assertEquals(3, traversal.getSteps().size());</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(0) instanceof SqlgGraphStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(1) instanceof SqlgPropertiesStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(2) instanceof SqlgMaxGlobalStep);</b>
<b class="nc">&nbsp;        Assert.assertEquals(&quot;d&quot;, traversal.next());</b>
&nbsp;    }
&nbsp;
&nbsp;    @SuppressWarnings(&quot;Duplicates&quot;)
&nbsp;    @Test
&nbsp;    public void testMin() {
<b class="nc">&nbsp;        this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;Person&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;age&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;name&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;a1&quot;, &quot;age&quot;, 1);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;a2&quot;, &quot;age&quot;, 2);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;a3&quot;, &quot;age&quot;, 3);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;a4&quot;, &quot;age&quot;, 0);</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;
<b class="nc">&nbsp;        DefaultTraversal&lt;Vertex, Integer&gt; traversal = (DefaultTraversal) this.sqlgGraph.traversal().V().hasLabel(&quot;Person&quot;).values(&quot;age&quot;).min();</b>
<b class="nc">&nbsp;        String sql = getSQL(traversal);</b>
<b class="nc">&nbsp;        if (isPostgres()) {</b>
<b class="nc">&nbsp;            Assert.assertEquals(&quot;\n&quot; +</b>
&nbsp;                    &quot;SELECT\n&quot; +
&nbsp;                    &quot;\tMIN(\&quot;public\&quot;.\&quot;V_Person\&quot;.\&quot;age\&quot;) AS \&quot;alias1\&quot;\n&quot; +
&nbsp;                    &quot;FROM\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_Person\&quot;&quot;, sql);
&nbsp;        }
<b class="nc">&nbsp;        Assert.assertEquals(3, traversal.getSteps().size());</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(0) instanceof SqlgGraphStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(1) instanceof SqlgPropertiesStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(2) instanceof SqlgMinGlobalStep);</b>
<b class="nc">&nbsp;        Assert.assertEquals(0, traversal.next(), 0);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testMinOnString() {
<b class="nc">&nbsp;        this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;Person&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;age&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;name&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;a1&quot;, &quot;age&quot;, &quot;a&quot;);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;a2&quot;, &quot;age&quot;, &quot;b&quot;);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;a3&quot;, &quot;age&quot;, &quot;c&quot;);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;a4&quot;, &quot;age&quot;, &quot;d&quot;);</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;
<b class="nc">&nbsp;        DefaultTraversal&lt;Vertex, String&gt; traversal = (DefaultTraversal) this.sqlgGraph.traversal().V().hasLabel(&quot;Person&quot;).values(&quot;age&quot;).min();</b>
<b class="nc">&nbsp;        String sql = getSQL(traversal);</b>
<b class="nc">&nbsp;        if (isPostgres()) {</b>
<b class="nc">&nbsp;            Assert.assertEquals(&quot;\n&quot; +</b>
&nbsp;                    &quot;SELECT\n&quot; +
&nbsp;                    &quot;\tMIN(\&quot;public\&quot;.\&quot;V_Person\&quot;.\&quot;age\&quot;) AS \&quot;alias1\&quot;\n&quot; +
&nbsp;                    &quot;FROM\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_Person\&quot;&quot;, sql);
&nbsp;        }
<b class="nc">&nbsp;        Assert.assertEquals(3, traversal.getSteps().size());</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(0) instanceof SqlgGraphStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(1) instanceof SqlgPropertiesStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(2) instanceof SqlgMinGlobalStep);</b>
<b class="nc">&nbsp;        Assert.assertEquals(&quot;a&quot;, traversal.next());</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testSum() {
<b class="nc">&nbsp;        this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;Person&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;age&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;name&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;a1&quot;, &quot;age&quot;, 1);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;a2&quot;, &quot;age&quot;, 2);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;a3&quot;, &quot;age&quot;, 3);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;a4&quot;, &quot;age&quot;, 0);</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;
<b class="nc">&nbsp;        DefaultTraversal&lt;Vertex, Long&gt; traversal = (DefaultTraversal) this.sqlgGraph.traversal().V().hasLabel(&quot;Person&quot;).values(&quot;age&quot;).sum();</b>
<b class="nc">&nbsp;        String sql = getSQL(traversal);</b>
<b class="nc">&nbsp;        if (isPostgres()) {</b>
<b class="nc">&nbsp;            Assert.assertEquals(&quot;\n&quot; +</b>
&nbsp;                    &quot;SELECT\n&quot; +
&nbsp;                    &quot;\tSUM(\&quot;public\&quot;.\&quot;V_Person\&quot;.\&quot;age\&quot;) AS \&quot;alias1\&quot;\n&quot; +
&nbsp;                    &quot;FROM\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_Person\&quot;&quot;, sql);
&nbsp;        }
<b class="nc">&nbsp;        Assert.assertEquals(3, traversal.getSteps().size());</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(0) instanceof SqlgGraphStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(1) instanceof SqlgPropertiesStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(2) instanceof SqlgSumGlobalStep);</b>
<b class="nc">&nbsp;        Assert.assertEquals(6, traversal.next(), 0L);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testMean() {
<b class="nc">&nbsp;        this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;Person&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;age&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;name&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;a1&quot;, &quot;age&quot;, 1);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;a2&quot;, &quot;age&quot;, 2);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;a3&quot;, &quot;age&quot;, 3);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;a4&quot;, &quot;age&quot;, 0);</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        DefaultTraversal&lt;Vertex, Double&gt; traversal = (DefaultTraversal) this.sqlgGraph.traversal().V().hasLabel(&quot;Person&quot;).values(&quot;age&quot;).mean();</b>
<b class="nc">&nbsp;        String sql = getSQL(traversal);</b>
<b class="nc">&nbsp;        if (isPostgres()) {</b>
<b class="nc">&nbsp;            Assert.assertEquals(&quot;\n&quot; +</b>
&nbsp;                    &quot;SELECT\n&quot; +
&nbsp;                    &quot;\tAVG(\&quot;public\&quot;.\&quot;V_Person\&quot;.\&quot;age\&quot;) AS \&quot;alias1\&quot;, COUNT(1) AS \&quot;alias1_weight\&quot;\n&quot; +
&nbsp;                    &quot;FROM\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_Person\&quot;&quot;, sql);
&nbsp;        }
<b class="nc">&nbsp;        Assert.assertEquals(3, traversal.getSteps().size());</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(0) instanceof SqlgGraphStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(1) instanceof SqlgPropertiesStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(2) instanceof SqlgAvgGlobalStep);</b>
<b class="nc">&nbsp;        Double d = traversal.next();</b>
<b class="nc">&nbsp;        Assert.assertEquals(1.5, d, 0D);</b>
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;    @Test
&nbsp;    public void testGroupOverOnePropertyMin() {
<b class="nc">&nbsp;        this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;Person&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;uid&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;age&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;uid&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;uid&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;A&quot;, &quot;age&quot;, 1);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;uid&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;B&quot;, &quot;age&quot;, 2);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;uid&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;A&quot;, &quot;age&quot;, 3);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;uid&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;B&quot;, &quot;age&quot;, 4);</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;
<b class="nc">&nbsp;        DefaultTraversal&lt;Vertex, Map&lt;String, Integer&gt;&gt; traversal = (DefaultTraversal) sqlgGraph.traversal()</b>
<b class="nc">&nbsp;                .V().hasLabel(&quot;Person&quot;)</b>
<b class="nc">&nbsp;                .&lt;String, Integer&gt;group().by(&quot;name&quot;).by(__.values(&quot;age&quot;).min());</b>
<b class="nc">&nbsp;        String sql = getSQL(traversal);</b>
<b class="nc">&nbsp;        if (isPostgres()) {</b>
<b class="nc">&nbsp;            Assert.assertEquals(&quot;\n&quot; +</b>
&nbsp;                    &quot;SELECT\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_Person\&quot;.\&quot;name\&quot; AS \&quot;alias1\&quot;,\n&quot; +
&nbsp;                    &quot;\tMIN(\&quot;public\&quot;.\&quot;V_Person\&quot;.\&quot;age\&quot;) AS \&quot;alias2\&quot;\n&quot; +
&nbsp;                    &quot;FROM\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_Person\&quot;\n&quot; +
&nbsp;                    &quot;GROUP BY\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_Person\&quot;.\&quot;name\&quot;&quot;, sql);
&nbsp;        }
<b class="nc">&nbsp;        Assert.assertEquals(2, traversal.getSteps().size());</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(0) instanceof SqlgGraphStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(1) instanceof SqlgGroupStep);</b>
<b class="nc">&nbsp;        Map&lt;String, Integer&gt; result = traversal.next();</b>
<b class="nc">&nbsp;        Assert.assertFalse(traversal.hasNext());</b>
<b class="nc">&nbsp;        Assert.assertTrue(result.containsKey(&quot;A&quot;));</b>
<b class="nc">&nbsp;        Assert.assertTrue(result.containsKey(&quot;B&quot;));</b>
<b class="nc">&nbsp;        Assert.assertEquals(1, result.get(&quot;A&quot;), 0);</b>
<b class="nc">&nbsp;        Assert.assertEquals(2, result.get(&quot;B&quot;), 0);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testGroupOverOnePropertySum() {
<b class="nc">&nbsp;        this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;Person&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;uid&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;age&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;uid&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;uid&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;A&quot;, &quot;age&quot;, 1);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;uid&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;B&quot;, &quot;age&quot;, 2);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;uid&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;A&quot;, &quot;age&quot;, 3);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;uid&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;B&quot;, &quot;age&quot;, 4);</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;
<b class="nc">&nbsp;        DefaultTraversal&lt;Vertex, Map&lt;String, Long&gt;&gt; traversal = (DefaultTraversal) sqlgGraph.traversal()</b>
<b class="nc">&nbsp;                .V().hasLabel(&quot;Person&quot;)</b>
<b class="nc">&nbsp;                .&lt;String, Long&gt;group().by(&quot;name&quot;).by(__.values(&quot;age&quot;).sum());</b>
<b class="nc">&nbsp;        String sql = getSQL(traversal);</b>
<b class="nc">&nbsp;        if (isPostgres()) {</b>
<b class="nc">&nbsp;            Assert.assertEquals(&quot;\n&quot; +</b>
&nbsp;                    &quot;SELECT\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_Person\&quot;.\&quot;name\&quot; AS \&quot;alias1\&quot;,\n&quot; +
&nbsp;                    &quot;\tSUM(\&quot;public\&quot;.\&quot;V_Person\&quot;.\&quot;age\&quot;) AS \&quot;alias2\&quot;\n&quot; +
&nbsp;                    &quot;FROM\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_Person\&quot;\n&quot; +
&nbsp;                    &quot;GROUP BY\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_Person\&quot;.\&quot;name\&quot;&quot;, sql);
&nbsp;        }
<b class="nc">&nbsp;        Assert.assertEquals(2, traversal.getSteps().size());</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(0) instanceof SqlgGraphStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(1) instanceof SqlgGroupStep);</b>
<b class="nc">&nbsp;        Map&lt;String, Long&gt; result = traversal.next();</b>
<b class="nc">&nbsp;        Assert.assertFalse(traversal.hasNext());</b>
<b class="nc">&nbsp;        Assert.assertTrue(result.containsKey(&quot;A&quot;));</b>
<b class="nc">&nbsp;        Assert.assertTrue(result.containsKey(&quot;B&quot;));</b>
<b class="nc">&nbsp;        Assert.assertEquals(4, result.get(&quot;A&quot;), 0L);</b>
<b class="nc">&nbsp;        Assert.assertEquals(6, result.get(&quot;B&quot;), 0L);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testGroupOverOnePropertyMean() {
<b class="nc">&nbsp;        this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;Person&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;uid&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;age&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;uid&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;uid&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;A&quot;, &quot;age&quot;, 1);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;uid&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;B&quot;, &quot;age&quot;, 2);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;uid&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;A&quot;, &quot;age&quot;, 3);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;uid&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;B&quot;, &quot;age&quot;, 4);</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;
<b class="nc">&nbsp;        DefaultTraversal&lt;Vertex, Map&lt;String, Double&gt;&gt; traversal = (DefaultTraversal) sqlgGraph.traversal()</b>
<b class="nc">&nbsp;                .V().hasLabel(&quot;Person&quot;)</b>
<b class="nc">&nbsp;                .&lt;String, Double&gt;group().by(&quot;name&quot;).by(__.values(&quot;age&quot;).mean());</b>
<b class="nc">&nbsp;        String sql = getSQL(traversal);</b>
<b class="nc">&nbsp;        if (isPostgres()) {</b>
<b class="nc">&nbsp;            Assert.assertEquals(&quot;\n&quot; +</b>
&nbsp;                    &quot;SELECT\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_Person\&quot;.\&quot;name\&quot; AS \&quot;alias1\&quot;,\n&quot; +
&nbsp;                    &quot;\tAVG(\&quot;public\&quot;.\&quot;V_Person\&quot;.\&quot;age\&quot;) AS \&quot;alias2\&quot;, COUNT(1) AS \&quot;alias2_weight\&quot;\n&quot; +
&nbsp;                    &quot;FROM\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_Person\&quot;\n&quot; +
&nbsp;                    &quot;GROUP BY\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_Person\&quot;.\&quot;name\&quot;&quot;, sql);
&nbsp;        }
<b class="nc">&nbsp;        Assert.assertEquals(2, traversal.getSteps().size());</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(0) instanceof SqlgGraphStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(1) instanceof SqlgGroupStep);</b>
<b class="nc">&nbsp;        Map&lt;String, Double&gt; result = traversal.next();</b>
<b class="nc">&nbsp;        Assert.assertFalse(traversal.hasNext());</b>
<b class="nc">&nbsp;        Assert.assertTrue(result.containsKey(&quot;A&quot;));</b>
<b class="nc">&nbsp;        Assert.assertTrue(result.containsKey(&quot;B&quot;));</b>
<b class="nc">&nbsp;        Assert.assertEquals(2.0, result.get(&quot;A&quot;), 0D);</b>
<b class="nc">&nbsp;        Assert.assertEquals(3.0, result.get(&quot;B&quot;), 0D);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testGroupOverTwoPropertiesWithValues() {
<b class="nc">&nbsp;        this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;Person&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;uid1&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;uid2&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;surname&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;age&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;uid1&quot;, &quot;uid2&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;uid1&quot;, UUID.randomUUID().toString(), &quot;uid2&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;A&quot;, &quot;surname&quot;, &quot;C&quot;, &quot;age&quot;, 1);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;uid1&quot;, UUID.randomUUID().toString(), &quot;uid2&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;B&quot;, &quot;surname&quot;, &quot;D&quot;, &quot;age&quot;, 2);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;uid1&quot;, UUID.randomUUID().toString(), &quot;uid2&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;A&quot;, &quot;surname&quot;, &quot;C&quot;, &quot;age&quot;, 3);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;uid1&quot;, UUID.randomUUID().toString(), &quot;uid2&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;B&quot;, &quot;surname&quot;, &quot;E&quot;, &quot;age&quot;, 4);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;uid1&quot;, UUID.randomUUID().toString(), &quot;uid2&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;C&quot;, &quot;surname&quot;, &quot;E&quot;, &quot;age&quot;, 5);</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;
<b class="nc">&nbsp;        DefaultTraversal&lt;Vertex, Map&lt;List&lt;String&gt;, Integer&gt;&gt; traversal = (DefaultTraversal) this.sqlgGraph.traversal().V().hasLabel(&quot;Person&quot;)</b>
<b class="nc">&nbsp;                .&lt;List&lt;String&gt;, Integer&gt;group()</b>
<b class="nc">&nbsp;                .by(__.values(&quot;name&quot;, &quot;surname&quot;).fold())</b>
<b class="nc">&nbsp;                .by(__.values(&quot;age&quot;).max());</b>
&nbsp;
<b class="nc">&nbsp;        String sql = getSQL(traversal);</b>
<b class="nc">&nbsp;        if (isPostgres()) {</b>
<b class="nc">&nbsp;            Assert.assertEquals(&quot;\n&quot; +</b>
&nbsp;                    &quot;SELECT\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_Person\&quot;.\&quot;surname\&quot; AS \&quot;alias1\&quot;,\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_Person\&quot;.\&quot;name\&quot; AS \&quot;alias2\&quot;,\n&quot; +
&nbsp;                    &quot;\tMAX(\&quot;public\&quot;.\&quot;V_Person\&quot;.\&quot;age\&quot;) AS \&quot;alias3\&quot;\n&quot; +
&nbsp;                    &quot;FROM\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_Person\&quot;\n&quot; +
&nbsp;                    &quot;GROUP BY\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_Person\&quot;.\&quot;name\&quot;,\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_Person\&quot;.\&quot;surname\&quot;&quot;, sql);
&nbsp;        }
<b class="nc">&nbsp;        Assert.assertEquals(2, traversal.getSteps().size());</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(0) instanceof SqlgGraphStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(1) instanceof SqlgGroupStep);</b>
&nbsp;
<b class="nc">&nbsp;        Map&lt;List&lt;String&gt;, Integer&gt; result = traversal.next();</b>
<b class="nc">&nbsp;        System.out.println(result);</b>
&nbsp;
<b class="nc">&nbsp;        Assert.assertTrue(result.containsKey(Arrays.asList(&quot;A&quot;, &quot;C&quot;)) || result.containsKey(Arrays.asList(&quot;C&quot;, &quot;A&quot;)));</b>
<b class="nc">&nbsp;        Assert.assertTrue(result.containsKey(Arrays.asList(&quot;B&quot;, &quot;D&quot;)) || result.containsKey(Arrays.asList(&quot;D&quot;, &quot;B&quot;)));</b>
<b class="nc">&nbsp;        Assert.assertTrue(result.containsKey(Arrays.asList(&quot;B&quot;, &quot;E&quot;)) || result.containsKey(Arrays.asList(&quot;E&quot;, &quot;B&quot;)));</b>
<b class="nc">&nbsp;        Assert.assertTrue(result.containsKey(Arrays.asList(&quot;C&quot;, &quot;E&quot;)) || result.containsKey(Arrays.asList(&quot;E&quot;, &quot;C&quot;)));</b>
<b class="nc">&nbsp;        Assert.assertEquals(4, result.size());</b>
<b class="nc">&nbsp;        Assert.assertFalse(traversal.hasNext());</b>
&nbsp;
<b class="nc">&nbsp;        if (result.containsKey(Arrays.asList(&quot;A&quot;, &quot;C&quot;))) {</b>
<b class="nc">&nbsp;            Assert.assertEquals(3, result.get(Arrays.asList(&quot;A&quot;, &quot;C&quot;)), 0);</b>
&nbsp;        } else {
<b class="nc">&nbsp;            Assert.assertEquals(3, result.get(Arrays.asList(&quot;C&quot;, &quot;A&quot;)), 0);</b>
&nbsp;        }
<b class="nc">&nbsp;        if (result.containsKey(Arrays.asList(&quot;B&quot;, &quot;D&quot;))) {</b>
<b class="nc">&nbsp;            Assert.assertEquals(2, result.get(Arrays.asList(&quot;B&quot;, &quot;D&quot;)), 0);</b>
&nbsp;        } else {
<b class="nc">&nbsp;            Assert.assertEquals(2, result.get(Arrays.asList(&quot;D&quot;, &quot;B&quot;)), 0);</b>
&nbsp;        }
<b class="nc">&nbsp;        if (result.containsKey(Arrays.asList(&quot;B&quot;, &quot;E&quot;))) {</b>
<b class="nc">&nbsp;            Assert.assertEquals(4, result.get(Arrays.asList(&quot;B&quot;, &quot;E&quot;)), 0);</b>
&nbsp;        } else {
<b class="nc">&nbsp;            Assert.assertEquals(4, result.get(Arrays.asList(&quot;E&quot;, &quot;B&quot;)), 0);</b>
&nbsp;        }
<b class="nc">&nbsp;        if (result.containsKey(Arrays.asList(&quot;C&quot;, &quot;E&quot;))) {</b>
<b class="nc">&nbsp;            Assert.assertEquals(5, result.get(Arrays.asList(&quot;C&quot;, &quot;E&quot;)), 0);</b>
&nbsp;        } else {
<b class="nc">&nbsp;            Assert.assertEquals(5, result.get(Arrays.asList(&quot;E&quot;, &quot;C&quot;)), 0);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @SuppressWarnings(&quot;ArraysAsListWithZeroOrOneArgument&quot;)
&nbsp;    @Test
&nbsp;    public void testGroupOverTwoPropertiesWithValueMap() {
<b class="nc">&nbsp;        this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;Person&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;uid1&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;uid2&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;surname&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;age&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;uid1&quot;, &quot;uid2&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;uid1&quot;, UUID.randomUUID().toString(), &quot;uid2&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;A&quot;, &quot;surname&quot;, &quot;C&quot;, &quot;age&quot;, 1);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;uid1&quot;, UUID.randomUUID().toString(), &quot;uid2&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;B&quot;, &quot;surname&quot;, &quot;D&quot;, &quot;age&quot;, 2);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;uid1&quot;, UUID.randomUUID().toString(), &quot;uid2&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;A&quot;, &quot;surname&quot;, &quot;C&quot;, &quot;age&quot;, 3);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;uid1&quot;, UUID.randomUUID().toString(), &quot;uid2&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;B&quot;, &quot;surname&quot;, &quot;E&quot;, &quot;age&quot;, 4);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;uid1&quot;, UUID.randomUUID().toString(), &quot;uid2&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;C&quot;, &quot;surname&quot;, &quot;E&quot;, &quot;age&quot;, 5);</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;
<b class="nc">&nbsp;        DefaultTraversal&lt;Vertex, Map&lt;Map&lt;String, List&lt;String&gt;&gt;, Integer&gt;&gt; traversal = (DefaultTraversal) this.sqlgGraph.traversal().V().hasLabel(&quot;Person&quot;)</b>
<b class="nc">&nbsp;                .&lt;Map&lt;String, List&lt;String&gt;&gt;, Integer&gt;group()</b>
<b class="nc">&nbsp;                .by(__.valueMap(&quot;name&quot;, &quot;surname&quot;))</b>
<b class="nc">&nbsp;                .by(__.values(&quot;age&quot;).max());</b>
&nbsp;
<b class="nc">&nbsp;        String sql = getSQL(traversal);</b>
<b class="nc">&nbsp;        if (isPostgres()) {</b>
<b class="nc">&nbsp;            Assert.assertEquals(&quot;\n&quot; +</b>
&nbsp;                    &quot;SELECT\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_Person\&quot;.\&quot;surname\&quot; AS \&quot;alias1\&quot;,\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_Person\&quot;.\&quot;name\&quot; AS \&quot;alias2\&quot;,\n&quot; +
&nbsp;                    &quot;\tMAX(\&quot;public\&quot;.\&quot;V_Person\&quot;.\&quot;age\&quot;) AS \&quot;alias3\&quot;\n&quot; +
&nbsp;                    &quot;FROM\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_Person\&quot;\n&quot; +
&nbsp;                    &quot;GROUP BY\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_Person\&quot;.\&quot;name\&quot;,\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_Person\&quot;.\&quot;surname\&quot;&quot;, sql);
&nbsp;        }
<b class="nc">&nbsp;        Assert.assertEquals(2, traversal.getSteps().size());</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(0) instanceof SqlgGraphStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(1) instanceof SqlgGroupStep);</b>
&nbsp;
<b class="nc">&nbsp;        Map&lt;Map&lt;String, List&lt;String&gt;&gt;, Integer&gt; result = traversal.next();</b>
<b class="nc">&nbsp;        System.out.println(result);</b>
&nbsp;
<b class="nc">&nbsp;        Assert.assertTrue(result.containsKey(new HashMap&lt;String, List&lt;String&gt;&gt;() {{</b>
<b class="nc">&nbsp;            put(&quot;surname&quot;, Arrays.asList(&quot;C&quot;));</b>
<b class="nc">&nbsp;            put(&quot;name&quot;, Arrays.asList(&quot;A&quot;));</b>
&nbsp;        }}));
<b class="nc">&nbsp;        Assert.assertTrue(result.containsKey(new HashMap&lt;String, List&lt;String&gt;&gt;() {{</b>
<b class="nc">&nbsp;            put(&quot;surname&quot;, Arrays.asList(&quot;D&quot;));</b>
<b class="nc">&nbsp;            put(&quot;name&quot;, Arrays.asList(&quot;B&quot;));</b>
&nbsp;        }}));
<b class="nc">&nbsp;        Assert.assertTrue(result.containsKey(new HashMap&lt;String, List&lt;String&gt;&gt;() {{</b>
<b class="nc">&nbsp;            put(&quot;surname&quot;, Arrays.asList(&quot;E&quot;));</b>
<b class="nc">&nbsp;            put(&quot;name&quot;, Arrays.asList(&quot;B&quot;));</b>
&nbsp;        }}));
<b class="nc">&nbsp;        Assert.assertTrue(result.containsKey(new HashMap&lt;String, List&lt;String&gt;&gt;() {{</b>
<b class="nc">&nbsp;            put(&quot;surname&quot;, Arrays.asList(&quot;E&quot;));</b>
<b class="nc">&nbsp;            put(&quot;name&quot;, Arrays.asList(&quot;C&quot;));</b>
&nbsp;        }}));
&nbsp;
<b class="nc">&nbsp;        Assert.assertEquals(3, result.get(new HashMap&lt;String, List&lt;String&gt;&gt;() {{</b>
<b class="nc">&nbsp;            put(&quot;surname&quot;, Arrays.asList(&quot;C&quot;));</b>
<b class="nc">&nbsp;            put(&quot;name&quot;, Arrays.asList(&quot;A&quot;));</b>
&nbsp;        }}), 0);
<b class="nc">&nbsp;        Assert.assertEquals(2, result.get(new HashMap&lt;String, List&lt;String&gt;&gt;() {{</b>
<b class="nc">&nbsp;            put(&quot;surname&quot;, Arrays.asList(&quot;D&quot;));</b>
<b class="nc">&nbsp;            put(&quot;name&quot;, Arrays.asList(&quot;B&quot;));</b>
&nbsp;        }}), 0);
<b class="nc">&nbsp;        Assert.assertEquals(4, result.get(new HashMap&lt;String, List&lt;String&gt;&gt;() {{</b>
<b class="nc">&nbsp;            put(&quot;surname&quot;, Arrays.asList(&quot;E&quot;));</b>
<b class="nc">&nbsp;            put(&quot;name&quot;, Arrays.asList(&quot;B&quot;));</b>
&nbsp;        }}), 0);
<b class="nc">&nbsp;        Assert.assertEquals(5, result.get(new HashMap&lt;String, List&lt;String&gt;&gt;() {{</b>
<b class="nc">&nbsp;            put(&quot;surname&quot;, Arrays.asList(&quot;E&quot;));</b>
<b class="nc">&nbsp;            put(&quot;name&quot;, Arrays.asList(&quot;C&quot;));</b>
&nbsp;        }}), 0);
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testGroupOverOnePropertyWithJoin() {
<b class="nc">&nbsp;        this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;Person&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;uid1&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;uid2&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;uid1&quot;, &quot;uid2&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;Person&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;uid1&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;uid2&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;year&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;uid1&quot;, &quot;uid2&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        Vertex person = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;uid1&quot;, UUID.randomUUID().toString(), &quot;uid2&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;A&quot;);</b>
<b class="nc">&nbsp;        Vertex address1 = this.sqlgGraph.addVertex(T.label, &quot;Address&quot;, &quot;uid1&quot;, UUID.randomUUID().toString(), &quot;uid2&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;A&quot;, &quot;year&quot;, 2);</b>
<b class="nc">&nbsp;        Vertex address2 = this.sqlgGraph.addVertex(T.label, &quot;Address&quot;, &quot;uid1&quot;, UUID.randomUUID().toString(), &quot;uid2&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;A&quot;, &quot;year&quot;, 4);</b>
<b class="nc">&nbsp;        Vertex address3 = this.sqlgGraph.addVertex(T.label, &quot;Address&quot;, &quot;uid1&quot;, UUID.randomUUID().toString(), &quot;uid2&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;C&quot;, &quot;year&quot;, 6);</b>
<b class="nc">&nbsp;        Vertex address4 = this.sqlgGraph.addVertex(T.label, &quot;Address&quot;, &quot;uid1&quot;, UUID.randomUUID().toString(), &quot;uid2&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;D&quot;, &quot;year&quot;, 8);</b>
<b class="nc">&nbsp;        Vertex address5 = this.sqlgGraph.addVertex(T.label, &quot;Address&quot;, &quot;uid1&quot;, UUID.randomUUID().toString(), &quot;uid2&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;D&quot;, &quot;year&quot;, 7);</b>
<b class="nc">&nbsp;        Vertex address6 = this.sqlgGraph.addVertex(T.label, &quot;Address&quot;, &quot;uid1&quot;, UUID.randomUUID().toString(), &quot;uid2&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;D&quot;, &quot;year&quot;, 6);</b>
<b class="nc">&nbsp;        person.addEdge(&quot;livesAt&quot;, address1);</b>
<b class="nc">&nbsp;        person.addEdge(&quot;livesAt&quot;, address2);</b>
<b class="nc">&nbsp;        person.addEdge(&quot;livesAt&quot;, address3);</b>
<b class="nc">&nbsp;        person.addEdge(&quot;livesAt&quot;, address4);</b>
<b class="nc">&nbsp;        person.addEdge(&quot;livesAt&quot;, address5);</b>
<b class="nc">&nbsp;        person.addEdge(&quot;livesAt&quot;, address6);</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;
<b class="nc">&nbsp;        DefaultTraversal&lt;Vertex, Map&lt;String, Integer&gt;&gt; traversal = (DefaultTraversal) this.sqlgGraph.traversal()</b>
<b class="nc">&nbsp;                .V().hasLabel(&quot;Person&quot;)</b>
<b class="nc">&nbsp;                .out(&quot;livesAt&quot;)</b>
<b class="nc">&nbsp;                .&lt;String, Integer&gt;group()</b>
<b class="nc">&nbsp;                .by(&quot;name&quot;)</b>
<b class="nc">&nbsp;                .by(__.values(&quot;year&quot;).max());</b>
&nbsp;
<b class="nc">&nbsp;        String sql = getSQL(traversal);</b>
<b class="nc">&nbsp;        if (isPostgres()) {</b>
<b class="nc">&nbsp;            Assert.assertEquals(&quot;\n&quot; +</b>
&nbsp;                    &quot;SELECT\n&quot; +
&nbsp;                    &quot;\tMAX(\&quot;public\&quot;.\&quot;V_Address\&quot;.\&quot;year\&quot;) AS \&quot;alias1\&quot;,\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_Address\&quot;.\&quot;name\&quot; AS \&quot;alias2\&quot;\n&quot; +
&nbsp;                    &quot;FROM\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_Person\&quot; INNER JOIN\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;E_livesAt\&quot; ON \&quot;public\&quot;.\&quot;V_Person\&quot;.\&quot;uid1\&quot; = \&quot;public\&quot;.\&quot;E_livesAt\&quot;.\&quot;public.Person.uid1__O\&quot; AND \&quot;public\&quot;.\&quot;V_Person\&quot;.\&quot;uid2\&quot; = \&quot;public\&quot;.\&quot;E_livesAt\&quot;.\&quot;public.Person.uid2__O\&quot; INNER JOIN\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_Address\&quot; ON \&quot;public\&quot;.\&quot;E_livesAt\&quot;.\&quot;public.Address__I\&quot; = \&quot;public\&quot;.\&quot;V_Address\&quot;.\&quot;ID\&quot;\n&quot; +
&nbsp;                    &quot;GROUP BY\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_Address\&quot;.\&quot;name\&quot;&quot;, sql);
&nbsp;        }
<b class="nc">&nbsp;        Assert.assertEquals(2, traversal.getSteps().size());</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(0) instanceof SqlgGraphStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(1) instanceof SqlgGroupStep);</b>
&nbsp;
<b class="nc">&nbsp;        Map&lt;String, Integer&gt; result = traversal.next();</b>
<b class="nc">&nbsp;        Assert.assertFalse(traversal.hasNext());</b>
<b class="nc">&nbsp;        Assert.assertEquals(3, result.size());</b>
<b class="nc">&nbsp;        Assert.assertTrue(result.containsKey(&quot;A&quot;));</b>
<b class="nc">&nbsp;        Assert.assertTrue(result.containsKey(&quot;C&quot;));</b>
<b class="nc">&nbsp;        Assert.assertTrue(result.containsKey(&quot;D&quot;));</b>
<b class="nc">&nbsp;        Assert.assertEquals(4, result.get(&quot;A&quot;), 0);</b>
<b class="nc">&nbsp;        Assert.assertEquals(6, result.get(&quot;C&quot;), 0);</b>
<b class="nc">&nbsp;        Assert.assertEquals(8, result.get(&quot;D&quot;), 0);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testGroupByLabelMax() {
<b class="nc">&nbsp;        this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;Person&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;age&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;name&quot;, &quot;age&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;Dog&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;age&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;name&quot;, &quot;age&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;A&quot;, &quot;age&quot;, 10);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;B&quot;, &quot;age&quot;, 20);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;C&quot;, &quot;age&quot;, 100);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name&quot;, &quot;D&quot;, &quot;age&quot;, 40);</b>
&nbsp;
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Dog&quot;, &quot;name&quot;, &quot;A&quot;, &quot;age&quot;, 10);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Dog&quot;, &quot;name&quot;, &quot;B&quot;, &quot;age&quot;, 200);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Dog&quot;, &quot;name&quot;, &quot;C&quot;, &quot;age&quot;, 30);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Dog&quot;, &quot;name&quot;, &quot;D&quot;, &quot;age&quot;, 40);</b>
&nbsp;
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;
<b class="nc">&nbsp;        DefaultTraversal&lt;Vertex, Map&lt;String, Integer&gt;&gt; traversal = (DefaultTraversal) this.sqlgGraph.traversal().V()</b>
<b class="nc">&nbsp;                .&lt;String, Integer&gt;group().by(T.label).by(__.values(&quot;age&quot;).max());</b>
<b class="nc">&nbsp;        String sql = getSQL(traversal);</b>
<b class="nc">&nbsp;        if (isPostgres()) {</b>
<b class="nc">&nbsp;            Assert.assertEquals(&quot;\n&quot; +</b>
&nbsp;                    &quot;SELECT\n&quot; +
&nbsp;                    &quot;\tMAX(\&quot;public\&quot;.\&quot;V_Dog\&quot;.\&quot;age\&quot;) AS \&quot;alias1\&quot;\n&quot; +
&nbsp;                    &quot;FROM\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_Dog\&quot;&quot;, sql);
&nbsp;        }
<b class="nc">&nbsp;        Assert.assertEquals(2, traversal.getSteps().size());</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(0) instanceof SqlgGraphStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(1) instanceof SqlgGroupStep);</b>
&nbsp;
<b class="nc">&nbsp;        Map&lt;String, Integer&gt; result = traversal.next();</b>
<b class="nc">&nbsp;        Assert.assertFalse(traversal.hasNext());</b>
<b class="nc">&nbsp;        Assert.assertEquals(2, result.size());</b>
<b class="nc">&nbsp;        Assert.assertTrue(result.containsKey(&quot;Person&quot;));</b>
<b class="nc">&nbsp;        Assert.assertTrue(result.containsKey(&quot;Dog&quot;));</b>
<b class="nc">&nbsp;        Assert.assertEquals(100, result.get(&quot;Person&quot;), 0);</b>
<b class="nc">&nbsp;        Assert.assertEquals(200, result.get(&quot;Dog&quot;), 0);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testDuplicatePathQuery() {
<b class="nc">&nbsp;        VertexLabel vertexLabel = this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;A&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;uid&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;age&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;uid&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        vertexLabel.ensureEdgeLabelExist(</b>
&nbsp;                &quot;aa&quot;,
&nbsp;                vertexLabel,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;uid&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;uid&quot;)));</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        Vertex a1 = this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;uid&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;a1&quot;, &quot;age&quot;, 1);</b>
<b class="nc">&nbsp;        Vertex a2 = this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;uid&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;a2&quot;, &quot;age&quot;, 5);</b>
<b class="nc">&nbsp;        Vertex a3 = this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;uid&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;a3&quot;, &quot;age&quot;, 7);</b>
<b class="nc">&nbsp;        Vertex a4 = this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;uid&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;a4&quot;, &quot;age&quot;, 5);</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;aa&quot;, a2, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;aa&quot;, a3, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;aa&quot;, a4, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;
<b class="nc">&nbsp;        DefaultTraversal&lt;Vertex, Integer&gt; traversal = (DefaultTraversal) this.sqlgGraph.traversal().V(a1).out(&quot;aa&quot;).values(&quot;age&quot;).max();</b>
<b class="nc">&nbsp;        String sql = getSQL(traversal);</b>
<b class="nc">&nbsp;        if (isPostgres()) {</b>
<b class="nc">&nbsp;            Assert.assertEquals(&quot;SELECT\n&quot; +</b>
&nbsp;                    &quot;\tMAX(a2.\&quot;alias2\&quot;) \n&quot; +
&nbsp;                    &quot;FROM (\n&quot; +
&nbsp;                    &quot;SELECT\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;E_aa\&quot;.\&quot;public.A.uid__I\&quot; AS \&quot;public.E_aa.public.A.uid__I\&quot;\n&quot; +
&nbsp;                    &quot;FROM\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot; INNER JOIN\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;E_aa\&quot; ON \&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;uid\&quot; = \&quot;public\&quot;.\&quot;E_aa\&quot;.\&quot;public.A.uid__O\&quot;\n&quot; +
&nbsp;                    &quot;WHERE\n&quot; +
&nbsp;                    &quot;\t( \&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;uid\&quot; = ?)\n&quot; +
&nbsp;                    &quot;) a1 INNER JOIN (\n&quot; +
&nbsp;                    &quot;SELECT\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;uid\&quot; AS \&quot;alias1\&quot;,\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;age\&quot; AS \&quot;alias2\&quot;\n&quot; +
&nbsp;                    &quot;FROM\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot;\n&quot; +
&nbsp;                    &quot;) a2 ON a1.\&quot;public.E_aa.public.A.uid__I\&quot; = a2.\&quot;alias1\&quot;&quot;, sql);
&nbsp;        }
<b class="nc">&nbsp;        Assert.assertEquals(3, traversal.getSteps().size());</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(0) instanceof SqlgGraphStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(1) instanceof SqlgPropertiesStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(2) instanceof SqlgMaxGlobalStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.hasNext());</b>
<b class="nc">&nbsp;        Integer max = traversal.next();</b>
<b class="nc">&nbsp;        Assert.assertEquals(7, max, 0);</b>
<b class="nc">&nbsp;        Assert.assertFalse(traversal.hasNext());</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testDuplicatePathQueryAggregateOnUid() {
<b class="nc">&nbsp;        VertexLabel vertexLabel = this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;A&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;age&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;age&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        vertexLabel.ensureEdgeLabelExist(</b>
&nbsp;                &quot;aa&quot;,
&nbsp;                vertexLabel,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;uid&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;uid&quot;)));</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        Vertex a1 = this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;uid&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;a1&quot;, &quot;age&quot;, 1);</b>
<b class="nc">&nbsp;        Vertex a2 = this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;uid&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;a2&quot;, &quot;age&quot;, 2);</b>
<b class="nc">&nbsp;        Vertex a3 = this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;uid&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;a3&quot;, &quot;age&quot;, 3);</b>
<b class="nc">&nbsp;        Vertex a4 = this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;uid&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;a4&quot;, &quot;age&quot;, 4);</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;aa&quot;, a2, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;aa&quot;, a3, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;aa&quot;, a4, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;
<b class="nc">&nbsp;        DefaultTraversal&lt;Vertex, Integer&gt; traversal = (DefaultTraversal) this.sqlgGraph.traversal().V(a1).out(&quot;aa&quot;).values(&quot;age&quot;).max();</b>
<b class="nc">&nbsp;        String sql = getSQL(traversal);</b>
<b class="nc">&nbsp;        if (isPostgres()) {</b>
<b class="nc">&nbsp;            Assert.assertEquals(&quot;SELECT\n&quot; +</b>
&nbsp;                    &quot;\tMAX(a2.\&quot;alias2\&quot;) \n&quot; +
&nbsp;                    &quot;FROM (\n&quot; +
&nbsp;                    &quot;SELECT\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;E_aa\&quot;.\&quot;public.A.age__I\&quot; AS \&quot;public.E_aa.public.A.age__I\&quot;\n&quot; +
&nbsp;                    &quot;FROM\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot; INNER JOIN\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;E_aa\&quot; ON \&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;age\&quot; = \&quot;public\&quot;.\&quot;E_aa\&quot;.\&quot;public.A.age__O\&quot;\n&quot; +
&nbsp;                    &quot;WHERE\n&quot; +
&nbsp;                    &quot;\t( \&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;age\&quot; = ?)\n&quot; +
&nbsp;                    &quot;) a1 INNER JOIN (\n&quot; +
&nbsp;                    &quot;SELECT\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;age\&quot; AS \&quot;alias1\&quot;,\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;age\&quot; AS \&quot;alias2\&quot;\n&quot; +
&nbsp;                    &quot;FROM\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot;\n&quot; +
&nbsp;                    &quot;) a2 ON a1.\&quot;public.E_aa.public.A.age__I\&quot; = a2.\&quot;alias2\&quot;&quot;, sql);
&nbsp;        }
<b class="nc">&nbsp;        Assert.assertEquals(3, traversal.getSteps().size());</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(0) instanceof SqlgGraphStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(1) instanceof SqlgPropertiesStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(2) instanceof SqlgMaxGlobalStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.hasNext());</b>
<b class="nc">&nbsp;        Integer max = traversal.next();</b>
<b class="nc">&nbsp;        Assert.assertEquals(4, max, 0);</b>
<b class="nc">&nbsp;        Assert.assertFalse(traversal.hasNext());</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testUserSuppliedIds() {
<b class="nc">&nbsp;        VertexLabel vertexLabel = this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;A&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;age&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;name&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        vertexLabel.ensureEdgeLabelExist(&quot;aa&quot;,</b>
&nbsp;                vertexLabel,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;uid&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(Set.of(&quot;uid&quot;)));</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        Vertex a1 = this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;name&quot;, &quot;a1&quot;, &quot;age&quot;, 1);</b>
<b class="nc">&nbsp;        Vertex a2 = this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;name&quot;, &quot;a2&quot;, &quot;age&quot;, 2);</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;aa&quot;, a2, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a2.addEdge(&quot;aa&quot;, a1, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        List&lt;Integer&gt; ages = this.sqlgGraph.traversal().V(a1).out().out().&lt;Integer&gt;values(&quot;age&quot;).toList();</b>
<b class="nc">&nbsp;        Assert.assertEquals(1, ages.size());</b>
<b class="nc">&nbsp;        Assert.assertEquals(1, ages.get(0), 0);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testDuplicatePathQuery2() {
<b class="nc">&nbsp;        VertexLabel vertexLabel = this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;A&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;age&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;name&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        vertexLabel.ensureEdgeLabelExist(&quot;aa&quot;,</b>
&nbsp;                vertexLabel,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;uid&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(Set.of(&quot;uid&quot;)));</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        Vertex a1 = this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;name&quot;, &quot;a1&quot;, &quot;age&quot;, 1);</b>
<b class="nc">&nbsp;        Vertex a2 = this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;name&quot;, &quot;a2&quot;, &quot;age&quot;, 5);</b>
<b class="nc">&nbsp;        Vertex a3 = this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;name&quot;, &quot;a3&quot;, &quot;age&quot;, 7);</b>
<b class="nc">&nbsp;        Vertex a4 = this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;name&quot;, &quot;a4&quot;, &quot;age&quot;, 5);</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;aa&quot;, a2, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;aa&quot;, a3, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;aa&quot;, a4, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a2.addEdge(&quot;aa&quot;, a1, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a2.addEdge(&quot;aa&quot;, a3, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;
<b class="nc">&nbsp;        DefaultTraversal&lt;Vertex, Integer&gt; traversal = (DefaultTraversal) this.sqlgGraph.traversal().V(a1).out(&quot;aa&quot;).out(&quot;aa&quot;).values(&quot;age&quot;).max();</b>
<b class="nc">&nbsp;        String sql = getSQL(traversal);</b>
<b class="nc">&nbsp;        if (isPostgres()) {</b>
<b class="nc">&nbsp;            Assert.assertEquals(&quot;SELECT\n&quot; +</b>
&nbsp;                    &quot;\tMAX(a3.\&quot;alias3\&quot;) \n&quot; +
&nbsp;                    &quot;FROM (\n&quot; +
&nbsp;                    &quot;SELECT\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;E_aa\&quot;.\&quot;public.A.name__I\&quot; AS \&quot;public.E_aa.public.A.name__I\&quot;\n&quot; +
&nbsp;                    &quot;FROM\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot; INNER JOIN\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;E_aa\&quot; ON \&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;name\&quot; = \&quot;public\&quot;.\&quot;E_aa\&quot;.\&quot;public.A.name__O\&quot;\n&quot; +
&nbsp;                    &quot;WHERE\n&quot; +
&nbsp;                    &quot;\t( \&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;name\&quot; = ?)\n&quot; +
&nbsp;                    &quot;) a1 INNER JOIN (\n&quot; +
&nbsp;                    &quot;SELECT\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;name\&quot; AS \&quot;alias1\&quot;,\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;E_aa\&quot;.\&quot;public.A.name__I\&quot; AS \&quot;public.E_aa.public.A.name__I\&quot;\n&quot; +
&nbsp;                    &quot;FROM\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot; INNER JOIN\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;E_aa\&quot; ON \&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;name\&quot; = \&quot;public\&quot;.\&quot;E_aa\&quot;.\&quot;public.A.name__O\&quot;\n&quot; +
&nbsp;                    &quot;) a2 ON a1.\&quot;public.E_aa.public.A.name__I\&quot; = a2.\&quot;alias1\&quot; INNER JOIN (\n&quot; +
&nbsp;                    &quot;SELECT\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;name\&quot; AS \&quot;alias2\&quot;,\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;age\&quot; AS \&quot;alias3\&quot;\n&quot; +
&nbsp;                    &quot;FROM\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot;\n&quot; +
&nbsp;                    &quot;) a3 ON a2.\&quot;public.E_aa.public.A.name__I\&quot; = a3.\&quot;alias2\&quot;&quot;, sql);
&nbsp;        }
<b class="nc">&nbsp;        Assert.assertEquals(3, traversal.getSteps().size());</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(0) instanceof SqlgGraphStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(1) instanceof SqlgPropertiesStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(2) instanceof SqlgMaxGlobalStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.hasNext());</b>
<b class="nc">&nbsp;        Integer max = traversal.next();</b>
<b class="nc">&nbsp;        Assert.assertEquals(7, max, 0);</b>
<b class="nc">&nbsp;        Assert.assertFalse(traversal.hasNext());</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testDuplicatePathQueryAggregateOnIdentifierMax() {
<b class="nc">&nbsp;        VertexLabel vertexLabel = this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;A&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;age&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;age&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        vertexLabel.ensureEdgeLabelExist(&quot;aa&quot;,</b>
&nbsp;                vertexLabel,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;uid&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(Set.of(&quot;uid&quot;)));</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        Vertex a1 = this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;name&quot;, &quot;a1&quot;, &quot;age&quot;, 1);</b>
<b class="nc">&nbsp;        Vertex a2 = this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;name&quot;, &quot;a2&quot;, &quot;age&quot;, 2);</b>
<b class="nc">&nbsp;        Vertex a3 = this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;name&quot;, &quot;a3&quot;, &quot;age&quot;, 3);</b>
<b class="nc">&nbsp;        Vertex a4 = this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;name&quot;, &quot;a4&quot;, &quot;age&quot;, 4);</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;aa&quot;, a2, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;aa&quot;, a3, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;aa&quot;, a4, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a2.addEdge(&quot;aa&quot;, a1, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a2.addEdge(&quot;aa&quot;, a3, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;
<b class="nc">&nbsp;        DefaultTraversal&lt;Vertex, Integer&gt; traversal = (DefaultTraversal) this.sqlgGraph.traversal().V(a1).out(&quot;aa&quot;).out(&quot;aa&quot;).values(&quot;age&quot;).max();</b>
<b class="nc">&nbsp;        String sql = getSQL(traversal);</b>
<b class="nc">&nbsp;        if (isPostgres()) {</b>
<b class="nc">&nbsp;            Assert.assertEquals(&quot;SELECT\n&quot; +</b>
&nbsp;                    &quot;\tMAX(a3.\&quot;alias3\&quot;) \n&quot; +
&nbsp;                    &quot;FROM (\n&quot; +
&nbsp;                    &quot;SELECT\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;E_aa\&quot;.\&quot;public.A.age__I\&quot; AS \&quot;public.E_aa.public.A.age__I\&quot;\n&quot; +
&nbsp;                    &quot;FROM\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot; INNER JOIN\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;E_aa\&quot; ON \&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;age\&quot; = \&quot;public\&quot;.\&quot;E_aa\&quot;.\&quot;public.A.age__O\&quot;\n&quot; +
&nbsp;                    &quot;WHERE\n&quot; +
&nbsp;                    &quot;\t( \&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;age\&quot; = ?)\n&quot; +
&nbsp;                    &quot;) a1 INNER JOIN (\n&quot; +
&nbsp;                    &quot;SELECT\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;age\&quot; AS \&quot;alias1\&quot;,\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;E_aa\&quot;.\&quot;public.A.age__I\&quot; AS \&quot;public.E_aa.public.A.age__I\&quot;\n&quot; +
&nbsp;                    &quot;FROM\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot; INNER JOIN\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;E_aa\&quot; ON \&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;age\&quot; = \&quot;public\&quot;.\&quot;E_aa\&quot;.\&quot;public.A.age__O\&quot;\n&quot; +
&nbsp;                    &quot;) a2 ON a1.\&quot;public.E_aa.public.A.age__I\&quot; = a2.\&quot;alias1\&quot; INNER JOIN (\n&quot; +
&nbsp;                    &quot;SELECT\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;age\&quot; AS \&quot;alias2\&quot;,\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;age\&quot; AS \&quot;alias3\&quot;\n&quot; +
&nbsp;                    &quot;FROM\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot;\n&quot; +
&nbsp;                    &quot;) a3 ON a2.\&quot;public.E_aa.public.A.age__I\&quot; = a3.\&quot;alias3\&quot;&quot;, sql);
&nbsp;        }
<b class="nc">&nbsp;        Assert.assertEquals(3, traversal.getSteps().size());</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(0) instanceof SqlgGraphStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(1) instanceof SqlgPropertiesStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(2) instanceof SqlgMaxGlobalStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.hasNext());</b>
<b class="nc">&nbsp;        Integer max = traversal.next();</b>
<b class="nc">&nbsp;        Assert.assertEquals(3, max, 0);</b>
<b class="nc">&nbsp;        Assert.assertFalse(traversal.hasNext());</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testDuplicatePathQueryAggregateOnIdentifierMean() {
<b class="nc">&nbsp;        VertexLabel vertexLabel = this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;A&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;age&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;age&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        vertexLabel.ensureEdgeLabelExist(&quot;aa&quot;,</b>
&nbsp;                vertexLabel,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;uid&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(Set.of(&quot;uid&quot;)));</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        Vertex a1 = this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;name&quot;, &quot;a1&quot;, &quot;age&quot;, 1);</b>
<b class="nc">&nbsp;        Vertex a2 = this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;name&quot;, &quot;a2&quot;, &quot;age&quot;, 2);</b>
<b class="nc">&nbsp;        Vertex a3 = this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;name&quot;, &quot;a3&quot;, &quot;age&quot;, 3);</b>
<b class="nc">&nbsp;        Vertex a4 = this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;name&quot;, &quot;a4&quot;, &quot;age&quot;, 4);</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;aa&quot;, a2, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;aa&quot;, a3, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;aa&quot;, a4, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a2.addEdge(&quot;aa&quot;, a1, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a2.addEdge(&quot;aa&quot;, a3, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;
<b class="nc">&nbsp;        DefaultTraversal&lt;Vertex, Double&gt; traversal = (DefaultTraversal) this.sqlgGraph.traversal().V(a1).out(&quot;aa&quot;).out(&quot;aa&quot;).values(&quot;age&quot;).mean();</b>
<b class="nc">&nbsp;        String sql = getSQL(traversal);</b>
<b class="nc">&nbsp;        if (isPostgres()) {</b>
<b class="nc">&nbsp;            Assert.assertEquals(&quot;SELECT\n&quot; +</b>
&nbsp;                    &quot;\tAVG(a3.\&quot;alias3\&quot;), COUNT(1) AS \&quot;alias3_weight\&quot; \n&quot; +
&nbsp;                    &quot;FROM (\n&quot; +
&nbsp;                    &quot;SELECT\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;E_aa\&quot;.\&quot;public.A.age__I\&quot; AS \&quot;public.E_aa.public.A.age__I\&quot;\n&quot; +
&nbsp;                    &quot;FROM\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot; INNER JOIN\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;E_aa\&quot; ON \&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;age\&quot; = \&quot;public\&quot;.\&quot;E_aa\&quot;.\&quot;public.A.age__O\&quot;\n&quot; +
&nbsp;                    &quot;WHERE\n&quot; +
&nbsp;                    &quot;\t( \&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;age\&quot; = ?)\n&quot; +
&nbsp;                    &quot;) a1 INNER JOIN (\n&quot; +
&nbsp;                    &quot;SELECT\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;age\&quot; AS \&quot;alias1\&quot;,\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;E_aa\&quot;.\&quot;public.A.age__I\&quot; AS \&quot;public.E_aa.public.A.age__I\&quot;\n&quot; +
&nbsp;                    &quot;FROM\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot; INNER JOIN\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;E_aa\&quot; ON \&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;age\&quot; = \&quot;public\&quot;.\&quot;E_aa\&quot;.\&quot;public.A.age__O\&quot;\n&quot; +
&nbsp;                    &quot;) a2 ON a1.\&quot;public.E_aa.public.A.age__I\&quot; = a2.\&quot;alias1\&quot; INNER JOIN (\n&quot; +
&nbsp;                    &quot;SELECT\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;age\&quot; AS \&quot;alias2\&quot;,\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;age\&quot; AS \&quot;alias3\&quot;\n&quot; +
&nbsp;                    &quot;FROM\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot;\n&quot; +
&nbsp;                    &quot;) a3 ON a2.\&quot;public.E_aa.public.A.age__I\&quot; = a3.\&quot;alias3\&quot;&quot;, sql);
&nbsp;        }
<b class="nc">&nbsp;        Assert.assertEquals(3, traversal.getSteps().size());</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(0) instanceof SqlgGraphStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(1) instanceof SqlgPropertiesStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(2) instanceof SqlgAvgGlobalStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.hasNext());</b>
<b class="nc">&nbsp;        Double mean = traversal.next();</b>
<b class="nc">&nbsp;        Assert.assertEquals(2, mean, 0);</b>
<b class="nc">&nbsp;        Assert.assertFalse(traversal.hasNext());</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testDuplicatePathQueryAggregateOnIdentifierSum() {
<b class="nc">&nbsp;        VertexLabel vertexLabel = this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;A&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;age&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;age&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        vertexLabel.ensureEdgeLabelExist(&quot;aa&quot;,</b>
&nbsp;                vertexLabel,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;uid&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(Set.of(&quot;uid&quot;)));</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        Vertex a1 = this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;name&quot;, &quot;a1&quot;, &quot;age&quot;, 1);</b>
<b class="nc">&nbsp;        Vertex a2 = this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;name&quot;, &quot;a2&quot;, &quot;age&quot;, 2);</b>
<b class="nc">&nbsp;        Vertex a3 = this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;name&quot;, &quot;a3&quot;, &quot;age&quot;, 3);</b>
<b class="nc">&nbsp;        Vertex a4 = this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;name&quot;, &quot;a4&quot;, &quot;age&quot;, 4);</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;aa&quot;, a2, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;aa&quot;, a3, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;aa&quot;, a4, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a2.addEdge(&quot;aa&quot;, a1, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a2.addEdge(&quot;aa&quot;, a3, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;
<b class="nc">&nbsp;        DefaultTraversal&lt;Vertex, Long&gt; traversal = (DefaultTraversal) this.sqlgGraph.traversal().V(a1).out(&quot;aa&quot;).out(&quot;aa&quot;).values(&quot;age&quot;).sum();</b>
<b class="nc">&nbsp;        String sql = getSQL(traversal);</b>
<b class="nc">&nbsp;        if (isPostgres()) {</b>
<b class="nc">&nbsp;            Assert.assertEquals(&quot;SELECT\n&quot; +</b>
&nbsp;                    &quot;\tSUM(a3.\&quot;alias3\&quot;) \n&quot; +
&nbsp;                    &quot;FROM (\n&quot; +
&nbsp;                    &quot;SELECT\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;E_aa\&quot;.\&quot;public.A.age__I\&quot; AS \&quot;public.E_aa.public.A.age__I\&quot;\n&quot; +
&nbsp;                    &quot;FROM\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot; INNER JOIN\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;E_aa\&quot; ON \&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;age\&quot; = \&quot;public\&quot;.\&quot;E_aa\&quot;.\&quot;public.A.age__O\&quot;\n&quot; +
&nbsp;                    &quot;WHERE\n&quot; +
&nbsp;                    &quot;\t( \&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;age\&quot; = ?)\n&quot; +
&nbsp;                    &quot;) a1 INNER JOIN (\n&quot; +
&nbsp;                    &quot;SELECT\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;age\&quot; AS \&quot;alias1\&quot;,\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;E_aa\&quot;.\&quot;public.A.age__I\&quot; AS \&quot;public.E_aa.public.A.age__I\&quot;\n&quot; +
&nbsp;                    &quot;FROM\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot; INNER JOIN\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;E_aa\&quot; ON \&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;age\&quot; = \&quot;public\&quot;.\&quot;E_aa\&quot;.\&quot;public.A.age__O\&quot;\n&quot; +
&nbsp;                    &quot;) a2 ON a1.\&quot;public.E_aa.public.A.age__I\&quot; = a2.\&quot;alias1\&quot; INNER JOIN (\n&quot; +
&nbsp;                    &quot;SELECT\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;age\&quot; AS \&quot;alias2\&quot;,\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;age\&quot; AS \&quot;alias3\&quot;\n&quot; +
&nbsp;                    &quot;FROM\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot;\n&quot; +
&nbsp;                    &quot;) a3 ON a2.\&quot;public.E_aa.public.A.age__I\&quot; = a3.\&quot;alias3\&quot;&quot;, sql);
&nbsp;        }
<b class="nc">&nbsp;        Assert.assertEquals(3, traversal.getSteps().size());</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(0) instanceof SqlgGraphStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(1) instanceof SqlgPropertiesStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(2) instanceof SqlgSumGlobalStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.hasNext());</b>
<b class="nc">&nbsp;        Long sum = traversal.next();</b>
<b class="nc">&nbsp;        Assert.assertEquals(4, sum, 0);</b>
<b class="nc">&nbsp;        Assert.assertFalse(traversal.hasNext());</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testDuplicatePathQueryAggregateOnIdentifierMin() {
<b class="nc">&nbsp;        VertexLabel vertexLabel = this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;A&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;age&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;age&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        vertexLabel.ensureEdgeLabelExist(&quot;aa&quot;,</b>
&nbsp;                vertexLabel,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;uid&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(Set.of(&quot;uid&quot;)));</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        Vertex a1 = this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;name&quot;, &quot;a1&quot;, &quot;age&quot;, 1);</b>
<b class="nc">&nbsp;        Vertex a2 = this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;name&quot;, &quot;a2&quot;, &quot;age&quot;, 2);</b>
<b class="nc">&nbsp;        Vertex a3 = this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;name&quot;, &quot;a3&quot;, &quot;age&quot;, 3);</b>
<b class="nc">&nbsp;        Vertex a4 = this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;name&quot;, &quot;a4&quot;, &quot;age&quot;, 4);</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;aa&quot;, a2, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;aa&quot;, a3, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;aa&quot;, a4, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a2.addEdge(&quot;aa&quot;, a1, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a2.addEdge(&quot;aa&quot;, a3, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;
<b class="nc">&nbsp;        DefaultTraversal&lt;Vertex, Integer&gt; traversal = (DefaultTraversal) this.sqlgGraph.traversal().V(a1).out(&quot;aa&quot;).out(&quot;aa&quot;).values(&quot;age&quot;).min();</b>
<b class="nc">&nbsp;        String sql = getSQL(traversal);</b>
<b class="nc">&nbsp;        if (isPostgres()) {</b>
<b class="nc">&nbsp;            Assert.assertEquals(&quot;SELECT\n&quot; +</b>
&nbsp;                    &quot;\tMIN(a3.\&quot;alias3\&quot;) \n&quot; +
&nbsp;                    &quot;FROM (\n&quot; +
&nbsp;                    &quot;SELECT\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;E_aa\&quot;.\&quot;public.A.age__I\&quot; AS \&quot;public.E_aa.public.A.age__I\&quot;\n&quot; +
&nbsp;                    &quot;FROM\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot; INNER JOIN\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;E_aa\&quot; ON \&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;age\&quot; = \&quot;public\&quot;.\&quot;E_aa\&quot;.\&quot;public.A.age__O\&quot;\n&quot; +
&nbsp;                    &quot;WHERE\n&quot; +
&nbsp;                    &quot;\t( \&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;age\&quot; = ?)\n&quot; +
&nbsp;                    &quot;) a1 INNER JOIN (\n&quot; +
&nbsp;                    &quot;SELECT\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;age\&quot; AS \&quot;alias1\&quot;,\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;E_aa\&quot;.\&quot;public.A.age__I\&quot; AS \&quot;public.E_aa.public.A.age__I\&quot;\n&quot; +
&nbsp;                    &quot;FROM\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot; INNER JOIN\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;E_aa\&quot; ON \&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;age\&quot; = \&quot;public\&quot;.\&quot;E_aa\&quot;.\&quot;public.A.age__O\&quot;\n&quot; +
&nbsp;                    &quot;) a2 ON a1.\&quot;public.E_aa.public.A.age__I\&quot; = a2.\&quot;alias1\&quot; INNER JOIN (\n&quot; +
&nbsp;                    &quot;SELECT\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;age\&quot; AS \&quot;alias2\&quot;,\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;age\&quot; AS \&quot;alias3\&quot;\n&quot; +
&nbsp;                    &quot;FROM\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot;\n&quot; +
&nbsp;                    &quot;) a3 ON a2.\&quot;public.E_aa.public.A.age__I\&quot; = a3.\&quot;alias3\&quot;&quot;, sql);
&nbsp;        }
<b class="nc">&nbsp;        Assert.assertEquals(3, traversal.getSteps().size());</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(0) instanceof SqlgGraphStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(1) instanceof SqlgPropertiesStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(2) instanceof SqlgMinGlobalStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.hasNext());</b>
<b class="nc">&nbsp;        Integer min = traversal.next();</b>
<b class="nc">&nbsp;        Assert.assertEquals(1, min, 0);</b>
<b class="nc">&nbsp;        Assert.assertFalse(traversal.hasNext());</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testDuplicatePathQuery3() {
<b class="nc">&nbsp;        this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;A&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;age&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;name&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;B&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;age&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;name&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;C&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;age&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;name&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        Vertex a1 = this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;name&quot;, &quot;a1&quot;, &quot;age&quot;, 1);</b>
<b class="nc">&nbsp;        Vertex b1 = this.sqlgGraph.addVertex(T.label, &quot;B&quot;, &quot;name&quot;, &quot;b1&quot;, &quot;age&quot;, 1);</b>
<b class="nc">&nbsp;        Vertex b2 = this.sqlgGraph.addVertex(T.label, &quot;B&quot;, &quot;name&quot;, &quot;b2&quot;, &quot;age&quot;, 2);</b>
<b class="nc">&nbsp;        Vertex b3 = this.sqlgGraph.addVertex(T.label, &quot;B&quot;, &quot;name&quot;, &quot;b3&quot;, &quot;age&quot;, 3);</b>
<b class="nc">&nbsp;        Vertex c1 = this.sqlgGraph.addVertex(T.label, &quot;C&quot;, &quot;name&quot;, &quot;c1&quot;, &quot;age&quot;, 1);</b>
<b class="nc">&nbsp;        Vertex c2 = this.sqlgGraph.addVertex(T.label, &quot;C&quot;, &quot;name&quot;, &quot;c2&quot;, &quot;age&quot;, 2);</b>
<b class="nc">&nbsp;        Vertex c3 = this.sqlgGraph.addVertex(T.label, &quot;C&quot;, &quot;name&quot;, &quot;c3&quot;, &quot;age&quot;, 3);</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;ab&quot;, b1);</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;ab&quot;, b2);</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;ab&quot;, b3);</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;ac&quot;, c1);</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;ac&quot;, c2);</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;ac&quot;, c3);</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;
<b class="nc">&nbsp;        DefaultTraversal&lt;Vertex, Long&gt; traversal = (DefaultTraversal) this.sqlgGraph.traversal().V(a1).out(&quot;ab&quot;, &quot;ac&quot;).values(&quot;age&quot;).sum();</b>
<b class="nc">&nbsp;        String sql = getSQL(traversal);</b>
<b class="nc">&nbsp;        if (isPostgres()) {</b>
<b class="nc">&nbsp;            Assert.assertEquals(&quot;\n&quot; +</b>
&nbsp;                    &quot;SELECT\n&quot; +
&nbsp;                    &quot;\tSUM(\&quot;public\&quot;.\&quot;V_B\&quot;.\&quot;age\&quot;) AS \&quot;alias1\&quot;\n&quot; +
&nbsp;                    &quot;FROM\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot; INNER JOIN\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;E_ab\&quot; ON \&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;name\&quot; = \&quot;public\&quot;.\&quot;E_ab\&quot;.\&quot;public.A.name__O\&quot; INNER JOIN\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_B\&quot; ON \&quot;public\&quot;.\&quot;E_ab\&quot;.\&quot;public.B.name__I\&quot; = \&quot;public\&quot;.\&quot;V_B\&quot;.\&quot;name\&quot;\n&quot; +
&nbsp;                    &quot;WHERE\n&quot; +
&nbsp;                    &quot;\t( \&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;name\&quot; = ?)&quot;, sql);
&nbsp;        }
<b class="nc">&nbsp;        Assert.assertEquals(3, traversal.getSteps().size());</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(0) instanceof SqlgGraphStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(1) instanceof SqlgPropertiesStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(2) instanceof SqlgSumGlobalStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.hasNext());</b>
<b class="nc">&nbsp;        Long max = traversal.next();</b>
<b class="nc">&nbsp;        Assert.assertEquals(12, max, 0);</b>
<b class="nc">&nbsp;        Assert.assertFalse(traversal.hasNext());</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testDuplicatePathGroupCountQuery2() {
<b class="nc">&nbsp;        VertexLabel aVertexLabel = this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;A&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;uid&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;age&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;uid&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        VertexLabel bVertexLabel = this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;B&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;uid&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;age&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;uid&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;C&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;uid&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;age&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;uid&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        aVertexLabel.ensureEdgeLabelExist(&quot;ab&quot;, bVertexLabel, new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;uid&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(Set.of(&quot;uid&quot;)));</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        Vertex a1 = this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;name&quot;, &quot;a&quot;, &quot;age&quot;, 1, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        Vertex b1 = this.sqlgGraph.addVertex(T.label, &quot;B&quot;, &quot;name&quot;, &quot;b&quot;, &quot;age&quot;, 1, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        Vertex b2 = this.sqlgGraph.addVertex(T.label, &quot;B&quot;, &quot;name&quot;, &quot;b&quot;, &quot;age&quot;, 2, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        Vertex b3 = this.sqlgGraph.addVertex(T.label, &quot;B&quot;, &quot;name&quot;, &quot;b&quot;, &quot;age&quot;, 3, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        Vertex b4 = this.sqlgGraph.addVertex(T.label, &quot;B&quot;, &quot;name&quot;, &quot;b&quot;, &quot;age&quot;, 3, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        Vertex c1 = this.sqlgGraph.addVertex(T.label, &quot;C&quot;, &quot;name&quot;, &quot;b&quot;, &quot;age&quot;, 0, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        Vertex c2 = this.sqlgGraph.addVertex(T.label, &quot;C&quot;, &quot;name&quot;, &quot;b&quot;, &quot;age&quot;, 2, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        Vertex c3 = this.sqlgGraph.addVertex(T.label, &quot;C&quot;, &quot;name&quot;, &quot;b&quot;, &quot;age&quot;, 4, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;ab&quot;, b1, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;ab&quot;, b2, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;ab&quot;, b3, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;ab&quot;, b4, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;ac&quot;, c1, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;ac&quot;, c2, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;ac&quot;, c3, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;
<b class="nc">&nbsp;        DefaultTraversal&lt;Vertex, Map&lt;String, Long&gt;&gt; traversal = (DefaultTraversal) this.sqlgGraph.traversal().V(a1).out(&quot;ab&quot;, &quot;ac&quot;).group().by(&quot;name&quot;).by(__.values(&quot;age&quot;).count());</b>
<b class="nc">&nbsp;        String sql = getSQL(traversal);</b>
<b class="nc">&nbsp;        if (isPostgres()) {</b>
<b class="nc">&nbsp;            Assert.assertEquals(&quot;\n&quot; +</b>
&nbsp;                    &quot;SELECT\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_B\&quot;.\&quot;uid\&quot; AS \&quot;alias1\&quot;,\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_B\&quot;.\&quot;name\&quot; AS \&quot;alias2\&quot;,\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_B\&quot;.\&quot;age\&quot; AS \&quot;alias3\&quot;\n&quot; +
&nbsp;                    &quot;FROM\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot; INNER JOIN\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;E_ab\&quot; ON \&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;uid\&quot; = \&quot;public\&quot;.\&quot;E_ab\&quot;.\&quot;public.A.uid__O\&quot; INNER JOIN\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_B\&quot; ON \&quot;public\&quot;.\&quot;E_ab\&quot;.\&quot;public.B.uid__I\&quot; = \&quot;public\&quot;.\&quot;V_B\&quot;.\&quot;uid\&quot;\n&quot; +
&nbsp;                    &quot;WHERE\n&quot; +
&nbsp;                    &quot;\t( \&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;uid\&quot; = ?)&quot;, sql);
&nbsp;        }
<b class="nc">&nbsp;        Assert.assertEquals(2, traversal.getSteps().size());</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(0) instanceof SqlgGraphStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(1) instanceof GroupStep);</b>
<b class="nc">&nbsp;        Map&lt;String, Long&gt; result = traversal.next();</b>
<b class="nc">&nbsp;        Assert.assertEquals(1, result.size());</b>
<b class="nc">&nbsp;        Assert.assertTrue(result.containsKey(&quot;b&quot;));</b>
<b class="nc">&nbsp;        Long l = result.get(&quot;b&quot;);</b>
<b class="nc">&nbsp;        Assert.assertEquals(7L, l, 0L);</b>
<b class="nc">&nbsp;        Assert.assertFalse(traversal.hasNext());</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testDuplicatePathGroupCountQuery() {
<b class="nc">&nbsp;        VertexLabel aVertexLabel = this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;A&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;uid&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;age&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;uid&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        VertexLabel bVertexLabel = this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;B&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;uid&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;age&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;uid&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        VertexLabel cVertexLabel = this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;C&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;uid&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;age&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;uid&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        aVertexLabel.ensureEdgeLabelExist(&quot;ab&quot;, bVertexLabel, new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;            put(&quot;uid&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;        }}, ListOrderedSet.listOrderedSet(Set.of(&quot;uid&quot;)));</b>
<b class="nc">&nbsp;        aVertexLabel.ensureEdgeLabelExist(&quot;ac&quot;, cVertexLabel, new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;            put(&quot;uid&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;        }}, ListOrderedSet.listOrderedSet(Set.of(&quot;uid&quot;)));</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        Vertex a1 = this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;name&quot;, &quot;a1&quot;, &quot;age&quot;, 1, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        Vertex b1 = this.sqlgGraph.addVertex(T.label, &quot;B&quot;, &quot;name&quot;, &quot;b&quot;, &quot;age&quot;, 1, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        Vertex b2 = this.sqlgGraph.addVertex(T.label, &quot;B&quot;, &quot;name&quot;, &quot;b&quot;, &quot;age&quot;, 2, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        Vertex b3 = this.sqlgGraph.addVertex(T.label, &quot;B&quot;, &quot;name&quot;, &quot;b&quot;, &quot;age&quot;, 3, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        Vertex b4 = this.sqlgGraph.addVertex(T.label, &quot;B&quot;, &quot;name&quot;, &quot;b&quot;, &quot;age&quot;, 3, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        Vertex c1 = this.sqlgGraph.addVertex(T.label, &quot;C&quot;, &quot;name&quot;, &quot;b&quot;, &quot;age&quot;, 1, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        Vertex c2 = this.sqlgGraph.addVertex(T.label, &quot;C&quot;, &quot;name&quot;, &quot;b&quot;, &quot;age&quot;, 2, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        Vertex c3 = this.sqlgGraph.addVertex(T.label, &quot;C&quot;, &quot;name&quot;, &quot;b&quot;, &quot;age&quot;, 3, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;ab&quot;, b1, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;ab&quot;, b2, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;ab&quot;, b3, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;ab&quot;, b4, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;ac&quot;, c1, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;ac&quot;, c2, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;ac&quot;, c3, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;
<b class="nc">&nbsp;        DefaultTraversal&lt;Vertex, Map&lt;String, Long&gt;&gt; traversal = (DefaultTraversal) this.sqlgGraph.traversal().V(a1).out(&quot;ab&quot;, &quot;ac&quot;).group().by(&quot;name&quot;).by(__.count());</b>
<b class="nc">&nbsp;        String sql = getSQL(traversal);</b>
<b class="nc">&nbsp;        if (isPostgres()) {</b>
<b class="nc">&nbsp;            Assert.assertEquals(&quot;\n&quot; +</b>
&nbsp;                    &quot;SELECT\n&quot; +
&nbsp;                    &quot;\tCOUNT(1) AS \&quot;count\&quot;,\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_B\&quot;.\&quot;name\&quot; AS \&quot;alias1\&quot;\n&quot; +
&nbsp;                    &quot;FROM\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot; INNER JOIN\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;E_ab\&quot; ON \&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;uid\&quot; = \&quot;public\&quot;.\&quot;E_ab\&quot;.\&quot;public.A.uid__O\&quot; INNER JOIN\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_B\&quot; ON \&quot;public\&quot;.\&quot;E_ab\&quot;.\&quot;public.B.uid__I\&quot; = \&quot;public\&quot;.\&quot;V_B\&quot;.\&quot;uid\&quot;\n&quot; +
&nbsp;                    &quot;WHERE\n&quot; +
&nbsp;                    &quot;\t( \&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;uid\&quot; = ?)\n&quot; +
&nbsp;                    &quot;GROUP BY\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_B\&quot;.\&quot;name\&quot;&quot;, sql);
&nbsp;        }
<b class="nc">&nbsp;        Assert.assertEquals(2, traversal.getSteps().size());</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(0) instanceof SqlgGraphStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(1) instanceof SqlgGroupStep);</b>
<b class="nc">&nbsp;        Map&lt;String, Long&gt; result = traversal.next();</b>
<b class="nc">&nbsp;        Assert.assertEquals(1, result.size());</b>
<b class="nc">&nbsp;        Assert.assertTrue(result.containsKey(&quot;b&quot;));</b>
<b class="nc">&nbsp;        Assert.assertEquals(7, result.get(&quot;b&quot;), 0);</b>
<b class="nc">&nbsp;        Assert.assertFalse(traversal.hasNext());</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testDuplicatePathGroupSumQuery() {
<b class="nc">&nbsp;        VertexLabel aVertexLabel = this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;A&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;uid&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;age&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;uid&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        VertexLabel bVertexLabel = this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;B&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;uid&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;age&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;uid&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        VertexLabel cVertexLabel = this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;C&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;uid&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;age&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;uid&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        aVertexLabel.ensureEdgeLabelExist(&quot;ab&quot;, bVertexLabel, new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;            put(&quot;uid&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;        }}, ListOrderedSet.listOrderedSet(Set.of(&quot;uid&quot;)));</b>
<b class="nc">&nbsp;        aVertexLabel.ensureEdgeLabelExist(&quot;ac&quot;, cVertexLabel, new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;            put(&quot;uid&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;        }}, ListOrderedSet.listOrderedSet(Set.of(&quot;uid&quot;)));</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        Vertex a1 = this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;name&quot;, &quot;a1&quot;, &quot;age&quot;, 1, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        Vertex b1 = this.sqlgGraph.addVertex(T.label, &quot;B&quot;, &quot;name&quot;, &quot;b&quot;, &quot;age&quot;, 1, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        Vertex b2 = this.sqlgGraph.addVertex(T.label, &quot;B&quot;, &quot;name&quot;, &quot;b&quot;, &quot;age&quot;, 2, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        Vertex b3 = this.sqlgGraph.addVertex(T.label, &quot;B&quot;, &quot;name&quot;, &quot;b&quot;, &quot;age&quot;, 3, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        Vertex b4 = this.sqlgGraph.addVertex(T.label, &quot;B&quot;, &quot;name&quot;, &quot;b&quot;, &quot;age&quot;, 3, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        Vertex c1 = this.sqlgGraph.addVertex(T.label, &quot;C&quot;, &quot;name&quot;, &quot;b&quot;, &quot;age&quot;, 1, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        Vertex c2 = this.sqlgGraph.addVertex(T.label, &quot;C&quot;, &quot;name&quot;, &quot;b&quot;, &quot;age&quot;, 2, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        Vertex c3 = this.sqlgGraph.addVertex(T.label, &quot;C&quot;, &quot;name&quot;, &quot;b&quot;, &quot;age&quot;, 3, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;ab&quot;, b1, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;ab&quot;, b2, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;ab&quot;, b3, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;ab&quot;, b4, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;ac&quot;, c1, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;ac&quot;, c2, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;ac&quot;, c3, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;
<b class="nc">&nbsp;        DefaultTraversal&lt;Vertex, Map&lt;String, Long&gt;&gt; traversal = (DefaultTraversal) this.sqlgGraph.traversal().V(a1).out(&quot;ab&quot;, &quot;ac&quot;).group().by(&quot;name&quot;).by(__.values(&quot;age&quot;).sum());</b>
<b class="nc">&nbsp;        String sql = getSQL(traversal);</b>
<b class="nc">&nbsp;        if (isPostgres()) {</b>
<b class="nc">&nbsp;            Assert.assertEquals(&quot;\n&quot; +</b>
&nbsp;                    &quot;SELECT\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_B\&quot;.\&quot;name\&quot; AS \&quot;alias1\&quot;,\n&quot; +
&nbsp;                    &quot;\tSUM(\&quot;public\&quot;.\&quot;V_B\&quot;.\&quot;age\&quot;) AS \&quot;alias2\&quot;\n&quot; +
&nbsp;                    &quot;FROM\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot; INNER JOIN\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;E_ab\&quot; ON \&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;uid\&quot; = \&quot;public\&quot;.\&quot;E_ab\&quot;.\&quot;public.A.uid__O\&quot; INNER JOIN\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_B\&quot; ON \&quot;public\&quot;.\&quot;E_ab\&quot;.\&quot;public.B.uid__I\&quot; = \&quot;public\&quot;.\&quot;V_B\&quot;.\&quot;uid\&quot;\n&quot; +
&nbsp;                    &quot;WHERE\n&quot; +
&nbsp;                    &quot;\t( \&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;uid\&quot; = ?)\n&quot; +
&nbsp;                    &quot;GROUP BY\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_B\&quot;.\&quot;name\&quot;&quot;, sql);
&nbsp;        }
<b class="nc">&nbsp;        Assert.assertEquals(2, traversal.getSteps().size());</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(0) instanceof SqlgGraphStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(1) instanceof SqlgGroupStep);</b>
<b class="nc">&nbsp;        Map&lt;String, Long&gt; result = traversal.next();</b>
<b class="nc">&nbsp;        Assert.assertEquals(1, result.size());</b>
<b class="nc">&nbsp;        Assert.assertTrue(result.containsKey(&quot;b&quot;));</b>
<b class="nc">&nbsp;        Assert.assertEquals(15, result.get(&quot;b&quot;), 0);</b>
<b class="nc">&nbsp;        Assert.assertFalse(traversal.hasNext());</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testDuplicatePathGroupMaxQuery() {
<b class="nc">&nbsp;        VertexLabel aVertexLabel = this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;A&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;uid&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;age&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;uid&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        VertexLabel bVertexLabel = this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;B&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;uid&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;age&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;uid&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        VertexLabel cVertexLabel = this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;C&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;uid&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;age&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;uid&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        aVertexLabel.ensureEdgeLabelExist(&quot;ab&quot;, bVertexLabel, new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;            put(&quot;uid&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;        }}, ListOrderedSet.listOrderedSet(Set.of(&quot;uid&quot;)));</b>
<b class="nc">&nbsp;        aVertexLabel.ensureEdgeLabelExist(&quot;ac&quot;, cVertexLabel, new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;            put(&quot;uid&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;        }}, ListOrderedSet.listOrderedSet(Set.of(&quot;uid&quot;)));</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        Vertex a1 = this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;name&quot;, &quot;a1&quot;, &quot;age&quot;, 1, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        Vertex b1 = this.sqlgGraph.addVertex(T.label, &quot;B&quot;, &quot;name&quot;, &quot;b&quot;, &quot;age&quot;, 1, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        Vertex b2 = this.sqlgGraph.addVertex(T.label, &quot;B&quot;, &quot;name&quot;, &quot;b&quot;, &quot;age&quot;, 2, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        Vertex b3 = this.sqlgGraph.addVertex(T.label, &quot;B&quot;, &quot;name&quot;, &quot;b&quot;, &quot;age&quot;, 3, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        Vertex b4 = this.sqlgGraph.addVertex(T.label, &quot;B&quot;, &quot;name&quot;, &quot;b&quot;, &quot;age&quot;, 3, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        Vertex c1 = this.sqlgGraph.addVertex(T.label, &quot;C&quot;, &quot;name&quot;, &quot;b&quot;, &quot;age&quot;, 1, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        Vertex c2 = this.sqlgGraph.addVertex(T.label, &quot;C&quot;, &quot;name&quot;, &quot;b&quot;, &quot;age&quot;, 2, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        Vertex c3 = this.sqlgGraph.addVertex(T.label, &quot;C&quot;, &quot;name&quot;, &quot;b&quot;, &quot;age&quot;, 4, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;ab&quot;, b1, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;ab&quot;, b2, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;ab&quot;, b3, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;ab&quot;, b4, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;ac&quot;, c1, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;ac&quot;, c2, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;ac&quot;, c3, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;
<b class="nc">&nbsp;        DefaultTraversal&lt;Vertex, Map&lt;String, Integer&gt;&gt; traversal = (DefaultTraversal) this.sqlgGraph.traversal().V(a1).out(&quot;ab&quot;, &quot;ac&quot;).group().by(&quot;name&quot;).by(__.values(&quot;age&quot;).max());</b>
<b class="nc">&nbsp;        String sql = getSQL(traversal);</b>
<b class="nc">&nbsp;        if (isPostgres()) {</b>
<b class="nc">&nbsp;            Assert.assertEquals(&quot;\n&quot; +</b>
&nbsp;                    &quot;SELECT\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_B\&quot;.\&quot;name\&quot; AS \&quot;alias1\&quot;,\n&quot; +
&nbsp;                    &quot;\tMAX(\&quot;public\&quot;.\&quot;V_B\&quot;.\&quot;age\&quot;) AS \&quot;alias2\&quot;\n&quot; +
&nbsp;                    &quot;FROM\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot; INNER JOIN\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;E_ab\&quot; ON \&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;uid\&quot; = \&quot;public\&quot;.\&quot;E_ab\&quot;.\&quot;public.A.uid__O\&quot; INNER JOIN\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_B\&quot; ON \&quot;public\&quot;.\&quot;E_ab\&quot;.\&quot;public.B.uid__I\&quot; = \&quot;public\&quot;.\&quot;V_B\&quot;.\&quot;uid\&quot;\n&quot; +
&nbsp;                    &quot;WHERE\n&quot; +
&nbsp;                    &quot;\t( \&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;uid\&quot; = ?)\n&quot; +
&nbsp;                    &quot;GROUP BY\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_B\&quot;.\&quot;name\&quot;&quot;, sql);
&nbsp;        }
<b class="nc">&nbsp;        Assert.assertEquals(2, traversal.getSteps().size());</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(0) instanceof SqlgGraphStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(1) instanceof SqlgGroupStep);</b>
<b class="nc">&nbsp;        Map&lt;String, Integer&gt; result = traversal.next();</b>
<b class="nc">&nbsp;        Assert.assertEquals(1, result.size());</b>
<b class="nc">&nbsp;        Assert.assertTrue(result.containsKey(&quot;b&quot;));</b>
<b class="nc">&nbsp;        Assert.assertEquals(4, result.get(&quot;b&quot;), 0);</b>
<b class="nc">&nbsp;        Assert.assertFalse(traversal.hasNext());</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testDuplicatePathGroupMinQuery() {
<b class="nc">&nbsp;        VertexLabel aVertexLabel = this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;A&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;uid&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;age&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;uid&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        VertexLabel bVertexLabel = this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;B&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;uid&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;age&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;uid&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        VertexLabel cVertexLabel = this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;C&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;uid&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;age&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;uid&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        aVertexLabel.ensureEdgeLabelExist(&quot;ab&quot;, bVertexLabel, new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;            put(&quot;uid&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;        }}, ListOrderedSet.listOrderedSet(Set.of(&quot;uid&quot;)));</b>
<b class="nc">&nbsp;        aVertexLabel.ensureEdgeLabelExist(&quot;ac&quot;, cVertexLabel, new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;            put(&quot;uid&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;        }}, ListOrderedSet.listOrderedSet(Set.of(&quot;uid&quot;)));</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        Vertex a1 = this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;name&quot;, &quot;a1&quot;, &quot;age&quot;, 1, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        Vertex b1 = this.sqlgGraph.addVertex(T.label, &quot;B&quot;, &quot;name&quot;, &quot;b&quot;, &quot;age&quot;, 1, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        Vertex b2 = this.sqlgGraph.addVertex(T.label, &quot;B&quot;, &quot;name&quot;, &quot;b&quot;, &quot;age&quot;, 2, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        Vertex b3 = this.sqlgGraph.addVertex(T.label, &quot;B&quot;, &quot;name&quot;, &quot;b&quot;, &quot;age&quot;, 3, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        Vertex b4 = this.sqlgGraph.addVertex(T.label, &quot;B&quot;, &quot;name&quot;, &quot;b&quot;, &quot;age&quot;, 3, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        Vertex c1 = this.sqlgGraph.addVertex(T.label, &quot;C&quot;, &quot;name&quot;, &quot;b&quot;, &quot;age&quot;, 0, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        Vertex c2 = this.sqlgGraph.addVertex(T.label, &quot;C&quot;, &quot;name&quot;, &quot;b&quot;, &quot;age&quot;, 2, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        Vertex c3 = this.sqlgGraph.addVertex(T.label, &quot;C&quot;, &quot;name&quot;, &quot;b&quot;, &quot;age&quot;, 4, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;ab&quot;, b1, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;ab&quot;, b2, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;ab&quot;, b3, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;ab&quot;, b4, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;ac&quot;, c1, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;ac&quot;, c2, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;ac&quot;, c3, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;
<b class="nc">&nbsp;        DefaultTraversal&lt;Vertex, Map&lt;String, Integer&gt;&gt; traversal = (DefaultTraversal) this.sqlgGraph.traversal().V(a1).out(&quot;ab&quot;, &quot;ac&quot;).group().by(&quot;name&quot;).by(__.values(&quot;age&quot;).min());</b>
<b class="nc">&nbsp;        String sql = getSQL(traversal);</b>
<b class="nc">&nbsp;        if (isPostgres()) {</b>
<b class="nc">&nbsp;            Assert.assertEquals(&quot;\n&quot; +</b>
&nbsp;                    &quot;SELECT\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_B\&quot;.\&quot;name\&quot; AS \&quot;alias1\&quot;,\n&quot; +
&nbsp;                    &quot;\tMIN(\&quot;public\&quot;.\&quot;V_B\&quot;.\&quot;age\&quot;) AS \&quot;alias2\&quot;\n&quot; +
&nbsp;                    &quot;FROM\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot; INNER JOIN\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;E_ab\&quot; ON \&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;uid\&quot; = \&quot;public\&quot;.\&quot;E_ab\&quot;.\&quot;public.A.uid__O\&quot; INNER JOIN\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_B\&quot; ON \&quot;public\&quot;.\&quot;E_ab\&quot;.\&quot;public.B.uid__I\&quot; = \&quot;public\&quot;.\&quot;V_B\&quot;.\&quot;uid\&quot;\n&quot; +
&nbsp;                    &quot;WHERE\n&quot; +
&nbsp;                    &quot;\t( \&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;uid\&quot; = ?)\n&quot; +
&nbsp;                    &quot;GROUP BY\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_B\&quot;.\&quot;name\&quot;&quot;, sql);
&nbsp;        }
<b class="nc">&nbsp;        Assert.assertEquals(2, traversal.getSteps().size());</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(0) instanceof SqlgGraphStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(1) instanceof SqlgGroupStep);</b>
<b class="nc">&nbsp;        Map&lt;String, Integer&gt; result = traversal.next();</b>
<b class="nc">&nbsp;        Assert.assertEquals(1, result.size());</b>
<b class="nc">&nbsp;        Assert.assertTrue(result.containsKey(&quot;b&quot;));</b>
<b class="nc">&nbsp;        Assert.assertEquals(0, result.get(&quot;b&quot;), 0);</b>
<b class="nc">&nbsp;        Assert.assertFalse(traversal.hasNext());</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testDuplicatePathGroupMeanQuery() {
<b class="nc">&nbsp;        VertexLabel aVertexLabel = this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;A&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;uid&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;age&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;uid&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        VertexLabel bVertexLabel = this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;B&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;uid&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;age&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;uid&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        VertexLabel cVertexLabel = this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;C&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;uid&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;age&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;uid&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        aVertexLabel.ensureEdgeLabelExist(&quot;ab&quot;, bVertexLabel, new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;            put(&quot;uid&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;        }}, ListOrderedSet.listOrderedSet(Set.of(&quot;uid&quot;)));</b>
<b class="nc">&nbsp;        aVertexLabel.ensureEdgeLabelExist(&quot;ac&quot;, cVertexLabel, new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;            put(&quot;uid&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;        }}, ListOrderedSet.listOrderedSet(Set.of(&quot;uid&quot;)));</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        Vertex a1 = this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;name&quot;, &quot;a1&quot;, &quot;age&quot;, 1, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        Vertex b1 = this.sqlgGraph.addVertex(T.label, &quot;B&quot;, &quot;name&quot;, &quot;b&quot;, &quot;age&quot;, 1, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        Vertex b2 = this.sqlgGraph.addVertex(T.label, &quot;B&quot;, &quot;name&quot;, &quot;b&quot;, &quot;age&quot;, 2, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        Vertex b3 = this.sqlgGraph.addVertex(T.label, &quot;B&quot;, &quot;name&quot;, &quot;b&quot;, &quot;age&quot;, 3, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        Vertex b4 = this.sqlgGraph.addVertex(T.label, &quot;B&quot;, &quot;name&quot;, &quot;b&quot;, &quot;age&quot;, 3, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        Vertex c1 = this.sqlgGraph.addVertex(T.label, &quot;C&quot;, &quot;name&quot;, &quot;b&quot;, &quot;age&quot;, 0, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        Vertex c2 = this.sqlgGraph.addVertex(T.label, &quot;C&quot;, &quot;name&quot;, &quot;b&quot;, &quot;age&quot;, 2, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        Vertex c3 = this.sqlgGraph.addVertex(T.label, &quot;C&quot;, &quot;name&quot;, &quot;b&quot;, &quot;age&quot;, 4, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;ab&quot;, b1, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;ab&quot;, b2, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;ab&quot;, b3, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;ab&quot;, b4, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;ac&quot;, c1, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;ac&quot;, c2, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;ac&quot;, c3, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;
<b class="nc">&nbsp;        DefaultTraversal&lt;Vertex, Map&lt;String, Double&gt;&gt; traversal = (DefaultTraversal) this.sqlgGraph.traversal().V(a1).out(&quot;ab&quot;, &quot;ac&quot;).group().by(&quot;name&quot;).by(__.values(&quot;age&quot;).mean());</b>
<b class="nc">&nbsp;        String sql = getSQL(traversal);</b>
<b class="nc">&nbsp;        if (isPostgres()) {</b>
<b class="nc">&nbsp;            Assert.assertEquals(&quot;\n&quot; +</b>
&nbsp;                    &quot;SELECT\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_B\&quot;.\&quot;name\&quot; AS \&quot;alias1\&quot;,\n&quot; +
&nbsp;                    &quot;\tAVG(\&quot;public\&quot;.\&quot;V_B\&quot;.\&quot;age\&quot;) AS \&quot;alias2\&quot;, COUNT(1) AS \&quot;alias2_weight\&quot;\n&quot; +
&nbsp;                    &quot;FROM\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot; INNER JOIN\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;E_ab\&quot; ON \&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;uid\&quot; = \&quot;public\&quot;.\&quot;E_ab\&quot;.\&quot;public.A.uid__O\&quot; INNER JOIN\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_B\&quot; ON \&quot;public\&quot;.\&quot;E_ab\&quot;.\&quot;public.B.uid__I\&quot; = \&quot;public\&quot;.\&quot;V_B\&quot;.\&quot;uid\&quot;\n&quot; +
&nbsp;                    &quot;WHERE\n&quot; +
&nbsp;                    &quot;\t( \&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;uid\&quot; = ?)\n&quot; +
&nbsp;                    &quot;GROUP BY\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_B\&quot;.\&quot;name\&quot;&quot;, sql);
&nbsp;        }
<b class="nc">&nbsp;        Assert.assertEquals(2, traversal.getSteps().size());</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(0) instanceof SqlgGraphStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(1) instanceof SqlgGroupStep);</b>
<b class="nc">&nbsp;        Map&lt;String, Double&gt; result = traversal.next();</b>
<b class="nc">&nbsp;        Assert.assertEquals(1, result.size());</b>
<b class="nc">&nbsp;        Assert.assertTrue(result.containsKey(&quot;b&quot;));</b>
<b class="nc">&nbsp;        Double d = result.get(&quot;b&quot;);</b>
<b class="nc">&nbsp;        Assert.assertEquals(2.142857142857143D, d, 0D);</b>
<b class="nc">&nbsp;        Assert.assertFalse(traversal.hasNext());</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testGroupByDuplicatePaths() {
<b class="nc">&nbsp;        VertexLabel aVertexLabel = this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;A&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;uid&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;age&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;uid&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        aVertexLabel.ensureEdgeLabelExist(&quot;aa&quot;, aVertexLabel, new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;            put(&quot;uid&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;        }}, ListOrderedSet.listOrderedSet(Set.of(&quot;uid&quot;)));</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        Vertex a1 = this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;name&quot;, &quot;a1&quot;, &quot;age&quot;, 1, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        Vertex a2 = this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;name&quot;, &quot;a2&quot;, &quot;age&quot;, 2, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        Vertex a3 = this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;name&quot;, &quot;a2&quot;, &quot;age&quot;, 3, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        Vertex a4 = this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;name&quot;, &quot;a3&quot;, &quot;age&quot;, 4, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        Vertex a5 = this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;name&quot;, &quot;a3&quot;, &quot;age&quot;, 5, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        Vertex a6 = this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;name&quot;, &quot;a3&quot;, &quot;age&quot;, 6, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;aa&quot;, a2, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;aa&quot;, a3, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;aa&quot;, a4, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;aa&quot;, a5, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;aa&quot;, a6, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;
<b class="nc">&nbsp;        DefaultTraversal&lt;Vertex, Map&lt;String, Integer&gt;&gt; traversal = (DefaultTraversal) this.sqlgGraph.traversal().V(a1).out().&lt;String, Integer&gt;group().by(&quot;name&quot;).by(__.values(&quot;age&quot;).max());</b>
<b class="nc">&nbsp;        String sql = getSQL(traversal);</b>
<b class="nc">&nbsp;        if (isPostgres()) {</b>
<b class="nc">&nbsp;            Assert.assertEquals(&quot;SELECT\n&quot; +</b>
&nbsp;                    &quot;\ta2.\&quot;alias2\&quot;, MAX(a2.\&quot;alias3\&quot;) \n&quot; +
&nbsp;                    &quot;FROM (\n&quot; +
&nbsp;                    &quot;SELECT\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;E_aa\&quot;.\&quot;public.A.uid__I\&quot; AS \&quot;public.E_aa.public.A.uid__I\&quot;\n&quot; +
&nbsp;                    &quot;FROM\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot; INNER JOIN\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;E_aa\&quot; ON \&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;uid\&quot; = \&quot;public\&quot;.\&quot;E_aa\&quot;.\&quot;public.A.uid__O\&quot;\n&quot; +
&nbsp;                    &quot;WHERE\n&quot; +
&nbsp;                    &quot;\t( \&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;uid\&quot; = ?)\n&quot; +
&nbsp;                    &quot;) a1 INNER JOIN (\n&quot; +
&nbsp;                    &quot;SELECT\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;uid\&quot; AS \&quot;alias1\&quot;,\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;name\&quot; AS \&quot;alias2\&quot;,\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;age\&quot; AS \&quot;alias3\&quot;\n&quot; +
&nbsp;                    &quot;FROM\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot;\n&quot; +
&nbsp;                    &quot;) a2 ON a1.\&quot;public.E_aa.public.A.uid__I\&quot; = a2.\&quot;alias1\&quot;\n&quot; +
&nbsp;                    &quot;GROUP BY\n&quot; +
&nbsp;                    &quot;\ta2.\&quot;alias2\&quot;&quot;, sql);
&nbsp;        }
<b class="nc">&nbsp;        Assert.assertEquals(2, traversal.getSteps().size());</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(0) instanceof SqlgGraphStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(1) instanceof SqlgGroupStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.hasNext());</b>
<b class="nc">&nbsp;        Map&lt;String, Integer&gt; result = traversal.next();</b>
<b class="nc">&nbsp;        Assert.assertEquals(2, result.size());</b>
<b class="nc">&nbsp;        Assert.assertTrue(result.containsKey(&quot;a2&quot;));</b>
<b class="nc">&nbsp;        Assert.assertEquals(3, result.get(&quot;a2&quot;), 0);</b>
<b class="nc">&nbsp;        Assert.assertTrue(result.containsKey(&quot;a3&quot;));</b>
<b class="nc">&nbsp;        Assert.assertEquals(6, result.get(&quot;a3&quot;), 0);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void duplicateQueryMax() {
<b class="nc">&nbsp;        this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;A&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;age&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;age&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;B&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;age&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;age&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;age&quot;, 1);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;B&quot;, &quot;age&quot;, 2);</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;
<b class="nc">&nbsp;        DefaultTraversal&lt;Vertex, Integer&gt; traversal = (DefaultTraversal) this.sqlgGraph.traversal().V().values(&quot;age&quot;).max();</b>
<b class="nc">&nbsp;        String sql = getSQL(traversal);</b>
<b class="nc">&nbsp;        if (isPostgres()) {</b>
<b class="nc">&nbsp;            Assert.assertEquals(&quot;\n&quot; +</b>
&nbsp;                    &quot;SELECT\n&quot; +
&nbsp;                    &quot;\tMAX(\&quot;public\&quot;.\&quot;V_B\&quot;.\&quot;age\&quot;) AS \&quot;alias1\&quot;\n&quot; +
&nbsp;                    &quot;FROM\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_B\&quot;&quot;, sql);
&nbsp;        }
<b class="nc">&nbsp;        Assert.assertEquals(3, traversal.getSteps().size());</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(0) instanceof SqlgGraphStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(1) instanceof SqlgPropertiesStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(2) instanceof SqlgMaxGlobalStep);</b>
&nbsp;
<b class="nc">&nbsp;        Assert.assertEquals(2, traversal.next(), 0);</b>
<b class="nc">&nbsp;        Assert.assertFalse(traversal.hasNext());</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void duplicateQueryMin() {
<b class="nc">&nbsp;        this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;A&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;age&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;age&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;B&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;age&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;age&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;age&quot;, 1);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;B&quot;, &quot;age&quot;, 2);</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;
<b class="nc">&nbsp;        DefaultTraversal&lt;Vertex, Integer&gt; traversal = (DefaultTraversal) this.sqlgGraph.traversal().V().values(&quot;age&quot;).min();</b>
<b class="nc">&nbsp;        String sql = getSQL(traversal);</b>
<b class="nc">&nbsp;        if (isPostgres()) {</b>
<b class="nc">&nbsp;            Assert.assertEquals(&quot;\n&quot; +</b>
&nbsp;                    &quot;SELECT\n&quot; +
&nbsp;                    &quot;\tMIN(\&quot;public\&quot;.\&quot;V_B\&quot;.\&quot;age\&quot;) AS \&quot;alias1\&quot;\n&quot; +
&nbsp;                    &quot;FROM\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_B\&quot;&quot;, sql);
&nbsp;        }
<b class="nc">&nbsp;        Assert.assertEquals(3, traversal.getSteps().size());</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(0) instanceof SqlgGraphStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(1) instanceof SqlgPropertiesStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(2) instanceof SqlgMinGlobalStep);</b>
&nbsp;
<b class="nc">&nbsp;        Assert.assertEquals(1, traversal.next(), 0);</b>
<b class="nc">&nbsp;        Assert.assertFalse(traversal.hasNext());</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void duplicateQuerySum() {
<b class="nc">&nbsp;        this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;A&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;age&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;age&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;B&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;age&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;age&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;age&quot;, 1);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;B&quot;, &quot;age&quot;, 2);</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;
<b class="nc">&nbsp;        DefaultTraversal&lt;Vertex, Long&gt; traversal = (DefaultTraversal) this.sqlgGraph.traversal().V().values(&quot;age&quot;).sum();</b>
<b class="nc">&nbsp;        String sql = getSQL(traversal);</b>
<b class="nc">&nbsp;        if (isPostgres()) {</b>
<b class="nc">&nbsp;            Assert.assertEquals(&quot;\n&quot; +</b>
&nbsp;                    &quot;SELECT\n&quot; +
&nbsp;                    &quot;\tSUM(\&quot;public\&quot;.\&quot;V_B\&quot;.\&quot;age\&quot;) AS \&quot;alias1\&quot;\n&quot; +
&nbsp;                    &quot;FROM\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_B\&quot;&quot;, sql);
&nbsp;        }
<b class="nc">&nbsp;        Assert.assertEquals(3, traversal.getSteps().size());</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(0) instanceof SqlgGraphStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(1) instanceof SqlgPropertiesStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(2) instanceof SqlgSumGlobalStep);</b>
&nbsp;
<b class="nc">&nbsp;        Assert.assertEquals(3, traversal.next(), 0L);</b>
<b class="nc">&nbsp;        Assert.assertFalse(traversal.hasNext());</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void duplicateQueryMean() {
<b class="nc">&nbsp;        this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;A&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;age&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;name&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;B&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;age&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;name&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;age&quot;, 1, &quot;name&quot;, &quot;a1&quot;);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;B&quot;, &quot;age&quot;, 2, &quot;name&quot;, &quot;b1&quot;);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;B&quot;, &quot;age&quot;, 2, &quot;name&quot;, &quot;b2&quot;);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;B&quot;, &quot;age&quot;, 2, &quot;name&quot;, &quot;b3&quot;);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;B&quot;, &quot;age&quot;, 2, &quot;name&quot;, &quot;b4&quot;);</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;
<b class="nc">&nbsp;        DefaultTraversal&lt;Vertex, Double&gt; traversal = (DefaultTraversal) this.sqlgGraph.traversal().V().values(&quot;age&quot;).mean();</b>
<b class="nc">&nbsp;        String sql = getSQL(traversal);</b>
<b class="nc">&nbsp;        if (isPostgres()) {</b>
<b class="nc">&nbsp;            Assert.assertEquals(&quot;\n&quot; +</b>
&nbsp;                    &quot;SELECT\n&quot; +
&nbsp;                    &quot;\tAVG(\&quot;public\&quot;.\&quot;V_B\&quot;.\&quot;age\&quot;) AS \&quot;alias1\&quot;, COUNT(1) AS \&quot;alias1_weight\&quot;\n&quot; +
&nbsp;                    &quot;FROM\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_B\&quot;&quot;, sql);
&nbsp;        }
<b class="nc">&nbsp;        Assert.assertEquals(3, traversal.getSteps().size());</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(0) instanceof SqlgGraphStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(1) instanceof SqlgPropertiesStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(2) instanceof SqlgAvgGlobalStep);</b>
&nbsp;
<b class="nc">&nbsp;        Assert.assertEquals(1.8, traversal.next(), 0);</b>
<b class="nc">&nbsp;        Assert.assertFalse(traversal.hasNext());</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testDuplicateQueryNoLabel() {
<b class="nc">&nbsp;        VertexLabel person = this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;person&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;age&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;name&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        person.ensureEdgeLabelExist(&quot;knows&quot;, person, new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;            put(&quot;uid&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;        }}, ListOrderedSet.listOrderedSet(Set.of(&quot;uid&quot;)));</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        Vertex p1 = this.sqlgGraph.addVertex(T.label, &quot;person&quot;, &quot;age&quot;, 1, &quot;name&quot;, &quot;person1&quot;);</b>
<b class="nc">&nbsp;        Vertex p2 = this.sqlgGraph.addVertex(T.label, &quot;person&quot;, &quot;age&quot;, 2, &quot;name&quot;, &quot;person2&quot;);</b>
<b class="nc">&nbsp;        p1.addEdge(&quot;knows&quot;, p2, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;
<b class="nc">&nbsp;        DefaultTraversal&lt;Vertex, Double&gt; traversal = (DefaultTraversal) this.sqlgGraph.traversal().V().hasLabel(&quot;person&quot;).out().out().values(&quot;age&quot;).max();</b>
<b class="nc">&nbsp;        String sql = getSQL(traversal);</b>
<b class="nc">&nbsp;        if (isPostgres()) {</b>
<b class="nc">&nbsp;            Assert.assertEquals(&quot;SELECT\n&quot; +</b>
&nbsp;                    &quot;\tMAX(a3.\&quot;alias3\&quot;) \n&quot; +
&nbsp;                    &quot;FROM (\n&quot; +
&nbsp;                    &quot;SELECT\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;E_knows\&quot;.\&quot;public.person.name__I\&quot; AS \&quot;public.E_knows.public.person.name__I\&quot;\n&quot; +
&nbsp;                    &quot;FROM\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_person\&quot; INNER JOIN\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;E_knows\&quot; ON \&quot;public\&quot;.\&quot;V_person\&quot;.\&quot;name\&quot; = \&quot;public\&quot;.\&quot;E_knows\&quot;.\&quot;public.person.name__O\&quot;\n&quot; +
&nbsp;                    &quot;) a1 INNER JOIN (\n&quot; +
&nbsp;                    &quot;SELECT\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_person\&quot;.\&quot;name\&quot; AS \&quot;alias1\&quot;,\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;E_knows\&quot;.\&quot;public.person.name__I\&quot; AS \&quot;public.E_knows.public.person.name__I\&quot;\n&quot; +
&nbsp;                    &quot;FROM\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_person\&quot; INNER JOIN\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;E_knows\&quot; ON \&quot;public\&quot;.\&quot;V_person\&quot;.\&quot;name\&quot; = \&quot;public\&quot;.\&quot;E_knows\&quot;.\&quot;public.person.name__O\&quot;\n&quot; +
&nbsp;                    &quot;) a2 ON a1.\&quot;public.E_knows.public.person.name__I\&quot; = a2.\&quot;alias1\&quot; INNER JOIN (\n&quot; +
&nbsp;                    &quot;SELECT\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_person\&quot;.\&quot;name\&quot; AS \&quot;alias2\&quot;,\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_person\&quot;.\&quot;age\&quot; AS \&quot;alias3\&quot;\n&quot; +
&nbsp;                    &quot;FROM\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_person\&quot;\n&quot; +
&nbsp;                    &quot;) a3 ON a2.\&quot;public.E_knows.public.person.name__I\&quot; = a3.\&quot;alias2\&quot;&quot;, sql);
&nbsp;        }
<b class="nc">&nbsp;        Assert.assertEquals(3, traversal.getSteps().size());</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(0) instanceof SqlgGraphStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(1) instanceof SqlgPropertiesStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(2) instanceof SqlgMaxGlobalStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.hasNext());</b>
<b class="nc">&nbsp;        Number m = traversal.next();</b>
&nbsp;        //noinspection ConstantConditions
<b class="nc">&nbsp;        Assert.assertTrue(m instanceof Double);</b>
&nbsp;        //noinspection CastCanBeRemovedNarrowingVariableType
<b class="nc">&nbsp;        Assert.assertEquals(Double.NaN, (Double) m, 0D);</b>
<b class="nc">&nbsp;        Assert.assertFalse(traversal.hasNext());</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testMaxAgain() {
<b class="nc">&nbsp;        this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;Person&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;age&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;name&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;Dog&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;age&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;name&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;age&quot;, 1, &quot;name&quot;, &quot;person1&quot;);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;age&quot;, 3, &quot;name&quot;, &quot;person2&quot;);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;age&quot;, 5, &quot;name&quot;, &quot;person3&quot;);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Dog&quot;, &quot;age&quot;, 7, &quot;name&quot;, &quot;dog1&quot;);</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        Traversal&lt;Vertex, Integer&gt; traversal = this.sqlgGraph.traversal().V().values(&quot;age&quot;).max();</b>
<b class="nc">&nbsp;        printTraversalForm(traversal);</b>
<b class="nc">&nbsp;        Integer max = traversal.next();</b>
<b class="nc">&nbsp;        Assert.assertFalse(traversal.hasNext());</b>
<b class="nc">&nbsp;        Assert.assertEquals(7, max, 0);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testSummingNothing() {
<b class="nc">&nbsp;        this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;A&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;age&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;name&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;name&quot;, &quot;a1&quot;, &quot;age&quot;, 1);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;name&quot;, &quot;a2&quot;, &quot;age&quot;, 1);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;name&quot;, &quot;a3&quot;, &quot;age&quot;, 1);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;name&quot;, &quot;a4&quot;, &quot;age&quot;, 1);</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;
<b class="nc">&nbsp;        Traversal&lt;Vertex, Map&lt;String, Number&gt;&gt; traversal = this.sqlgGraph.traversal()</b>
<b class="nc">&nbsp;                .V().has(&quot;name&quot;, &quot;a5&quot;)</b>
<b class="nc">&nbsp;                .&lt;String, Number&gt;group().by(T.label).by(__.values(&quot;age&quot;).sum());</b>
<b class="nc">&nbsp;        printTraversalForm(traversal);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.hasNext());</b>
<b class="nc">&nbsp;        Map&lt;String, Number&gt; result = traversal.next();</b>
<b class="nc">&nbsp;        Assert.assertTrue(result.containsKey(&quot;A&quot;));</b>
<b class="nc">&nbsp;        Assert.assertEquals(Double.NaN, (Double) result.get(&quot;A&quot;), 0D);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testCount() {
<b class="nc">&nbsp;        this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;A&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;uid&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;uid&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;name&quot;, &quot;a&quot;, &quot;uid&quot;, 1);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;name&quot;, &quot;a&quot;, &quot;uid&quot;, 2);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;name&quot;, &quot;a&quot;, &quot;uid&quot;, 3);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;name&quot;, &quot;a&quot;, &quot;uid&quot;, 4);</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        DefaultTraversal&lt;Vertex, Long&gt; traversal = (DefaultTraversal&lt;Vertex, Long&gt;) this.sqlgGraph.traversal().V().count();</b>
<b class="nc">&nbsp;        String sql = getSQL(traversal);</b>
<b class="nc">&nbsp;        if (isPostgres()) {</b>
<b class="nc">&nbsp;            Assert.assertEquals(&quot;\n&quot; +</b>
&nbsp;                    &quot;SELECT\n&quot; +
&nbsp;                    &quot;\tCOUNT(1) AS \&quot;count\&quot;\n&quot; +
&nbsp;                    &quot;FROM\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot;&quot;, sql);
&nbsp;        }
<b class="nc">&nbsp;        Assert.assertEquals(4, traversal.next(), 0);</b>
<b class="nc">&nbsp;        Assert.assertEquals(3, traversal.getSteps().size());</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(0) instanceof SqlgGraphStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(1) instanceof SqlgPropertiesStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(2) instanceof SqlgCountGlobalStep);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testCountStartEdge() {
<b class="nc">&nbsp;        VertexLabel aVertexLabel = this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;A&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;name&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        VertexLabel bVertexLabel = this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;B&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;name&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        aVertexLabel.ensureEdgeLabelExist(&quot;ab&quot;, bVertexLabel, new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;            put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;        }}, ListOrderedSet.listOrderedSet(Set.of(&quot;name&quot;)));</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;
<b class="nc">&nbsp;        Vertex a1 = this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;name&quot;, &quot;a&quot;);</b>
<b class="nc">&nbsp;        Vertex b1 = this.sqlgGraph.addVertex(T.label, &quot;B&quot;, &quot;name&quot;, &quot;b&quot;);</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;ab&quot;, b1, &quot;name&quot;, &quot;edge1&quot;);</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        List&lt;Vertex&gt; vertices = this.sqlgGraph.traversal().V().hasLabel(&quot;A&quot;).outE().otherV().toList();</b>
<b class="nc">&nbsp;        Assert.assertEquals(1, vertices.size());</b>
<b class="nc">&nbsp;        DefaultTraversal&lt;Vertex, Long&gt; traversal = (DefaultTraversal&lt;Vertex, Long&gt;) this.sqlgGraph.traversal().V().hasLabel(&quot;A&quot;).outE().otherV().count();</b>
<b class="nc">&nbsp;        String sql = getSQL(traversal);</b>
<b class="nc">&nbsp;        if (isPostgres()) {</b>
<b class="nc">&nbsp;            Assert.assertEquals(&quot;\n&quot; +</b>
&nbsp;                    &quot;SELECT\n&quot; +
&nbsp;                    &quot;\tCOUNT(1) AS \&quot;count\&quot;\n&quot; +
&nbsp;                    &quot;FROM\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot; INNER JOIN\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;E_ab\&quot; ON \&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;name\&quot; = \&quot;public\&quot;.\&quot;E_ab\&quot;.\&quot;public.A.name__O\&quot; INNER JOIN\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_B\&quot; ON \&quot;public\&quot;.\&quot;E_ab\&quot;.\&quot;public.B.name__I\&quot; = \&quot;public\&quot;.\&quot;V_B\&quot;.\&quot;name\&quot;&quot;, sql);
&nbsp;        }
<b class="nc">&nbsp;        Assert.assertEquals(1, traversal.next(), 0);</b>
<b class="nc">&nbsp;        Assert.assertFalse(traversal.hasNext());</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testCountWithJoins() {
<b class="nc">&nbsp;        VertexLabel aVertexLabel = this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;A&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;name&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        VertexLabel bVertexLabel = this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;B&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;uid&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;uid&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        aVertexLabel.ensureEdgeLabelExist(&quot;ab&quot;, bVertexLabel, new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;            put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;        }}, ListOrderedSet.listOrderedSet(Set.of(&quot;name&quot;)));</b>
<b class="nc">&nbsp;        Vertex a1 = this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;name&quot;, &quot;a&quot;, &quot;age&quot;, 1);</b>
<b class="nc">&nbsp;        Vertex b1 = this.sqlgGraph.addVertex(T.label, &quot;B&quot;, &quot;name&quot;, &quot;b&quot;, &quot;age&quot;, 2, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        Vertex b2 = this.sqlgGraph.addVertex(T.label, &quot;B&quot;, &quot;name&quot;, &quot;b&quot;, &quot;age&quot;, 2, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        Vertex b3 = this.sqlgGraph.addVertex(T.label, &quot;B&quot;, &quot;name&quot;, &quot;b&quot;, &quot;age&quot;, 5, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        Vertex b4 = this.sqlgGraph.addVertex(T.label, &quot;B&quot;, &quot;name&quot;, &quot;b&quot;, &quot;age&quot;, 2, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;ab&quot;, b1, &quot;name&quot;, &quot;edge1&quot;);</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;ab&quot;, b2, &quot;name&quot;, &quot;edge2&quot;);</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;ab&quot;, b3, &quot;name&quot;, &quot;edge3&quot;);</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;ab&quot;, b4, &quot;name&quot;, &quot;edge4&quot;);</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        DefaultTraversal&lt;Vertex, Long&gt; traversal = (DefaultTraversal&lt;Vertex, Long&gt;) this.sqlgGraph.traversal().V().hasLabel(&quot;A&quot;).out(&quot;ab&quot;).count();</b>
<b class="nc">&nbsp;        String sql = getSQL(traversal);</b>
<b class="nc">&nbsp;        if (isPostgres()) {</b>
<b class="nc">&nbsp;            Assert.assertEquals(&quot;\n&quot; +</b>
&nbsp;                    &quot;SELECT\n&quot; +
&nbsp;                    &quot;\tCOUNT(1) AS \&quot;count\&quot;\n&quot; +
&nbsp;                    &quot;FROM\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot; INNER JOIN\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;E_ab\&quot; ON \&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;name\&quot; = \&quot;public\&quot;.\&quot;E_ab\&quot;.\&quot;public.A.name__O\&quot; INNER JOIN\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_B\&quot; ON \&quot;public\&quot;.\&quot;E_ab\&quot;.\&quot;public.B.uid__I\&quot; = \&quot;public\&quot;.\&quot;V_B\&quot;.\&quot;uid\&quot;&quot;, sql);
&nbsp;        }
<b class="nc">&nbsp;        Assert.assertEquals(4, traversal.next(), 0);</b>
<b class="nc">&nbsp;        Assert.assertFalse(traversal.hasNext());</b>
<b class="nc">&nbsp;        Traversal&lt;Vertex, Integer&gt; maxTraversal = this.sqlgGraph.traversal().V().outE().otherV().values(&quot;age&quot;).max();</b>
<b class="nc">&nbsp;        sql = getSQL(maxTraversal);</b>
<b class="nc">&nbsp;        if (isPostgres()) {</b>
<b class="nc">&nbsp;            Assert.assertEquals(&quot;\n&quot; +</b>
&nbsp;                    &quot;SELECT\n&quot; +
&nbsp;                    &quot;\tMAX(\&quot;public\&quot;.\&quot;V_B\&quot;.\&quot;age\&quot;) AS \&quot;alias1\&quot;\n&quot; +
&nbsp;                    &quot;FROM\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot; INNER JOIN\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;E_ab\&quot; ON \&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;name\&quot; = \&quot;public\&quot;.\&quot;E_ab\&quot;.\&quot;public.A.name__O\&quot; INNER JOIN\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_B\&quot; ON \&quot;public\&quot;.\&quot;E_ab\&quot;.\&quot;public.B.uid__I\&quot; = \&quot;public\&quot;.\&quot;V_B\&quot;.\&quot;uid\&quot;&quot;, sql);
&nbsp;        }
<b class="nc">&nbsp;        Assert.assertEquals(5, maxTraversal.next(), 0);</b>
<b class="nc">&nbsp;        Assert.assertFalse(maxTraversal.hasNext());</b>
<b class="nc">&nbsp;        traversal = (DefaultTraversal&lt;Vertex, Long&gt;) this.sqlgGraph.traversal().V().outE().otherV().count();</b>
<b class="nc">&nbsp;        sql = getSQL(traversal);</b>
<b class="nc">&nbsp;        if (isPostgres()) {</b>
<b class="nc">&nbsp;            Assert.assertEquals(&quot;\n&quot; +</b>
&nbsp;                    &quot;SELECT\n&quot; +
&nbsp;                    &quot;\tCOUNT(1) AS \&quot;count\&quot;\n&quot; +
&nbsp;                    &quot;FROM\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot; INNER JOIN\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;E_ab\&quot; ON \&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;name\&quot; = \&quot;public\&quot;.\&quot;E_ab\&quot;.\&quot;public.A.name__O\&quot; INNER JOIN\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_B\&quot; ON \&quot;public\&quot;.\&quot;E_ab\&quot;.\&quot;public.B.uid__I\&quot; = \&quot;public\&quot;.\&quot;V_B\&quot;.\&quot;uid\&quot;&quot;, sql);
&nbsp;        }
<b class="nc">&nbsp;        Assert.assertEquals(4, traversal.next(), 0);</b>
<b class="nc">&nbsp;        Assert.assertFalse(traversal.hasNext());</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testCountMultipleLabels() {
<b class="nc">&nbsp;        this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;A&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;prop&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;prop&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;B&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;name&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;prop&quot;, &quot;a1&quot;);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;prop&quot;, &quot;a2&quot;);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;prop&quot;, &quot;a3&quot;);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;prop&quot;, &quot;a4&quot;);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;B&quot;, &quot;name&quot;, &quot;b1&quot;);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;B&quot;, &quot;name&quot;, &quot;b2&quot;);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;B&quot;, &quot;name&quot;, &quot;b3&quot;);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;B&quot;, &quot;name&quot;, &quot;b4&quot;);</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        DefaultTraversal&lt;Vertex, Long&gt; traversal = (DefaultTraversal&lt;Vertex, Long&gt;) this.sqlgGraph.traversal().V().count();</b>
<b class="nc">&nbsp;        String sql = getSQL(traversal);</b>
<b class="nc">&nbsp;        if (isPostgres()) {</b>
<b class="nc">&nbsp;            Assert.assertEquals(&quot;\n&quot; +</b>
&nbsp;                    &quot;SELECT\n&quot; +
&nbsp;                    &quot;\tCOUNT(1) AS \&quot;count\&quot;\n&quot; +
&nbsp;                    &quot;FROM\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_B\&quot;&quot;, sql);
&nbsp;        }
<b class="nc">&nbsp;        Assert.assertEquals(8, traversal.next(), 0);</b>
<b class="nc">&nbsp;        Assert.assertEquals(3, traversal.getSteps().size());</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(0) instanceof SqlgGraphStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(1) instanceof SqlgPropertiesStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(2) instanceof SqlgCountGlobalStep);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testCountDuplicatePaths() {
<b class="nc">&nbsp;        VertexLabel aVertexLabel = this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;A&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;name&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        aVertexLabel.ensureEdgeLabelExist(&quot;aa&quot;, aVertexLabel, new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;            put(&quot;uid&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;        }}, ListOrderedSet.listOrderedSet(Set.of(&quot;uid&quot;)));</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        Vertex a1 = this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;name&quot;, &quot;a1&quot;);</b>
<b class="nc">&nbsp;        Vertex a2 = this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;name&quot;, &quot;a2&quot;);</b>
<b class="nc">&nbsp;        Vertex a3 = this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;name&quot;, &quot;a3&quot;);</b>
<b class="nc">&nbsp;        Vertex a4 = this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;name&quot;, &quot;a4&quot;);</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;aa&quot;, a2, &quot;uid&quot;, &quot;uid1&quot;);</b>
<b class="nc">&nbsp;        a2.addEdge(&quot;aa&quot;, a3, &quot;uid&quot;, &quot;uid2&quot;);</b>
<b class="nc">&nbsp;        a2.addEdge(&quot;aa&quot;, a4, &quot;uid&quot;, &quot;uid3&quot;);</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;
<b class="nc">&nbsp;        DefaultTraversal&lt;Vertex, Long&gt; traversal = (DefaultTraversal&lt;Vertex, Long&gt;) this.sqlgGraph.traversal().V(a1).out().out().count();</b>
<b class="nc">&nbsp;        String sql = getSQL(traversal);</b>
<b class="nc">&nbsp;        if (isPostgres()) {</b>
<b class="nc">&nbsp;            Assert.assertEquals(&quot;SELECT\n&quot; +</b>
&nbsp;                    &quot;\tCOUNT(1) \n&quot; +
&nbsp;                    &quot;FROM (\n&quot; +
&nbsp;                    &quot;SELECT\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;E_aa\&quot;.\&quot;public.A.name__I\&quot; AS \&quot;public.E_aa.public.A.name__I\&quot;\n&quot; +
&nbsp;                    &quot;FROM\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot; INNER JOIN\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;E_aa\&quot; ON \&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;name\&quot; = \&quot;public\&quot;.\&quot;E_aa\&quot;.\&quot;public.A.name__O\&quot;\n&quot; +
&nbsp;                    &quot;WHERE\n&quot; +
&nbsp;                    &quot;\t( \&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;name\&quot; = ?)\n&quot; +
&nbsp;                    &quot;) a1 INNER JOIN (\n&quot; +
&nbsp;                    &quot;SELECT\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;name\&quot; AS \&quot;alias1\&quot;,\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;E_aa\&quot;.\&quot;public.A.name__I\&quot; AS \&quot;public.E_aa.public.A.name__I\&quot;\n&quot; +
&nbsp;                    &quot;FROM\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot; INNER JOIN\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;E_aa\&quot; ON \&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;name\&quot; = \&quot;public\&quot;.\&quot;E_aa\&quot;.\&quot;public.A.name__O\&quot;\n&quot; +
&nbsp;                    &quot;) a2 ON a1.\&quot;public.E_aa.public.A.name__I\&quot; = a2.\&quot;alias1\&quot; INNER JOIN (\n&quot; +
&nbsp;                    &quot;SELECT\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;name\&quot; AS \&quot;alias2\&quot;\n&quot; +
&nbsp;                    &quot;FROM\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot;\n&quot; +
&nbsp;                    &quot;) a3 ON a2.\&quot;public.E_aa.public.A.name__I\&quot; = a3.\&quot;alias2\&quot;&quot;, sql);
&nbsp;        }
<b class="nc">&nbsp;        Assert.assertEquals(2, traversal.next(), 0);</b>
&nbsp;
<b class="nc">&nbsp;        Assert.assertEquals(3, traversal.getSteps().size());</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(0) instanceof SqlgGraphStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(1) instanceof SqlgPropertiesStep);</b>
<b class="nc">&nbsp;        Assert.assertTrue(traversal.getSteps().get(2) instanceof SqlgCountGlobalStep);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testCountOnPropertyNotYetExists() {
<b class="nc">&nbsp;        this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;A&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;prop&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;prop&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;prop&quot;, &quot;what&quot;);</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        DefaultTraversal&lt;Vertex, Long&gt; traversal = (DefaultTraversal&lt;Vertex, Long&gt;) this.sqlgGraph.traversal().V().has(T.label, &quot;Person&quot;).has(&quot;name&quot;, &quot;john&quot;).count();</b>
<b class="nc">&nbsp;        List&lt;Long&gt; count = traversal.toList();</b>
<b class="nc">&nbsp;        Assert.assertEquals(1, count.size());</b>
<b class="nc">&nbsp;        Assert.assertEquals(0L, count.get(0), 0);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testMaxDuplicatePaths() {
<b class="nc">&nbsp;        VertexLabel aVertexLabel = this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(</b>
&nbsp;                &quot;A&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;age&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;name&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        aVertexLabel.ensureEdgeLabelExist(&quot;aa&quot;, aVertexLabel, new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;            put(&quot;uid&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;        }}, ListOrderedSet.listOrderedSet(Set.of(&quot;uid&quot;)));</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;
<b class="nc">&nbsp;        Vertex a1 = this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;name&quot;, &quot;a1&quot;, &quot;age&quot;, 1);</b>
<b class="nc">&nbsp;        Vertex a2 = this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;name&quot;, &quot;a2&quot;, &quot;age&quot;, 2);</b>
<b class="nc">&nbsp;        Vertex a3 = this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;name&quot;, &quot;a3&quot;, &quot;age&quot;, 3);</b>
<b class="nc">&nbsp;        Vertex a4 = this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;name&quot;, &quot;a4&quot;, &quot;age&quot;, 4);</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;aa&quot;, a2, &quot;uid&quot;, &quot;uid1&quot;);</b>
<b class="nc">&nbsp;        a2.addEdge(&quot;aa&quot;, a3, &quot;uid&quot;, &quot;uid2&quot;);</b>
<b class="nc">&nbsp;        a2.addEdge(&quot;aa&quot;, a4, &quot;uid&quot;, &quot;uid3&quot;);</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;
<b class="nc">&nbsp;        Traversal&lt;Vertex, Integer&gt; traversal = this.sqlgGraph.traversal().V(a1).out().out().values(&quot;age&quot;).max();</b>
<b class="nc">&nbsp;        String sql = getSQL(traversal);</b>
<b class="nc">&nbsp;        if (isPostgres()) {</b>
<b class="nc">&nbsp;            Assert.assertEquals(&quot;SELECT\n&quot; +</b>
&nbsp;                    &quot;\tMAX(a3.\&quot;alias3\&quot;) \n&quot; +
&nbsp;                    &quot;FROM (\n&quot; +
&nbsp;                    &quot;SELECT\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;E_aa\&quot;.\&quot;public.A.name__I\&quot; AS \&quot;public.E_aa.public.A.name__I\&quot;\n&quot; +
&nbsp;                    &quot;FROM\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot; INNER JOIN\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;E_aa\&quot; ON \&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;name\&quot; = \&quot;public\&quot;.\&quot;E_aa\&quot;.\&quot;public.A.name__O\&quot;\n&quot; +
&nbsp;                    &quot;WHERE\n&quot; +
&nbsp;                    &quot;\t( \&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;name\&quot; = ?)\n&quot; +
&nbsp;                    &quot;) a1 INNER JOIN (\n&quot; +
&nbsp;                    &quot;SELECT\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;name\&quot; AS \&quot;alias1\&quot;,\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;E_aa\&quot;.\&quot;public.A.name__I\&quot; AS \&quot;public.E_aa.public.A.name__I\&quot;\n&quot; +
&nbsp;                    &quot;FROM\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot; INNER JOIN\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;E_aa\&quot; ON \&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;name\&quot; = \&quot;public\&quot;.\&quot;E_aa\&quot;.\&quot;public.A.name__O\&quot;\n&quot; +
&nbsp;                    &quot;) a2 ON a1.\&quot;public.E_aa.public.A.name__I\&quot; = a2.\&quot;alias1\&quot; INNER JOIN (\n&quot; +
&nbsp;                    &quot;SELECT\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;name\&quot; AS \&quot;alias2\&quot;,\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot;.\&quot;age\&quot; AS \&quot;alias3\&quot;\n&quot; +
&nbsp;                    &quot;FROM\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_A\&quot;\n&quot; +
&nbsp;                    &quot;) a3 ON a2.\&quot;public.E_aa.public.A.name__I\&quot; = a3.\&quot;alias2\&quot;&quot;, sql);
&nbsp;        }
<b class="nc">&nbsp;        Assert.assertEquals(4, traversal.next(), 0);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testUserSuppliedPKCount() {
<b class="nc">&nbsp;        this.sqlgGraph.getTopology().getPublicSchema()</b>
<b class="nc">&nbsp;                .ensureVertexLabelExist(</b>
&nbsp;                        &quot;Person&quot;,
<b class="nc">&nbsp;                        new HashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                            put(&quot;uid&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                            put(&quot;name&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
&nbsp;                        }},
<b class="nc">&nbsp;                        ListOrderedSet.listOrderedSet(Collections.singletonList(&quot;uid&quot;))</b>
&nbsp;                );
<b class="nc">&nbsp;        Vertex marko = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;uid&quot;, UUID.randomUUID().toString(), &quot;name&quot;, &quot;marko&quot;);</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        Vertex john = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;uid&quot;, UUID.randomUUID().toString());</b>
<b class="nc">&nbsp;        john.property(&quot;name&quot;, &quot;john&quot;);</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        Traversal&lt;Vertex, Long&gt; traversal = this.sqlgGraph.traversal().V().hasLabel(&quot;Person&quot;).count();</b>
<b class="nc">&nbsp;        String sql = getSQL(traversal);</b>
<b class="nc">&nbsp;        if (isPostgres()) {</b>
<b class="nc">&nbsp;            Assert.assertEquals(&quot;\n&quot; +</b>
&nbsp;                    &quot;SELECT\n&quot; +
&nbsp;                    &quot;\tCOUNT(1) AS \&quot;count\&quot;\n&quot; +
&nbsp;                    &quot;FROM\n&quot; +
&nbsp;                    &quot;\t\&quot;public\&quot;.\&quot;V_Person\&quot;&quot;, sql);
&nbsp;        }
<b class="nc">&nbsp;        Assert.assertEquals(2, traversal.next().intValue());</b>
<b class="nc">&nbsp;        Assert.assertEquals(&quot;marko&quot;, this.sqlgGraph.traversal().V(marko).next().value(&quot;name&quot;));</b>
<b class="nc">&nbsp;        Assert.assertEquals(&quot;john&quot;, this.sqlgGraph.traversal().V(john).next().value(&quot;name&quot;));</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * This test BaseStrategy skipping optimizing count which comes after a SqlgPropertiesStep
&nbsp;     */
&nbsp;    @Test
&nbsp;    public void testAndColumns() {
<b class="nc">&nbsp;        this.sqlgGraph.getTopology().getPublicSchema()</b>
<b class="nc">&nbsp;                .ensureVertexLabelExist(</b>
&nbsp;                        &quot;Person&quot;,
<b class="nc">&nbsp;                        new HashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                            put(&quot;name1&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                            put(&quot;name2&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
&nbsp;                        }},
<b class="nc">&nbsp;                        ListOrderedSet.listOrderedSet(Collections.singletonList(&quot;name1&quot;))</b>
&nbsp;                );
<b class="nc">&nbsp;        Vertex v1 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name1&quot;, &quot;marko&quot;);</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        Assert.assertEquals(1, vertexTraversal(this.sqlgGraph, v1).properties().count().next(), 0);</b>
<b class="nc">&nbsp;        Vertex v2 = this.sqlgGraph.addVertex(T.label, &quot;Person&quot;, &quot;name2&quot;, &quot;john&quot;, &quot;name1&quot;, &quot;Jones&quot;);</b>
<b class="nc">&nbsp;        Assert.assertEquals(2, this.sqlgGraph.traversal().V().count().next(), 0);</b>
<b class="nc">&nbsp;        Assert.assertEquals(v2, this.sqlgGraph.traversal().V(v2.id()).next());</b>
<b class="nc">&nbsp;        Assert.assertEquals(2, vertexTraversal(this.sqlgGraph, v2).properties().count().next(), 0);</b>
&nbsp;    }
&nbsp;
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2025-06-23 10:13</div>
</div>
</body>
</html>
