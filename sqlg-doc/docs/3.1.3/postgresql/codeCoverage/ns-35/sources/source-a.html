


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > TestSubSubPartition</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">org.umlg.sqlg.test.topology</a>
</div>

<h1>Coverage Summary for Class: TestSubSubPartition (org.umlg.sqlg.test.topology)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">TestSubSubPartition</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (11/11)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    83.3%
  </span>
  <span class="absValue">
    (5/6)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    99.1%
  </span>
  <span class="absValue">
    (344/347)
  </span>
</td>
</tr>
  <tr>
    <td class="name">TestSubSubPartition$1</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (5/5)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestSubSubPartition$2</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (5/5)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestSubSubPartition$3</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (5/5)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestSubSubPartition$4</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (5/5)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (15/15)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    83.3%
  </span>
  <span class="absValue">
    (5/6)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    99.2%
  </span>
  <span class="absValue">
    (364/367)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package org.umlg.sqlg.test.topology;
&nbsp;
&nbsp;import org.apache.commons.collections4.set.ListOrderedSet;
&nbsp;import org.apache.commons.configuration2.builder.fluent.Configurations;
&nbsp;import org.apache.commons.configuration2.ex.ConfigurationException;
&nbsp;import org.apache.tinkerpop.gremlin.structure.Edge;
&nbsp;import org.apache.tinkerpop.gremlin.structure.T;
&nbsp;import org.apache.tinkerpop.gremlin.structure.Vertex;
&nbsp;import org.junit.*;
&nbsp;import org.umlg.sqlg.structure.PropertyDefinition;
&nbsp;import org.umlg.sqlg.structure.PropertyType;
&nbsp;import org.umlg.sqlg.structure.SqlgGraph;
&nbsp;import org.umlg.sqlg.structure.topology.*;
&nbsp;import org.umlg.sqlg.test.BaseTest;
&nbsp;
&nbsp;import java.net.URL;
&nbsp;import java.util.*;
&nbsp;
&nbsp;/**
&nbsp; * @author &lt;a href=&quot;https://github.com/pietermartin&quot;&gt;Pieter Martin&lt;/a&gt;
&nbsp; * Date: 2018/01/26
&nbsp; */
<b class="fc">&nbsp;public class TestSubSubPartition extends BaseTest {</b>
&nbsp;
&nbsp;    @SuppressWarnings(&quot;Duplicates&quot;)
&nbsp;    @BeforeClass
&nbsp;    public static void beforeClass() {
<b class="fc">&nbsp;        URL sqlProperties = Thread.currentThread().getContextClassLoader().getResource(&quot;sqlg.properties&quot;);</b>
&nbsp;        try {
<b class="fc">&nbsp;            Configurations configs = new Configurations();</b>
<b class="fc">&nbsp;            configuration = configs.properties(sqlProperties);</b>
<b class="fc">&nbsp;            Assume.assumeTrue(isPostgres());</b>
<b class="fc">&nbsp;            configuration.addProperty(&quot;distributed&quot;, true);</b>
<b class="fc">&nbsp;            configuration.addProperty(&quot;validate.topology&quot;, true);</b>
<b class="pc">&nbsp;            if (!configuration.containsKey(&quot;jdbc.url&quot;))</b>
<b class="nc">&nbsp;                throw new IllegalArgumentException(String.format(&quot;SqlGraph configuration requires that the %s be set&quot;, &quot;jdbc.url&quot;));</b>
&nbsp;
&nbsp;        } catch (ConfigurationException e) {
<b class="nc">&nbsp;            throw new RuntimeException(e);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Before
&nbsp;    public void before() throws Exception {
<b class="fc">&nbsp;        super.before();</b>
<b class="fc">&nbsp;        Assume.assumeTrue(this.sqlgGraph.getSqlDialect().supportsPartitioning());</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testVertexSubSubPartitionRange() throws Exception {
<b class="fc">&nbsp;        Schema publicSchema = this.sqlgGraph.getTopology().getPublicSchema();</b>
<b class="fc">&nbsp;        VertexLabel a = publicSchema.ensurePartitionedVertexLabelExist(</b>
&nbsp;                &quot;A&quot;,
<b class="fc">&nbsp;                new HashMap&lt;&gt;() {{</b>
<b class="fc">&nbsp;                    put(&quot;uid&quot;, PropertyDefinition.of(PropertyType.STRING));</b>
<b class="fc">&nbsp;                    put(&quot;int1&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
<b class="fc">&nbsp;                    put(&quot;int2&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
<b class="fc">&nbsp;                    put(&quot;int3&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                }},
<b class="fc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;uid&quot;, &quot;int1&quot;, &quot;int2&quot;, &quot;int3&quot;)),</b>
&nbsp;                PartitionType.RANGE,
&nbsp;                &quot;int1&quot;);
<b class="fc">&nbsp;        Partition p1 = a.ensureRangePartitionWithSubPartitionExists(&quot;int1&quot;, &quot;1&quot;, &quot;5&quot;, PartitionType.RANGE, &quot;int2&quot;);</b>
<b class="fc">&nbsp;        Partition p2 = a.ensureRangePartitionWithSubPartitionExists(&quot;int2&quot;, &quot;5&quot;, &quot;10&quot;, PartitionType.RANGE, &quot;int2&quot;);</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        Thread.sleep(1000);</b>
&nbsp;
<b class="fc">&nbsp;        Partition p1_1 = p1.ensureRangePartitionWithSubPartitionExists(&quot;int11&quot;, &quot;1&quot;, &quot;5&quot;, PartitionType.RANGE, &quot;int3&quot;);</b>
<b class="fc">&nbsp;        Partition p1_2 = p1.ensureRangePartitionWithSubPartitionExists(&quot;int12&quot;, &quot;5&quot;, &quot;10&quot;, PartitionType.RANGE, &quot;int3&quot;);</b>
<b class="fc">&nbsp;        Partition p2_1 = p2.ensureRangePartitionWithSubPartitionExists(&quot;int21&quot;, &quot;1&quot;, &quot;5&quot;, PartitionType.RANGE, &quot;int3&quot;);</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        Thread.sleep(1000);</b>
<b class="fc">&nbsp;        Partition p2_2 = p2.ensureRangePartitionWithSubPartitionExists(&quot;int22&quot;, &quot;5&quot;, &quot;10&quot;, PartitionType.RANGE, &quot;int3&quot;);</b>
&nbsp;
<b class="fc">&nbsp;        p1_1.ensureRangePartitionExists(&quot;int111&quot;, &quot;1&quot;, &quot;5&quot;);</b>
<b class="fc">&nbsp;        p1_1.ensureRangePartitionExists(&quot;int112&quot;, &quot;5&quot;, &quot;10&quot;);</b>
<b class="fc">&nbsp;        p1_2.ensureRangePartitionExists(&quot;int121&quot;, &quot;1&quot;, &quot;5&quot;);</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        Thread.sleep(1000);</b>
<b class="fc">&nbsp;        p1_2.ensureRangePartitionExists(&quot;int122&quot;, &quot;5&quot;, &quot;10&quot;);</b>
<b class="fc">&nbsp;        p2_1.ensureRangePartitionExists(&quot;int211&quot;, &quot;1&quot;, &quot;5&quot;);</b>
<b class="fc">&nbsp;        p2_1.ensureRangePartitionExists(&quot;int212&quot;, &quot;5&quot;, &quot;10&quot;);</b>
<b class="fc">&nbsp;        p2_2.ensureRangePartitionExists(&quot;int221&quot;, &quot;1&quot;, &quot;5&quot;);</b>
<b class="fc">&nbsp;        p2_2.ensureRangePartitionExists(&quot;int222&quot;, &quot;5&quot;, &quot;10&quot;);</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        Thread.sleep(2000);</b>
&nbsp;
<b class="fc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;uid&quot;, UUID.randomUUID().toString(), &quot;int1&quot;, 1, &quot;int2&quot;, 1, &quot;int3&quot;, 1);</b>
<b class="fc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;uid&quot;, UUID.randomUUID().toString(), &quot;int1&quot;, 5, &quot;int2&quot;, 5, &quot;int3&quot;, 5);</b>
&nbsp;
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;
<b class="fc">&nbsp;        List&lt;Vertex&gt; vertices = this.sqlgGraph.traversal().V().hasLabel(&quot;A&quot;).has(&quot;int1&quot;, 1).has(&quot;int2&quot;, 1).has(&quot;int3&quot;, 1).toList();</b>
<b class="fc">&nbsp;        Assert.assertEquals(1, vertices.size());</b>
<b class="fc">&nbsp;        vertices = this.sqlgGraph.traversal().V().hasLabel(&quot;A&quot;).has(&quot;int1&quot;, 5).has(&quot;int2&quot;, 5).has(&quot;int3&quot;, 5).toList();</b>
<b class="fc">&nbsp;        Assert.assertEquals(1, vertices.size());</b>
&nbsp;
<b class="fc">&nbsp;        assert_vertexLabelSubSubPartition(this.sqlgGraph);</b>
<b class="fc">&nbsp;        try (SqlgGraph sqlgGraph1 = SqlgGraph.open(configuration)) {</b>
<b class="fc">&nbsp;            assert_vertexLabelSubSubPartition(sqlgGraph1);</b>
&nbsp;        } catch (Exception e) {
<b class="nc">&nbsp;            Assert.fail(e.getMessage());</b>
&nbsp;        }
<b class="fc">&nbsp;        assert_vertexLabelSubSubPartition(this.sqlgGraph1);</b>
&nbsp;
&nbsp;        //Delete the topology
<b class="fc">&nbsp;        dropSqlgSchema(this.sqlgGraph);</b>
&nbsp;
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        this.sqlgGraph.close();</b>
&nbsp;
<b class="fc">&nbsp;        try (SqlgGraph sqlgGraph1 = SqlgGraph.open(configuration)) {</b>
<b class="fc">&nbsp;            assert_vertexLabelSubSubPartition(sqlgGraph1);</b>
<b class="fc">&nbsp;            a = sqlgGraph1.getTopology().getPublicSchema().getVertexLabel(&quot;A&quot;).orElseThrow();</b>
<b class="fc">&nbsp;            p2 = a.getPartition(&quot;int2&quot;).orElseThrow();</b>
<b class="fc">&nbsp;            p2.remove();</b>
<b class="fc">&nbsp;            Assert.assertEquals(1, a.getPartitions().size());</b>
<b class="fc">&nbsp;            Assert.assertEquals(7, sqlgGraph1.topology().V().hasLabel(&quot;sqlg_schema.partition&quot;).count().next(), 0);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void assert_vertexLabelSubSubPartition(SqlgGraph sqlgGraph1) {
<b class="fc">&nbsp;        List&lt;Vertex&gt; vertices;VertexLabel vertexLabel = sqlgGraph1.getTopology().getPublicSchema().getVertexLabel(&quot;A&quot;).orElseThrow();</b>
<b class="fc">&nbsp;        Map&lt;String, Partition&gt; partitions = vertexLabel.getPartitions();</b>
<b class="fc">&nbsp;        Assert.assertEquals(2, partitions.size());</b>
<b class="fc">&nbsp;        Assert.assertTrue(partitions.containsKey(&quot;int1&quot;));</b>
<b class="fc">&nbsp;        Partition pint1 = partitions.get(&quot;int1&quot;);</b>
<b class="fc">&nbsp;        Assert.assertTrue(pint1.getPartitionType().isRange());</b>
<b class="fc">&nbsp;        Assert.assertEquals(&quot;int2&quot;, pint1.getPartitionExpression());</b>
&nbsp;
<b class="fc">&nbsp;        Assert.assertEquals(2, pint1.getPartitions().size());</b>
<b class="fc">&nbsp;        Assert.assertTrue(pint1.getPartitions().containsKey(&quot;int11&quot;));</b>
<b class="fc">&nbsp;        Partition pint11 = pint1.getPartitions().get(&quot;int11&quot;);</b>
<b class="fc">&nbsp;        Assert.assertTrue(pint11.getPartitionType().isRange());</b>
<b class="fc">&nbsp;        Assert.assertEquals(&quot;int3&quot;, pint11.getPartitionExpression());</b>
&nbsp;
<b class="fc">&nbsp;        Assert.assertEquals(2, pint11.getPartitions().size());</b>
<b class="fc">&nbsp;        Assert.assertTrue(pint11.getPartitions().containsKey(&quot;int111&quot;));</b>
<b class="fc">&nbsp;        Partition pint111 = pint11.getPartitions().get(&quot;int111&quot;);</b>
<b class="fc">&nbsp;        Assert.assertTrue(pint111.getPartitionType().isNone());</b>
<b class="fc">&nbsp;        Assert.assertNull(pint111.getPartitionExpression());</b>
&nbsp;
<b class="fc">&nbsp;        Assert.assertEquals(0, pint111.getPartitions().size());</b>
<b class="fc">&nbsp;        Assert.assertTrue(pint11.getPartitions().containsKey(&quot;int112&quot;));</b>
<b class="fc">&nbsp;        Partition pint112 = pint11.getPartitions().get(&quot;int112&quot;);</b>
<b class="fc">&nbsp;        Assert.assertEquals(0, pint112.getPartitions().size());</b>
&nbsp;
<b class="fc">&nbsp;        Assert.assertTrue(pint1.getPartitions().containsKey(&quot;int12&quot;));</b>
<b class="fc">&nbsp;        Partition pint12 = pint1.getPartitions().get(&quot;int12&quot;);</b>
<b class="fc">&nbsp;        Assert.assertEquals(2, pint12.getPartitions().size());</b>
<b class="fc">&nbsp;        Assert.assertTrue(pint12.getPartitions().containsKey(&quot;int121&quot;));</b>
<b class="fc">&nbsp;        Partition pint121 = pint12.getPartitions().get(&quot;int121&quot;);</b>
<b class="fc">&nbsp;        Assert.assertEquals(0, pint121.getPartitions().size());</b>
<b class="fc">&nbsp;        Assert.assertTrue(pint12.getPartitions().containsKey(&quot;int122&quot;));</b>
<b class="fc">&nbsp;        Partition pint122 = pint12.getPartitions().get(&quot;int122&quot;);</b>
<b class="fc">&nbsp;        Assert.assertEquals(0, pint122.getPartitions().size());</b>
&nbsp;
<b class="fc">&nbsp;        Assert.assertTrue(partitions.containsKey(&quot;int2&quot;));</b>
<b class="fc">&nbsp;        Partition pint2 = partitions.get(&quot;int2&quot;);</b>
<b class="fc">&nbsp;        Assert.assertTrue(pint2.getPartitionType().isRange());</b>
<b class="fc">&nbsp;        Assert.assertEquals(&quot;int2&quot;, pint2.getPartitionExpression());</b>
<b class="fc">&nbsp;        Assert.assertEquals(2, pint2.getPartitions().size());</b>
<b class="fc">&nbsp;        Assert.assertTrue(pint2.getPartitions().containsKey(&quot;int21&quot;));</b>
<b class="fc">&nbsp;        Partition pint21 = pint2.getPartitions().get(&quot;int21&quot;);</b>
<b class="fc">&nbsp;        Assert.assertTrue(pint21.getPartitionType().isRange());</b>
<b class="fc">&nbsp;        Assert.assertEquals(&quot;int3&quot;, pint21.getPartitionExpression());</b>
<b class="fc">&nbsp;        Assert.assertEquals(2, pint21.getPartitions().size());</b>
<b class="fc">&nbsp;        Assert.assertTrue(pint21.getPartitions().containsKey(&quot;int211&quot;));</b>
<b class="fc">&nbsp;        Partition pint211 = pint21.getPartitions().get(&quot;int211&quot;);</b>
<b class="fc">&nbsp;        Assert.assertEquals(0, pint211.getPartitions().size());</b>
<b class="fc">&nbsp;        Assert.assertTrue(pint21.getPartitions().containsKey(&quot;int212&quot;));</b>
<b class="fc">&nbsp;        Partition pint212 = pint21.getPartitions().get(&quot;int212&quot;);</b>
<b class="fc">&nbsp;        Assert.assertTrue(pint212.getPartitionType().isNone());</b>
<b class="fc">&nbsp;        Assert.assertNull(pint212.getPartitionExpression());</b>
<b class="fc">&nbsp;        Assert.assertEquals(0, pint212.getPartitions().size());</b>
&nbsp;
<b class="fc">&nbsp;        Assert.assertTrue(pint2.getPartitions().containsKey(&quot;int22&quot;));</b>
<b class="fc">&nbsp;        Partition pint22 = pint2.getPartitions().get(&quot;int22&quot;);</b>
<b class="fc">&nbsp;        Assert.assertEquals(2, pint22.getPartitions().size());</b>
<b class="fc">&nbsp;        Assert.assertTrue(pint22.getPartitions().containsKey(&quot;int221&quot;));</b>
<b class="fc">&nbsp;        Partition pint221 = pint22.getPartitions().get(&quot;int221&quot;);</b>
<b class="fc">&nbsp;        Assert.assertEquals(0, pint221.getPartitions().size());</b>
<b class="fc">&nbsp;        Assert.assertTrue(pint22.getPartitions().containsKey(&quot;int222&quot;));</b>
<b class="fc">&nbsp;        Partition pint222 = pint22.getPartitions().get(&quot;int222&quot;);</b>
<b class="fc">&nbsp;        Assert.assertEquals(0, pint222.getPartitions().size());</b>
&nbsp;
<b class="fc">&nbsp;        Assert.assertEquals(14, sqlgGraph1.topology().V().hasLabel(&quot;sqlg_schema.partition&quot;).count().next(), 0);</b>
&nbsp;
<b class="fc">&nbsp;        vertices = sqlgGraph1.traversal().V().hasLabel(&quot;A&quot;).has(&quot;int1&quot;, 1).has(&quot;int2&quot;, 1).has(&quot;int3&quot;, 1).toList();</b>
<b class="fc">&nbsp;        Assert.assertEquals(1, vertices.size());</b>
<b class="fc">&nbsp;        vertices = sqlgGraph1.traversal().V().hasLabel(&quot;A&quot;).has(&quot;int1&quot;, 5).has(&quot;int2&quot;, 5).has(&quot;int3&quot;, 5).toList();</b>
<b class="fc">&nbsp;        Assert.assertEquals(1, vertices.size());</b>
<b class="fc">&nbsp;        sqlgGraph1.tx().rollback();</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testEdgeSubSubPartitionRange() throws Exception {
<b class="fc">&nbsp;        Schema publicSchema = this.sqlgGraph.getTopology().getPublicSchema();</b>
<b class="fc">&nbsp;        VertexLabel a = publicSchema.ensureVertexLabelExist(&quot;A&quot;);</b>
<b class="fc">&nbsp;        VertexLabel b = publicSchema.ensureVertexLabelExist(&quot;B&quot;);</b>
<b class="fc">&nbsp;        EdgeLabel ab = a.ensurePartitionedEdgeLabelExist(</b>
&nbsp;                &quot;ab&quot;,
&nbsp;                b,
<b class="fc">&nbsp;                new HashMap&lt;&gt;() {{</b>
<b class="fc">&nbsp;                    put(&quot;uid&quot;, PropertyDefinition.of(PropertyType.STRING));</b>
<b class="fc">&nbsp;                    put(&quot;int1&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
<b class="fc">&nbsp;                    put(&quot;int2&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
<b class="fc">&nbsp;                    put(&quot;int3&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                }},
<b class="fc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;uid&quot;, &quot;int1&quot;, &quot;int2&quot;, &quot;int3&quot;)),</b>
&nbsp;                PartitionType.RANGE,
&nbsp;                &quot;int1&quot;);
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        Thread.sleep(2000);</b>
&nbsp;
<b class="fc">&nbsp;        Partition p1 = ab.ensureRangePartitionWithSubPartitionExists(&quot;int1&quot;, &quot;1&quot;, &quot;5&quot;, PartitionType.RANGE, &quot;int2&quot;);</b>
<b class="fc">&nbsp;        Partition p2 = ab.ensureRangePartitionWithSubPartitionExists(&quot;int2&quot;, &quot;5&quot;, &quot;10&quot;, PartitionType.RANGE, &quot;int2&quot;);</b>
&nbsp;
<b class="fc">&nbsp;        Partition p11 = p1.ensureRangePartitionWithSubPartitionExists(&quot;int11&quot;, &quot;1&quot;, &quot;5&quot;, PartitionType.RANGE, &quot;int3&quot;);</b>
<b class="fc">&nbsp;        Partition p12 = p1.ensureRangePartitionWithSubPartitionExists(&quot;int12&quot;, &quot;5&quot;, &quot;10&quot;, PartitionType.RANGE, &quot;int3&quot;);</b>
<b class="fc">&nbsp;        Partition p21 = p2.ensureRangePartitionWithSubPartitionExists(&quot;int21&quot;, &quot;1&quot;, &quot;5&quot;, PartitionType.RANGE, &quot;int3&quot;);</b>
<b class="fc">&nbsp;        Partition p22 = p2.ensureRangePartitionWithSubPartitionExists(&quot;int22&quot;, &quot;5&quot;, &quot;10&quot;, PartitionType.RANGE, &quot;int3&quot;);</b>
&nbsp;
<b class="fc">&nbsp;        p11.ensureRangePartitionExists(&quot;int111&quot;, &quot;1&quot;, &quot;5&quot;);</b>
<b class="fc">&nbsp;        p11.ensureRangePartitionExists(&quot;int112&quot;, &quot;5&quot;, &quot;10&quot;);</b>
<b class="fc">&nbsp;        p12.ensureRangePartitionExists(&quot;int121&quot;, &quot;1&quot;, &quot;5&quot;);</b>
<b class="fc">&nbsp;        p12.ensureRangePartitionExists(&quot;int122&quot;, &quot;5&quot;, &quot;10&quot;);</b>
<b class="fc">&nbsp;        p21.ensureRangePartitionExists(&quot;int221&quot;, &quot;1&quot;, &quot;5&quot;);</b>
<b class="fc">&nbsp;        p22.ensureRangePartitionExists(&quot;int222&quot;, &quot;5&quot;, &quot;10&quot;);</b>
&nbsp;
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        Thread.sleep(2000);</b>
&nbsp;
<b class="fc">&nbsp;        for (int i = 1; i &lt; 10; i++) {</b>
<b class="fc">&nbsp;            Vertex a1 = this.sqlgGraph.addVertex(T.label, &quot;A&quot;);</b>
<b class="fc">&nbsp;            Vertex b1 = this.sqlgGraph.addVertex(T.label, &quot;B&quot;);</b>
<b class="fc">&nbsp;            a1.addEdge(&quot;ab&quot;, b1, &quot;uid&quot;, UUID.randomUUID().toString(), &quot;int1&quot;, i, &quot;int2&quot;, i, &quot;int3&quot;, i);</b>
&nbsp;        }
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        assert_edgePartitions(this.sqlgGraph);</b>
<b class="fc">&nbsp;        assert_edgePartitions(this.sqlgGraph1);</b>
&nbsp;
<b class="fc">&nbsp;        Assert.assertEquals(12, this.sqlgGraph.topology().V().hasLabel(&quot;sqlg_schema.partition&quot;).count().next(), 0);</b>
<b class="fc">&nbsp;        EdgeLabel edgeLabel1 = this.sqlgGraph.getTopology().getPublicSchema().getEdgeLabel(&quot;ab&quot;).orElseThrow();</b>
<b class="fc">&nbsp;        Optional&lt;Partition&gt; optionalPartition = edgeLabel1.getPartition(&quot;int1&quot;);</b>
<b class="fc">&nbsp;        Assert.assertTrue(optionalPartition.isPresent());</b>
<b class="fc">&nbsp;        Partition p = optionalPartition.get();</b>
<b class="fc">&nbsp;        optionalPartition = p.getPartition(&quot;int11&quot;);</b>
<b class="fc">&nbsp;        Assert.assertTrue(optionalPartition.isPresent());</b>
<b class="fc">&nbsp;        optionalPartition = edgeLabel1.getPartition(&quot;int2&quot;);</b>
<b class="fc">&nbsp;        Assert.assertTrue(optionalPartition.isPresent());</b>
<b class="fc">&nbsp;        p = optionalPartition.get();</b>
<b class="fc">&nbsp;        optionalPartition = p.getPartition(&quot;int22&quot;);</b>
<b class="fc">&nbsp;        Assert.assertTrue(optionalPartition.isPresent());</b>
&nbsp;
<b class="fc">&nbsp;        List&lt;Vertex&gt; vertices = this.sqlgGraph.traversal().V().toList();</b>
<b class="fc">&nbsp;        Assert.assertEquals(18, vertices.size());</b>
<b class="fc">&nbsp;        List&lt;Edge&gt; edges = this.sqlgGraph.traversal().E().toList();</b>
<b class="fc">&nbsp;        Assert.assertEquals(9, edges.size());</b>
<b class="fc">&nbsp;        vertices = this.sqlgGraph.traversal()</b>
<b class="fc">&nbsp;                .V().hasLabel(&quot;A&quot;)</b>
<b class="fc">&nbsp;                .outE(&quot;ab&quot;)</b>
<b class="fc">&nbsp;                .has(&quot;int1&quot;, 1)</b>
<b class="fc">&nbsp;                .has(&quot;int2&quot;, 1)</b>
<b class="fc">&nbsp;                .has(&quot;int3&quot;, 1)</b>
<b class="fc">&nbsp;                .otherV()</b>
<b class="fc">&nbsp;                .toList();</b>
<b class="fc">&nbsp;        Assert.assertEquals(1, vertices.size());</b>
&nbsp;
<b class="fc">&nbsp;        assert_edgePartitions(this.sqlgGraph1);</b>
&nbsp;
<b class="fc">&nbsp;        try (SqlgGraph sqlgGraph1 = SqlgGraph.open(configuration)) {</b>
<b class="fc">&nbsp;            assert_edgePartitions(sqlgGraph1);</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        p22.remove();</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        Thread.sleep(2000);</b>
&nbsp;
<b class="fc">&nbsp;        assert_edgePartitionsAfterRemove(this.sqlgGraph);</b>
<b class="fc">&nbsp;        assert_edgePartitionsAfterRemove(this.sqlgGraph1);</b>
&nbsp;
<b class="fc">&nbsp;        p1.remove();</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        Thread.sleep(2000);</b>
<b class="fc">&nbsp;        assert_edgePartitionsAfterRemove2(this.sqlgGraph);</b>
<b class="fc">&nbsp;        assert_edgePartitionsAfterRemove2(this.sqlgGraph1);</b>
&nbsp;
&nbsp;    }
&nbsp;
&nbsp;    private void assert_edgePartitionsAfterRemove(SqlgGraph sqlgGraph1) {
<b class="fc">&nbsp;        EdgeLabel edgeLabel1 = sqlgGraph1.getTopology().getPublicSchema().getEdgeLabel(&quot;ab&quot;).orElseThrow();</b>
<b class="fc">&nbsp;        Optional&lt;Partition&gt; optionalPartition = edgeLabel1.getPartition(&quot;int2&quot;);</b>
<b class="fc">&nbsp;        Assert.assertTrue(optionalPartition.isPresent());</b>
<b class="fc">&nbsp;        Partition p = optionalPartition.get();</b>
<b class="fc">&nbsp;        optionalPartition = p.getPartition(&quot;int22&quot;);</b>
<b class="fc">&nbsp;        Assert.assertFalse(optionalPartition.isPresent());</b>
<b class="fc">&nbsp;        Assert.assertEquals(10, sqlgGraph1.topology().V().hasLabel(&quot;sqlg_schema.partition&quot;).count().next(), 0);</b>
&nbsp;    }
&nbsp;
&nbsp;    private void assert_edgePartitionsAfterRemove2(SqlgGraph sqlgGraph1) {
<b class="fc">&nbsp;        EdgeLabel edgeLabel1 = sqlgGraph1.getTopology().getPublicSchema().getEdgeLabel(&quot;ab&quot;).orElseThrow();</b>
<b class="fc">&nbsp;        Optional&lt;Partition&gt; optionalPartition = edgeLabel1.getPartition(&quot;int1&quot;);</b>
<b class="fc">&nbsp;        Assert.assertFalse(optionalPartition.isPresent());</b>
<b class="fc">&nbsp;        Assert.assertEquals(3, sqlgGraph1.topology().V().hasLabel(&quot;sqlg_schema.partition&quot;).count().next(), 0);</b>
&nbsp;    }
&nbsp;
&nbsp;    private void assert_edgePartitions(SqlgGraph sqlgGraph1) {
<b class="fc">&nbsp;        List&lt;Edge&gt; edges;VertexLabel vertexLabel = sqlgGraph1.getTopology().getPublicSchema().getVertexLabel(&quot;A&quot;).orElseThrow();</b>
<b class="fc">&nbsp;        EdgeLabel edgeLabel = vertexLabel.getOutEdgeLabel(&quot;ab&quot;).orElseThrow();</b>
&nbsp;
<b class="fc">&nbsp;        Map&lt;String, Partition&gt; partitions = edgeLabel.getPartitions();</b>
<b class="fc">&nbsp;        Assert.assertEquals(2, partitions.size());</b>
<b class="fc">&nbsp;        Assert.assertTrue(partitions.containsKey(&quot;int1&quot;));</b>
<b class="fc">&nbsp;        Partition pint1 = partitions.get(&quot;int1&quot;);</b>
<b class="fc">&nbsp;        Assert.assertEquals(2, pint1.getPartitions().size());</b>
<b class="fc">&nbsp;        Assert.assertTrue(pint1.getPartitions().containsKey(&quot;int11&quot;));</b>
<b class="fc">&nbsp;        Partition pint11 = pint1.getPartitions().get(&quot;int11&quot;);</b>
<b class="fc">&nbsp;        Assert.assertEquals(2, pint11.getPartitions().size());</b>
<b class="fc">&nbsp;        Assert.assertTrue(pint11.getPartitions().containsKey(&quot;int111&quot;));</b>
<b class="fc">&nbsp;        Partition pint111 = pint11.getPartitions().get(&quot;int111&quot;);</b>
<b class="fc">&nbsp;        Assert.assertEquals(0, pint111.getPartitions().size());</b>
<b class="fc">&nbsp;        Assert.assertTrue(pint11.getPartitions().containsKey(&quot;int112&quot;));</b>
<b class="fc">&nbsp;        Partition pint112 = pint11.getPartitions().get(&quot;int112&quot;);</b>
<b class="fc">&nbsp;        Assert.assertEquals(0, pint112.getPartitions().size());</b>
&nbsp;
&nbsp;
<b class="fc">&nbsp;        Assert.assertTrue(pint1.getPartitions().containsKey(&quot;int12&quot;));</b>
<b class="fc">&nbsp;        Partition pint12 = pint1.getPartitions().get(&quot;int12&quot;);</b>
<b class="fc">&nbsp;        Assert.assertEquals(2, pint12.getPartitions().size());</b>
<b class="fc">&nbsp;        Assert.assertTrue(pint12.getPartitions().containsKey(&quot;int121&quot;));</b>
<b class="fc">&nbsp;        Partition pint121 = pint12.getPartitions().get(&quot;int121&quot;);</b>
<b class="fc">&nbsp;        Assert.assertEquals(0, pint121.getPartitions().size());</b>
<b class="fc">&nbsp;        Assert.assertTrue(pint12.getPartitions().containsKey(&quot;int122&quot;));</b>
<b class="fc">&nbsp;        Partition pint122 = pint12.getPartitions().get(&quot;int122&quot;);</b>
<b class="fc">&nbsp;        Assert.assertEquals(0, pint122.getPartitions().size());</b>
&nbsp;
<b class="fc">&nbsp;        Assert.assertTrue(partitions.containsKey(&quot;int2&quot;));</b>
<b class="fc">&nbsp;        Partition pint2 = partitions.get(&quot;int2&quot;);</b>
<b class="fc">&nbsp;        Assert.assertEquals(2, pint2.getPartitions().size());</b>
<b class="fc">&nbsp;        Assert.assertTrue(pint2.getPartitions().containsKey(&quot;int21&quot;));</b>
<b class="fc">&nbsp;        Partition pint21 = pint2.getPartitions().get(&quot;int21&quot;);</b>
<b class="fc">&nbsp;        Assert.assertEquals(1, pint21.getPartitions().size());</b>
<b class="fc">&nbsp;        Assert.assertTrue(pint21.getPartitions().containsKey(&quot;int221&quot;));</b>
<b class="fc">&nbsp;        Partition pint221 = pint21.getPartitions().get(&quot;int221&quot;);</b>
<b class="fc">&nbsp;        Assert.assertEquals(0, pint221.getPartitions().size());</b>
&nbsp;
<b class="fc">&nbsp;        Assert.assertTrue(pint2.getPartitions().containsKey(&quot;int22&quot;));</b>
<b class="fc">&nbsp;        Partition pint22 = pint2.getPartitions().get(&quot;int22&quot;);</b>
<b class="fc">&nbsp;        Assert.assertEquals(1, pint22.getPartitions().size());</b>
<b class="fc">&nbsp;        Assert.assertTrue(pint22.getPartitions().containsKey(&quot;int222&quot;));</b>
<b class="fc">&nbsp;        Partition pint222 = pint22.getPartitions().get(&quot;int222&quot;);</b>
<b class="fc">&nbsp;        Assert.assertEquals(0, pint222.getPartitions().size());</b>
&nbsp;
<b class="fc">&nbsp;        Assert.assertEquals(12, sqlgGraph1.topology().V().hasLabel(&quot;sqlg_schema.partition&quot;).count().next(), 0);</b>
<b class="fc">&nbsp;        edges = sqlgGraph1.traversal().E().hasLabel(&quot;ab&quot;).has(&quot;int1&quot;, 1).has(&quot;int2&quot;, 1).has(&quot;int3&quot;, 1).toList();</b>
<b class="fc">&nbsp;        Assert.assertEquals(1, edges.size());</b>
<b class="fc">&nbsp;        edges = sqlgGraph1.traversal().E().hasLabel(&quot;ab&quot;).has(&quot;int1&quot;, 9).has(&quot;int2&quot;, 9).has(&quot;int3&quot;, 9).toList();</b>
<b class="fc">&nbsp;        Assert.assertEquals(1, edges.size());</b>
<b class="fc">&nbsp;        sqlgGraph1.tx().rollback();</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testSubSubPartitionList() throws InterruptedException {
<b class="fc">&nbsp;        Schema publicSchema = this.sqlgGraph.getTopology().getPublicSchema();</b>
<b class="fc">&nbsp;        VertexLabel a = publicSchema.ensurePartitionedVertexLabelExist(</b>
&nbsp;                &quot;A&quot;,
<b class="fc">&nbsp;                new HashMap&lt;&gt;() {{</b>
<b class="fc">&nbsp;                    put(&quot;uid&quot;, PropertyDefinition.of(PropertyType.STRING));</b>
<b class="fc">&nbsp;                    put(&quot;int1&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
<b class="fc">&nbsp;                    put(&quot;int2&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
<b class="fc">&nbsp;                    put(&quot;int3&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                }},
<b class="fc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;uid&quot;, &quot;int1&quot;, &quot;int2&quot;, &quot;int3&quot;)),</b>
&nbsp;                PartitionType.LIST,
&nbsp;                &quot;int1&quot;);
<b class="fc">&nbsp;        Partition p1 = a.ensureListPartitionWithSubPartitionExists(&quot;int1&quot;, &quot;1,2,3,4,5&quot;, PartitionType.LIST, &quot;int2&quot;);</b>
<b class="fc">&nbsp;        Partition p2 = a.ensureListPartitionWithSubPartitionExists(&quot;int2&quot;, &quot;6,7,8,9,10&quot;, PartitionType.LIST, &quot;int2&quot;);</b>
&nbsp;
<b class="fc">&nbsp;        Partition p1_1 = p1.ensureListPartitionWithSubPartitionExists(&quot;int11&quot;, &quot;1,2,3,4,5&quot;, PartitionType.LIST, &quot;int3&quot;);</b>
<b class="fc">&nbsp;        Partition p1_2 = p1.ensureListPartitionWithSubPartitionExists(&quot;int12&quot;, &quot;6,7,8,9,10&quot;, PartitionType.LIST, &quot;int3&quot;);</b>
<b class="fc">&nbsp;        Partition p2_1 = p2.ensureListPartitionWithSubPartitionExists(&quot;int21&quot;, &quot;1,2,3,4,5&quot;, PartitionType.LIST, &quot;int3&quot;);</b>
<b class="fc">&nbsp;        Partition p2_2 = p2.ensureListPartitionWithSubPartitionExists(&quot;int22&quot;, &quot;6,7,8,9,10&quot;, PartitionType.LIST, &quot;int3&quot;);</b>
&nbsp;
<b class="fc">&nbsp;        p1_1.ensureListPartitionExists(&quot;int111&quot;, &quot;1,2,3,4,5&quot;);</b>
<b class="fc">&nbsp;        p1_1.ensureListPartitionExists(&quot;int112&quot;, &quot;6,7,8,9,10&quot;);</b>
<b class="fc">&nbsp;        p1_2.ensureListPartitionExists(&quot;int121&quot;, &quot;1,2,3,4,5&quot;);</b>
<b class="fc">&nbsp;        p1_2.ensureListPartitionExists(&quot;int122&quot;, &quot;6,7,8,9,10&quot;);</b>
<b class="fc">&nbsp;        p2_1.ensureListPartitionExists(&quot;int211&quot;, &quot;1,2,3,4,5&quot;);</b>
<b class="fc">&nbsp;        p2_1.ensureListPartitionExists(&quot;int212&quot;, &quot;6,7,8,9,10&quot;);</b>
<b class="fc">&nbsp;        p2_2.ensureListPartitionExists(&quot;int221&quot;, &quot;1,2,3,4,5&quot;);</b>
<b class="fc">&nbsp;        p2_2.ensureListPartitionExists(&quot;int222&quot;, &quot;6,7,8,9,10&quot;);</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;
<b class="fc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;uid&quot;, UUID.randomUUID().toString(), &quot;int1&quot;, 1, &quot;int2&quot;, 1, &quot;int3&quot;, 1);</b>
<b class="fc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;uid&quot;, UUID.randomUUID().toString(), &quot;int1&quot;, 5, &quot;int2&quot;, 5, &quot;int3&quot;, 5);</b>
&nbsp;
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;
<b class="fc">&nbsp;        List&lt;Vertex&gt; vertices = this.sqlgGraph.traversal()</b>
<b class="fc">&nbsp;                .V().hasLabel(&quot;A&quot;)</b>
<b class="fc">&nbsp;                .has(&quot;int1&quot;, 1)</b>
<b class="fc">&nbsp;                .has(&quot;int2&quot;, 1)</b>
<b class="fc">&nbsp;                .has(&quot;int3&quot;, 1)</b>
<b class="fc">&nbsp;                .toList();</b>
<b class="fc">&nbsp;        Assert.assertEquals(1, vertices.size());</b>
<b class="fc">&nbsp;        vertices = this.sqlgGraph.traversal()</b>
<b class="fc">&nbsp;                .V().hasLabel(&quot;A&quot;)</b>
<b class="fc">&nbsp;                .has(&quot;int1&quot;, 5)</b>
<b class="fc">&nbsp;                .has(&quot;int2&quot;, 5)</b>
<b class="fc">&nbsp;                .has(&quot;int3&quot;, 5)</b>
<b class="fc">&nbsp;                .toList();</b>
<b class="fc">&nbsp;        Assert.assertEquals(1, vertices.size());</b>
&nbsp;
<b class="fc">&nbsp;        Thread.sleep(1000);</b>
<b class="fc">&nbsp;        a = this.sqlgGraph.getTopology().getPublicSchema().getVertexLabel(&quot;A&quot;).orElseThrow();</b>
<b class="fc">&nbsp;        Optional&lt;Partition&gt; int222 = a.getPartition(&quot;int222&quot;);</b>
<b class="fc">&nbsp;        Assert.assertTrue(int222.isPresent());</b>
<b class="fc">&nbsp;        a = this.sqlgGraph1.getTopology().getPublicSchema().getVertexLabel(&quot;A&quot;).orElseThrow();</b>
<b class="fc">&nbsp;        int222 = a.getPartition(&quot;int222&quot;);</b>
<b class="fc">&nbsp;        Assert.assertTrue(int222.isPresent());</b>
&nbsp;
&nbsp;        //test remove partition
<b class="fc">&nbsp;        VertexLabel aVertexLabel = publicSchema.getVertexLabel(&quot;A&quot;).orElseThrow();</b>
<b class="fc">&nbsp;        Optional&lt;Partition&gt; partitionOpt = aVertexLabel.getPartition(&quot;int1&quot;);</b>
<b class="fc">&nbsp;        Assert.assertTrue(partitionOpt.isPresent());</b>
<b class="fc">&nbsp;        partitionOpt.get().remove();</b>
<b class="fc">&nbsp;        partitionOpt = aVertexLabel.getPartition(&quot;int1&quot;);</b>
<b class="fc">&nbsp;        Assert.assertTrue(partitionOpt.isEmpty());</b>
&nbsp;
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testEdgeSubSubPartitionList() throws Exception {
<b class="fc">&nbsp;        Schema publicSchema = this.sqlgGraph.getTopology().getPublicSchema();</b>
<b class="fc">&nbsp;        VertexLabel a = publicSchema.ensureVertexLabelExist(&quot;A&quot;);</b>
<b class="fc">&nbsp;        VertexLabel b = publicSchema.ensureVertexLabelExist(&quot;B&quot;);</b>
<b class="fc">&nbsp;        EdgeLabel ab = a.ensurePartitionedEdgeLabelExist(</b>
&nbsp;                &quot;ab&quot;,
&nbsp;                b,
<b class="fc">&nbsp;                new HashMap&lt;&gt;() {{</b>
<b class="fc">&nbsp;                    put(&quot;uid&quot;, PropertyDefinition.of(PropertyType.STRING));</b>
<b class="fc">&nbsp;                    put(&quot;int1&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
<b class="fc">&nbsp;                    put(&quot;int2&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
<b class="fc">&nbsp;                    put(&quot;int3&quot;, PropertyDefinition.of(PropertyType.INTEGER));</b>
&nbsp;                }},
<b class="fc">&nbsp;                ListOrderedSet.listOrderedSet(List.of(&quot;uid&quot;, &quot;int1&quot;, &quot;int2&quot;, &quot;int3&quot;)),</b>
&nbsp;                PartitionType.LIST,
&nbsp;                &quot;int1&quot;);
&nbsp;
<b class="fc">&nbsp;        Partition p1 = ab.ensureListPartitionWithSubPartitionExists(&quot;int1&quot;, &quot;1,2,3,4,5&quot;, PartitionType.LIST, &quot;int2&quot;);</b>
<b class="fc">&nbsp;        Partition p2 = ab.ensureListPartitionWithSubPartitionExists(&quot;int2&quot;, &quot;6,7,8,9,10&quot;, PartitionType.LIST, &quot;int2&quot;);</b>
&nbsp;
<b class="fc">&nbsp;        Partition p11 = p1.ensureListPartitionWithSubPartitionExists(&quot;int11&quot;, &quot;1,2,3,4,5&quot;, PartitionType.LIST, &quot;int3&quot;);</b>
<b class="fc">&nbsp;        Partition p12 = p1.ensureListPartitionWithSubPartitionExists(&quot;int12&quot;, &quot;6,7,8,9,10&quot;, PartitionType.LIST, &quot;int3&quot;);</b>
<b class="fc">&nbsp;        Partition p21 = p2.ensureListPartitionWithSubPartitionExists(&quot;int21&quot;, &quot;1,2,3,4,5&quot;, PartitionType.LIST, &quot;int3&quot;);</b>
<b class="fc">&nbsp;        Partition p22 = p2.ensureListPartitionWithSubPartitionExists(&quot;int22&quot;, &quot;6,7,8,9,10&quot;, PartitionType.LIST, &quot;int3&quot;);</b>
&nbsp;
<b class="fc">&nbsp;        p11.ensureListPartitionExists(&quot;int111&quot;, &quot;1,2,3,4,5&quot;);</b>
<b class="fc">&nbsp;        p11.ensureListPartitionExists(&quot;int112&quot;, &quot;6,7,8,9,10&quot;);</b>
<b class="fc">&nbsp;        p12.ensureListPartitionExists(&quot;int121&quot;, &quot;1,2,3,4,5&quot;);</b>
<b class="fc">&nbsp;        p12.ensureListPartitionExists(&quot;int122&quot;, &quot;6,7,8,9,10&quot;);</b>
<b class="fc">&nbsp;        p21.ensureListPartitionExists(&quot;int221&quot;, &quot;1,2,3,4,5&quot;);</b>
<b class="fc">&nbsp;        p22.ensureListPartitionExists(&quot;int222&quot;, &quot;6,7,8,9,10&quot;);</b>
&nbsp;
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;
<b class="fc">&nbsp;        for (int i = 1; i &lt; 10; i++) {</b>
<b class="fc">&nbsp;            Vertex a1 = this.sqlgGraph.addVertex(T.label, &quot;A&quot;);</b>
<b class="fc">&nbsp;            Vertex b1 = this.sqlgGraph.addVertex(T.label, &quot;B&quot;);</b>
<b class="fc">&nbsp;            a1.addEdge(&quot;ab&quot;, b1, &quot;uid&quot;, UUID.randomUUID().toString(), &quot;int1&quot;, i, &quot;int2&quot;, i, &quot;int3&quot;, i);</b>
&nbsp;        }
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;
<b class="fc">&nbsp;        List&lt;Vertex&gt; vertices = this.sqlgGraph.traversal().V().toList();</b>
<b class="fc">&nbsp;        Assert.assertEquals(18, vertices.size());</b>
<b class="fc">&nbsp;        List&lt;Edge&gt; edges = this.sqlgGraph.traversal().E().toList();</b>
<b class="fc">&nbsp;        Assert.assertEquals(9, edges.size());</b>
<b class="fc">&nbsp;        vertices = this.sqlgGraph.traversal()</b>
<b class="fc">&nbsp;                .V().hasLabel(&quot;A&quot;)</b>
<b class="fc">&nbsp;                .outE(&quot;ab&quot;)</b>
<b class="fc">&nbsp;                .has(&quot;int1&quot;, 1)</b>
<b class="fc">&nbsp;                .has(&quot;int2&quot;, 1)</b>
<b class="fc">&nbsp;                .has(&quot;int3&quot;, 1)</b>
<b class="fc">&nbsp;                .otherV()</b>
<b class="fc">&nbsp;                .toList();</b>
<b class="fc">&nbsp;        Assert.assertEquals(1, vertices.size());</b>
&nbsp;
<b class="fc">&nbsp;        Thread.sleep(1000);</b>
<b class="fc">&nbsp;        ab = this.sqlgGraph.getTopology().getPublicSchema().getEdgeLabel(&quot;ab&quot;).orElseThrow();</b>
<b class="fc">&nbsp;        Optional&lt;Partition&gt; p = ab.getPartition(&quot;int222&quot;);</b>
<b class="fc">&nbsp;        Assert.assertTrue(p.isPresent());</b>
<b class="fc">&nbsp;        ab = this.sqlgGraph1.getTopology().getPublicSchema().getEdgeLabel(&quot;ab&quot;).orElseThrow();</b>
<b class="fc">&nbsp;        p = ab.getPartition(&quot;int222&quot;);</b>
<b class="fc">&nbsp;        Assert.assertTrue(p.isPresent());</b>
&nbsp;
&nbsp;        //test remove partition
<b class="fc">&nbsp;        EdgeLabel edgeLabel = publicSchema.getEdgeLabel(&quot;ab&quot;).orElseThrow();</b>
<b class="fc">&nbsp;        Optional&lt;Partition&gt; partitionOpt = edgeLabel.getPartition(&quot;int1&quot;);</b>
<b class="fc">&nbsp;        Assert.assertTrue(partitionOpt.isPresent());</b>
<b class="fc">&nbsp;        partitionOpt.get().remove();</b>
<b class="fc">&nbsp;        partitionOpt = edgeLabel.getPartition(&quot;int1&quot;);</b>
<b class="fc">&nbsp;        Assert.assertTrue(partitionOpt.isEmpty());</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;
&nbsp;        //Delete the topology
<b class="fc">&nbsp;        dropSqlgSchema(this.sqlgGraph);</b>
&nbsp;
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        this.sqlgGraph.close();</b>
&nbsp;
&nbsp;        //noinspection EmptyTryBlock
<b class="fc">&nbsp;        try (@SuppressWarnings(&quot;unused&quot;) SqlgGraph sqlgGraph1 = SqlgGraph.open(configuration)) {</b>
&nbsp;        }
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2025-06-23 10:13</div>
</div>
</body>
</html>
