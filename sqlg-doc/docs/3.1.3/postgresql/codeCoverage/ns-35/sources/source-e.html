


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > TestTopologyDelete</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">org.umlg.sqlg.test.topology</a>
</div>

<h1>Coverage Summary for Class: TestTopologyDelete (org.umlg.sqlg.test.topology)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">TestTopologyDelete</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (42/42)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    98.4%
  </span>
  <span class="absValue">
    (61/62)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    99.7%
  </span>
  <span class="absValue">
    (781/783)
  </span>
</td>
</tr>
  <tr>
    <td class="name">TestTopologyDelete$1</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (4/4)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (43/43)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    98.4%
  </span>
  <span class="absValue">
    (61/62)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    99.7%
  </span>
  <span class="absValue">
    (785/787)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package org.umlg.sqlg.test.topology;
&nbsp;
&nbsp;import org.apache.commons.configuration2.builder.fluent.Configurations;
&nbsp;import org.apache.commons.configuration2.ex.ConfigurationException;
&nbsp;import org.apache.tinkerpop.gremlin.process.traversal.dsl.graph.GraphTraversal;
&nbsp;import org.apache.tinkerpop.gremlin.structure.Direction;
&nbsp;import org.apache.tinkerpop.gremlin.structure.Edge;
&nbsp;import org.apache.tinkerpop.gremlin.structure.T;
&nbsp;import org.apache.tinkerpop.gremlin.structure.Vertex;
&nbsp;import org.junit.*;
&nbsp;import org.junit.runner.RunWith;
&nbsp;import org.junit.runners.Parameterized;
&nbsp;import org.junit.runners.Parameterized.Parameter;
&nbsp;import org.umlg.sqlg.structure.PropertyDefinition;
&nbsp;import org.umlg.sqlg.structure.PropertyType;
&nbsp;import org.umlg.sqlg.structure.SqlgGraph;
&nbsp;import org.umlg.sqlg.structure.TopologyChangeAction;
&nbsp;import org.umlg.sqlg.structure.topology.*;
&nbsp;import org.umlg.sqlg.test.BaseTest;
&nbsp;import org.umlg.sqlg.test.topology.TestTopologyChangeListener.TopologyListenerTest;
&nbsp;
&nbsp;import java.net.URL;
&nbsp;import java.sql.ResultSet;
&nbsp;import java.sql.SQLException;
&nbsp;import java.util.*;
&nbsp;
&nbsp;import static org.junit.Assert.*;
&nbsp;import static org.umlg.sqlg.structure.topology.Topology.*;
&nbsp;
&nbsp;/**
&nbsp; * Test the deletion of topology items
&nbsp; *
&nbsp; * @author jpmoresmau
&nbsp; */
&nbsp;@RunWith(Parameterized.class)
<b class="fc">&nbsp;public class TestTopologyDelete extends BaseTest {</b>
&nbsp;
&nbsp;    @Parameter
&nbsp;    public String schema;
&nbsp;    @Parameter(1)
&nbsp;    public boolean preserve;
&nbsp;    @Parameter(2)
&nbsp;    public boolean rollback;
&nbsp;
&nbsp;    @Parameterized.Parameters(name = &quot;{index}: schema:{0}, preserve:{1}, rollback:{2}&quot;)
&nbsp;    public static Collection&lt;Object[]&gt; data() {
<b class="fc">&nbsp;        List&lt;Object[]&gt; l = new ArrayList&lt;&gt;();</b>
<b class="fc">&nbsp;        String[] schemas = new String[]{null, &quot;MySchema&quot;};</b>
<b class="fc">&nbsp;        boolean[] preserve = new boolean[]{true, false};</b>
<b class="fc">&nbsp;        boolean[] rollback = new boolean[]{true, false};</b>
&nbsp;//        String[] schemas = new String[]{null};
&nbsp;//        boolean[] preserve = new boolean[]{true};
&nbsp;//        boolean[] rollback = new boolean[]{false};
<b class="fc">&nbsp;        for (String s : schemas) {</b>
<b class="fc">&nbsp;            for (boolean p : preserve) {</b>
<b class="fc">&nbsp;                for (boolean r : rollback) {</b>
<b class="fc">&nbsp;                    l.add(new Object[]{s, p, r});</b>
&nbsp;                }
&nbsp;            }
&nbsp;        }
<b class="fc">&nbsp;        return l;</b>
&nbsp;    }
&nbsp;
&nbsp;    @SuppressWarnings(&quot;Duplicates&quot;)
&nbsp;    @BeforeClass
&nbsp;    public static void beforeClass() {
<b class="fc">&nbsp;        URL sqlProperties = Thread.currentThread().getContextClassLoader().getResource(&quot;sqlg.properties&quot;);</b>
&nbsp;        try {
<b class="fc">&nbsp;            Configurations configs = new Configurations();</b>
<b class="fc">&nbsp;            configuration = configs.properties(sqlProperties);</b>
<b class="fc">&nbsp;            Assume.assumeTrue(isPostgres());</b>
<b class="fc">&nbsp;            configuration.addProperty(SqlgGraph.DISTRIBUTED, true);</b>
<b class="pc">&nbsp;            if (!configuration.containsKey(SqlgGraph.JDBC_URL))</b>
<b class="nc">&nbsp;                throw new IllegalArgumentException(String.format(&quot;SqlGraph configuration requires that the %s be set&quot;, SqlgGraph.JDBC_URL));</b>
&nbsp;
&nbsp;        } catch (ConfigurationException e) {
<b class="nc">&nbsp;            throw new IllegalStateException(e);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;    @Before
&nbsp;    public void buildLoops() {
<b class="fc">&nbsp;        if (schema == null) {</b>
<b class="fc">&nbsp;            schema = this.sqlgGraph.getSqlDialect().getPublicSchema();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testDeleteSchema() throws Exception {
&nbsp;        // we assume public schema is never deleted
<b class="fc">&nbsp;        if (schema.equals(this.sqlgGraph.getSqlDialect().getPublicSchema())) {</b>
&nbsp;            return;
&nbsp;        }
<b class="fc">&nbsp;        try (SqlgGraph sqlgGraph1 = SqlgGraph.open(configuration)) {</b>
<b class="fc">&nbsp;            String A = getLabel(schema, &quot;A&quot;);</b>
<b class="fc">&nbsp;            String B = getLabel(schema, &quot;B&quot;);</b>
<b class="fc">&nbsp;            Vertex a = this.sqlgGraph.addVertex(T.label, A, &quot;name&quot;, &quot;A&quot;);</b>
<b class="fc">&nbsp;            Vertex b = this.sqlgGraph.addVertex(T.label, B, &quot;name&quot;, &quot;B&quot;);</b>
<b class="fc">&nbsp;            a.addEdge(&quot;E&quot;, b, &quot;attr&quot;, &quot;value&quot;);</b>
&nbsp;
<b class="fc">&nbsp;            VertexLabel lbl = this.sqlgGraph.getTopology().getVertexLabel(schema, &quot;A&quot;).orElseThrow(IllegalStateException::new);</b>
<b class="fc">&nbsp;            lbl.ensureIndexExists(IndexType.UNIQUE, Collections.singletonList(lbl.getProperty(&quot;name&quot;).orElseThrow(IllegalStateException::new)));</b>
&nbsp;
<b class="fc">&nbsp;            EdgeLabel elbl = lbl.getOutEdgeLabels().values().iterator().next();</b>
<b class="fc">&nbsp;            elbl.ensureIndexExists(IndexType.UNIQUE, Collections.singletonList(elbl.getProperty(&quot;attr&quot;).orElseThrow(IllegalStateException::new)));</b>
&nbsp;
&nbsp;
<b class="fc">&nbsp;            testSchemaBeforeDeletion(this.sqlgGraph, schema);</b>
<b class="fc">&nbsp;            this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;            testSchemaBeforeDeletion(this.sqlgGraph, schema);</b>
<b class="fc">&nbsp;            Thread.sleep(1_000);</b>
<b class="fc">&nbsp;            testSchemaBeforeDeletion(sqlgGraph1, schema);</b>
<b class="fc">&nbsp;            sqlgGraph1.tx().rollback();</b>
&nbsp;
<b class="fc">&nbsp;            TopologyListenerTest tlt = new TopologyListenerTest();</b>
<b class="fc">&nbsp;            this.sqlgGraph.getTopology().registerListener(tlt);</b>
&nbsp;
<b class="fc">&nbsp;            Schema sch = this.sqlgGraph.getTopology().getSchema(schema).orElseThrow(IllegalStateException::new);</b>
<b class="fc">&nbsp;            sch.remove(preserve);</b>
<b class="fc">&nbsp;            assertTrue(tlt.receivedEvent(sch, TopologyChangeAction.DELETE));</b>
&nbsp;
<b class="fc">&nbsp;            testSchemaAfterDeletion(this.sqlgGraph, schema, preserve);</b>
&nbsp;
<b class="fc">&nbsp;            if (rollback) {</b>
<b class="fc">&nbsp;                this.sqlgGraph.tx().rollback();</b>
<b class="fc">&nbsp;                testSchemaBeforeDeletion(this.sqlgGraph, schema);</b>
&nbsp;
&nbsp;            } else {
<b class="fc">&nbsp;                TopologyListenerTest tlt1 = new TopologyListenerTest();</b>
<b class="fc">&nbsp;                sqlgGraph1.getTopology().registerListener(tlt1);</b>
&nbsp;
<b class="fc">&nbsp;                this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;                testSchemaAfterDeletion(this.sqlgGraph, schema, preserve);</b>
<b class="fc">&nbsp;                Thread.sleep(1_000);</b>
<b class="fc">&nbsp;                assertTrue(tlt1.receivedEvent(sch, TopologyChangeAction.DELETE));</b>
<b class="fc">&nbsp;                testSchemaAfterDeletion(sqlgGraph1, schema, preserve);</b>
&nbsp;            }
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testDeleteSchemaWithOtherEdges() throws Exception {
&nbsp;        // we assume public schema is never deleted
<b class="fc">&nbsp;        if (schema.equals(this.sqlgGraph.getSqlDialect().getPublicSchema())) {</b>
&nbsp;            return;
&nbsp;        }
<b class="fc">&nbsp;        try (SqlgGraph sqlgGraph1 = SqlgGraph.open(configuration)) {</b>
<b class="fc">&nbsp;            String otherSchema = &quot;otherSchema&quot;;</b>
<b class="fc">&nbsp;            String A = getLabel(otherSchema, &quot;A&quot;);</b>
<b class="fc">&nbsp;            String B = getLabel(schema, &quot;B&quot;);</b>
<b class="fc">&nbsp;            Vertex a = this.sqlgGraph.addVertex(T.label, A, &quot;name&quot;, &quot;A&quot;);</b>
<b class="fc">&nbsp;            Vertex b = this.sqlgGraph.addVertex(T.label, B, &quot;name&quot;, &quot;B&quot;);</b>
<b class="fc">&nbsp;            a.addEdge(&quot;E&quot;, b, &quot;attr&quot;, &quot;value&quot;);</b>
<b class="fc">&nbsp;            testSchemaWithOtherEdges(this.sqlgGraph, schema, otherSchema);</b>
&nbsp;
<b class="fc">&nbsp;            this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;            testSchemaWithOtherEdges(this.sqlgGraph, schema, otherSchema);</b>
<b class="fc">&nbsp;            Thread.sleep(1_000);</b>
<b class="fc">&nbsp;            testSchemaWithOtherEdges(sqlgGraph1, schema, otherSchema);</b>
<b class="fc">&nbsp;            sqlgGraph1.tx().rollback();</b>
&nbsp;
<b class="fc">&nbsp;            Schema sch = this.sqlgGraph.getTopology().getSchema(schema).orElseThrow(IllegalStateException::new);</b>
<b class="fc">&nbsp;            sch.remove(preserve);</b>
&nbsp;
<b class="fc">&nbsp;            testSchemaWithOtherEdgesAfterDeletion(sqlgGraph, schema, otherSchema);</b>
&nbsp;
<b class="fc">&nbsp;            if (rollback) {</b>
<b class="fc">&nbsp;                this.sqlgGraph.tx().rollback();</b>
<b class="fc">&nbsp;                testSchemaWithOtherEdges(this.sqlgGraph, schema, otherSchema);</b>
&nbsp;            } else {
<b class="fc">&nbsp;                this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;                testSchemaWithOtherEdgesAfterDeletion(sqlgGraph, schema, otherSchema);</b>
<b class="fc">&nbsp;                Thread.sleep(1_000);</b>
<b class="fc">&nbsp;                testSchemaWithOtherEdgesAfterDeletion(sqlgGraph1, schema, otherSchema);</b>
&nbsp;            }
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testDeleteVertexProperty() throws Exception {
<b class="fc">&nbsp;        try (SqlgGraph sqlgGraph1 = SqlgGraph.open(configuration)) {</b>
<b class="fc">&nbsp;            String fullLabel = getLabel(schema, &quot;A&quot;);</b>
<b class="fc">&nbsp;            Vertex a1 = this.sqlgGraph.addVertex(T.label, fullLabel, &quot;name&quot;, &quot;A&quot;, &quot;p1&quot;, &quot;val1&quot;, &quot;p2&quot;, &quot;val2&quot;);</b>
&nbsp;
<b class="fc">&nbsp;            assertNotNull(a1.property(&quot;p1&quot;).value());</b>
<b class="fc">&nbsp;            assertNotNull(a1.property(&quot;p2&quot;).value());</b>
<b class="fc">&nbsp;            checkPropertyExistenceBeforeDeletion(schema);</b>
<b class="fc">&nbsp;            this.sqlgGraph.tx().commit();</b>
&nbsp;
<b class="fc">&nbsp;            Object aid = a1.id();</b>
&nbsp;
<b class="fc">&nbsp;            checkPropertyExistenceBeforeDeletion(schema);</b>
<b class="fc">&nbsp;            a1 = this.sqlgGraph.traversal().V(aid).next();</b>
<b class="fc">&nbsp;            assertNotNull(a1.property(&quot;p1&quot;).value());</b>
<b class="fc">&nbsp;            assertNotNull(a1.property(&quot;p2&quot;).value());</b>
&nbsp;
<b class="fc">&nbsp;            TopologyListenerTest tlt = new TopologyListenerTest();</b>
<b class="fc">&nbsp;            this.sqlgGraph.getTopology().registerListener(tlt);</b>
&nbsp;
<b class="fc">&nbsp;            VertexLabel lbl = this.sqlgGraph.getTopology().getVertexLabel(schema, &quot;A&quot;).orElseThrow(IllegalStateException::new);</b>
<b class="fc">&nbsp;            PropertyColumn p1 = lbl.getProperty(&quot;p1&quot;).orElseThrow(IllegalStateException::new);</b>
<b class="fc">&nbsp;            p1.remove(false);</b>
<b class="fc">&nbsp;            PropertyColumn p2 = lbl.getProperty(&quot;p2&quot;).orElseThrow(IllegalStateException::new);</b>
<b class="fc">&nbsp;            p2.remove(true);</b>
&nbsp;
<b class="fc">&nbsp;            assertTrue(tlt.receivedEvent(p1, TopologyChangeAction.DELETE));</b>
<b class="fc">&nbsp;            assertTrue(tlt.receivedEvent(p2, TopologyChangeAction.DELETE));</b>
&nbsp;
<b class="fc">&nbsp;            checkPropertyExistenceAfterDeletion(this.sqlgGraph, schema);</b>
&nbsp;            /* doesn&#39;t work because the topology allTableCache is only updated after commit
&nbsp;            a1=this.sqlgGraph.traversal().V(aid).next();
&nbsp;			assertFalse(a1.property(&quot;p1&quot;).isPresent());
&nbsp;			assertFalse(a1.property(&quot;p2&quot;).isPresent());
&nbsp;			*/
<b class="fc">&nbsp;            if (rollback) {</b>
<b class="fc">&nbsp;                this.sqlgGraph.tx().rollback();</b>
<b class="fc">&nbsp;                checkPropertyExistenceBeforeDeletion(schema);</b>
&nbsp;            } else {
<b class="fc">&nbsp;                TopologyListenerTest tlt1 = new TopologyListenerTest();</b>
<b class="fc">&nbsp;                sqlgGraph1.getTopology().registerListener(tlt1);</b>
<b class="fc">&nbsp;                this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;                checkPropertyExistenceAfterDeletion(this.sqlgGraph, schema);</b>
&nbsp;
<b class="fc">&nbsp;                a1 = this.sqlgGraph.traversal().V(aid).next();</b>
<b class="fc">&nbsp;                assertFalse(a1.property(&quot;p1&quot;).isPresent());</b>
<b class="fc">&nbsp;                assertFalse(a1.property(&quot;p2&quot;).isPresent());</b>
&nbsp;
<b class="fc">&nbsp;                Thread.sleep(1_000);</b>
<b class="fc">&nbsp;                checkPropertyExistenceAfterDeletion(sqlgGraph1, schema);</b>
<b class="fc">&nbsp;                assertTrue(tlt1.receivedEvent(p1, TopologyChangeAction.DELETE));</b>
<b class="fc">&nbsp;                assertTrue(tlt1.receivedEvent(p2, TopologyChangeAction.DELETE));</b>
&nbsp;            }
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testDeleteVertexPropertyWithIndex() throws Exception {
<b class="fc">&nbsp;        try (SqlgGraph sqlgGraph1 = SqlgGraph.open(configuration)) {</b>
<b class="fc">&nbsp;            String fullLabel = getLabel(schema, &quot;A&quot;);</b>
&nbsp;            Schema _schema;
<b class="fc">&nbsp;            if (!schema.equals(sqlgGraph1.getTopology().getPublicSchema().getName())) {</b>
<b class="fc">&nbsp;                _schema = sqlgGraph.getTopology().ensureSchemaExist(schema);</b>
&nbsp;            } else {
<b class="fc">&nbsp;                _schema = sqlgGraph.getTopology().getPublicSchema();</b>
&nbsp;            }
<b class="fc">&nbsp;            VertexLabel vertexLabel = _schema.ensureVertexLabelExist(&quot;A&quot;, new HashMap&lt;&gt;() {{</b>
<b class="fc">&nbsp;                put(&quot;name&quot;, PropertyDefinition.of(PropertyType.STRING));</b>
<b class="fc">&nbsp;                put(&quot;p1&quot;, PropertyDefinition.of(PropertyType.STRING));</b>
<b class="fc">&nbsp;                put(&quot;p2&quot;, PropertyDefinition.of(PropertyType.STRING));</b>
&nbsp;            }});
<b class="fc">&nbsp;            Optional&lt;PropertyColumn&gt; propertyColumnOptional = vertexLabel.getProperty(&quot;p1&quot;);</b>
<b class="fc">&nbsp;            Assert.assertTrue(propertyColumnOptional.isPresent());</b>
<b class="fc">&nbsp;            Index i1 = vertexLabel.ensureIndexExists(IndexType.UNIQUE, List.of(propertyColumnOptional.get()));</b>
&nbsp;
<b class="fc">&nbsp;            Vertex a1 = this.sqlgGraph.addVertex(T.label, fullLabel, &quot;name&quot;, &quot;A&quot;, &quot;p1&quot;, &quot;val1&quot;, &quot;p2&quot;, &quot;val2&quot;);</b>
&nbsp;
<b class="fc">&nbsp;            assertNotNull(a1.property(&quot;p1&quot;).value());</b>
<b class="fc">&nbsp;            assertNotNull(a1.property(&quot;p2&quot;).value());</b>
<b class="fc">&nbsp;            checkPropertyExistenceBeforeDeletion(schema, i1);</b>
<b class="fc">&nbsp;            this.sqlgGraph.tx().commit();</b>
&nbsp;
<b class="fc">&nbsp;            Object aid = a1.id();</b>
&nbsp;
<b class="fc">&nbsp;            checkPropertyExistenceBeforeDeletion(schema, i1);</b>
<b class="fc">&nbsp;            a1 = this.sqlgGraph.traversal().V(aid).next();</b>
<b class="fc">&nbsp;            assertNotNull(a1.property(&quot;p1&quot;).value());</b>
<b class="fc">&nbsp;            assertNotNull(a1.property(&quot;p2&quot;).value());</b>
&nbsp;
<b class="fc">&nbsp;            TopologyListenerTest tlt = new TopologyListenerTest();</b>
<b class="fc">&nbsp;            this.sqlgGraph.getTopology().registerListener(tlt);</b>
&nbsp;
<b class="fc">&nbsp;            VertexLabel lbl = this.sqlgGraph.getTopology().getVertexLabel(schema, &quot;A&quot;).orElseThrow(IllegalStateException::new);</b>
<b class="fc">&nbsp;            PropertyColumn p1 = lbl.getProperty(&quot;p1&quot;).orElseThrow(IllegalStateException::new);</b>
<b class="fc">&nbsp;            p1.remove(false);</b>
<b class="fc">&nbsp;            PropertyColumn p2 = lbl.getProperty(&quot;p2&quot;).orElseThrow(IllegalStateException::new);</b>
<b class="fc">&nbsp;            p2.remove(true);</b>
&nbsp;
<b class="fc">&nbsp;            assertTrue(tlt.receivedEvent(p1, TopologyChangeAction.DELETE));</b>
<b class="fc">&nbsp;            assertTrue(tlt.receivedEvent(p2, TopologyChangeAction.DELETE));</b>
&nbsp;
<b class="fc">&nbsp;            checkPropertyExistenceAfterDeletion(this.sqlgGraph, schema, i1);</b>
&nbsp;            /* doesn&#39;t work because the topology allTableCache is only updated after commit
&nbsp;            a1=this.sqlgGraph.traversal().V(aid).next();
&nbsp;			assertFalse(a1.property(&quot;p1&quot;).isPresent());
&nbsp;			assertFalse(a1.property(&quot;p2&quot;).isPresent());
&nbsp;			*/
<b class="fc">&nbsp;            if (rollback) {</b>
<b class="fc">&nbsp;                this.sqlgGraph.tx().rollback();</b>
<b class="fc">&nbsp;                checkPropertyExistenceBeforeDeletion(schema, i1);</b>
&nbsp;            } else {
<b class="fc">&nbsp;                TopologyListenerTest tlt1 = new TopologyListenerTest();</b>
<b class="fc">&nbsp;                sqlgGraph1.getTopology().registerListener(tlt1);</b>
<b class="fc">&nbsp;                this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;                checkPropertyExistenceAfterDeletion(this.sqlgGraph, schema, i1);</b>
&nbsp;
<b class="fc">&nbsp;                a1 = this.sqlgGraph.traversal().V(aid).next();</b>
<b class="fc">&nbsp;                assertFalse(a1.property(&quot;p1&quot;).isPresent());</b>
<b class="fc">&nbsp;                assertFalse(a1.property(&quot;p2&quot;).isPresent());</b>
&nbsp;
<b class="fc">&nbsp;                Thread.sleep(1_000);</b>
<b class="fc">&nbsp;                checkPropertyExistenceAfterDeletion(sqlgGraph1, schema, i1);</b>
<b class="fc">&nbsp;                assertTrue(tlt1.receivedEvent(p1, TopologyChangeAction.DELETE));</b>
<b class="fc">&nbsp;                assertTrue(tlt1.receivedEvent(p2, TopologyChangeAction.DELETE));</b>
&nbsp;            }
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;    @Test
&nbsp;    public void testDeleteEdgeProperty() throws Exception {
<b class="fc">&nbsp;        try (SqlgGraph sqlgGraph1 = SqlgGraph.open(configuration)) {</b>
<b class="fc">&nbsp;            String fullLabelA = getLabel(schema, &quot;A&quot;);</b>
<b class="fc">&nbsp;            String fullLabelB = getLabel(schema, &quot;B&quot;);</b>
<b class="fc">&nbsp;            Vertex a1 = this.sqlgGraph.addVertex(T.label, fullLabelA, &quot;name&quot;, &quot;A&quot;);</b>
<b class="fc">&nbsp;            Vertex b1 = this.sqlgGraph.addVertex(T.label, fullLabelB, &quot;name&quot;, &quot;B&quot;);</b>
<b class="fc">&nbsp;            Edge e1 = a1.addEdge(&quot;E&quot;, b1, &quot;p1&quot;, &quot;val1&quot;, &quot;p2&quot;, &quot;val2&quot;);</b>
&nbsp;
<b class="fc">&nbsp;            assertNotNull(e1.property(&quot;p1&quot;).value());</b>
<b class="fc">&nbsp;            assertNotNull(e1.property(&quot;p2&quot;).value());</b>
<b class="fc">&nbsp;            checkEdgePropertyExistenceBeforeDeletion(schema);</b>
<b class="fc">&nbsp;            sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;            Object eid = e1.id();</b>
<b class="fc">&nbsp;            checkEdgePropertyExistenceBeforeDeletion(schema);</b>
<b class="fc">&nbsp;            e1 = this.sqlgGraph.traversal().E(eid).next();</b>
<b class="fc">&nbsp;            assertNotNull(e1.property(&quot;p1&quot;).value());</b>
<b class="fc">&nbsp;            assertNotNull(e1.property(&quot;p2&quot;).value());</b>
&nbsp;
<b class="fc">&nbsp;            TopologyListenerTest tlt = new TopologyListenerTest();</b>
<b class="fc">&nbsp;            this.sqlgGraph.getTopology().registerListener(tlt);</b>
&nbsp;
<b class="fc">&nbsp;            EdgeLabel lbl = this.sqlgGraph.getTopology().getEdgeLabel(schema, &quot;E&quot;).orElseThrow(IllegalStateException::new);</b>
<b class="fc">&nbsp;            PropertyColumn p1 = lbl.getProperty(&quot;p1&quot;).orElseThrow(IllegalStateException::new);</b>
<b class="fc">&nbsp;            p1.remove(false);</b>
<b class="fc">&nbsp;            PropertyColumn p2 = lbl.getProperty(&quot;p2&quot;).orElseThrow(IllegalStateException::new);</b>
<b class="fc">&nbsp;            p2.remove(true);</b>
&nbsp;
<b class="fc">&nbsp;            assertTrue(tlt.receivedEvent(p1, TopologyChangeAction.DELETE));</b>
<b class="fc">&nbsp;            assertTrue(tlt.receivedEvent(p2, TopologyChangeAction.DELETE));</b>
&nbsp;
<b class="fc">&nbsp;            checkEdgePropertyExistenceAfterDeletion(this.sqlgGraph, schema);</b>
&nbsp;			/* doesn&#39;t work because the topology allTableCache is only updated after commit
&nbsp;			a1=this.sqlgGraph.traversal().V(aid).next();
&nbsp;			assertFalse(a1.property(&quot;p1&quot;).isPresent());
&nbsp;			assertFalse(a1.property(&quot;p2&quot;).isPresent());
&nbsp;			*/
<b class="fc">&nbsp;            if (rollback) {</b>
<b class="fc">&nbsp;                this.sqlgGraph.tx().rollback();</b>
<b class="fc">&nbsp;                checkEdgePropertyExistenceBeforeDeletion(schema);</b>
&nbsp;            } else {
<b class="fc">&nbsp;                TopologyListenerTest tlt1 = new TopologyListenerTest();</b>
<b class="fc">&nbsp;                sqlgGraph1.getTopology().registerListener(tlt1);</b>
<b class="fc">&nbsp;                this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;                checkEdgePropertyExistenceAfterDeletion(this.sqlgGraph, schema);</b>
&nbsp;
&nbsp;
<b class="fc">&nbsp;                e1 = this.sqlgGraph.traversal().E(eid).next();</b>
<b class="fc">&nbsp;                assertFalse(e1.property(&quot;p1&quot;).isPresent());</b>
<b class="fc">&nbsp;                assertFalse(e1.property(&quot;p2&quot;).isPresent());</b>
&nbsp;
<b class="fc">&nbsp;                Thread.sleep(1_000);</b>
<b class="fc">&nbsp;                checkEdgePropertyExistenceAfterDeletion(sqlgGraph1, schema);</b>
<b class="fc">&nbsp;                assertTrue(tlt1.receivedEvent(p1, TopologyChangeAction.DELETE));</b>
<b class="fc">&nbsp;                assertTrue(tlt1.receivedEvent(p2, TopologyChangeAction.DELETE));</b>
&nbsp;            }
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testDeleteVertexIndex() throws Exception {
<b class="fc">&nbsp;        try (SqlgGraph sqlgGraph1 = SqlgGraph.open(configuration)) {</b>
<b class="fc">&nbsp;            String fullLabel = getLabel(schema, &quot;A&quot;);</b>
<b class="fc">&nbsp;            this.sqlgGraph.addVertex(T.label, fullLabel, &quot;name&quot;, &quot;A&quot;, &quot;p1&quot;, &quot;val1&quot;, &quot;p2&quot;, &quot;val2&quot;);</b>
<b class="fc">&nbsp;            VertexLabel lbl = this.sqlgGraph.getTopology().getVertexLabel(schema, &quot;A&quot;).orElseThrow(IllegalStateException::new);</b>
&nbsp;
<b class="fc">&nbsp;            Index i1 = lbl.ensureIndexExists(IndexType.UNIQUE, Collections.singletonList(lbl.getProperty(&quot;p1&quot;).orElseThrow(IllegalStateException::new)));</b>
<b class="fc">&nbsp;            Index i2 = lbl.ensureIndexExists(IndexType.UNIQUE, Collections.singletonList(lbl.getProperty(&quot;p2&quot;).orElseThrow(IllegalStateException::new)));</b>
&nbsp;
&nbsp;
<b class="fc">&nbsp;            checkIndexExistenceBeforeDeletion(schema, i1, i2);</b>
<b class="fc">&nbsp;            this.sqlgGraph.tx().commit();</b>
&nbsp;
<b class="fc">&nbsp;            checkIndexExistenceBeforeDeletion(schema, i1, i2);</b>
&nbsp;
<b class="fc">&nbsp;            TopologyListenerTest tlt = new TopologyListenerTest();</b>
<b class="fc">&nbsp;            this.sqlgGraph.getTopology().registerListener(tlt);</b>
&nbsp;
<b class="fc">&nbsp;            i1.remove(false);</b>
<b class="fc">&nbsp;            i2.remove(true);</b>
&nbsp;
<b class="fc">&nbsp;            assertTrue(tlt.receivedEvent(i1, TopologyChangeAction.DELETE));</b>
<b class="fc">&nbsp;            assertTrue(tlt.receivedEvent(i2, TopologyChangeAction.DELETE));</b>
&nbsp;
<b class="fc">&nbsp;            checkIndexExistenceAfterDeletion(this.sqlgGraph, schema, i1, i2);</b>
&nbsp;
<b class="fc">&nbsp;            if (rollback) {</b>
<b class="fc">&nbsp;                this.sqlgGraph.tx().rollback();</b>
<b class="fc">&nbsp;                checkIndexExistenceBeforeDeletion(schema, i1, i2);</b>
&nbsp;            } else {
<b class="fc">&nbsp;                TopologyListenerTest tlt1 = new TopologyListenerTest();</b>
<b class="fc">&nbsp;                sqlgGraph1.getTopology().registerListener(tlt1);</b>
&nbsp;
<b class="fc">&nbsp;                this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;                checkIndexExistenceAfterDeletion(this.sqlgGraph, schema, i1, i2);</b>
&nbsp;
&nbsp;
<b class="fc">&nbsp;                Thread.sleep(5_000);</b>
<b class="fc">&nbsp;                checkIndexExistenceAfterDeletion(sqlgGraph1, schema, i1, i2);</b>
<b class="fc">&nbsp;                assertTrue(tlt1.receivedEvent(i1, TopologyChangeAction.DELETE));</b>
<b class="fc">&nbsp;                assertTrue(tlt1.receivedEvent(i2, TopologyChangeAction.DELETE));</b>
&nbsp;            }
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testDeleteEdgeIndex() throws Exception {
<b class="fc">&nbsp;        try (SqlgGraph sqlgGraph1 = SqlgGraph.open(configuration)) {</b>
<b class="fc">&nbsp;            String fullLabelA = getLabel(schema, &quot;A&quot;);</b>
<b class="fc">&nbsp;            String fullLabelB = getLabel(schema, &quot;B&quot;);</b>
<b class="fc">&nbsp;            Vertex a1 = this.sqlgGraph.addVertex(T.label, fullLabelA, &quot;name&quot;, &quot;A&quot;);</b>
<b class="fc">&nbsp;            Vertex b1 = this.sqlgGraph.addVertex(T.label, fullLabelB, &quot;name&quot;, &quot;B&quot;);</b>
<b class="fc">&nbsp;            a1.addEdge(&quot;E&quot;, b1, &quot;p1&quot;, &quot;val1&quot;, &quot;p2&quot;, &quot;val2&quot;);</b>
&nbsp;
<b class="fc">&nbsp;            EdgeLabel lbl = this.sqlgGraph.getTopology().getEdgeLabel(schema, &quot;E&quot;).orElseThrow(IllegalStateException::new);</b>
<b class="fc">&nbsp;            Index i1 = lbl.ensureIndexExists(IndexType.UNIQUE, Collections.singletonList(lbl.getProperty(&quot;p1&quot;).orElseThrow(IllegalStateException::new)));</b>
<b class="fc">&nbsp;            Index i2 = lbl.ensureIndexExists(IndexType.UNIQUE, Collections.singletonList(lbl.getProperty(&quot;p2&quot;).orElseThrow(IllegalStateException::new)));</b>
&nbsp;
&nbsp;
<b class="fc">&nbsp;            checkEdgeIndexExistenceBeforeDeletion(schema, i1, i2);</b>
<b class="fc">&nbsp;            this.sqlgGraph.tx().commit();</b>
&nbsp;
<b class="fc">&nbsp;            checkEdgeIndexExistenceBeforeDeletion(schema, i1, i2);</b>
&nbsp;
<b class="fc">&nbsp;            TopologyListenerTest tlt = new TopologyListenerTest();</b>
<b class="fc">&nbsp;            this.sqlgGraph.getTopology().registerListener(tlt);</b>
&nbsp;
<b class="fc">&nbsp;            i1.remove(false);</b>
<b class="fc">&nbsp;            i2.remove(true);</b>
&nbsp;
<b class="fc">&nbsp;            assertTrue(tlt.receivedEvent(i1, TopologyChangeAction.DELETE));</b>
<b class="fc">&nbsp;            assertTrue(tlt.receivedEvent(i2, TopologyChangeAction.DELETE));</b>
&nbsp;
<b class="fc">&nbsp;            checkEdgeIndexExistenceAfterDeletion(this.sqlgGraph, schema, i1, i2);</b>
<b class="fc">&nbsp;            if (rollback) {</b>
<b class="fc">&nbsp;                this.sqlgGraph.tx().rollback();</b>
<b class="fc">&nbsp;                checkEdgeIndexExistenceBeforeDeletion(schema, i1, i2);</b>
&nbsp;            } else {
&nbsp;
<b class="fc">&nbsp;                TopologyListenerTest tlt1 = new TopologyListenerTest();</b>
<b class="fc">&nbsp;                sqlgGraph1.getTopology().registerListener(tlt1);</b>
&nbsp;
<b class="fc">&nbsp;                this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;                checkEdgeIndexExistenceAfterDeletion(this.sqlgGraph, schema, i1, i2);</b>
&nbsp;
<b class="fc">&nbsp;                Thread.sleep(1_000);</b>
<b class="fc">&nbsp;                checkEdgeIndexExistenceAfterDeletion(sqlgGraph1, schema, i1, i2);</b>
<b class="fc">&nbsp;                assertTrue(tlt1.receivedEvent(i1, TopologyChangeAction.DELETE));</b>
<b class="fc">&nbsp;                assertTrue(tlt1.receivedEvent(i2, TopologyChangeAction.DELETE));</b>
&nbsp;            }
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testDeleteEdgeLabel() throws Exception {
<b class="fc">&nbsp;        try (SqlgGraph sqlgGraph1 = SqlgGraph.open(configuration)) {</b>
<b class="fc">&nbsp;            String fullLabelA = getLabel(schema, &quot;A&quot;);</b>
<b class="fc">&nbsp;            String fullLabelB = getLabel(schema, &quot;B&quot;);</b>
<b class="fc">&nbsp;            Vertex a1 = this.sqlgGraph.addVertex(T.label, fullLabelA, &quot;name&quot;, &quot;A&quot;);</b>
<b class="fc">&nbsp;            Vertex b1 = this.sqlgGraph.addVertex(T.label, fullLabelB, &quot;name&quot;, &quot;B1&quot;);</b>
<b class="fc">&nbsp;            Vertex b2 = this.sqlgGraph.addVertex(T.label, fullLabelB, &quot;name&quot;, &quot;B2&quot;);</b>
<b class="fc">&nbsp;            a1.addEdge(&quot;E1&quot;, b1);</b>
<b class="fc">&nbsp;            a1.addEdge(&quot;E2&quot;, b2);</b>
&nbsp;
&nbsp;
<b class="fc">&nbsp;            checkEdgeExistenceBeforeDeletion(this.sqlgGraph, schema);</b>
<b class="fc">&nbsp;            this.sqlgGraph.tx().commit();</b>
&nbsp;
<b class="fc">&nbsp;            checkEdgeExistenceBeforeDeletion(this.sqlgGraph, schema);</b>
<b class="fc">&nbsp;            Thread.sleep(1_000);</b>
<b class="fc">&nbsp;            checkEdgeExistenceBeforeDeletion(this.sqlgGraph1, schema);</b>
&nbsp;
<b class="fc">&nbsp;            TopologyListenerTest tlt = new TopologyListenerTest();</b>
<b class="fc">&nbsp;            this.sqlgGraph.getTopology().registerListener(tlt);</b>
&nbsp;
<b class="fc">&nbsp;            EdgeLabel e1 = this.sqlgGraph.getTopology().getEdgeLabel(schema, &quot;E1&quot;).orElseThrow(IllegalStateException::new);</b>
<b class="fc">&nbsp;            EdgeLabel e2 = this.sqlgGraph.getTopology().getEdgeLabel(schema, &quot;E2&quot;).orElseThrow(IllegalStateException::new);</b>
&nbsp;
<b class="fc">&nbsp;            e1.remove(false);</b>
<b class="fc">&nbsp;            e2.remove(true);</b>
&nbsp;
<b class="fc">&nbsp;            assertTrue(tlt.receivedEvent(e1, TopologyChangeAction.DELETE));</b>
<b class="fc">&nbsp;            assertTrue(tlt.receivedEvent(e2, TopologyChangeAction.DELETE));</b>
&nbsp;
<b class="fc">&nbsp;            checkEdgeExistenceAfterDeletion(this.sqlgGraph, schema);</b>
&nbsp;
<b class="fc">&nbsp;            if (rollback) {</b>
<b class="fc">&nbsp;                this.sqlgGraph.tx().rollback();</b>
<b class="fc">&nbsp;                checkEdgeExistenceBeforeDeletion(this.sqlgGraph, schema);</b>
&nbsp;            } else {
&nbsp;
<b class="fc">&nbsp;                TopologyListenerTest tlt1 = new TopologyListenerTest();</b>
<b class="fc">&nbsp;                sqlgGraph1.getTopology().registerListener(tlt1);</b>
<b class="fc">&nbsp;                this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;                checkEdgeExistenceAfterDeletion(this.sqlgGraph, schema);</b>
&nbsp;
&nbsp;
<b class="fc">&nbsp;                Thread.sleep(1_000);</b>
<b class="fc">&nbsp;                checkEdgeExistenceAfterDeletion(sqlgGraph1, schema);</b>
<b class="fc">&nbsp;                assertTrue(tlt1.receivedEvent(e1, TopologyChangeAction.DELETE));</b>
<b class="fc">&nbsp;                assertTrue(tlt1.receivedEvent(e2, TopologyChangeAction.DELETE));</b>
&nbsp;            }
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testDeleteEdgeRoleOut() throws Exception {
<b class="fc">&nbsp;        testDeleteEdgeRole(schema, &quot;MySchema2&quot;);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testDeleteEdgeRoleIn() throws Exception {
<b class="fc">&nbsp;        testDeleteEdgeRole(&quot;MySchema2&quot;, schema);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testDeleteVertexLabel() throws Exception {
<b class="fc">&nbsp;        try (SqlgGraph sqlgGraph1 = SqlgGraph.open(configuration)) {</b>
<b class="fc">&nbsp;            String A = getLabel(schema, &quot;A&quot;);</b>
<b class="fc">&nbsp;            String B = getLabel(schema, &quot;B&quot;);</b>
<b class="fc">&nbsp;            String C = getLabel(schema, &quot;C&quot;);</b>
<b class="fc">&nbsp;            String D = getLabel(schema, &quot;D&quot;);</b>
<b class="fc">&nbsp;            Vertex a = this.sqlgGraph.addVertex(T.label, A, &quot;name&quot;, &quot;A&quot;);</b>
<b class="fc">&nbsp;            Vertex b = this.sqlgGraph.addVertex(T.label, B, &quot;name&quot;, &quot;B&quot;);</b>
<b class="fc">&nbsp;            Vertex c = this.sqlgGraph.addVertex(T.label, C, &quot;name&quot;, &quot;C&quot;, &quot;p1&quot;, &quot;v1&quot;);</b>
<b class="fc">&nbsp;            Vertex d = this.sqlgGraph.addVertex(T.label, D, &quot;name&quot;, &quot;D&quot;, &quot;p1&quot;, &quot;v1&quot;);</b>
<b class="fc">&nbsp;            a.addEdge(&quot;E&quot;, b);</b>
<b class="fc">&nbsp;            b.addEdge(&quot;E&quot;, c);</b>
<b class="fc">&nbsp;            c.addEdge(&quot;E&quot;, d);</b>
<b class="fc">&nbsp;            b.addEdge(&quot;E1&quot;, c);</b>
<b class="fc">&nbsp;            c.addEdge(&quot;E2&quot;, d);</b>
&nbsp;
&nbsp;            //checkVertexLabelBeforeDeletion(sqlgGraph,schema);
<b class="fc">&nbsp;            this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;            checkVertexLabelBeforeDeletion(sqlgGraph, schema);</b>
<b class="fc">&nbsp;            Thread.sleep(1_000);</b>
<b class="fc">&nbsp;            checkVertexLabelBeforeDeletion(sqlgGraph1, schema);</b>
&nbsp;
<b class="fc">&nbsp;            checkCount(sqlgGraph.traversal().V().hasLabel(C), 1);</b>
<b class="fc">&nbsp;            checkCount(sqlgGraph1.traversal().V().hasLabel(C), 1);</b>
&nbsp;            // clear locks on the tables we&#39;re going to modify
<b class="fc">&nbsp;            sqlgGraph.tx().rollback();</b>
<b class="fc">&nbsp;            sqlgGraph1.tx().rollback();</b>
&nbsp;
&nbsp;
<b class="fc">&nbsp;            TopologyListenerTest tlt = new TopologyListenerTest();</b>
<b class="fc">&nbsp;            this.sqlgGraph.getTopology().registerListener(tlt);</b>
&nbsp;
<b class="fc">&nbsp;            Optional&lt;EdgeLabel&gt; oelbl1 = this.sqlgGraph.getTopology().getEdgeLabel(schema, &quot;E1&quot;);</b>
<b class="fc">&nbsp;            assertTrue(oelbl1.isPresent());</b>
<b class="fc">&nbsp;            Optional&lt;EdgeLabel&gt; oelbl2 = this.sqlgGraph.getTopology().getEdgeLabel(schema, &quot;E2&quot;);</b>
<b class="fc">&nbsp;            assertTrue(oelbl2.isPresent());</b>
&nbsp;
<b class="fc">&nbsp;            VertexLabel lblc = this.sqlgGraph.getTopology().getVertexLabel(schema, &quot;C&quot;).orElseThrow(IllegalStateException::new);</b>
<b class="fc">&nbsp;            lblc.remove(this.preserve);</b>
<b class="fc">&nbsp;            assertTrue(tlt.receivedEvent(lblc, TopologyChangeAction.DELETE));</b>
&nbsp;
<b class="fc">&nbsp;            assertTrue(tlt.receivedEvent(oelbl1.get(), TopologyChangeAction.DELETE));</b>
<b class="fc">&nbsp;            assertTrue(tlt.receivedEvent(oelbl2.get(), TopologyChangeAction.DELETE));</b>
&nbsp;
<b class="fc">&nbsp;            assertFalse(this.sqlgGraph.getTopology().getAllTables().containsKey(lblc.getName()));</b>
<b class="fc">&nbsp;            assertFalse(this.sqlgGraph.getTopology().getAllTables().containsKey(oelbl1.orElseThrow(IllegalStateException::new).getName()));</b>
<b class="fc">&nbsp;            assertFalse(this.sqlgGraph.getTopology().getAllTables().containsKey(oelbl2.orElseThrow(IllegalStateException::new).getName()));</b>
&nbsp;
&nbsp;
<b class="fc">&nbsp;            checkCount(sqlgGraph.traversal().V().hasLabel(C), 0);</b>
&nbsp;
&nbsp;			/*VertexLabel lbld=this.sqlgGraph.getTopology().getVertexLabel(schema, &quot;D&quot;).get();
&nbsp;			lbld.remove(true);
&nbsp;			assertTrue(tlt.receivedEvent(lbld, TopologyChangeAction.DELETE));
&nbsp;			*/
<b class="fc">&nbsp;            if (rollback) {</b>
<b class="fc">&nbsp;                sqlgGraph.tx().rollback();</b>
<b class="fc">&nbsp;                checkVertexLabelBeforeDeletion(sqlgGraph, schema);</b>
&nbsp;
<b class="fc">&nbsp;                checkCount(sqlgGraph.traversal().V().hasLabel(C), 1);</b>
&nbsp;
&nbsp;            } else {
&nbsp;                //checkVertexLabelAfterDeletion(sqlgGraph,schema);
<b class="fc">&nbsp;                TopologyListenerTest tlt1 = new TopologyListenerTest();</b>
<b class="fc">&nbsp;                sqlgGraph1.getTopology().registerListener(tlt1);</b>
&nbsp;
<b class="fc">&nbsp;                oelbl1 = sqlgGraph1.getTopology().getEdgeLabel(schema, &quot;E1&quot;);</b>
<b class="fc">&nbsp;                assertTrue(oelbl1.isPresent());</b>
<b class="fc">&nbsp;                oelbl2 = sqlgGraph1.getTopology().getEdgeLabel(schema, &quot;E2&quot;);</b>
<b class="fc">&nbsp;                assertTrue(oelbl2.isPresent());</b>
&nbsp;
<b class="fc">&nbsp;                lblc = sqlgGraph1.getTopology().getVertexLabel(schema, &quot;C&quot;).orElseThrow(IllegalStateException::new);</b>
&nbsp;
&nbsp;
<b class="fc">&nbsp;                sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;                checkVertexLabelAfterDeletion(sqlgGraph, schema);</b>
<b class="fc">&nbsp;                checkCount(sqlgGraph.traversal().V().hasLabel(C), 0);</b>
&nbsp;
&nbsp;
<b class="fc">&nbsp;                Thread.sleep(1_000);</b>
<b class="fc">&nbsp;                checkVertexLabelAfterDeletion(sqlgGraph1, schema);</b>
<b class="fc">&nbsp;                checkCount(sqlgGraph1.traversal().V().hasLabel(C), 0);</b>
&nbsp;
&nbsp;
<b class="fc">&nbsp;                assertTrue(tlt1.receivedEvent(lblc, TopologyChangeAction.DELETE));</b>
&nbsp;
<b class="fc">&nbsp;                assertTrue(tlt1.receivedEvent(oelbl1.get(), TopologyChangeAction.DELETE));</b>
<b class="fc">&nbsp;                assertTrue(tlt1.receivedEvent(oelbl2.get(), TopologyChangeAction.DELETE));</b>
&nbsp;
<b class="fc">&nbsp;                assertFalse(sqlgGraph1.getTopology().getAllTables().containsKey(lblc.getName()));</b>
<b class="fc">&nbsp;                assertFalse(sqlgGraph1.getTopology().getAllTables().containsKey(oelbl1.orElseThrow(IllegalStateException::new).getName()));</b>
<b class="fc">&nbsp;                assertFalse(sqlgGraph1.getTopology().getAllTables().containsKey(oelbl2.orElseThrow(IllegalStateException::new).getName()));</b>
&nbsp;
&nbsp;
&nbsp;				/*VertexLabel lblb=this.sqlgGraph.getTopology().getVertexLabel(schema, &quot;B&quot;).get();
&nbsp;				lblb.remove(true);
&nbsp;				assertTrue(tlt.receivedEvent(lblb, TopologyChangeAction.DELETE));
&nbsp;
&nbsp;				assertFalse(sqlgGraph.getTopology().getEdgeLabel(schema, &quot;E&quot;).isPresent());
&nbsp;
&nbsp;				TopologyListenerTest tlt1=new TopologyListenerTest();
&nbsp;				sqlgGraph1.getTopology().registerListener(tlt1);
&nbsp;
&nbsp;				sqlgGraph.tx().commit();
&nbsp;				assertFalse(sqlgGraph.getTopology().getEdgeLabel(schema, &quot;E&quot;).isPresent());
&nbsp;				Thread.sleep(1_000);
&nbsp;				assertFalse(sqlgGraph1.getTopology().getEdgeLabel(schema, &quot;E&quot;).isPresent());
&nbsp;				assertTrue(tlt1.receivedEvent(lblb, TopologyChangeAction.DELETE));*/
&nbsp;            }
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void checkEdgePropertyExistenceBeforeDeletion(String schema) throws Exception {
<b class="fc">&nbsp;        Optional&lt;EdgeLabel&gt; olbl = this.sqlgGraph.getTopology().getEdgeLabel(schema, &quot;E&quot;);</b>
<b class="fc">&nbsp;        assertNotNull(olbl);</b>
<b class="fc">&nbsp;        assertTrue(olbl.isPresent());</b>
<b class="fc">&nbsp;        assertTrue(olbl.get().getProperty(&quot;p1&quot;).isPresent());</b>
<b class="fc">&nbsp;        assertTrue(olbl.get().getProperty(&quot;p2&quot;).isPresent());</b>
&nbsp;
<b class="fc">&nbsp;        assertEquals(1L, this.sqlgGraph.topology().V().hasLabel(SQLG_SCHEMA + &quot;.&quot; + SQLG_SCHEMA_SCHEMA).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, schema)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_SCHEMA_VERTEX_EDGE).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, &quot;A&quot;)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_OUT_EDGES_EDGE).has(SQLG_SCHEMA_EDGE_LABEL_NAME, &quot;E&quot;)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_EDGE_PROPERTIES_EDGE).has(SQLG_SCHEMA_PROPERTY_NAME, &quot;p1&quot;).count().next().longValue());</b>
&nbsp;
<b class="fc">&nbsp;        assertEquals(1L, this.sqlgGraph.topology().V().hasLabel(SQLG_SCHEMA + &quot;.&quot; + SQLG_SCHEMA_SCHEMA).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, schema)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_SCHEMA_VERTEX_EDGE).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, &quot;A&quot;)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_OUT_EDGES_EDGE).has(SQLG_SCHEMA_EDGE_LABEL_NAME, &quot;E&quot;)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_EDGE_PROPERTIES_EDGE).has(SQLG_SCHEMA_PROPERTY_NAME, &quot;p2&quot;).count().next().longValue());</b>
&nbsp;
<b class="fc">&nbsp;        assertTrue(columnExistsInSQL(schema, EDGE_PREFIX + &quot;E&quot;, &quot;p1&quot;));</b>
<b class="fc">&nbsp;        assertTrue(columnExistsInSQL(schema, EDGE_PREFIX + &quot;E&quot;, &quot;p2&quot;));</b>
&nbsp;
&nbsp;    }
&nbsp;
&nbsp;    private void checkEdgePropertyExistenceAfterDeletion(SqlgGraph g, String schema) throws Exception {
<b class="fc">&nbsp;        Optional&lt;EdgeLabel&gt; olbl = g.getTopology().getEdgeLabel(schema, &quot;E&quot;);</b>
<b class="fc">&nbsp;        assertNotNull(olbl);</b>
<b class="fc">&nbsp;        assertTrue(olbl.isPresent());</b>
<b class="fc">&nbsp;        assertFalse(olbl.get().getProperty(&quot;p1&quot;).isPresent());</b>
<b class="fc">&nbsp;        assertFalse(olbl.get().getProperty(&quot;p2&quot;).isPresent());</b>
&nbsp;
<b class="fc">&nbsp;        assertEquals(0L, g.topology().V().hasLabel(SQLG_SCHEMA + &quot;.&quot; + SQLG_SCHEMA_SCHEMA).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, schema)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_SCHEMA_VERTEX_EDGE).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, &quot;A&quot;)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_OUT_EDGES_EDGE).has(SQLG_SCHEMA_EDGE_LABEL_NAME, &quot;E&quot;)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_EDGE_PROPERTIES_EDGE).has(SQLG_SCHEMA_PROPERTY_NAME, &quot;p1&quot;).count().next().longValue());</b>
&nbsp;
<b class="fc">&nbsp;        assertEquals(0L, g.topology().V().hasLabel(SQLG_SCHEMA + &quot;.&quot; + SQLG_SCHEMA_SCHEMA).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, schema)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_SCHEMA_VERTEX_EDGE).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, &quot;A&quot;)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_OUT_EDGES_EDGE).has(SQLG_SCHEMA_EDGE_LABEL_NAME, &quot;E&quot;)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_EDGE_PROPERTIES_EDGE).has(SQLG_SCHEMA_PROPERTY_NAME, &quot;p2&quot;).count().next().longValue());</b>
&nbsp;
<b class="fc">&nbsp;        assertFalse(columnExistsInSQL(schema, EDGE_PREFIX + &quot;E&quot;, &quot;p1&quot;));</b>
<b class="fc">&nbsp;        assertTrue(columnExistsInSQL(schema, EDGE_PREFIX + &quot;E&quot;, &quot;p2&quot;));</b>
&nbsp;
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;    private void checkIndexExistenceBeforeDeletion(String schema, Index i1, Index i2) throws Exception {
<b class="fc">&nbsp;        Optional&lt;VertexLabel&gt; olbl = this.sqlgGraph.getTopology().getVertexLabel(schema, &quot;A&quot;);</b>
<b class="fc">&nbsp;        assertNotNull(olbl);</b>
<b class="fc">&nbsp;        assertTrue(olbl.isPresent());</b>
<b class="fc">&nbsp;        assertTrue(olbl.get().getIndex(i1.getName()).isPresent());</b>
<b class="fc">&nbsp;        assertTrue(olbl.get().getIndex(i2.getName()).isPresent());</b>
&nbsp;
<b class="fc">&nbsp;        assertEquals(1L, this.sqlgGraph.topology().V().hasLabel(SQLG_SCHEMA + &quot;.&quot; + SQLG_SCHEMA_SCHEMA).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, schema)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_SCHEMA_VERTEX_EDGE).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, &quot;A&quot;)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_VERTEX_INDEX_EDGE).has(SQLG_SCHEMA_INDEX_NAME, i1.getName()).count().next().longValue());</b>
&nbsp;
<b class="fc">&nbsp;        assertEquals(1L, this.sqlgGraph.topology().V().hasLabel(SQLG_SCHEMA + &quot;.&quot; + SQLG_SCHEMA_SCHEMA).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, schema)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_SCHEMA_VERTEX_EDGE).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, &quot;A&quot;)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_VERTEX_INDEX_EDGE).has(SQLG_SCHEMA_INDEX_NAME, i2.getName()).count().next().longValue());</b>
&nbsp;
<b class="fc">&nbsp;        assertTrue(indexExistsInSQL(schema, VERTEX_PREFIX + &quot;A&quot;, i1.getName()));</b>
<b class="fc">&nbsp;        assertTrue(indexExistsInSQL(schema, VERTEX_PREFIX + &quot;A&quot;, i2.getName()));</b>
&nbsp;
&nbsp;    }
&nbsp;
&nbsp;    private void checkIndexExistenceAfterDeletion(SqlgGraph g, String schema, Index i1, Index i2) throws Exception {
<b class="fc">&nbsp;        Optional&lt;VertexLabel&gt; olbl = g.getTopology().getVertexLabel(schema, &quot;A&quot;);</b>
<b class="fc">&nbsp;        assertNotNull(olbl);</b>
<b class="fc">&nbsp;        assertTrue(olbl.isPresent());</b>
<b class="fc">&nbsp;        assertFalse(olbl.get().getProperty(i1.getName()).isPresent());</b>
<b class="fc">&nbsp;        assertFalse(olbl.get().getProperty(i2.getName()).isPresent());</b>
&nbsp;
<b class="fc">&nbsp;        assertEquals(0L, g.topology().V().hasLabel(SQLG_SCHEMA + &quot;.&quot; + SQLG_SCHEMA_SCHEMA).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, schema)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_SCHEMA_VERTEX_EDGE).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, &quot;A&quot;)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_VERTEX_INDEX_EDGE).has(SQLG_SCHEMA_INDEX_NAME, i1.getName()).count().next().longValue());</b>
&nbsp;
<b class="fc">&nbsp;        assertEquals(0L, g.topology().V().hasLabel(SQLG_SCHEMA + &quot;.&quot; + SQLG_SCHEMA_SCHEMA).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, schema)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_SCHEMA_VERTEX_EDGE).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, &quot;A&quot;)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_VERTEX_INDEX_EDGE).has(SQLG_SCHEMA_INDEX_NAME, i2.getName()).count().next().longValue());</b>
&nbsp;
<b class="fc">&nbsp;        assertFalse(indexExistsInSQL(schema, VERTEX_PREFIX + &quot;A&quot;, i1.getName()));</b>
<b class="fc">&nbsp;        assertTrue(indexExistsInSQL(schema, VERTEX_PREFIX + &quot;A&quot;, i2.getName()));</b>
&nbsp;
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;    private void checkEdgeIndexExistenceBeforeDeletion(String schema, Index i1, Index i2) throws Exception {
<b class="fc">&nbsp;        Optional&lt;EdgeLabel&gt; olbl = sqlgGraph.getTopology().getEdgeLabel(schema, &quot;E&quot;);</b>
<b class="fc">&nbsp;        assertNotNull(olbl);</b>
<b class="fc">&nbsp;        assertTrue(olbl.isPresent());</b>
<b class="fc">&nbsp;        assertTrue(olbl.get().getIndex(i1.getName()).isPresent());</b>
<b class="fc">&nbsp;        assertTrue(olbl.get().getIndex(i2.getName()).isPresent());</b>
&nbsp;
<b class="fc">&nbsp;        assertEquals(1L, this.sqlgGraph.topology().V().hasLabel(SQLG_SCHEMA + &quot;.&quot; + SQLG_SCHEMA_SCHEMA).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, schema)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_SCHEMA_VERTEX_EDGE).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, &quot;A&quot;)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_OUT_EDGES_EDGE).has(SQLG_SCHEMA_EDGE_LABEL_NAME, &quot;E&quot;)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_EDGE_INDEX_EDGE).has(SQLG_SCHEMA_INDEX_NAME, i1.getName()).count().next().longValue());</b>
&nbsp;
<b class="fc">&nbsp;        assertEquals(1L, this.sqlgGraph.topology().V().hasLabel(SQLG_SCHEMA + &quot;.&quot; + SQLG_SCHEMA_SCHEMA).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, schema)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_SCHEMA_VERTEX_EDGE).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, &quot;A&quot;)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_OUT_EDGES_EDGE).has(SQLG_SCHEMA_EDGE_LABEL_NAME, &quot;E&quot;)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_EDGE_INDEX_EDGE).has(SQLG_SCHEMA_INDEX_NAME, i2.getName()).count().next().longValue());</b>
&nbsp;
<b class="fc">&nbsp;        assertTrue(indexExistsInSQL(schema, EDGE_PREFIX + &quot;E&quot;, i1.getName()));</b>
<b class="fc">&nbsp;        assertTrue(indexExistsInSQL(schema, EDGE_PREFIX + &quot;E&quot;, i2.getName()));</b>
&nbsp;
&nbsp;    }
&nbsp;
&nbsp;    private void checkEdgeIndexExistenceAfterDeletion(SqlgGraph g, String schema, Index i1, Index i2) throws Exception {
<b class="fc">&nbsp;        Optional&lt;EdgeLabel&gt; olbl = g.getTopology().getEdgeLabel(schema, &quot;E&quot;);</b>
<b class="fc">&nbsp;        assertNotNull(olbl);</b>
<b class="fc">&nbsp;        assertTrue(olbl.isPresent());</b>
<b class="fc">&nbsp;        assertFalse(olbl.get().getProperty(i1.getName()).isPresent());</b>
<b class="fc">&nbsp;        assertFalse(olbl.get().getProperty(i2.getName()).isPresent());</b>
&nbsp;
<b class="fc">&nbsp;        assertEquals(0L, g.topology().V().hasLabel(SQLG_SCHEMA + &quot;.&quot; + SQLG_SCHEMA_SCHEMA).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, schema)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_SCHEMA_VERTEX_EDGE).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, &quot;A&quot;)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_OUT_EDGES_EDGE).has(SQLG_SCHEMA_EDGE_LABEL_NAME, &quot;E&quot;)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_EDGE_INDEX_EDGE).has(SQLG_SCHEMA_INDEX_NAME, i1.getName()).count().next().longValue());</b>
&nbsp;
<b class="fc">&nbsp;        assertEquals(0L, g.topology().V().hasLabel(SQLG_SCHEMA + &quot;.&quot; + SQLG_SCHEMA_SCHEMA).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, schema)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_SCHEMA_VERTEX_EDGE).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, &quot;A&quot;)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_OUT_EDGES_EDGE).has(SQLG_SCHEMA_EDGE_LABEL_NAME, &quot;E&quot;)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_EDGE_INDEX_EDGE).has(SQLG_SCHEMA_INDEX_NAME, i2.getName()).count().next().longValue());</b>
&nbsp;
<b class="fc">&nbsp;        assertFalse(indexExistsInSQL(schema, EDGE_PREFIX + &quot;E&quot;, i1.getName()));</b>
<b class="fc">&nbsp;        assertTrue(indexExistsInSQL(schema, EDGE_PREFIX + &quot;E&quot;, i2.getName()));</b>
&nbsp;
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;    private void checkEdgeExistenceBeforeDeletion(SqlgGraph g, String schema) throws Exception {
<b class="fc">&nbsp;        Optional&lt;EdgeLabel&gt; olbl = g.getTopology().getEdgeLabel(schema, &quot;E1&quot;);</b>
<b class="fc">&nbsp;        assertNotNull(olbl);</b>
<b class="fc">&nbsp;        assertTrue(olbl.isPresent());</b>
<b class="fc">&nbsp;        olbl = g.getTopology().getEdgeLabel(schema, &quot;E2&quot;);</b>
<b class="fc">&nbsp;        assertNotNull(olbl);</b>
<b class="fc">&nbsp;        assertTrue(olbl.isPresent());</b>
&nbsp;
<b class="fc">&nbsp;        VertexLabel a = g.getTopology().getVertexLabel(schema, &quot;A&quot;).orElseThrow(IllegalStateException::new);</b>
<b class="fc">&nbsp;        assertTrue(a.getOutEdgeLabel(&quot;E1&quot;).isPresent());</b>
<b class="fc">&nbsp;        assertTrue(a.getOutEdgeLabel(&quot;E2&quot;).isPresent());</b>
&nbsp;
&nbsp;
<b class="fc">&nbsp;        assertEquals(1L, g.topology().V().hasLabel(SQLG_SCHEMA + &quot;.&quot; + SQLG_SCHEMA_SCHEMA).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, schema)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_SCHEMA_VERTEX_EDGE).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, &quot;A&quot;)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_OUT_EDGES_EDGE).has(SQLG_SCHEMA_EDGE_LABEL_NAME, &quot;E1&quot;).count().next().longValue());</b>
&nbsp;
<b class="fc">&nbsp;        assertEquals(1L, g.topology().V().hasLabel(SQLG_SCHEMA + &quot;.&quot; + SQLG_SCHEMA_SCHEMA).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, schema)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_SCHEMA_VERTEX_EDGE).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, &quot;A&quot;)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_OUT_EDGES_EDGE).has(SQLG_SCHEMA_EDGE_LABEL_NAME, &quot;E2&quot;).count().next().longValue());</b>
&nbsp;
<b class="fc">&nbsp;        assertTrue(tableExistsInSQL(schema, EDGE_PREFIX + &quot;E1&quot;));</b>
<b class="fc">&nbsp;        assertTrue(tableExistsInSQL(schema, EDGE_PREFIX + &quot;E2&quot;));</b>
&nbsp;
&nbsp;    }
&nbsp;
&nbsp;    private void checkEdgeExistenceAfterDeletion(SqlgGraph g, String schema) throws Exception {
<b class="fc">&nbsp;        Optional&lt;EdgeLabel&gt; olbl = g.getTopology().getEdgeLabel(schema, &quot;E1&quot;);</b>
<b class="fc">&nbsp;        assertNotNull(olbl);</b>
<b class="fc">&nbsp;        assertFalse(olbl.isPresent());</b>
<b class="fc">&nbsp;        olbl = g.getTopology().getEdgeLabel(schema, &quot;E2&quot;);</b>
<b class="fc">&nbsp;        assertNotNull(olbl);</b>
<b class="fc">&nbsp;        assertFalse(olbl.isPresent());</b>
&nbsp;
<b class="fc">&nbsp;        VertexLabel a = g.getTopology().getVertexLabel(schema, &quot;A&quot;).orElseThrow(IllegalStateException::new);</b>
<b class="fc">&nbsp;        assertFalse(a.getOutEdgeLabel(&quot;E1&quot;).isPresent());</b>
<b class="fc">&nbsp;        assertFalse(a.getOutEdgeLabel(&quot;E2&quot;).isPresent());</b>
&nbsp;
<b class="fc">&nbsp;        assertEquals(0L, g.topology().V().hasLabel(SQLG_SCHEMA + &quot;.&quot; + SQLG_SCHEMA_SCHEMA).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, schema)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_SCHEMA_VERTEX_EDGE).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, &quot;A&quot;)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_OUT_EDGES_EDGE).has(SQLG_SCHEMA_EDGE_LABEL_NAME, &quot;E1&quot;).count().next().longValue());</b>
&nbsp;
<b class="fc">&nbsp;        assertEquals(0L, g.topology().V().hasLabel(SQLG_SCHEMA + &quot;.&quot; + SQLG_SCHEMA_SCHEMA).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, schema)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_SCHEMA_VERTEX_EDGE).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, &quot;A&quot;)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_OUT_EDGES_EDGE).has(SQLG_SCHEMA_EDGE_LABEL_NAME, &quot;E2&quot;).count().next().longValue());</b>
&nbsp;
<b class="fc">&nbsp;        assertFalse(tableExistsInSQL(schema, EDGE_PREFIX + &quot;E1&quot;));</b>
<b class="fc">&nbsp;        assertTrue(tableExistsInSQL(schema, EDGE_PREFIX + &quot;E2&quot;));</b>
&nbsp;
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;    private void checkEdgeRoleExistenceBeforeDeletion(String schemaOut, String schemaIn) throws Exception {
<b class="fc">&nbsp;        Optional&lt;EdgeLabel&gt; olbl = this.sqlgGraph.getTopology().getEdgeLabel(schemaOut, &quot;E1&quot;);</b>
<b class="fc">&nbsp;        assertNotNull(olbl);</b>
<b class="fc">&nbsp;        assertTrue(olbl.isPresent());</b>
&nbsp;
<b class="fc">&nbsp;        VertexLabel a = this.sqlgGraph.getTopology().getVertexLabel(schemaOut, &quot;A&quot;).orElseThrow(IllegalStateException::new);</b>
<b class="fc">&nbsp;        VertexLabel b = this.sqlgGraph.getTopology().getVertexLabel(schemaOut, &quot;B&quot;).orElseThrow(IllegalStateException::new);</b>
<b class="fc">&nbsp;        VertexLabel pa = this.sqlgGraph.getTopology().getVertexLabel(schemaIn, &quot;A&quot;).orElseThrow(IllegalStateException::new);</b>
<b class="fc">&nbsp;        VertexLabel pb = this.sqlgGraph.getTopology().getVertexLabel(schemaIn, &quot;B&quot;).orElseThrow(IllegalStateException::new);</b>
<b class="fc">&nbsp;        assertEquals(1, a.getOutEdgeLabels().size());</b>
<b class="fc">&nbsp;        assertEquals(1, b.getOutEdgeLabels().size());</b>
<b class="fc">&nbsp;        assertEquals(1, pb.getInEdgeLabels().size());</b>
<b class="fc">&nbsp;        assertEquals(1, pa.getInEdgeLabels().size());</b>
&nbsp;
<b class="fc">&nbsp;        Set&lt;VertexLabel&gt; inLbls = olbl.get().getInVertexLabels();</b>
<b class="fc">&nbsp;        assertEquals(2, inLbls.size());</b>
<b class="fc">&nbsp;        assertTrue(inLbls.contains(pa));</b>
<b class="fc">&nbsp;        assertTrue(inLbls.contains(pb));</b>
&nbsp;
<b class="fc">&nbsp;        Set&lt;EdgeRole&gt; inRoles = olbl.get().getInEdgeRoles();</b>
<b class="fc">&nbsp;        assertEquals(2, inRoles.size());</b>
&nbsp;
&nbsp;
<b class="fc">&nbsp;        Set&lt;VertexLabel&gt; outLbls = olbl.get().getOutVertexLabels();</b>
<b class="fc">&nbsp;        assertEquals(2, outLbls.size());</b>
<b class="fc">&nbsp;        assertTrue(outLbls.contains(a));</b>
<b class="fc">&nbsp;        assertTrue(outLbls.contains(b));</b>
&nbsp;
<b class="fc">&nbsp;        Set&lt;EdgeRole&gt; outRoles = olbl.get().getOutEdgeRoles();</b>
<b class="fc">&nbsp;        assertEquals(2, outRoles.size());</b>
&nbsp;
&nbsp;
<b class="fc">&nbsp;        assertTrue(tableExistsInSQL(schemaOut, EDGE_PREFIX + &quot;E1&quot;));</b>
<b class="fc">&nbsp;        assertTrue(columnExistsInSQL(schemaOut, EDGE_PREFIX + &quot;E1&quot;, schemaOut + &quot;.A&quot; + Topology.OUT_VERTEX_COLUMN_END));</b>
<b class="fc">&nbsp;        assertTrue(columnExistsInSQL(schemaOut, EDGE_PREFIX + &quot;E1&quot;, schemaOut + &quot;.B&quot; + Topology.OUT_VERTEX_COLUMN_END));</b>
<b class="fc">&nbsp;        assertTrue(columnExistsInSQL(schemaOut, EDGE_PREFIX + &quot;E1&quot;, schemaIn + &quot;.A&quot; + Topology.IN_VERTEX_COLUMN_END));</b>
<b class="fc">&nbsp;        assertTrue(columnExistsInSQL(schemaOut, EDGE_PREFIX + &quot;E1&quot;, schemaIn + &quot;.B&quot; + Topology.IN_VERTEX_COLUMN_END));</b>
&nbsp;    }
&nbsp;
&nbsp;    private void checkEdgeRoleExistenceAfterRoleDeletion(SqlgGraph g, String schemaOut, String schemaIn) throws Exception {
<b class="fc">&nbsp;        Optional&lt;EdgeLabel&gt; optionalEdgeLabel = g.getTopology().getEdgeLabel(schemaOut, &quot;E1&quot;);</b>
<b class="fc">&nbsp;        assertNotNull(optionalEdgeLabel);</b>
<b class="fc">&nbsp;        assertTrue(optionalEdgeLabel.isPresent());</b>
&nbsp;
<b class="fc">&nbsp;        VertexLabel a = g.getTopology().getVertexLabel(schemaOut, &quot;A&quot;).orElseThrow(IllegalStateException::new);</b>
<b class="fc">&nbsp;        VertexLabel b = g.getTopology().getVertexLabel(schemaOut, &quot;B&quot;).orElseThrow(IllegalStateException::new);</b>
<b class="fc">&nbsp;        VertexLabel pa = g.getTopology().getVertexLabel(schemaIn, &quot;A&quot;).orElseThrow(IllegalStateException::new);</b>
<b class="fc">&nbsp;        VertexLabel pb = g.getTopology().getVertexLabel(schemaIn, &quot;B&quot;).orElseThrow(IllegalStateException::new);</b>
<b class="fc">&nbsp;        assertEquals(1, a.getOutEdgeLabels().size());</b>
<b class="fc">&nbsp;        assertEquals(0, b.getOutEdgeLabels().size());</b>
<b class="fc">&nbsp;        assertEquals(1, pb.getInEdgeLabels().size());</b>
<b class="fc">&nbsp;        assertEquals(0, pa.getInEdgeLabels().size());</b>
&nbsp;
<b class="fc">&nbsp;        Set&lt;VertexLabel&gt; inLbls = optionalEdgeLabel.get().getInVertexLabels();</b>
<b class="fc">&nbsp;        assertEquals(1, inLbls.size());</b>
<b class="fc">&nbsp;        assertFalse(inLbls.contains(pa));</b>
<b class="fc">&nbsp;        assertTrue(inLbls.contains(pb));</b>
&nbsp;
<b class="fc">&nbsp;        Set&lt;EdgeRole&gt; inRoles = optionalEdgeLabel.get().getInEdgeRoles();</b>
<b class="fc">&nbsp;        assertEquals(1, inRoles.size());</b>
<b class="fc">&nbsp;        assertEquals(&quot;B&quot;, inRoles.iterator().next().getVertexLabel().getName());</b>
&nbsp;
&nbsp;
<b class="fc">&nbsp;        Set&lt;VertexLabel&gt; outLbls = optionalEdgeLabel.get().getOutVertexLabels();</b>
<b class="fc">&nbsp;        assertEquals(1, outLbls.size());</b>
<b class="fc">&nbsp;        assertTrue(outLbls.contains(a));</b>
<b class="fc">&nbsp;        assertFalse(outLbls.contains(b));</b>
&nbsp;
<b class="fc">&nbsp;        Set&lt;EdgeRole&gt; outRoles = optionalEdgeLabel.get().getOutEdgeRoles();</b>
<b class="fc">&nbsp;        assertEquals(1, outRoles.size());</b>
<b class="fc">&nbsp;        assertEquals(&quot;A&quot;, outRoles.iterator().next().getVertexLabel().getName());</b>
&nbsp;
<b class="fc">&nbsp;        assertTrue(tableExistsInSQL(schemaOut, EDGE_PREFIX + &quot;E1&quot;));</b>
<b class="fc">&nbsp;        assertTrue(columnExistsInSQL(schemaOut, EDGE_PREFIX + &quot;E1&quot;, schemaOut + &quot;.A&quot; + Topology.OUT_VERTEX_COLUMN_END));</b>
<b class="fc">&nbsp;        assertFalse(columnExistsInSQL(schemaOut, EDGE_PREFIX + &quot;E1&quot;, schemaOut + &quot;.B&quot; + Topology.OUT_VERTEX_COLUMN_END));</b>
<b class="fc">&nbsp;        assertTrue(columnExistsInSQL(schemaOut, EDGE_PREFIX + &quot;E1&quot;, schemaIn + &quot;.A&quot; + Topology.IN_VERTEX_COLUMN_END));</b>
<b class="fc">&nbsp;        assertTrue(columnExistsInSQL(schemaOut, EDGE_PREFIX + &quot;E1&quot;, schemaIn + &quot;.B&quot; + Topology.IN_VERTEX_COLUMN_END));</b>
&nbsp;    }
&nbsp;
&nbsp;    private void testDeleteEdgeRole(String schemaOut, String schemaIn) throws Exception {
<b class="fc">&nbsp;        try (SqlgGraph sqlgGraph1 = SqlgGraph.open(configuration)) {</b>
<b class="fc">&nbsp;            String Aout = getLabel(schemaOut, &quot;A&quot;);</b>
<b class="fc">&nbsp;            String Bout = getLabel(schemaOut, &quot;B&quot;);</b>
<b class="fc">&nbsp;            String Ain = getLabel(schemaIn, &quot;A&quot;);</b>
<b class="fc">&nbsp;            String Bin = getLabel(schemaIn, &quot;B&quot;);</b>
<b class="fc">&nbsp;            Vertex a1 = this.sqlgGraph.addVertex(T.label, Aout, &quot;name&quot;, &quot;A1&quot;);</b>
<b class="fc">&nbsp;            Vertex a2 = this.sqlgGraph.addVertex(T.label, Ain, &quot;name&quot;, &quot;A2&quot;);</b>
&nbsp;
<b class="fc">&nbsp;            Vertex b1 = this.sqlgGraph.addVertex(T.label, Bout, &quot;name&quot;, &quot;B1&quot;);</b>
<b class="fc">&nbsp;            Vertex b2 = this.sqlgGraph.addVertex(T.label, Bin, &quot;name&quot;, &quot;B2&quot;);</b>
<b class="fc">&nbsp;            a1.addEdge(&quot;E1&quot;, b2);</b>
<b class="fc">&nbsp;            b1.addEdge(&quot;E1&quot;, a2);</b>
&nbsp;
&nbsp;            //checkEdgeRoleExistenceBeforeDeletion();
<b class="fc">&nbsp;            this.sqlgGraph.tx().commit();</b>
&nbsp;
<b class="fc">&nbsp;            checkEdgeRoleExistenceBeforeDeletion(schemaOut, schemaIn);</b>
&nbsp;
<b class="fc">&nbsp;            TopologyListenerTest tlt = new TopologyListenerTest();</b>
<b class="fc">&nbsp;            this.sqlgGraph.getTopology().registerListener(tlt);</b>
&nbsp;
&nbsp;
<b class="fc">&nbsp;            EdgeLabel lbl = this.sqlgGraph.getTopology().getEdgeLabel(schemaOut, &quot;E1&quot;).get();</b>
<b class="fc">&nbsp;            for (EdgeRole er : lbl.getOutEdgeRoles()) {</b>
<b class="fc">&nbsp;                if (er.getVertexLabel().getName().equals(&quot;B&quot;)) {</b>
<b class="fc">&nbsp;                    er.remove(false);</b>
<b class="fc">&nbsp;                    assertTrue(tlt.receivedEvent(er, TopologyChangeAction.DELETE));</b>
&nbsp;
&nbsp;                }
&nbsp;            }
<b class="fc">&nbsp;            for (EdgeRole er : lbl.getInEdgeRoles()) {</b>
<b class="fc">&nbsp;                if (er.getVertexLabel().getName().equals(&quot;A&quot;)) {</b>
<b class="fc">&nbsp;                    er.remove(true);</b>
<b class="fc">&nbsp;                    assertTrue(tlt.receivedEvent(er, TopologyChangeAction.DELETE));</b>
&nbsp;
&nbsp;                }
&nbsp;            }
<b class="fc">&nbsp;            if (rollback) {</b>
<b class="fc">&nbsp;                this.sqlgGraph.tx().rollback();</b>
<b class="fc">&nbsp;                checkEdgeRoleExistenceBeforeDeletion(schemaOut, schemaIn);</b>
&nbsp;
&nbsp;            } else {
<b class="fc">&nbsp;                this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;                checkEdgeRoleExistenceAfterRoleDeletion(this.sqlgGraph, schemaOut, schemaIn);</b>
<b class="fc">&nbsp;                Thread.sleep(10_000);</b>
<b class="fc">&nbsp;                checkEdgeRoleExistenceAfterRoleDeletion(sqlgGraph1, schemaOut, schemaIn);</b>
&nbsp;
<b class="fc">&nbsp;                assertFalse(b1.edges(Direction.OUT, &quot;E1&quot;).hasNext());</b>
<b class="fc">&nbsp;                assertTrue(a1.edges(Direction.OUT, &quot;E1&quot;).hasNext());</b>
&nbsp;
<b class="fc">&nbsp;                lbl.getOutEdgeRoles().iterator().next().remove(false);</b>
<b class="fc">&nbsp;                assertFalse(this.sqlgGraph.getTopology().getEdgeLabel(schemaOut, &quot;E1&quot;).isPresent());</b>
<b class="fc">&nbsp;                this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;                assertFalse(this.sqlgGraph.getTopology().getEdgeLabel(schemaOut, &quot;E1&quot;).isPresent());</b>
&nbsp;            }
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void checkVertexLabelBeforeDeletion(SqlgGraph g, String schema) throws Exception {
<b class="fc">&nbsp;        Optional&lt;VertexLabel&gt; olbl = g.getTopology().getVertexLabel(schema, &quot;A&quot;);</b>
<b class="fc">&nbsp;        assertNotNull(olbl);</b>
<b class="fc">&nbsp;        assertTrue(olbl.isPresent());</b>
&nbsp;
<b class="fc">&nbsp;        olbl = g.getTopology().getVertexLabel(schema, &quot;B&quot;);</b>
<b class="fc">&nbsp;        assertNotNull(olbl);</b>
<b class="fc">&nbsp;        assertTrue(olbl.isPresent());</b>
&nbsp;
<b class="fc">&nbsp;        olbl = g.getTopology().getVertexLabel(schema, &quot;C&quot;);</b>
<b class="fc">&nbsp;        assertNotNull(olbl);</b>
<b class="fc">&nbsp;        assertTrue(olbl.isPresent());</b>
&nbsp;
<b class="fc">&nbsp;        olbl = g.getTopology().getVertexLabel(schema, &quot;D&quot;);</b>
<b class="fc">&nbsp;        assertNotNull(olbl);</b>
<b class="fc">&nbsp;        assertTrue(olbl.isPresent());</b>
&nbsp;
<b class="fc">&nbsp;        assertEquals(1L, g.topology().V().hasLabel(SQLG_SCHEMA + &quot;.&quot; + SQLG_SCHEMA_SCHEMA).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, schema)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_SCHEMA_VERTEX_EDGE).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, &quot;A&quot;).count().next().longValue());</b>
&nbsp;
<b class="fc">&nbsp;        assertEquals(1L, g.topology().V().hasLabel(SQLG_SCHEMA + &quot;.&quot; + SQLG_SCHEMA_SCHEMA).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, schema)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_SCHEMA_VERTEX_EDGE).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, &quot;B&quot;).count().next().longValue());</b>
&nbsp;
<b class="fc">&nbsp;        assertEquals(1L, g.topology().V().hasLabel(SQLG_SCHEMA + &quot;.&quot; + SQLG_SCHEMA_SCHEMA).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, schema)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_SCHEMA_VERTEX_EDGE).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, &quot;C&quot;).count().next().longValue());</b>
&nbsp;
<b class="fc">&nbsp;        assertEquals(1L, g.topology().V().hasLabel(SQLG_SCHEMA + &quot;.&quot; + SQLG_SCHEMA_SCHEMA).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, schema)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_SCHEMA_VERTEX_EDGE).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, &quot;D&quot;).count().next().longValue());</b>
&nbsp;
&nbsp;
<b class="fc">&nbsp;        assertTrue(tableExistsInSQL(schema, VERTEX_PREFIX + &quot;A&quot;));</b>
<b class="fc">&nbsp;        assertTrue(tableExistsInSQL(schema, VERTEX_PREFIX + &quot;B&quot;));</b>
<b class="fc">&nbsp;        assertTrue(tableExistsInSQL(schema, VERTEX_PREFIX + &quot;C&quot;));</b>
<b class="fc">&nbsp;        assertTrue(tableExistsInSQL(schema, VERTEX_PREFIX + &quot;D&quot;));</b>
&nbsp;
&nbsp;
<b class="fc">&nbsp;        Optional&lt;EdgeLabel&gt; oelbl = g.getTopology().getEdgeLabel(schema, &quot;E&quot;);</b>
<b class="fc">&nbsp;        assertNotNull(oelbl);</b>
<b class="fc">&nbsp;        assertTrue(oelbl.isPresent());</b>
<b class="fc">&nbsp;        EdgeLabel elbl = oelbl.get();</b>
<b class="fc">&nbsp;        assertEquals(3, elbl.getInVertexLabels().size());</b>
<b class="fc">&nbsp;        assertEquals(3, elbl.getOutVertexLabels().size());</b>
&nbsp;
<b class="fc">&nbsp;        oelbl = g.getTopology().getEdgeLabel(schema, &quot;E1&quot;);</b>
<b class="fc">&nbsp;        assertNotNull(oelbl);</b>
<b class="fc">&nbsp;        assertTrue(oelbl.isPresent());</b>
<b class="fc">&nbsp;        elbl = oelbl.get();</b>
<b class="fc">&nbsp;        assertEquals(1, elbl.getInVertexLabels().size());</b>
<b class="fc">&nbsp;        assertEquals(1, elbl.getOutVertexLabels().size());</b>
&nbsp;
<b class="fc">&nbsp;        oelbl = g.getTopology().getEdgeLabel(schema, &quot;E2&quot;);</b>
<b class="fc">&nbsp;        assertNotNull(oelbl);</b>
<b class="fc">&nbsp;        assertTrue(oelbl.isPresent());</b>
<b class="fc">&nbsp;        elbl = oelbl.get();</b>
<b class="fc">&nbsp;        assertEquals(1, elbl.getInVertexLabels().size());</b>
<b class="fc">&nbsp;        assertEquals(1, elbl.getOutVertexLabels().size());</b>
&nbsp;    }
&nbsp;
&nbsp;    private void checkVertexLabelAfterDeletion(SqlgGraph g, String schema) throws Exception {
<b class="fc">&nbsp;        Optional&lt;VertexLabel&gt; olbl = g.getTopology().getVertexLabel(schema, &quot;A&quot;);</b>
<b class="fc">&nbsp;        assertNotNull(olbl);</b>
<b class="fc">&nbsp;        assertTrue(olbl.isPresent());</b>
&nbsp;
<b class="fc">&nbsp;        olbl = g.getTopology().getVertexLabel(schema, &quot;B&quot;);</b>
<b class="fc">&nbsp;        assertNotNull(olbl);</b>
<b class="fc">&nbsp;        assertTrue(olbl.isPresent());</b>
&nbsp;
<b class="fc">&nbsp;        olbl = g.getTopology().getVertexLabel(schema, &quot;C&quot;);</b>
<b class="fc">&nbsp;        assertNotNull(olbl);</b>
<b class="fc">&nbsp;        assertFalse(olbl.isPresent());</b>
&nbsp;
<b class="fc">&nbsp;        olbl = g.getTopology().getVertexLabel(schema, &quot;D&quot;);</b>
<b class="fc">&nbsp;        assertNotNull(olbl);</b>
<b class="fc">&nbsp;        assertTrue(olbl.isPresent());</b>
&nbsp;
<b class="fc">&nbsp;        assertEquals(1L, g.topology().V().hasLabel(SQLG_SCHEMA + &quot;.&quot; + SQLG_SCHEMA_SCHEMA).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, schema)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_SCHEMA_VERTEX_EDGE).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, &quot;A&quot;).count().next().longValue());</b>
&nbsp;
<b class="fc">&nbsp;        assertEquals(1L, g.topology().V().hasLabel(SQLG_SCHEMA + &quot;.&quot; + SQLG_SCHEMA_SCHEMA).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, schema)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_SCHEMA_VERTEX_EDGE).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, &quot;B&quot;).count().next().longValue());</b>
&nbsp;
<b class="fc">&nbsp;        assertEquals(0L, g.topology().V().hasLabel(SQLG_SCHEMA + &quot;.&quot; + SQLG_SCHEMA_SCHEMA).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, schema)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_SCHEMA_VERTEX_EDGE).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, &quot;C&quot;).count().next().longValue());</b>
&nbsp;
<b class="fc">&nbsp;        assertEquals(1L, g.topology().V().hasLabel(SQLG_SCHEMA + &quot;.&quot; + SQLG_SCHEMA_SCHEMA).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, schema)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_SCHEMA_VERTEX_EDGE).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, &quot;D&quot;).count().next().longValue());</b>
&nbsp;
&nbsp;
<b class="fc">&nbsp;        assertTrue(tableExistsInSQL(schema, VERTEX_PREFIX + &quot;A&quot;));</b>
<b class="fc">&nbsp;        assertTrue(tableExistsInSQL(schema, VERTEX_PREFIX + &quot;B&quot;));</b>
<b class="fc">&nbsp;        if (preserve) {</b>
<b class="fc">&nbsp;            assertTrue(tableExistsInSQL(schema, VERTEX_PREFIX + &quot;C&quot;));</b>
&nbsp;        } else {
<b class="fc">&nbsp;            assertFalse(tableExistsInSQL(schema, VERTEX_PREFIX + &quot;C&quot;));</b>
&nbsp;        }
<b class="fc">&nbsp;        assertTrue(tableExistsInSQL(schema, VERTEX_PREFIX + &quot;D&quot;));</b>
&nbsp;
&nbsp;
<b class="fc">&nbsp;        Optional&lt;EdgeLabel&gt; oelbl = g.getTopology().getEdgeLabel(schema, &quot;E&quot;);</b>
<b class="fc">&nbsp;        assertNotNull(oelbl);</b>
<b class="fc">&nbsp;        assertTrue(oelbl.isPresent());</b>
<b class="fc">&nbsp;        EdgeLabel elbl = oelbl.get();</b>
<b class="fc">&nbsp;        assertEquals(2, elbl.getInVertexLabels().size());</b>
<b class="fc">&nbsp;        assertEquals(2, elbl.getOutVertexLabels().size());</b>
&nbsp;
<b class="fc">&nbsp;        oelbl = g.getTopology().getEdgeLabel(schema, &quot;E1&quot;);</b>
<b class="fc">&nbsp;        assertNotNull(oelbl);</b>
<b class="fc">&nbsp;        assertFalse(oelbl.isPresent());</b>
&nbsp;
<b class="fc">&nbsp;        oelbl = g.getTopology().getEdgeLabel(schema, &quot;E2&quot;);</b>
<b class="fc">&nbsp;        assertNotNull(oelbl);</b>
<b class="fc">&nbsp;        assertFalse(oelbl.isPresent());</b>
&nbsp;    }
&nbsp;
&nbsp;    private void checkCount(GraphTraversal&lt;?, ?&gt; gt, long count) throws Exception {
&nbsp;        try {
<b class="fc">&nbsp;            assertEquals(count, gt.count().next().longValue());</b>
&nbsp;        } finally {
&nbsp;            gt.close();
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void testSchemaBeforeDeletion(SqlgGraph g, String schema) throws Exception {
<b class="fc">&nbsp;        Optional&lt;Schema&gt; osch = g.getTopology().getSchema(schema);</b>
<b class="fc">&nbsp;        assertNotNull(osch);</b>
<b class="fc">&nbsp;        assertTrue(osch.isPresent());</b>
<b class="fc">&nbsp;        Schema sch = osch.get();</b>
<b class="fc">&nbsp;        assertTrue(g.getTopology().getSchemas().contains(sch));</b>
&nbsp;
<b class="fc">&nbsp;        assertEquals(1, g.topology().V().has(SQLG_SCHEMA + &quot;.&quot; + SQLG_SCHEMA_SCHEMA,</b>
<b class="fc">&nbsp;                &quot;name&quot;, schema).count().next().longValue());</b>
<b class="fc">&nbsp;        assertEquals(2, g.topology().V().has(SQLG_SCHEMA + &quot;.&quot; + SQLG_SCHEMA_SCHEMA,</b>
<b class="fc">&nbsp;                &quot;name&quot;, schema).out(SQLG_SCHEMA_SCHEMA_VERTEX_EDGE).count().next().longValue());</b>
<b class="fc">&nbsp;        assertEquals(1, g.topology().V().has(SQLG_SCHEMA + &quot;.&quot; + SQLG_SCHEMA_SCHEMA,</b>
<b class="fc">&nbsp;                &quot;name&quot;, schema).out(SQLG_SCHEMA_SCHEMA_VERTEX_EDGE).has(&quot;name&quot;, &quot;A&quot;)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_VERTEX_PROPERTIES_EDGE)</b>
<b class="fc">&nbsp;                .count().next().longValue());</b>
<b class="fc">&nbsp;        assertEquals(1, g.topology().V().has(SQLG_SCHEMA + &quot;.&quot; + SQLG_SCHEMA_SCHEMA,</b>
<b class="fc">&nbsp;                &quot;name&quot;, schema).out(SQLG_SCHEMA_SCHEMA_VERTEX_EDGE).has(&quot;name&quot;, &quot;B&quot;)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_VERTEX_PROPERTIES_EDGE)</b>
<b class="fc">&nbsp;                .count().next().longValue());</b>
<b class="fc">&nbsp;        assertEquals(1, g.topology().V().has(SQLG_SCHEMA + &quot;.&quot; + SQLG_SCHEMA_SCHEMA,</b>
<b class="fc">&nbsp;                &quot;name&quot;, schema).out(SQLG_SCHEMA_SCHEMA_VERTEX_EDGE).has(&quot;name&quot;, &quot;A&quot;)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_VERTEX_INDEX_EDGE)</b>
<b class="fc">&nbsp;                .count().next().longValue());</b>
<b class="fc">&nbsp;        assertEquals(1, g.topology().V().has(SQLG_SCHEMA + &quot;.&quot; + SQLG_SCHEMA_SCHEMA,</b>
<b class="fc">&nbsp;                &quot;name&quot;, schema).out(SQLG_SCHEMA_SCHEMA_VERTEX_EDGE).has(&quot;name&quot;, &quot;A&quot;)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_OUT_EDGES_EDGE).has(&quot;name&quot;, &quot;E&quot;)</b>
<b class="fc">&nbsp;                .count().next().longValue());</b>
<b class="fc">&nbsp;        assertEquals(1, g.topology().V().has(SQLG_SCHEMA + &quot;.&quot; + SQLG_SCHEMA_SCHEMA,</b>
<b class="fc">&nbsp;                &quot;name&quot;, schema).out(SQLG_SCHEMA_SCHEMA_VERTEX_EDGE).has(&quot;name&quot;, &quot;A&quot;)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_OUT_EDGES_EDGE).has(&quot;name&quot;, &quot;E&quot;)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_EDGE_INDEX_EDGE)</b>
<b class="fc">&nbsp;                .count().next().longValue());</b>
<b class="fc">&nbsp;        assertTrue(schemaExistsInSQL(schema));</b>
&nbsp;    }
&nbsp;
&nbsp;    private void testSchemaAfterDeletion(SqlgGraph g, String schema, boolean preserveData) throws Exception {
<b class="fc">&nbsp;        Optional&lt;Schema&gt; osch = g.getTopology().getSchema(schema);</b>
<b class="fc">&nbsp;        assertNotNull(osch);</b>
<b class="fc">&nbsp;        assertFalse(osch.isPresent());</b>
&nbsp;
<b class="fc">&nbsp;        for (Schema s : g.getTopology().getSchemas()) {</b>
<b class="fc">&nbsp;            assertNotEquals(s.getName(), schema);</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        assertEquals(0, g.topology().V().has(SQLG_SCHEMA + &quot;.&quot; + SQLG_SCHEMA_SCHEMA,</b>
<b class="fc">&nbsp;                &quot;name&quot;, schema).count().next().longValue());</b>
<b class="fc">&nbsp;        assertEquals(0, g.topology().V().has(SQLG_SCHEMA + &quot;.&quot; + SQLG_SCHEMA_VERTEX_LABEL,</b>
&nbsp;                &quot;name&quot;, &quot;A&quot;)
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_VERTEX_PROPERTIES_EDGE)</b>
<b class="fc">&nbsp;                .count().next().longValue());</b>
<b class="fc">&nbsp;        assertEquals(0, g.topology().V().has(SQLG_SCHEMA + &quot;.&quot; + SQLG_SCHEMA_VERTEX_LABEL, &quot;name&quot;, &quot;B&quot;)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_VERTEX_PROPERTIES_EDGE)</b>
<b class="fc">&nbsp;                .count().next().longValue());</b>
<b class="fc">&nbsp;        assertEquals(0, g.topology().V().has(SQLG_SCHEMA + &quot;.&quot; + Topology.SQLG_SCHEMA_EDGE_LABEL,</b>
&nbsp;                &quot;name&quot;, &quot;E&quot;)
<b class="fc">&nbsp;                .count().next().longValue());</b>
&nbsp;
<b class="fc">&nbsp;        if (preserveData) {</b>
<b class="fc">&nbsp;            assertTrue(schemaExistsInSQL(schema));</b>
&nbsp;        } else {
<b class="fc">&nbsp;            assertFalse(schemaExistsInSQL(schema));</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;    private void testSchemaWithOtherEdges(SqlgGraph g, String schema, String otherSchema) throws Exception {
<b class="fc">&nbsp;        Optional&lt;Schema&gt; osch = g.getTopology().getSchema(schema);</b>
<b class="fc">&nbsp;        assertNotNull(osch);</b>
<b class="fc">&nbsp;        assertTrue(osch.isPresent());</b>
<b class="fc">&nbsp;        Optional&lt;VertexLabel&gt; ovl = osch.get().getVertexLabel(&quot;B&quot;);</b>
<b class="fc">&nbsp;        assertNotNull(ovl);</b>
<b class="fc">&nbsp;        assertTrue(ovl.isPresent());</b>
&nbsp;
<b class="fc">&nbsp;        osch = g.getTopology().getSchema(otherSchema);</b>
<b class="fc">&nbsp;        assertNotNull(osch);</b>
<b class="fc">&nbsp;        assertTrue(osch.isPresent());</b>
&nbsp;
<b class="fc">&nbsp;        Optional&lt;EdgeLabel&gt; oel = osch.get().getEdgeLabel(&quot;E&quot;);</b>
<b class="fc">&nbsp;        assertNotNull(oel);</b>
<b class="fc">&nbsp;        assertTrue(oel.isPresent());</b>
&nbsp;
<b class="fc">&nbsp;        Set&lt;VertexLabel&gt; vls = oel.get().getInVertexLabels();</b>
<b class="fc">&nbsp;        assertTrue(vls.contains(ovl.get()));</b>
&nbsp;
<b class="fc">&nbsp;        assertEquals(1L, g.topology().V().hasLabel(SQLG_SCHEMA + &quot;.&quot; + SQLG_SCHEMA_SCHEMA).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, otherSchema)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_SCHEMA_VERTEX_EDGE).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, &quot;A&quot;)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_OUT_EDGES_EDGE).has(SQLG_SCHEMA_EDGE_LABEL_NAME, &quot;E&quot;).count().next().longValue());</b>
&nbsp;
<b class="fc">&nbsp;        assertEquals(1L, g.topology().V().hasLabel(SQLG_SCHEMA + &quot;.&quot; + SQLG_SCHEMA_SCHEMA).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, schema)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_SCHEMA_VERTEX_EDGE).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, &quot;B&quot;)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_IN_EDGES_EDGE).has(SQLG_SCHEMA_EDGE_LABEL_NAME, &quot;E&quot;).count().next().longValue());</b>
&nbsp;
<b class="fc">&nbsp;        assertTrue(tableExistsInSQL(otherSchema, EDGE_PREFIX + &quot;E&quot;));</b>
&nbsp;
&nbsp;    }
&nbsp;
&nbsp;    private void testSchemaWithOtherEdgesAfterDeletion(SqlgGraph g, String schema, String otherSchema) throws Exception {
<b class="fc">&nbsp;        Optional&lt;Schema&gt; osch = g.getTopology().getSchema(schema);</b>
<b class="fc">&nbsp;        assertNotNull(osch);</b>
<b class="fc">&nbsp;        assertFalse(osch.isPresent());</b>
&nbsp;
<b class="fc">&nbsp;        osch = g.getTopology().getSchema(otherSchema);</b>
<b class="fc">&nbsp;        assertNotNull(osch);</b>
<b class="fc">&nbsp;        assertTrue(osch.isPresent());</b>
&nbsp;
<b class="fc">&nbsp;        Optional&lt;EdgeLabel&gt; oel = osch.get().getEdgeLabel(&quot;E&quot;);</b>
<b class="fc">&nbsp;        assertNotNull(oel);</b>
<b class="fc">&nbsp;        assertFalse(oel.isPresent());</b>
&nbsp;
&nbsp;
<b class="fc">&nbsp;        assertEquals(0L, g.topology().V().hasLabel(SQLG_SCHEMA + &quot;.&quot; + SQLG_SCHEMA_SCHEMA).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, otherSchema)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_SCHEMA_VERTEX_EDGE).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, &quot;A&quot;)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_OUT_EDGES_EDGE).has(SQLG_SCHEMA_EDGE_LABEL_NAME, &quot;E&quot;).count().next().longValue());</b>
&nbsp;
<b class="fc">&nbsp;        assertEquals(0L, g.topology().V().hasLabel(SQLG_SCHEMA + &quot;.&quot; + SQLG_SCHEMA_SCHEMA).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, schema)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_SCHEMA_VERTEX_EDGE).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, &quot;B&quot;)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_IN_EDGES_EDGE).has(SQLG_SCHEMA_EDGE_LABEL_NAME, &quot;E&quot;).count().next().longValue());</b>
&nbsp;
<b class="fc">&nbsp;        if (preserve) {</b>
<b class="fc">&nbsp;            assertTrue(tableExistsInSQL(otherSchema, EDGE_PREFIX + &quot;E&quot;));</b>
&nbsp;        } else {
<b class="fc">&nbsp;            assertFalse(tableExistsInSQL(otherSchema, EDGE_PREFIX + &quot;E&quot;));</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private String getLabel(String schema, String type) {
<b class="fc">&nbsp;        return schema.equals(this.sqlgGraph.getSqlDialect().getPublicSchema()) ? type : schema + &quot;.&quot; + type;</b>
&nbsp;    }
&nbsp;
&nbsp;    private boolean schemaExistsInSQL(String schema) throws SQLException {
<b class="fc">&nbsp;        try (ResultSet rs = this.sqlgGraph.tx().getConnection().getMetaData().getSchemas(null, schema)) {</b>
<b class="fc">&nbsp;            return rs.next();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private boolean tableExistsInSQL(String schema, String table) throws SQLException {
<b class="fc">&nbsp;        try (ResultSet rs = this.sqlgGraph.tx().getConnection().getMetaData().getTables(null, schema, table, null)) {</b>
<b class="fc">&nbsp;            return rs.next();</b>
&nbsp;        }
&nbsp;
&nbsp;    }
&nbsp;
&nbsp;    private boolean columnExistsInSQL(String schema, String table, String column) throws SQLException {
<b class="fc">&nbsp;        return !this.sqlgGraph.getSqlDialect().getTableColumns(</b>
<b class="fc">&nbsp;                this.sqlgGraph.tx().getConnection().getMetaData(),</b>
&nbsp;                null, schema, table, column
<b class="fc">&nbsp;        ).isEmpty();</b>
&nbsp;    }
&nbsp;
&nbsp;    private boolean indexExistsInSQL(String schema, String table, String index) throws SQLException {
<b class="fc">&nbsp;        try (ResultSet rs = this.sqlgGraph.tx().getConnection().getMetaData().getIndexInfo(null, schema, table, false, false)) {</b>
<b class="fc">&nbsp;            while (rs.next()) {</b>
<b class="fc">&nbsp;                String in = rs.getString(&quot;INDEX_NAME&quot;);</b>
<b class="fc">&nbsp;                if (index.equals(in)) {</b>
<b class="fc">&nbsp;                    return true;</b>
&nbsp;                }
&nbsp;            }
<b class="fc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;
&nbsp;    }
&nbsp;
&nbsp;    private void checkPropertyExistenceBeforeDeletion(String schema) throws Exception {
<b class="fc">&nbsp;        checkPropertyExistenceBeforeDeletion(schema, null);</b>
&nbsp;    }
&nbsp;
&nbsp;    private void checkPropertyExistenceBeforeDeletion(String schema, Index index) throws Exception {
<b class="fc">&nbsp;        Optional&lt;VertexLabel&gt; olbl = this.sqlgGraph.getTopology().getVertexLabel(schema, &quot;A&quot;);</b>
<b class="fc">&nbsp;        assertNotNull(olbl);</b>
<b class="fc">&nbsp;        assertTrue(olbl.isPresent());</b>
<b class="fc">&nbsp;        assertTrue(olbl.get().getProperty(&quot;p1&quot;).isPresent());</b>
<b class="fc">&nbsp;        assertTrue(olbl.get().getProperty(&quot;p2&quot;).isPresent());</b>
&nbsp;
<b class="fc">&nbsp;        assertEquals(1L, this.sqlgGraph.topology().V().hasLabel(SQLG_SCHEMA + &quot;.&quot; + SQLG_SCHEMA_SCHEMA).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, schema)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_SCHEMA_VERTEX_EDGE).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, &quot;A&quot;)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_VERTEX_PROPERTIES_EDGE).has(SQLG_SCHEMA_PROPERTY_NAME, &quot;p1&quot;).count().next().longValue());</b>
&nbsp;
<b class="fc">&nbsp;        if (index != null) {</b>
<b class="fc">&nbsp;            assertEquals(1L, this.sqlgGraph.topology().V().hasLabel(SQLG_SCHEMA + &quot;.&quot; + SQLG_SCHEMA_SCHEMA).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, schema)</b>
<b class="fc">&nbsp;                    .out(SQLG_SCHEMA_SCHEMA_VERTEX_EDGE).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, &quot;A&quot;)</b>
<b class="fc">&nbsp;                    .out(SQLG_SCHEMA_VERTEX_INDEX_EDGE).has(SQLG_SCHEMA_INDEX_NAME, index.getName()).count().next().longValue());</b>
<b class="fc">&nbsp;            assertTrue(indexExistsInSQL(schema, VERTEX_PREFIX + &quot;A&quot;, index.getName()));</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        assertEquals(1L, this.sqlgGraph.topology().V().hasLabel(SQLG_SCHEMA + &quot;.&quot; + SQLG_SCHEMA_SCHEMA).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, schema)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_SCHEMA_VERTEX_EDGE).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, &quot;A&quot;)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_VERTEX_PROPERTIES_EDGE).has(SQLG_SCHEMA_PROPERTY_NAME, &quot;p2&quot;).count().next().longValue());</b>
&nbsp;
<b class="fc">&nbsp;        assertTrue(columnExistsInSQL(schema, VERTEX_PREFIX + &quot;A&quot;, &quot;p1&quot;));</b>
<b class="fc">&nbsp;        assertTrue(columnExistsInSQL(schema, VERTEX_PREFIX + &quot;A&quot;, &quot;p2&quot;));</b>
&nbsp;
&nbsp;    }
&nbsp;
&nbsp;    private void checkPropertyExistenceAfterDeletion(SqlgGraph g, String schema) throws Exception {
<b class="fc">&nbsp;        checkPropertyExistenceAfterDeletion(g, schema, null);</b>
&nbsp;    }
&nbsp;
&nbsp;    private void checkPropertyExistenceAfterDeletion(SqlgGraph g, String schema, Index index) throws Exception {
<b class="fc">&nbsp;        Optional&lt;VertexLabel&gt; olbl = g.getTopology().getVertexLabel(schema, &quot;A&quot;);</b>
<b class="fc">&nbsp;        assertNotNull(olbl);</b>
<b class="fc">&nbsp;        assertTrue(olbl.isPresent());</b>
<b class="fc">&nbsp;        assertFalse(olbl.get().getProperty(&quot;p1&quot;).isPresent());</b>
<b class="fc">&nbsp;        assertFalse(olbl.get().getProperty(&quot;p2&quot;).isPresent());</b>
&nbsp;
<b class="fc">&nbsp;        assertEquals(0L, g.topology().V().hasLabel(SQLG_SCHEMA + &quot;.&quot; + SQLG_SCHEMA_SCHEMA).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, schema)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_SCHEMA_VERTEX_EDGE).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, &quot;A&quot;)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_VERTEX_PROPERTIES_EDGE).has(SQLG_SCHEMA_PROPERTY_NAME, &quot;p1&quot;).count().next().longValue());</b>
&nbsp;
<b class="fc">&nbsp;        if (index != null) {</b>
<b class="fc">&nbsp;            assertEquals(0L, g.topology().V().hasLabel(SQLG_SCHEMA + &quot;.&quot; + SQLG_SCHEMA_SCHEMA).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, schema)</b>
<b class="fc">&nbsp;                    .out(SQLG_SCHEMA_SCHEMA_VERTEX_EDGE).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, &quot;A&quot;)</b>
<b class="fc">&nbsp;                    .out(SQLG_SCHEMA_VERTEX_INDEX_EDGE).has(SQLG_SCHEMA_INDEX_NAME, index.getName()).count().next().longValue());</b>
<b class="fc">&nbsp;            assertFalse(indexExistsInSQL(schema, VERTEX_PREFIX + &quot;A&quot;, index.getName()));</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        assertEquals(0L, g.topology().V().hasLabel(SQLG_SCHEMA + &quot;.&quot; + SQLG_SCHEMA_SCHEMA).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, schema)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_SCHEMA_VERTEX_EDGE).has(SQLG_SCHEMA_VERTEX_LABEL_NAME, &quot;A&quot;)</b>
<b class="fc">&nbsp;                .out(SQLG_SCHEMA_VERTEX_PROPERTIES_EDGE).has(SQLG_SCHEMA_PROPERTY_NAME, &quot;p2&quot;).count().next().longValue());</b>
&nbsp;
<b class="fc">&nbsp;        assertFalse(columnExistsInSQL(schema, VERTEX_PREFIX + &quot;A&quot;, &quot;p1&quot;));</b>
<b class="fc">&nbsp;        assertTrue(columnExistsInSQL(schema, VERTEX_PREFIX + &quot;A&quot;, &quot;p2&quot;));</b>
&nbsp;
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2025-06-23 10:13</div>
</div>
</body>
</html>
