


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > BaseTest</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">org.umlg.sqlg.test</a>
</div>

<h1>Coverage Summary for Class: BaseTest (org.umlg.sqlg.test)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">BaseTest</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (45/45)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    62%
  </span>
  <span class="absValue">
    (103/166)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    88.7%
  </span>
  <span class="absValue">
    (305/344)
  </span>
</td>
</tr>
  <tr>
    <td class="name">BaseTest$1</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (3/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (9/9)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (48/48)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    62%
  </span>
  <span class="absValue">
    (103/166)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    89%
  </span>
  <span class="absValue">
    (314/353)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package org.umlg.sqlg.test;
&nbsp;
&nbsp;import org.apache.commons.configuration2.Configuration;
&nbsp;import org.apache.commons.configuration2.PropertiesConfiguration;
&nbsp;import org.apache.commons.configuration2.builder.fluent.Configurations;
&nbsp;import org.apache.commons.configuration2.ex.ConfigurationException;
&nbsp;import org.apache.commons.lang3.time.StopWatch;
&nbsp;import org.apache.logging.log4j.Level;
&nbsp;import org.apache.logging.log4j.LogManager;
&nbsp;import org.apache.logging.log4j.core.LoggerContext;
&nbsp;import org.apache.logging.log4j.core.config.LoggerConfig;
&nbsp;import org.apache.tinkerpop.gremlin.AbstractGremlinTest;
&nbsp;import org.apache.tinkerpop.gremlin.process.traversal.Step;
&nbsp;import org.apache.tinkerpop.gremlin.process.traversal.Traversal;
&nbsp;import org.apache.tinkerpop.gremlin.process.traversal.dsl.graph.GraphTraversal;
&nbsp;import org.apache.tinkerpop.gremlin.process.traversal.dsl.graph.GraphTraversalSource;
&nbsp;import org.apache.tinkerpop.gremlin.process.traversal.step.util.MapHelper;
&nbsp;import org.apache.tinkerpop.gremlin.structure.*;
&nbsp;import org.apache.tinkerpop.gremlin.structure.io.GraphReader;
&nbsp;import org.apache.tinkerpop.gremlin.structure.io.Io;
&nbsp;import org.apache.tinkerpop.gremlin.structure.io.graphson.GraphSONIo;
&nbsp;import org.apache.tinkerpop.gremlin.structure.io.graphson.GraphSONVersion;
&nbsp;import org.apache.tinkerpop.gremlin.util.iterator.IteratorUtils;
&nbsp;import org.hamcrest.CoreMatchers;
&nbsp;import org.hamcrest.MatcherAssert;
&nbsp;import org.junit.*;
&nbsp;import org.junit.rules.TestRule;
&nbsp;import org.junit.rules.TestWatcher;
&nbsp;import org.junit.runner.Description;
&nbsp;import org.slf4j.Logger;
&nbsp;import org.slf4j.LoggerFactory;
&nbsp;import org.umlg.sqlg.services.SqlgFunctionFactory;
&nbsp;import org.umlg.sqlg.sql.parse.ReplacedStep;
&nbsp;import org.umlg.sqlg.step.SqlgGraphStep;
&nbsp;import org.umlg.sqlg.step.SqlgStep;
&nbsp;import org.umlg.sqlg.step.SqlgVertexStep;
&nbsp;import org.umlg.sqlg.strategy.SqlgSqlExecutor;
&nbsp;import org.umlg.sqlg.structure.SqlgDataSource;
&nbsp;import org.umlg.sqlg.structure.SqlgGraph;
&nbsp;import org.umlg.sqlg.util.SqlgUtil;
&nbsp;
&nbsp;import java.io.IOException;
&nbsp;import java.io.InputStream;
&nbsp;import java.net.URL;
&nbsp;import java.sql.Connection;
&nbsp;import java.sql.ResultSet;
&nbsp;import java.sql.SQLException;
&nbsp;import java.sql.Statement;
&nbsp;import java.util.*;
&nbsp;import java.util.concurrent.TimeUnit;
&nbsp;import java.util.stream.Collectors;
&nbsp;
&nbsp;import static org.junit.Assert.*;
&nbsp;
&nbsp;/**
&nbsp; * Date: 2014/07/12
&nbsp; * Time: 5:44 PM
&nbsp; */
<b class="fc">&nbsp;public abstract class BaseTest {</b>
&nbsp;
<b class="fc">&nbsp;    private static final Logger LOGGER = LoggerFactory.getLogger(BaseTest.class.getName());</b>
&nbsp;    protected SqlgGraph sqlgGraph;
&nbsp;    protected SqlgGraph sqlgGraph1;
&nbsp;    protected GraphTraversalSource gt;
&nbsp;    protected static Configuration configuration;
&nbsp;    private long start;
&nbsp;    protected static final int SLEEP_TIME = 1000;
&nbsp;
<b class="fc">&nbsp;    @Rule</b>
<b class="fc">&nbsp;    public TestRule watcher = new TestWatcher() {</b>
&nbsp;        protected void starting(Description description) {
<b class="fc">&nbsp;            BaseTest.this.start = System.currentTimeMillis();</b>
<b class="fc">&nbsp;            LOGGER.info(&quot;Starting test: &quot; + description.getClassName() + &quot;.&quot; + description.getMethodName());</b>
&nbsp;        }
&nbsp;
&nbsp;        protected void finished(Description description) {
<b class="fc">&nbsp;            long millis = System.currentTimeMillis() - BaseTest.this.start;</b>
<b class="fc">&nbsp;            String time = String.format(&quot;%02d min, %02d sec, %02d mil&quot;,</b>
<b class="fc">&nbsp;                    TimeUnit.MILLISECONDS.toMinutes(millis),</b>
<b class="fc">&nbsp;                    TimeUnit.MILLISECONDS.toSeconds(millis) - TimeUnit.MINUTES.toSeconds(TimeUnit.MILLISECONDS.toMinutes(millis)),</b>
<b class="fc">&nbsp;                    TimeUnit.MILLISECONDS.toMillis(millis) - TimeUnit.SECONDS.toMillis(TimeUnit.MILLISECONDS.toSeconds(millis))</b>
&nbsp;            );
<b class="fc">&nbsp;            LOGGER.info(String.format(&quot;Finished test: %s.%s Time taken: %s&quot;, description.getClassName(), description.getMethodName(), time));</b>
&nbsp;        }
&nbsp;    };
&nbsp;
&nbsp;    @BeforeClass
&nbsp;    public static void beforeClass() {
<b class="fc">&nbsp;        URL sqlProperties = Thread.currentThread().getContextClassLoader().getResource(&quot;sqlg.properties&quot;);</b>
&nbsp;        try {
<b class="fc">&nbsp;            Configurations configs = new Configurations();</b>
<b class="fc">&nbsp;            configuration = configs.properties(sqlProperties);</b>
<b class="pc">&nbsp;            if (!configuration.containsKey(&quot;jdbc.url&quot;)) {</b>
<b class="nc">&nbsp;                throw new IllegalArgumentException(String.format(&quot;SqlGraph configuration requires that the %s be set&quot;, &quot;jdbc.url&quot;));</b>
&nbsp;            }
&nbsp;        } catch (ConfigurationException e) {
<b class="nc">&nbsp;            throw new RuntimeException(e);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Before
&nbsp;    public void before() throws Exception {
<b class="fc">&nbsp;        StopWatch stopWatch = new StopWatch();</b>
<b class="fc">&nbsp;        stopWatch.start();</b>
<b class="fc">&nbsp;        this.sqlgGraph = SqlgGraph.open(configuration);</b>
<b class="fc">&nbsp;        SqlgUtil.dropDb(this.sqlgGraph);</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="fc">&nbsp;        this.sqlgGraph.close();</b>
<b class="fc">&nbsp;        this.sqlgGraph = SqlgGraph.open(configuration);</b>
<b class="fc">&nbsp;        grantReadOnlyUserPrivileges();</b>
<b class="fc">&nbsp;        assertNotNull(this.sqlgGraph);</b>
<b class="fc">&nbsp;        assertNotNull(this.sqlgGraph.getBuildVersion());</b>
<b class="fc">&nbsp;        this.gt = this.sqlgGraph.traversal();</b>
<b class="fc">&nbsp;        if (configuration.getBoolean(&quot;distributed&quot;, false)) {</b>
<b class="fc">&nbsp;            this.sqlgGraph1 = SqlgGraph.open(configuration);</b>
<b class="fc">&nbsp;            assertNotNull(this.sqlgGraph1);</b>
<b class="fc">&nbsp;            assertEquals(this.sqlgGraph.getBuildVersion(), this.sqlgGraph1.getBuildVersion());</b>
&nbsp;        }
<b class="fc">&nbsp;        sqlgGraph.getServiceRegistry().registerService(new SqlgFunctionFactory(sqlgGraph));</b>
<b class="fc">&nbsp;        stopWatch.stop();</b>
<b class="fc">&nbsp;        LOGGER.info(&quot;Startup time for test = &quot; + stopWatch);</b>
&nbsp;    }
&nbsp;
&nbsp;    protected void grantReadOnlyUserPrivileges() {
<b class="fc">&nbsp;        this.sqlgGraph.getSqlDialect().grantReadOnlyUserPrivilegesToSqlgSchemas(this.sqlgGraph);</b>
<b class="fc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;    }
&nbsp;
&nbsp;    @After
&nbsp;    public void after() {
&nbsp;        try {
<b class="fc">&nbsp;            this.sqlgGraph.tx().onClose(Transaction.CLOSE_BEHAVIOR.ROLLBACK);</b>
<b class="fc">&nbsp;            this.sqlgGraph.close();</b>
&nbsp;        } catch (Exception e) {
<b class="nc">&nbsp;            LOGGER.error(e.getMessage(), e);</b>
&nbsp;        }
&nbsp;        try {
<b class="fc">&nbsp;            if (this.sqlgGraph1 != null) {</b>
<b class="fc">&nbsp;                this.sqlgGraph1.tx().onClose(Transaction.CLOSE_BEHAVIOR.ROLLBACK);</b>
<b class="fc">&nbsp;                this.sqlgGraph1.close();</b>
&nbsp;            }
&nbsp;        } catch (Exception e) {
<b class="nc">&nbsp;            LOGGER.error(e.getMessage(), e);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    protected static boolean isPostgres() {
<b class="fc">&nbsp;        return SqlgDataSource.isPostgres(configuration);</b>
&nbsp;    }
&nbsp;
&nbsp;    protected static boolean isMsSqlServer() {
<b class="fc">&nbsp;        return SqlgDataSource.isMsSqlServer(configuration);</b>
&nbsp;    }
&nbsp;
&nbsp;    protected static boolean isHsqldb() {
<b class="fc">&nbsp;        return SqlgDataSource.isHsqldb(configuration);</b>
&nbsp;    }
&nbsp;
&nbsp;    protected static boolean isH2() {
<b class="fc">&nbsp;        return SqlgDataSource.isH2(configuration);</b>
&nbsp;    }
&nbsp;
&nbsp;    protected static boolean isMariaDb() {
<b class="fc">&nbsp;        return SqlgDataSource.isMariaDb(configuration);</b>
&nbsp;    }
&nbsp;
&nbsp;    protected static boolean isMysql() {
<b class="fc">&nbsp;        return SqlgDataSource.isMysql(configuration);</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * return a clone of the configuration
&nbsp;     *
&nbsp;     * @return Sqlg&#39;s configuration
&nbsp;     */
&nbsp;    protected static Configuration getConfigurationClone() {
<b class="fc">&nbsp;        Configuration conf = new PropertiesConfiguration();</b>
<b class="fc">&nbsp;        Iterator&lt;String&gt; it = configuration.getKeys();</b>
<b class="fc">&nbsp;        while (it.hasNext()) {</b>
<b class="fc">&nbsp;            String s = it.next();</b>
<b class="fc">&nbsp;            conf.setProperty(s, configuration.getProperty(s));</b>
&nbsp;        }
<b class="fc">&nbsp;        return conf;</b>
&nbsp;    }
&nbsp;
&nbsp;    protected void dropSqlgSchema(SqlgGraph sqlgGraph) {
<b class="fc">&nbsp;        List&lt;String&gt; result = new ArrayList&lt;&gt;();</b>
<b class="pc">&nbsp;        result.add(&quot;DROP TABLE &quot; + sqlgGraph.getSqlDialect().maybeWrapInQoutes(&quot;sqlg_schema&quot;) + &quot;.&quot; + sqlgGraph.getSqlDialect().maybeWrapInQoutes(&quot;E_schema_vertex&quot;) + (sqlgGraph.getSqlDialect().needsSemicolon() ? &quot;;&quot; : &quot;&quot;));</b>
<b class="pc">&nbsp;        result.add(&quot;DROP TABLE &quot; + sqlgGraph.getSqlDialect().maybeWrapInQoutes(&quot;sqlg_schema&quot;) + &quot;.&quot; + sqlgGraph.getSqlDialect().maybeWrapInQoutes(&quot;E_in_edges&quot;) + (sqlgGraph.getSqlDialect().needsSemicolon() ? &quot;;&quot; : &quot;&quot;));</b>
<b class="pc">&nbsp;        result.add(&quot;DROP TABLE &quot; + sqlgGraph.getSqlDialect().maybeWrapInQoutes(&quot;sqlg_schema&quot;) + &quot;.&quot; + sqlgGraph.getSqlDialect().maybeWrapInQoutes(&quot;E_out_edges&quot;) + (sqlgGraph.getSqlDialect().needsSemicolon() ? &quot;;&quot; : &quot;&quot;));</b>
<b class="pc">&nbsp;        result.add(&quot;DROP TABLE &quot; + sqlgGraph.getSqlDialect().maybeWrapInQoutes(&quot;sqlg_schema&quot;) + &quot;.&quot; + sqlgGraph.getSqlDialect().maybeWrapInQoutes(&quot;E_vertex_property&quot;) + (sqlgGraph.getSqlDialect().needsSemicolon() ? &quot;;&quot; : &quot;&quot;));</b>
<b class="pc">&nbsp;        result.add(&quot;DROP TABLE &quot; + sqlgGraph.getSqlDialect().maybeWrapInQoutes(&quot;sqlg_schema&quot;) + &quot;.&quot; + sqlgGraph.getSqlDialect().maybeWrapInQoutes(&quot;E_vertex_partition&quot;) + (sqlgGraph.getSqlDialect().needsSemicolon() ? &quot;;&quot; : &quot;&quot;));</b>
<b class="pc">&nbsp;        result.add(&quot;DROP TABLE &quot; + sqlgGraph.getSqlDialect().maybeWrapInQoutes(&quot;sqlg_schema&quot;) + &quot;.&quot; + sqlgGraph.getSqlDialect().maybeWrapInQoutes(&quot;E_edge_partition&quot;) + (sqlgGraph.getSqlDialect().needsSemicolon() ? &quot;;&quot; : &quot;&quot;));</b>
<b class="pc">&nbsp;        result.add(&quot;DROP TABLE &quot; + sqlgGraph.getSqlDialect().maybeWrapInQoutes(&quot;sqlg_schema&quot;) + &quot;.&quot; + sqlgGraph.getSqlDialect().maybeWrapInQoutes(&quot;E_partition_partition&quot;) + (sqlgGraph.getSqlDialect().needsSemicolon() ? &quot;;&quot; : &quot;&quot;));</b>
<b class="pc">&nbsp;        result.add(&quot;DROP TABLE &quot; + sqlgGraph.getSqlDialect().maybeWrapInQoutes(&quot;sqlg_schema&quot;) + &quot;.&quot; + sqlgGraph.getSqlDialect().maybeWrapInQoutes(&quot;E_edge_property&quot;) + (sqlgGraph.getSqlDialect().needsSemicolon() ? &quot;;&quot; : &quot;&quot;));</b>
<b class="pc">&nbsp;        result.add(&quot;DROP TABLE &quot; + sqlgGraph.getSqlDialect().maybeWrapInQoutes(&quot;sqlg_schema&quot;) + &quot;.&quot; + sqlgGraph.getSqlDialect().maybeWrapInQoutes(&quot;E_vertex_identifier&quot;) + (sqlgGraph.getSqlDialect().needsSemicolon() ? &quot;;&quot; : &quot;&quot;));</b>
<b class="pc">&nbsp;        result.add(&quot;DROP TABLE &quot; + sqlgGraph.getSqlDialect().maybeWrapInQoutes(&quot;sqlg_schema&quot;) + &quot;.&quot; + sqlgGraph.getSqlDialect().maybeWrapInQoutes(&quot;E_edge_identifier&quot;) + (sqlgGraph.getSqlDialect().needsSemicolon() ? &quot;;&quot; : &quot;&quot;));</b>
<b class="pc">&nbsp;        result.add(&quot;DROP TABLE &quot; + sqlgGraph.getSqlDialect().maybeWrapInQoutes(&quot;sqlg_schema&quot;) + &quot;.&quot; + sqlgGraph.getSqlDialect().maybeWrapInQoutes(&quot;E_vertex_distribution&quot;) + (sqlgGraph.getSqlDialect().needsSemicolon() ? &quot;;&quot; : &quot;&quot;));</b>
<b class="pc">&nbsp;        result.add(&quot;DROP TABLE &quot; + sqlgGraph.getSqlDialect().maybeWrapInQoutes(&quot;sqlg_schema&quot;) + &quot;.&quot; + sqlgGraph.getSqlDialect().maybeWrapInQoutes(&quot;E_edge_distribution&quot;) + (sqlgGraph.getSqlDialect().needsSemicolon() ? &quot;;&quot; : &quot;&quot;));</b>
<b class="pc">&nbsp;        result.add(&quot;DROP TABLE &quot; + sqlgGraph.getSqlDialect().maybeWrapInQoutes(&quot;sqlg_schema&quot;) + &quot;.&quot; + sqlgGraph.getSqlDialect().maybeWrapInQoutes(&quot;E_vertex_colocate&quot;) + (sqlgGraph.getSqlDialect().needsSemicolon() ? &quot;;&quot; : &quot;&quot;));</b>
<b class="pc">&nbsp;        result.add(&quot;DROP TABLE &quot; + sqlgGraph.getSqlDialect().maybeWrapInQoutes(&quot;sqlg_schema&quot;) + &quot;.&quot; + sqlgGraph.getSqlDialect().maybeWrapInQoutes(&quot;E_edge_colocate&quot;) + (sqlgGraph.getSqlDialect().needsSemicolon() ? &quot;;&quot; : &quot;&quot;));</b>
<b class="pc">&nbsp;        result.add(&quot;DROP TABLE &quot; + sqlgGraph.getSqlDialect().maybeWrapInQoutes(&quot;sqlg_schema&quot;) + &quot;.&quot; + sqlgGraph.getSqlDialect().maybeWrapInQoutes(&quot;E_vertex_index&quot;) + (sqlgGraph.getSqlDialect().needsSemicolon() ? &quot;;&quot; : &quot;&quot;));</b>
<b class="pc">&nbsp;        result.add(&quot;DROP TABLE &quot; + sqlgGraph.getSqlDialect().maybeWrapInQoutes(&quot;sqlg_schema&quot;) + &quot;.&quot; + sqlgGraph.getSqlDialect().maybeWrapInQoutes(&quot;E_edge_index&quot;) + (sqlgGraph.getSqlDialect().needsSemicolon() ? &quot;;&quot; : &quot;&quot;));</b>
<b class="pc">&nbsp;        result.add(&quot;DROP TABLE &quot; + sqlgGraph.getSqlDialect().maybeWrapInQoutes(&quot;sqlg_schema&quot;) + &quot;.&quot; + sqlgGraph.getSqlDialect().maybeWrapInQoutes(&quot;E_index_property&quot;) + (sqlgGraph.getSqlDialect().needsSemicolon() ? &quot;;&quot; : &quot;&quot;));</b>
&nbsp;
<b class="pc">&nbsp;        result.add(&quot;DROP TABLE &quot; + sqlgGraph.getSqlDialect().maybeWrapInQoutes(&quot;sqlg_schema&quot;) + &quot;.&quot; + sqlgGraph.getSqlDialect().maybeWrapInQoutes(&quot;V_graph&quot;) + (sqlgGraph.getSqlDialect().needsSemicolon() ? &quot;;&quot; : &quot;&quot;));</b>
<b class="pc">&nbsp;        result.add(&quot;DROP TABLE &quot; + sqlgGraph.getSqlDialect().maybeWrapInQoutes(&quot;sqlg_schema&quot;) + &quot;.&quot; + sqlgGraph.getSqlDialect().maybeWrapInQoutes(&quot;V_log&quot;) + (sqlgGraph.getSqlDialect().needsSemicolon() ? &quot;;&quot; : &quot;&quot;));</b>
<b class="pc">&nbsp;        result.add(&quot;DROP TABLE &quot; + sqlgGraph.getSqlDialect().maybeWrapInQoutes(&quot;sqlg_schema&quot;) + &quot;.&quot; + sqlgGraph.getSqlDialect().maybeWrapInQoutes(&quot;V_schema&quot;) + (sqlgGraph.getSqlDialect().needsSemicolon() ? &quot;;&quot; : &quot;&quot;));</b>
<b class="pc">&nbsp;        result.add(&quot;DROP TABLE &quot; + sqlgGraph.getSqlDialect().maybeWrapInQoutes(&quot;sqlg_schema&quot;) + &quot;.&quot; + sqlgGraph.getSqlDialect().maybeWrapInQoutes(&quot;V_vertex&quot;) + (sqlgGraph.getSqlDialect().needsSemicolon() ? &quot;;&quot; : &quot;&quot;));</b>
<b class="pc">&nbsp;        result.add(&quot;DROP TABLE &quot; + sqlgGraph.getSqlDialect().maybeWrapInQoutes(&quot;sqlg_schema&quot;) + &quot;.&quot; + sqlgGraph.getSqlDialect().maybeWrapInQoutes(&quot;V_edge&quot;) + (sqlgGraph.getSqlDialect().needsSemicolon() ? &quot;;&quot; : &quot;&quot;));</b>
<b class="pc">&nbsp;        result.add(&quot;DROP TABLE &quot; + sqlgGraph.getSqlDialect().maybeWrapInQoutes(&quot;sqlg_schema&quot;) + &quot;.&quot; + sqlgGraph.getSqlDialect().maybeWrapInQoutes(&quot;V_partition&quot;) + (sqlgGraph.getSqlDialect().needsSemicolon() ? &quot;;&quot; : &quot;&quot;));</b>
<b class="pc">&nbsp;        result.add(&quot;DROP TABLE &quot; + sqlgGraph.getSqlDialect().maybeWrapInQoutes(&quot;sqlg_schema&quot;) + &quot;.&quot; + sqlgGraph.getSqlDialect().maybeWrapInQoutes(&quot;V_property&quot;) + (sqlgGraph.getSqlDialect().needsSemicolon() ? &quot;;&quot; : &quot;&quot;));</b>
<b class="pc">&nbsp;        result.add(&quot;DROP TABLE &quot; + sqlgGraph.getSqlDialect().maybeWrapInQoutes(&quot;sqlg_schema&quot;) + &quot;.&quot; + sqlgGraph.getSqlDialect().maybeWrapInQoutes(&quot;V_index&quot;) + (sqlgGraph.getSqlDialect().needsSemicolon() ? &quot;;&quot; : &quot;&quot;));</b>
&nbsp;
<b class="fc">&nbsp;        result.add(sqlgGraph.getSqlDialect().dropSchemaStatement(&quot;sqlg_schema&quot;));</b>
&nbsp;
<b class="fc">&nbsp;        Connection connection = sqlgGraph.tx().getConnection();</b>
<b class="fc">&nbsp;        try (Statement statement = connection.createStatement()) {</b>
<b class="fc">&nbsp;            for (String s : result) {</b>
<b class="fc">&nbsp;                statement.execute(s);</b>
&nbsp;            }
&nbsp;        } catch (SQLException e) {
<b class="nc">&nbsp;            throw new RuntimeException(e);</b>
&nbsp;        }
&nbsp;
&nbsp;    }
&nbsp;
&nbsp;    protected GraphTraversal&lt;Vertex, Vertex&gt; vertexTraversal(SqlgGraph sqlgGraph, Vertex v) {
<b class="fc">&nbsp;        return sqlgGraph.traversal().V(v);</b>
&nbsp;    }
&nbsp;
&nbsp;    protected GraphTraversal&lt;Edge, Edge&gt; edgeTraversal(SqlgGraph sqlgGraph, Edge e) {
<b class="fc">&nbsp;        return sqlgGraph.traversal().E(e);</b>
&nbsp;    }
&nbsp;
&nbsp;    protected void assertDb(String table, int numberOfRows) {
<b class="fc">&nbsp;        try (Connection conn = this.sqlgGraph.getConnection()) {</b>
<b class="fc">&nbsp;            try (Statement stmt = conn.createStatement()) {</b>
<b class="fc">&nbsp;                StringBuilder sql = new StringBuilder(&quot;SELECT * FROM &quot;);</b>
<b class="fc">&nbsp;                sql.append(this.sqlgGraph.getSqlDialect().maybeWrapInQoutes(this.sqlgGraph.getSqlDialect().getPublicSchema()));</b>
<b class="fc">&nbsp;                sql.append(&quot;.&quot;);</b>
<b class="fc">&nbsp;                sql.append(this.sqlgGraph.getSqlDialect().maybeWrapInQoutes(table));</b>
<b class="pc">&nbsp;                if (this.sqlgGraph.getSqlDialect().needsSemicolon()) {</b>
<b class="fc">&nbsp;                    sql.append(&quot;;&quot;);</b>
&nbsp;                }
<b class="pc">&nbsp;                if (LOGGER.isDebugEnabled()) {</b>
<b class="nc">&nbsp;                    LOGGER.debug(sql.toString());</b>
&nbsp;                }
<b class="fc">&nbsp;                try (ResultSet rs = stmt.executeQuery(sql.toString())) {</b>
<b class="fc">&nbsp;                    int countRows = 0;</b>
<b class="fc">&nbsp;                    while (rs.next()) {</b>
<b class="fc">&nbsp;                        countRows++;</b>
&nbsp;                    }
<b class="fc">&nbsp;                    assertEquals(numberOfRows, countRows);</b>
&nbsp;                }
&nbsp;            }
&nbsp;        } catch (Exception e) {
<b class="nc">&nbsp;            fail(e.getMessage());</b>
&nbsp;        }
&nbsp;
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * print the traversal before and after execution
&nbsp;     *
&nbsp;     * @param traversal The traversal to print.
&nbsp;     */
&nbsp;    protected void printTraversalForm(final Traversal&lt;?, ?&gt; traversal) {
<b class="fc">&nbsp;        final boolean muted = Boolean.parseBoolean(System.getProperty(&quot;muteTestLogs&quot;, &quot;false&quot;));</b>
&nbsp;
<b class="pc">&nbsp;        if (!muted) System.out.println(&quot;   pre-strategy:&quot; + traversal);</b>
&nbsp;        //noinspection ResultOfMethodCallIgnored
<b class="fc">&nbsp;        traversal.hasNext();</b>
<b class="pc">&nbsp;        if (!muted) System.out.println(&quot;  post-strategy:&quot; + traversal);</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * print the traversal before and after execution, and return the last SQL generated
&nbsp;     *
&nbsp;     * @param traversal The traversal that will execute some sql.
&nbsp;     * @return the SQL or null
&nbsp;     */
&nbsp;    protected String getSQL(final Traversal&lt;?, ?&gt; traversal) {
<b class="fc">&nbsp;        final LoggerContext ctx = (LoggerContext) LogManager.getContext(false);</b>
<b class="fc">&nbsp;        final org.apache.logging.log4j.core.config.Configuration config = ctx.getConfiguration();</b>
<b class="fc">&nbsp;        LoggerConfig loggerConfig = config.getLoggerConfig(SqlgSqlExecutor.class.getName());</b>
<b class="fc">&nbsp;        Level old = loggerConfig.getLevel();</b>
&nbsp;        try {
<b class="fc">&nbsp;            loggerConfig.setLevel(Level.DEBUG);</b>
<b class="fc">&nbsp;            ctx.updateLoggers();</b>
<b class="fc">&nbsp;            printTraversalForm(traversal);</b>
<b class="fc">&nbsp;            return Log4j2TestAppender.last(SqlgSqlExecutor.class.getName());</b>
&nbsp;        } finally {
<b class="fc">&nbsp;            loggerConfig.setLevel(old);</b>
<b class="fc">&nbsp;            ctx.updateLoggers();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    protected void loadModern(SqlgGraph sqlgGraph) {
<b class="fc">&nbsp;        Io.Builder&lt;GraphSONIo&gt; builder = GraphSONIo.build(GraphSONVersion.V3_0);</b>
<b class="fc">&nbsp;        final GraphReader reader = sqlgGraph.io(builder).reader().create();</b>
<b class="fc">&nbsp;        try (final InputStream stream = AbstractGremlinTest.class.getResourceAsStream(&quot;/tinkerpop-modern-v3d0.json&quot;)) {</b>
<b class="fc">&nbsp;            reader.readGraph(stream, sqlgGraph);</b>
&nbsp;        } catch (IOException e) {
<b class="nc">&nbsp;            Assert.fail(e.getMessage());</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    protected void loadModern() {
<b class="fc">&nbsp;        loadModern(this.sqlgGraph);</b>
&nbsp;    }
&nbsp;
&nbsp;    protected void loadClassic() {
<b class="fc">&nbsp;        loadClassic(this.sqlgGraph);</b>
&nbsp;    }
&nbsp;
&nbsp;    protected void loadClassic(SqlgGraph sqlgGraph) {
<b class="fc">&nbsp;        Io.Builder&lt;GraphSONIo&gt; builder = GraphSONIo.build(GraphSONVersion.V3_0);</b>
<b class="fc">&nbsp;        final GraphReader reader = sqlgGraph.io(builder).reader().create();</b>
<b class="fc">&nbsp;        try (final InputStream stream = AbstractGremlinTest.class.getResourceAsStream(&quot;/tinkerpop-classic-v3d0.json&quot;)) {</b>
<b class="fc">&nbsp;            reader.readGraph(stream, sqlgGraph);</b>
&nbsp;        } catch (IOException e) {
<b class="nc">&nbsp;            Assert.fail(e.getMessage());</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    protected void loadGratefulDead(SqlgGraph sqlgGraph) {
<b class="fc">&nbsp;        Io.Builder&lt;GraphSONIo&gt; builder = GraphSONIo.build(GraphSONVersion.V3_0);</b>
<b class="fc">&nbsp;        final GraphReader reader = sqlgGraph.io(builder).reader().create();</b>
<b class="fc">&nbsp;        try (final InputStream stream = AbstractGremlinTest.class.getResourceAsStream(&quot;/grateful-dead-v3d0.json&quot;)) {</b>
<b class="fc">&nbsp;            reader.readGraph(stream, sqlgGraph);</b>
&nbsp;        } catch (IOException e) {
<b class="nc">&nbsp;            Assert.fail(e.getMessage());</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    protected void loadGratefulDead() {
<b class="fc">&nbsp;        loadGratefulDead(this.sqlgGraph);</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Looks up the identifier as generated by the current source graph being tested.
&nbsp;     *
&nbsp;     * @param vertexName a unique string that will identify a graph element within a graph
&nbsp;     * @return the id as generated by the graph
&nbsp;     */
&nbsp;    protected Object convertToVertexId(final String vertexName) {
<b class="fc">&nbsp;        return convertToVertexId(this.sqlgGraph, vertexName);</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Looks up the identifier as generated by the current source graph being tested.
&nbsp;     *
&nbsp;     * @param g          the graph to get the element id from
&nbsp;     * @param vertexName a unique string that will identify a graph element within a graph
&nbsp;     * @return the id as generated by the graph
&nbsp;     */
&nbsp;    protected Object convertToVertexId(final Graph g, final String vertexName) {
<b class="fc">&nbsp;        return convertToVertex(g, vertexName).id();</b>
&nbsp;    }
&nbsp;
&nbsp;    protected Vertex convertToVertex(final Graph graph, final String vertexName) {
&nbsp;        // all test graphs have &quot;name&quot; as a unique id which makes it easy to hardcode this...works for now
<b class="fc">&nbsp;        return graph.traversal().V().has(&quot;name&quot;, vertexName).next();</b>
&nbsp;    }
&nbsp;
&nbsp;    protected Object convertToEdgeId(final Graph graph, final String outVertexName, String edgeLabel, final String inVertexName) {
<b class="fc">&nbsp;        return graph.traversal().V().has(&quot;name&quot;, outVertexName).outE(edgeLabel).as(&quot;e&quot;).inV().has(&quot;name&quot;, inVertexName).&lt;Edge&gt;select(&quot;e&quot;).next().id();</b>
&nbsp;    }
&nbsp;
&nbsp;    protected static void assertModernGraph(final Graph g1, final boolean assertDouble, final boolean lossyForId) {
<b class="fc">&nbsp;        assertToyGraph(g1, assertDouble, lossyForId, true);</b>
&nbsp;    }
&nbsp;
&nbsp;    private static void assertToyGraph(final Graph g1, final boolean assertDouble, final boolean lossyForId, @SuppressWarnings(&quot;SameParameterValue&quot;) final boolean assertSpecificLabel) {
<b class="fc">&nbsp;        assertEquals(Long.valueOf(6), g1.traversal().V().count().next());</b>
<b class="fc">&nbsp;        assertEquals(Long.valueOf(6), g1.traversal().E().count().next());</b>
&nbsp;
<b class="fc">&nbsp;        final Vertex v1 = g1.traversal().V().has(&quot;name&quot;, &quot;marko&quot;).next();</b>
<b class="fc">&nbsp;        assertEquals(29, v1.&lt;Integer&gt;value(&quot;age&quot;).intValue());</b>
<b class="fc">&nbsp;        assertEquals(2, v1.keys().size());</b>
<b class="pc">&nbsp;        assertEquals(assertSpecificLabel ? &quot;person&quot; : Vertex.DEFAULT_LABEL, v1.label());</b>
<b class="fc">&nbsp;        assertId(g1, lossyForId, v1, 1);</b>
&nbsp;
<b class="fc">&nbsp;        final List&lt;Edge&gt; v1Edges = g1.traversal().V(v1.id()).bothE().toList();</b>
<b class="fc">&nbsp;        assertEquals(3, v1Edges.size());</b>
<b class="fc">&nbsp;        v1Edges.forEach(e -&gt; {</b>
<b class="fc">&nbsp;            if (g1.traversal().E(e.id()).inV().values(&quot;name&quot;).next().equals(&quot;vadas&quot;)) {</b>
<b class="fc">&nbsp;                assertEquals(&quot;knows&quot;, e.label());</b>
<b class="pc">&nbsp;                if (assertDouble)</b>
<b class="fc">&nbsp;                    assertEquals(0.5d, e.value(&quot;weight&quot;), 0.0001d);</b>
&nbsp;                else
<b class="nc">&nbsp;                    assertEquals(0.5f, e.value(&quot;weight&quot;), 0.0001f);</b>
<b class="fc">&nbsp;                assertEquals(1, e.keys().size());</b>
<b class="fc">&nbsp;                assertId(g1, lossyForId, e, 7);</b>
<b class="fc">&nbsp;            } else if (g1.traversal().E(e.id()).inV().values(&quot;name&quot;).next().equals(&quot;josh&quot;)) {</b>
<b class="fc">&nbsp;                assertEquals(&quot;knows&quot;, e.label());</b>
<b class="pc">&nbsp;                if (assertDouble)</b>
<b class="fc">&nbsp;                    assertEquals(1.0, e.value(&quot;weight&quot;), 0.0001d);</b>
&nbsp;                else
<b class="nc">&nbsp;                    assertEquals(1.0f, e.value(&quot;weight&quot;), 0.0001f);</b>
<b class="fc">&nbsp;                assertEquals(1, e.keys().size());</b>
<b class="fc">&nbsp;                assertId(g1, lossyForId, e, 8);</b>
<b class="pc">&nbsp;            } else if (g1.traversal().E(e.id()).inV().values(&quot;name&quot;).next().equals(&quot;lop&quot;)) {</b>
<b class="fc">&nbsp;                assertEquals(&quot;created&quot;, e.label());</b>
<b class="pc">&nbsp;                if (assertDouble)</b>
<b class="fc">&nbsp;                    assertEquals(0.4d, e.value(&quot;weight&quot;), 0.0001d);</b>
&nbsp;                else
<b class="nc">&nbsp;                    assertEquals(0.4f, e.value(&quot;weight&quot;), 0.0001f);</b>
<b class="fc">&nbsp;                assertEquals(1, e.keys().size());</b>
<b class="fc">&nbsp;                assertId(g1, lossyForId, e, 9);</b>
&nbsp;            } else {
<b class="nc">&nbsp;                fail(&quot;Edge not expected&quot;);</b>
&nbsp;            }
&nbsp;        });
&nbsp;
<b class="fc">&nbsp;        final Vertex v2 = g1.traversal().V().has(&quot;name&quot;, &quot;vadas&quot;).next();</b>
<b class="fc">&nbsp;        assertEquals(27, v2.&lt;Integer&gt;value(&quot;age&quot;).intValue());</b>
<b class="fc">&nbsp;        assertEquals(2, v2.keys().size());</b>
<b class="pc">&nbsp;        assertEquals(assertSpecificLabel ? &quot;person&quot; : Vertex.DEFAULT_LABEL, v2.label());</b>
<b class="fc">&nbsp;        assertId(g1, lossyForId, v2, 2);</b>
&nbsp;
<b class="fc">&nbsp;        final List&lt;Edge&gt; v2Edges = g1.traversal().V(v2.id()).bothE().toList();</b>
<b class="fc">&nbsp;        assertEquals(1, v2Edges.size());</b>
<b class="fc">&nbsp;        v2Edges.forEach(e -&gt; {</b>
<b class="pc">&nbsp;            if (g1.traversal().E(e.id()).outV().values(&quot;name&quot;).next().equals(&quot;marko&quot;)) {</b>
<b class="fc">&nbsp;                assertEquals(&quot;knows&quot;, e.label());</b>
<b class="pc">&nbsp;                if (assertDouble)</b>
<b class="fc">&nbsp;                    assertEquals(0.5d, e.value(&quot;weight&quot;), 0.0001d);</b>
&nbsp;                else
<b class="nc">&nbsp;                    assertEquals(0.5f, e.value(&quot;weight&quot;), 0.0001f);</b>
<b class="fc">&nbsp;                assertEquals(1, e.keys().size());</b>
<b class="fc">&nbsp;                assertId(g1, lossyForId, e, 7);</b>
&nbsp;            } else {
<b class="nc">&nbsp;                fail(&quot;Edge not expected&quot;);</b>
&nbsp;            }
&nbsp;        });
&nbsp;
<b class="fc">&nbsp;        final Vertex v3 = g1.traversal().V().has(&quot;name&quot;, &quot;lop&quot;).next();</b>
<b class="fc">&nbsp;        assertEquals(&quot;java&quot;, v3.&lt;String&gt;value(&quot;lang&quot;));</b>
<b class="fc">&nbsp;        assertEquals(2, v2.keys().size());</b>
<b class="pc">&nbsp;        assertEquals(assertSpecificLabel ? &quot;software&quot; : Vertex.DEFAULT_LABEL, v3.label());</b>
<b class="fc">&nbsp;        assertId(g1, lossyForId, v3, 3);</b>
&nbsp;
<b class="fc">&nbsp;        final List&lt;Edge&gt; v3Edges = g1.traversal().V(v3.id()).bothE().toList();</b>
<b class="fc">&nbsp;        assertEquals(3, v3Edges.size());</b>
<b class="fc">&nbsp;        v3Edges.forEach(e -&gt; {</b>
<b class="fc">&nbsp;            if (g1.traversal().E(e.id()).outV().values(&quot;name&quot;).next().equals(&quot;peter&quot;)) {</b>
<b class="fc">&nbsp;                assertEquals(&quot;created&quot;, e.label());</b>
<b class="pc">&nbsp;                if (assertDouble)</b>
<b class="fc">&nbsp;                    assertEquals(0.2d, e.value(&quot;weight&quot;), 0.0001d);</b>
&nbsp;                else
<b class="nc">&nbsp;                    assertEquals(0.2f, e.value(&quot;weight&quot;), 0.0001f);</b>
<b class="fc">&nbsp;                assertEquals(1, e.keys().size());</b>
<b class="fc">&nbsp;                assertId(g1, lossyForId, e, 12);</b>
<b class="fc">&nbsp;            } else if (g1.traversal().E(e.id()).outV().next().value(&quot;name&quot;).equals(&quot;josh&quot;)) {</b>
<b class="fc">&nbsp;                assertEquals(&quot;created&quot;, e.label());</b>
<b class="pc">&nbsp;                if (assertDouble)</b>
<b class="fc">&nbsp;                    assertEquals(0.4d, e.value(&quot;weight&quot;), 0.0001d);</b>
&nbsp;                else
<b class="nc">&nbsp;                    assertEquals(0.4f, e.value(&quot;weight&quot;), 0.0001f);</b>
<b class="fc">&nbsp;                assertEquals(1, e.keys().size());</b>
<b class="fc">&nbsp;                assertId(g1, lossyForId, e, 11);</b>
<b class="pc">&nbsp;            } else if (g1.traversal().E(e.id()).outV().values(&quot;name&quot;).next().equals(&quot;marko&quot;)) {</b>
<b class="fc">&nbsp;                assertEquals(&quot;created&quot;, e.label());</b>
<b class="pc">&nbsp;                if (assertDouble)</b>
<b class="fc">&nbsp;                    assertEquals(0.4d, e.value(&quot;weight&quot;), 0.0001d);</b>
&nbsp;                else
<b class="nc">&nbsp;                    assertEquals(0.4f, e.value(&quot;weight&quot;), 0.0001f);</b>
<b class="fc">&nbsp;                assertEquals(1, e.keys().size());</b>
<b class="fc">&nbsp;                assertId(g1, lossyForId, e, 9);</b>
&nbsp;            } else {
<b class="nc">&nbsp;                fail(&quot;Edge not expected&quot;);</b>
&nbsp;            }
&nbsp;        });
&nbsp;
<b class="fc">&nbsp;        final Vertex v4 = g1.traversal().V().has(&quot;name&quot;, &quot;josh&quot;).next();</b>
<b class="fc">&nbsp;        assertEquals(32, v4.&lt;Integer&gt;value(&quot;age&quot;).intValue());</b>
<b class="fc">&nbsp;        assertEquals(2, v4.keys().size());</b>
<b class="pc">&nbsp;        assertEquals(assertSpecificLabel ? &quot;person&quot; : Vertex.DEFAULT_LABEL, v4.label());</b>
<b class="fc">&nbsp;        assertId(g1, lossyForId, v4, 4);</b>
&nbsp;
<b class="fc">&nbsp;        final List&lt;Edge&gt; v4Edges = g1.traversal().V(v4.id()).bothE().toList();</b>
<b class="fc">&nbsp;        assertEquals(3, v4Edges.size());</b>
<b class="fc">&nbsp;        v4Edges.forEach(e -&gt; {</b>
<b class="fc">&nbsp;            if (e.inVertex().values(&quot;name&quot;).next().equals(&quot;ripple&quot;)) {</b>
<b class="fc">&nbsp;                assertEquals(&quot;created&quot;, e.label());</b>
<b class="pc">&nbsp;                if (assertDouble)</b>
<b class="fc">&nbsp;                    assertEquals(1.0d, e.value(&quot;weight&quot;), 0.0001d);</b>
&nbsp;                else
<b class="nc">&nbsp;                    assertEquals(1.0f, e.value(&quot;weight&quot;), 0.0001f);</b>
<b class="fc">&nbsp;                assertEquals(1, e.keys().size());</b>
<b class="fc">&nbsp;                assertId(g1, lossyForId, e, 10);</b>
<b class="fc">&nbsp;            } else if (e.inVertex().values(&quot;name&quot;).next().equals(&quot;lop&quot;)) {</b>
<b class="fc">&nbsp;                assertEquals(&quot;created&quot;, e.label());</b>
<b class="pc">&nbsp;                if (assertDouble)</b>
<b class="fc">&nbsp;                    assertEquals(0.4d, e.value(&quot;weight&quot;), 0.0001d);</b>
&nbsp;                else
<b class="nc">&nbsp;                    assertEquals(0.4f, e.value(&quot;weight&quot;), 0.0001f);</b>
<b class="fc">&nbsp;                assertEquals(1, e.keys().size());</b>
<b class="fc">&nbsp;                assertId(g1, lossyForId, e, 11);</b>
<b class="pc">&nbsp;            } else if (e.outVertex().values(&quot;name&quot;).next().equals(&quot;marko&quot;)) {</b>
<b class="fc">&nbsp;                assertEquals(&quot;knows&quot;, e.label());</b>
<b class="pc">&nbsp;                if (assertDouble)</b>
<b class="fc">&nbsp;                    assertEquals(1.0d, e.value(&quot;weight&quot;), 0.0001d);</b>
&nbsp;                else
<b class="nc">&nbsp;                    assertEquals(1.0f, e.value(&quot;weight&quot;), 0.0001f);</b>
<b class="fc">&nbsp;                assertEquals(1, e.keys().size());</b>
<b class="fc">&nbsp;                assertId(g1, lossyForId, e, 8);</b>
&nbsp;            } else {
<b class="nc">&nbsp;                fail(&quot;Edge not expected&quot;);</b>
&nbsp;            }
&nbsp;        });
&nbsp;
<b class="fc">&nbsp;        final Vertex v5 = g1.traversal().V().has(&quot;name&quot;, &quot;ripple&quot;).next();</b>
<b class="fc">&nbsp;        assertEquals(&quot;java&quot;, v5.&lt;String&gt;value(&quot;lang&quot;));</b>
<b class="fc">&nbsp;        assertEquals(2, v5.keys().size());</b>
<b class="pc">&nbsp;        assertEquals(assertSpecificLabel ? &quot;software&quot; : Vertex.DEFAULT_LABEL, v5.label());</b>
<b class="fc">&nbsp;        assertId(g1, lossyForId, v5, 5);</b>
&nbsp;
<b class="fc">&nbsp;        final List&lt;Edge&gt; v5Edges = IteratorUtils.list(v5.edges(Direction.BOTH));</b>
<b class="fc">&nbsp;        assertEquals(1, v5Edges.size());</b>
<b class="fc">&nbsp;        v5Edges.forEach(e -&gt; {</b>
<b class="pc">&nbsp;            if (e.outVertex().values(&quot;name&quot;).next().equals(&quot;josh&quot;)) {</b>
<b class="fc">&nbsp;                assertEquals(&quot;created&quot;, e.label());</b>
<b class="pc">&nbsp;                if (assertDouble)</b>
<b class="fc">&nbsp;                    assertEquals(1.0d, e.value(&quot;weight&quot;), 0.0001d);</b>
&nbsp;                else
<b class="nc">&nbsp;                    assertEquals(1.0f, e.value(&quot;weight&quot;), 0.0001f);</b>
<b class="fc">&nbsp;                assertEquals(1, e.keys().size());</b>
<b class="fc">&nbsp;                assertId(g1, lossyForId, e, 10);</b>
&nbsp;            } else {
<b class="nc">&nbsp;                fail(&quot;Edge not expected&quot;);</b>
&nbsp;            }
&nbsp;        });
&nbsp;
<b class="fc">&nbsp;        final Vertex v6 = g1.traversal().V().has(&quot;name&quot;, &quot;peter&quot;).next();</b>
<b class="fc">&nbsp;        assertEquals(35, v6.&lt;Integer&gt;value(&quot;age&quot;).intValue());</b>
<b class="fc">&nbsp;        assertEquals(2, v6.keys().size());</b>
<b class="pc">&nbsp;        assertEquals(assertSpecificLabel ? &quot;person&quot; : Vertex.DEFAULT_LABEL, v6.label());</b>
<b class="fc">&nbsp;        assertId(g1, lossyForId, v6, 6);</b>
&nbsp;
<b class="fc">&nbsp;        final List&lt;Edge&gt; v6Edges = IteratorUtils.list(v6.edges(Direction.BOTH));</b>
<b class="fc">&nbsp;        assertEquals(1, v6Edges.size());</b>
<b class="fc">&nbsp;        v6Edges.forEach(e -&gt; {</b>
<b class="pc">&nbsp;            if (e.inVertex().values(&quot;name&quot;).next().equals(&quot;lop&quot;)) {</b>
<b class="fc">&nbsp;                assertEquals(&quot;created&quot;, e.label());</b>
<b class="pc">&nbsp;                if (assertDouble)</b>
<b class="fc">&nbsp;                    assertEquals(0.2d, e.value(&quot;weight&quot;), 0.0001d);</b>
&nbsp;                else
<b class="nc">&nbsp;                    assertEquals(0.2f, e.value(&quot;weight&quot;), 0.0001f);</b>
<b class="fc">&nbsp;                assertEquals(1, e.keys().size());</b>
<b class="fc">&nbsp;                assertId(g1, lossyForId, e, 12);</b>
&nbsp;            } else {
<b class="nc">&nbsp;                fail(&quot;Edge not expected&quot;);</b>
&nbsp;            }
&nbsp;        });
&nbsp;    }
&nbsp;
&nbsp;    private static void assertId(final Graph g, final boolean lossyForId, final Element e, final Object expected) {
<b class="pc">&nbsp;        if (g.features().edge().supportsUserSuppliedIds()) {</b>
<b class="nc">&nbsp;            if (lossyForId)</b>
<b class="nc">&nbsp;                assertEquals(expected.toString(), e.id().toString());</b>
&nbsp;            else
<b class="nc">&nbsp;                assertEquals(expected, e.id());</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    //copied from TinkerPop
&nbsp;    @SuppressWarnings({&quot;DuplicatedCode&quot;, &quot;rawtypes&quot;})
&nbsp;    protected static &lt;T&gt; void checkResults(final List&lt;T&gt; expectedResults, final Traversal&lt;?, T&gt; traversal) {
<b class="fc">&nbsp;        final List&lt;T&gt; results = traversal.toList();</b>
<b class="fc">&nbsp;        Assert.assertFalse(traversal.hasNext());</b>
<b class="pc">&nbsp;        if (expectedResults.size() != results.size()) {</b>
<b class="nc">&nbsp;            LOGGER.error(&quot;Expected results: &quot; + expectedResults);</b>
<b class="nc">&nbsp;            LOGGER.error(&quot;Actual results:   &quot; + results);</b>
<b class="nc">&nbsp;            Assert.assertEquals(&quot;Checking result size&quot;, expectedResults.size(), results.size());</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        for (T t : results) {</b>
<b class="fc">&nbsp;            if (t instanceof Map) {</b>
&nbsp;                //noinspection unchecked
<b class="fc">&nbsp;                MatcherAssert.assertThat(&quot;Checking map result existence: &quot; + t, expectedResults.stream().filter(e -&gt; e instanceof Map).anyMatch(e -&gt; internalCheckMap((Map) e, (Map) t)), CoreMatchers.is(true));</b>
&nbsp;            } else {
<b class="fc">&nbsp;                MatcherAssert.assertThat(&quot;Checking result existence: &quot; + t, expectedResults.contains(t), CoreMatchers.is(true));</b>
&nbsp;            }
&nbsp;        }
<b class="fc">&nbsp;        final Map&lt;T, Long&gt; expectedResultsCount = new HashMap&lt;&gt;();</b>
<b class="fc">&nbsp;        final Map&lt;T, Long&gt; resultsCount = new HashMap&lt;&gt;();</b>
<b class="fc">&nbsp;        Assert.assertEquals(&quot;Checking indexing is equivalent&quot;, expectedResultsCount.size(), resultsCount.size());</b>
<b class="fc">&nbsp;        expectedResults.forEach(t -&gt; MapHelper.incr(expectedResultsCount, t, 1L));</b>
<b class="fc">&nbsp;        results.forEach(t -&gt; MapHelper.incr(resultsCount, t, 1L));</b>
<b class="fc">&nbsp;        expectedResultsCount.forEach((k, v) -&gt; Assert.assertEquals(&quot;Checking result group counts&quot;, v, resultsCount.get(k)));</b>
<b class="fc">&nbsp;        MatcherAssert.assertThat(traversal.hasNext(), CoreMatchers.is(false));</b>
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;    @SuppressWarnings(&quot;DuplicatedCode&quot;)
&nbsp;    private static &lt;A, B&gt; boolean internalCheckMap(final Map&lt;A, B&gt; expectedMap, final Map&lt;A, B&gt; actualMap) {
<b class="fc">&nbsp;        final List&lt;Map.Entry&lt;A, B&gt;&gt; actualList = actualMap.entrySet().stream().sorted(Comparator.comparing(a -&gt; a.getKey().toString())).collect(Collectors.toList());</b>
<b class="fc">&nbsp;        final List&lt;Map.Entry&lt;A, B&gt;&gt; expectedList = expectedMap.entrySet().stream().sorted(Comparator.comparing(a -&gt; a.getKey().toString())).collect(Collectors.toList());</b>
&nbsp;
<b class="pc">&nbsp;        if (expectedList.size() != actualList.size()) {</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        for (int i = 0; i &lt; actualList.size(); i++) {</b>
<b class="pc">&nbsp;            if (!actualList.get(i).getKey().equals(expectedList.get(i).getKey())) {</b>
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
<b class="fc">&nbsp;            if (!actualList.get(i).getValue().equals(expectedList.get(i).getValue())) {</b>
<b class="fc">&nbsp;                return false;</b>
&nbsp;            }
&nbsp;        }
<b class="fc">&nbsp;        return true;</b>
&nbsp;    }
&nbsp;
&nbsp;    protected void assertStep(Step&lt;?, ?&gt; step, @SuppressWarnings(&quot;SameParameterValue&quot;) boolean isGraph, boolean isEagerLoad, boolean isForMultipleQueries, boolean comparatorsNotOnDb, boolean rangeOnDb) {
<b class="pc">&nbsp;        if (isGraph) {</b>
<b class="fc">&nbsp;            Assert.assertTrue(&quot;Expected SqlgGraphStep, found &quot; + step.getClass().getName(), step instanceof SqlgGraphStep);</b>
&nbsp;        } else {
<b class="nc">&nbsp;            Assert.assertTrue(&quot;Expected SqlgVertexStep, found &quot; + step.getClass().getName(), step instanceof SqlgVertexStep);</b>
&nbsp;        }
<b class="fc">&nbsp;        SqlgStep sqlgStep = (SqlgStep) step;</b>
<b class="fc">&nbsp;        Assert.assertEquals(&quot;isEagerLoad should be &quot; + isEagerLoad, isEagerLoad, sqlgStep.isEagerLoad());</b>
<b class="fc">&nbsp;        Assert.assertEquals(&quot;isForMultipleQueries should be &quot; + isForMultipleQueries, isForMultipleQueries, sqlgStep.isForMultipleQueries());</b>
<b class="fc">&nbsp;        Assert.assertEquals(&quot;comparatorsNotOnDb should be &quot; + comparatorsNotOnDb, comparatorsNotOnDb, sqlgStep.getReplacedSteps().stream().allMatch(r -&gt; r.getDbComparators().isEmpty()));</b>
<b class="fc">&nbsp;        if (!rangeOnDb) {</b>
<b class="fc">&nbsp;            Assert.assertEquals(&quot;rangeOnDb should be &quot; + rangeOnDb, rangeOnDb, sqlgStep.getReplacedSteps().get(sqlgStep.getReplacedSteps().size() - 1).getSqlgRangeHolder().isApplyOnDb());</b>
&nbsp;        } else {
&nbsp;            //rangeOnDb is true even if there is no range
<b class="fc">&nbsp;            ReplacedStep&lt;?, ?&gt; replacedStep = sqlgStep.getReplacedSteps().get(sqlgStep.getReplacedSteps().size() - 1);</b>
<b class="fc">&nbsp;            if (replacedStep.getSqlgRangeHolder() != null) {</b>
<b class="fc">&nbsp;                Assert.assertEquals(&quot;rangeOnDb should be &quot; + rangeOnDb, rangeOnDb, replacedStep.getSqlgRangeHolder().isApplyOnDb());</b>
&nbsp;            }
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    protected void assertStep(Step&lt;?, ?&gt; step, boolean isGraph, boolean isEagerLoad, boolean isForMultipleQueries, boolean comparatorsNotOnDb) {
<b class="fc">&nbsp;        if (isGraph) {</b>
<b class="fc">&nbsp;            Assert.assertTrue(&quot;Expected SqlgGraphStep, found &quot; + step.getClass().getName(), step instanceof SqlgGraphStep);</b>
&nbsp;        } else {
<b class="fc">&nbsp;            Assert.assertTrue(&quot;Expected SqlgVertexStep, found &quot; + step.getClass().getName(), step instanceof SqlgVertexStep);</b>
&nbsp;        }
<b class="fc">&nbsp;        SqlgStep sqlgStep = (SqlgStep) step;</b>
<b class="fc">&nbsp;        Assert.assertEquals(&quot;isEagerLoad should be &quot; + isEagerLoad, isEagerLoad, sqlgStep.isEagerLoad());</b>
<b class="fc">&nbsp;        Assert.assertEquals(&quot;isForMultipleQueries should be &quot; + isForMultipleQueries, isForMultipleQueries, sqlgStep.isForMultipleQueries());</b>
<b class="fc">&nbsp;        Assert.assertEquals(&quot;comparatorsNotOnDb should be &quot; + comparatorsNotOnDb, comparatorsNotOnDb, sqlgStep.getReplacedSteps().stream().allMatch(r -&gt; r.getDbComparators().isEmpty()));</b>
&nbsp;    }
&nbsp;
&nbsp;    @SuppressWarnings(&quot;SameParameterValue&quot;)
&nbsp;    protected void assertStep(Step&lt;?, ?&gt; step, boolean isGraph, boolean isEagerLoad, boolean comparatorsNotOnDb) {
<b class="pc">&nbsp;        if (isGraph) {</b>
<b class="nc">&nbsp;            Assert.assertTrue(&quot;Expected SqlgGraphStep, found &quot; + step.getClass().getName(), step instanceof SqlgGraphStep);</b>
&nbsp;        } else {
<b class="fc">&nbsp;            Assert.assertTrue(&quot;Expected SqlgVertexStep, found &quot; + step.getClass().getName(), step instanceof SqlgVertexStep);</b>
&nbsp;        }
<b class="fc">&nbsp;        SqlgStep sqlgStep = (SqlgStep) step;</b>
<b class="fc">&nbsp;        Assert.assertEquals(&quot;isEagerLoad should be &quot; + isEagerLoad, isEagerLoad, sqlgStep.isEagerLoad());</b>
<b class="fc">&nbsp;        Assert.assertEquals(&quot;comparatorsNotOnDb should be &quot; + comparatorsNotOnDb, comparatorsNotOnDb, sqlgStep.getReplacedSteps().stream().allMatch(r -&gt; r.getDbComparators().isEmpty()));</b>
&nbsp;    }
&nbsp;
&nbsp;    protected &lt;A, B&gt; List&lt;Map&lt;A, B&gt;&gt; makeMapList(final int size, final Object... keyValues) {
<b class="fc">&nbsp;        final List&lt;Map&lt;A, B&gt;&gt; mapList = new ArrayList&lt;&gt;();</b>
<b class="fc">&nbsp;        for (int i = 0; i &lt; keyValues.length; i = i + (2 * size)) {</b>
<b class="fc">&nbsp;            final Map&lt;A, B&gt; map = new HashMap&lt;&gt;();</b>
<b class="fc">&nbsp;            for (int j = 0; j &lt; (2 * size); j = j + 2) {</b>
&nbsp;                //noinspection unchecked
<b class="fc">&nbsp;                map.put((A) keyValues[i + j], (B) keyValues[i + j + 1]);</b>
&nbsp;            }
<b class="fc">&nbsp;            mapList.add(map);</b>
&nbsp;        }
<b class="fc">&nbsp;        return mapList;</b>
&nbsp;    }
&nbsp;
&nbsp;    @SuppressWarnings(&quot;TypeParameterHidesVisibleType&quot;)
&nbsp;    protected &lt;T&gt; void checkOrderedResults(final List&lt;T&gt; expectedResults, final Traversal&lt;?, T&gt; traversal) {
<b class="fc">&nbsp;        final List&lt;T&gt; results = traversal.toList();</b>
<b class="fc">&nbsp;        assertFalse(traversal.hasNext());</b>
<b class="pc">&nbsp;        if (expectedResults.size() != results.size()) {</b>
&nbsp;//            logger.error(&quot;Expected results: &quot; + expectedResults);
&nbsp;//            logger.error(&quot;Actual results:   &quot; + results);
<b class="nc">&nbsp;            assertEquals(&quot;Checking result size&quot;, expectedResults.size(), results.size());</b>
&nbsp;        }
<b class="fc">&nbsp;        for (int i = 0; i &lt; expectedResults.size(); i++) {</b>
<b class="fc">&nbsp;            assertEquals(expectedResults.get(i), results.get(i));</b>
&nbsp;        }
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2025-06-23 10:13</div>
</div>
</body>
</html>
