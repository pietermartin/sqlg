


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > TestTopology</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">org.umlg.sqlg.test.topology</a>
</div>

<h1>Coverage Summary for Class: TestTopology (org.umlg.sqlg.test.topology)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">TestTopology</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/11)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/140)
  </span>
</td>
</tr>
  <tr>
    <td class="name">TestTopology$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestTopology$10</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestTopology$2</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestTopology$3</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestTopology$4</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestTopology$5</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestTopology$6</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestTopology$7</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestTopology$8</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestTopology$9</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/21)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/163)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package org.umlg.sqlg.test.topology;
&nbsp;
&nbsp;import org.apache.commons.collections4.set.ListOrderedSet;
&nbsp;import org.apache.tinkerpop.gremlin.process.traversal.Order;
&nbsp;import org.apache.tinkerpop.gremlin.process.traversal.P;
&nbsp;import org.apache.tinkerpop.gremlin.process.traversal.Traversal;
&nbsp;import org.apache.tinkerpop.gremlin.structure.Direction;
&nbsp;import org.apache.tinkerpop.gremlin.structure.Edge;
&nbsp;import org.apache.tinkerpop.gremlin.structure.T;
&nbsp;import org.apache.tinkerpop.gremlin.structure.Vertex;
&nbsp;import org.apache.tinkerpop.gremlin.util.iterator.IteratorUtils;
&nbsp;import org.junit.Assert;
&nbsp;import org.junit.Test;
&nbsp;import org.umlg.sqlg.structure.Multiplicity;
&nbsp;import org.umlg.sqlg.structure.PropertyDefinition;
&nbsp;import org.umlg.sqlg.structure.PropertyType;
&nbsp;import org.umlg.sqlg.structure.topology.*;
&nbsp;import org.umlg.sqlg.test.BaseTest;
&nbsp;
&nbsp;import java.util.*;
&nbsp;
&nbsp;/**
&nbsp; * Date: 2016/06/27
&nbsp; * Time: 1:40 PM
&nbsp; */
<b class="nc">&nbsp;public class TestTopology extends BaseTest {</b>
&nbsp;
&nbsp;    @Test
&nbsp;    public void testDefaultLiteralAndCheckConstraintOnNewColumn() {
<b class="nc">&nbsp;        this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(&quot;A&quot;, new HashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;            put(&quot;col1&quot;, PropertyDefinition.of(PropertyType.STRING));</b>
&nbsp;        }});
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;col1&quot;, &quot;value1&quot;);</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        VertexLabel aVertexLabel = this.sqlgGraph.getTopology().getPublicSchema().getVertexLabel(&quot;A&quot;).orElseThrow();</b>
<b class="nc">&nbsp;        aVertexLabel.ensurePropertiesExist(new HashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;            put(&quot;col2&quot;, PropertyDefinition.of(PropertyType.STRING, Multiplicity.of(), &quot;&#39;aaa&#39;&quot;, &quot;(&quot; + sqlgGraph.getSqlDialect().maybeWrapInQoutes(&quot;col2&quot;) + &quot; &lt;&gt; &#39;a&#39;)&quot;));</b>
&nbsp;        }});
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;
<b class="nc">&nbsp;        PropertyColumn col2PropertyColumn = this.sqlgGraph.getTopology().getPublicSchema().getVertexLabel(&quot;A&quot;).orElseThrow().getProperty(&quot;col2&quot;).orElseThrow();</b>
<b class="nc">&nbsp;        Assert.assertEquals(&quot;(&quot; + sqlgGraph.getSqlDialect().maybeWrapInQoutes(&quot;col2&quot;) + &quot; &lt;&gt; &#39;a&#39;)&quot;, col2PropertyColumn.getPropertyDefinition().checkConstraint());</b>
<b class="nc">&nbsp;        Assert.assertEquals(&quot;&#39;aaa&#39;&quot;, col2PropertyColumn.getPropertyDefinition().defaultLiteral());</b>
&nbsp;
<b class="nc">&nbsp;        Vertex a = this.sqlgGraph.traversal().V().hasLabel(&quot;A&quot;).tryNext().orElseThrow();</b>
<b class="nc">&nbsp;        Assert.assertEquals(&quot;aaa&quot;, a.value(&quot;col2&quot;));</b>
&nbsp;
<b class="nc">&nbsp;        boolean failure = false;</b>
&nbsp;        try {
<b class="nc">&nbsp;            this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;col2&quot;, &quot;a&quot;);</b>
&nbsp;        } catch (RuntimeException e) {
<b class="nc">&nbsp;            this.sqlgGraph.tx().rollback();</b>
<b class="nc">&nbsp;            failure = true;</b>
&nbsp;        }
<b class="nc">&nbsp;        Assert.assertTrue(failure);</b>
&nbsp;
<b class="nc">&nbsp;        VertexLabel bVertexLabel = this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(&quot;B&quot;);</b>
<b class="nc">&nbsp;        aVertexLabel.ensureEdgeLabelExist(&quot;ab&quot;, bVertexLabel, new HashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;            put(&quot;col1&quot;, PropertyDefinition.of(PropertyType.STRING, Multiplicity.of(1, 1)));</b>
&nbsp;        }});
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        Vertex b = this.sqlgGraph.addVertex(T.label, &quot;B&quot;);</b>
<b class="nc">&nbsp;        a.addEdge(&quot;ab&quot;, b, &quot;col1&quot;, &quot;value1&quot;);</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;
<b class="nc">&nbsp;        EdgeLabel edgeLabel = aVertexLabel.getOutEdgeLabel(&quot;ab&quot;).orElseThrow();</b>
<b class="nc">&nbsp;        edgeLabel.ensurePropertiesExist(new HashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;            put(&quot;col2&quot;, PropertyDefinition.of(PropertyType.STRING, Multiplicity.of(), &quot;&#39;aaa&#39;&quot;, &quot;(&quot; + sqlgGraph.getSqlDialect().maybeWrapInQoutes(&quot;col2&quot;) + &quot; &lt;&gt; &#39;a&#39;)&quot;));</b>
&nbsp;        }});
&nbsp;
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        Edge e = this.sqlgGraph.traversal().E().tryNext().orElseThrow();</b>
<b class="nc">&nbsp;        Assert.assertEquals(&quot;value1&quot;, e.value(&quot;col1&quot;));</b>
<b class="nc">&nbsp;        Assert.assertEquals(&quot;aaa&quot;, e.value(&quot;col2&quot;));</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testPropertyDefinitionTemp() {
<b class="nc">&nbsp;        this.sqlgGraph.getTopology().getPublicSchema().ensureVertexLabelExist(&quot;A&quot;, new HashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;            put(&quot;col1&quot;, PropertyDefinition.of(PropertyType.STRING, Multiplicity.of(1, 1)));</b>
&nbsp;        }});
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;col1&quot;, &quot;value1&quot;);</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        PropertyColumn propertyColumn = this.sqlgGraph.getTopology().getPublicSchema()</b>
<b class="nc">&nbsp;                .getVertexLabel(&quot;A&quot;).orElseThrow()</b>
<b class="nc">&nbsp;                .getProperty(&quot;col1&quot;).orElseThrow();</b>
<b class="nc">&nbsp;        Assert.assertFalse(propertyColumn.getPropertyDefinition().temp());</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;A&quot;, &quot;col1&quot;, &quot;asd&quot;);</b>
<b class="nc">&nbsp;        propertyColumn = this.sqlgGraph.getTopology().getPublicSchema()</b>
<b class="nc">&nbsp;                .getVertexLabel(&quot;A&quot;).orElseThrow()</b>
<b class="nc">&nbsp;                .getProperty(&quot;col1&quot;).orElseThrow();</b>
<b class="nc">&nbsp;        Assert.assertFalse(propertyColumn.getPropertyDefinition().temp());</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testEnsureAdditionalPropertyExist() {
<b class="nc">&nbsp;        Schema publicSchema = this.sqlgGraph.getTopology().getPublicSchema();</b>
<b class="nc">&nbsp;        publicSchema.ensureVertexLabelExist(&quot;A&quot;, new HashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;            put(&quot;a&quot;, PropertyDefinition.of(PropertyType.STRING));</b>
&nbsp;        }});
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        VertexLabel aVertexLabel = publicSchema.getVertexLabel(&quot;A&quot;).orElseThrow();</b>
<b class="nc">&nbsp;        aVertexLabel.ensurePropertiesExist(new HashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;            put(&quot;b&quot;, PropertyDefinition.of(PropertyType.STRING));</b>
&nbsp;        }});
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;
<b class="nc">&nbsp;        publicSchema = this.sqlgGraph.getTopology().getPublicSchema();</b>
<b class="nc">&nbsp;        aVertexLabel = publicSchema.getVertexLabel(&quot;A&quot;).orElseThrow();</b>
<b class="nc">&nbsp;        Assert.assertTrue(aVertexLabel.getProperty(&quot;a&quot;).isPresent());</b>
<b class="nc">&nbsp;        Assert.assertTrue(aVertexLabel.getProperty(&quot;b&quot;).isPresent());</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testDotInLabelName() {
<b class="nc">&nbsp;        Vertex hand = this.sqlgGraph.addVertex(T.label, &quot;A.A&quot;, &quot;name&quot;, &quot;a&quot;);</b>
<b class="nc">&nbsp;        Vertex finger = this.sqlgGraph.addVertex(T.label, &quot;A.B.interface&quot;, &quot;name&quot;, &quot;b&quot;);</b>
<b class="nc">&nbsp;        hand.addEdge(&quot;a_b&quot;, finger);</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;
<b class="nc">&nbsp;        List&lt;Vertex&gt; children = sqlgGraph.traversal().V(hand)</b>
<b class="nc">&nbsp;                .out(&quot;a_b&quot;)</b>
<b class="nc">&nbsp;                .toList();</b>
<b class="nc">&nbsp;        Assert.assertEquals(1, children.size());</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testDotInLabelNameUserSuppliedIdentifiers() {
<b class="nc">&nbsp;        Schema aSchema = this.sqlgGraph.getTopology().ensureSchemaExist(&quot;A&quot;);</b>
<b class="nc">&nbsp;        VertexLabel testVertexLabel = aSchema.ensureVertexLabelExist(</b>
&nbsp;                &quot;TestA&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;uid&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;name1&quot;, PropertyDefinition.of(PropertyType.STRING));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(Collections.singletonList(&quot;uid&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        VertexLabel testTestVertexLabel = aSchema.ensureVertexLabelExist(</b>
&nbsp;                &quot;TestB&quot;,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;uid&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;name1&quot;, PropertyDefinition.of(PropertyType.STRING));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(Collections.singletonList(&quot;uid&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        Vertex v1 = this.sqlgGraph.addVertex(T.label, &quot;A.TestA&quot;, &quot;uid&quot;, UUID.randomUUID().toString(), &quot;name1&quot;, &quot;a&quot;);</b>
<b class="nc">&nbsp;        Vertex v2 = this.sqlgGraph.addVertex(T.label, &quot;A.Test.TestA&quot;, &quot;uid&quot;, UUID.randomUUID().toString(), &quot;name1&quot;, &quot;a&quot;);</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;
<b class="nc">&nbsp;        this.sqlgGraph.getTopology().ensureEdgeLabelExist(</b>
&nbsp;                &quot;e1&quot;,
&nbsp;                testVertexLabel,
&nbsp;                testTestVertexLabel,
<b class="nc">&nbsp;                new LinkedHashMap&lt;&gt;() {{</b>
<b class="nc">&nbsp;                    put(&quot;uid&quot;, PropertyDefinition.of(PropertyType.varChar(100)));</b>
<b class="nc">&nbsp;                    put(&quot;name1&quot;, PropertyDefinition.of(PropertyType.STRING));</b>
&nbsp;                }},
<b class="nc">&nbsp;                ListOrderedSet.listOrderedSet(Collections.singletonList(&quot;uid&quot;))</b>
&nbsp;        );
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        v1.addEdge(&quot;e1&quot;, v2, &quot;uid&quot;, UUID.randomUUID().toString(), &quot;name1&quot;, &quot;a&quot;);</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;
<b class="nc">&nbsp;        List&lt;Vertex&gt; vertices = this.sqlgGraph.traversal().V().hasLabel(&quot;A.TestA&quot;).out().toList();</b>
<b class="nc">&nbsp;        Assert.assertEquals(1, vertices.size());</b>
<b class="nc">&nbsp;        Assert.assertEquals(v2, vertices.get(0));</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void failTest() {
<b class="nc">&nbsp;        Vertex a1 = this.sqlgGraph.addVertex(T.label, &quot;MySchema.A&quot;, &quot;name&quot;, &quot;A&quot;);</b>
<b class="nc">&nbsp;        Vertex b1 = this.sqlgGraph.addVertex(T.label, &quot;MySchema.B&quot;, &quot;name&quot;, &quot;B&quot;);</b>
<b class="nc">&nbsp;        a1.addEdge(&quot;ab&quot;, b1);</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
&nbsp;
&nbsp;        //works
<b class="nc">&nbsp;        Assert.assertEquals(2,</b>
<b class="nc">&nbsp;                this.sqlgGraph.topology()</b>
<b class="nc">&nbsp;                        .V().hasLabel(&quot;sqlg_schema.schema&quot;).has(&quot;name&quot;, P.within(&quot;MySchema&quot;)).as(&quot;schema&quot;).values(&quot;name&quot;).as(&quot;schemaName&quot;).select(&quot;schema&quot;)</b>
<b class="nc">&nbsp;                        .out(&quot;schema_vertex&quot;)</b>
<b class="nc">&nbsp;                        .count().next().intValue());</b>
&nbsp;
&nbsp;        //fails, was bug no longer fails
<b class="nc">&nbsp;        Assert.assertTrue(</b>
<b class="nc">&nbsp;                this.sqlgGraph.topology()</b>
<b class="nc">&nbsp;                        .V().hasLabel(&quot;sqlg_schema.schema&quot;).has(&quot;name&quot;, P.within(&quot;MySchema&quot;)).as(&quot;schema&quot;).values(&quot;name&quot;).as(&quot;schemaName&quot;).select(&quot;schema&quot;)</b>
<b class="nc">&nbsp;                        .out(&quot;schema_vertex&quot;)</b>
<b class="nc">&nbsp;                        .hasNext());</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testTopologyTraversalWithOrderBy() {
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;A&quot;);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;B&quot;);</b>
<b class="nc">&nbsp;        this.sqlgGraph.addVertex(T.label, &quot;C&quot;);</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        List&lt;Vertex&gt; vertices = this.sqlgGraph.topology().V().hasLabel(&quot;sqlg_schema.schema&quot;).out(&quot;schema_vertex&quot;).order().by(&quot;name&quot;, Order.desc).toList();</b>
<b class="nc">&nbsp;        Assert.assertEquals(&quot;A&quot;, vertices.get(2).value(&quot;name&quot;));</b>
<b class="nc">&nbsp;        Assert.assertEquals(&quot;B&quot;, vertices.get(1).value(&quot;name&quot;));</b>
<b class="nc">&nbsp;        Assert.assertEquals(&quot;C&quot;, vertices.get(0).value(&quot;name&quot;));</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testTopologyTraversal() {
<b class="nc">&nbsp;        Vertex gis = this.sqlgGraph.addVertex(T.label, &quot;Gis&quot;, &quot;name&quot;, &quot;HaloGis1&quot;);</b>
<b class="nc">&nbsp;        Vertex something = this.sqlgGraph.addVertex(T.label, &quot;Something&quot;, &quot;name&quot;, &quot;Something1&quot;);</b>
<b class="nc">&nbsp;        gis.addEdge(&quot;testEdge&quot;, something, &quot;edgeProperty&quot;, &quot;asdasd&quot;);</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().commit();</b>
<b class="nc">&nbsp;        Assert.assertEquals(2, this.sqlgGraph.topology().V().hasLabel(&quot;sqlg_schema.schema&quot;).out(&quot;schema_vertex&quot;).count().next().intValue());</b>
<b class="nc">&nbsp;        Assert.assertEquals(2, this.sqlgGraph.topology().V().hasLabel(&quot;sqlg_schema.vertex&quot;).in(&quot;schema_vertex&quot;).count().next().intValue());</b>
<b class="nc">&nbsp;        Assert.assertEquals(2, this.sqlgGraph.topology().V().hasLabel(&quot;sqlg_schema.vertex&quot;).out(&quot;vertex_property&quot;).count().next().intValue());</b>
<b class="nc">&nbsp;        Assert.assertEquals(2, this.sqlgGraph.topology().V().hasLabel(&quot;sqlg_schema.property&quot;).in(&quot;vertex_property&quot;).count().next().intValue());</b>
<b class="nc">&nbsp;        Assert.assertEquals(1, this.sqlgGraph.topology().V().hasLabel(&quot;sqlg_schema.property&quot;).in(&quot;edge_property&quot;).count().next().intValue());</b>
&nbsp;
<b class="nc">&nbsp;        Vertex v = this.sqlgGraph.topology().V().hasLabel(&quot;sqlg_schema.schema&quot;).has(&quot;name&quot;, this.sqlgGraph.getSqlDialect().getPublicSchema()).next();</b>
<b class="nc">&nbsp;        Assert.assertTrue(v.edges(Direction.OUT, &quot;schema_vertex&quot;).hasNext());</b>
&nbsp;
<b class="nc">&nbsp;        Assert.assertEquals(2, this.sqlgGraph.topology().V().hasLabel(&quot;sqlg_schema.schema&quot;).as(&quot;schema&quot;).select(&quot;schema&quot;).out(&quot;schema_vertex&quot;).count().next().intValue());</b>
<b class="nc">&nbsp;        Assert.assertEquals(2, this.sqlgGraph.topology().V().hasLabel(&quot;sqlg_schema.schema&quot;).as(&quot;schema&quot;).values(&quot;name&quot;).as(&quot;schemaName&quot;).select(&quot;schema&quot;).out(&quot;schema_vertex&quot;).count().next().intValue());</b>
<b class="nc">&nbsp;        Assert.assertTrue(this.sqlgGraph.topology().V().hasLabel(&quot;sqlg_schema.schema&quot;).as(&quot;schema&quot;).values(&quot;name&quot;).as(&quot;schemaName&quot;).select(&quot;schema&quot;).out(&quot;schema_vertex&quot;).hasNext());</b>
&nbsp;
<b class="nc">&nbsp;        Assert.assertEquals(&quot;testEdge&quot;, this.sqlgGraph.topology().V().hasLabel(&quot;sqlg_schema.property&quot;).in(&quot;edge_property&quot;).values(&quot;name&quot;).next());</b>
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;    //    This test a bug in rollback on edges.
&nbsp;    @Test
&nbsp;    public void testRollback() {
<b class="nc">&nbsp;        loadModern();</b>
<b class="nc">&nbsp;        final Traversal&lt;Vertex, Edge&gt; traversal = this.sqlgGraph.traversal().V().aggregate(&quot;x&quot;).as(&quot;a&quot;).select(&quot;x&quot;).unfold().addE(&quot;existsWith&quot;).to(&quot;a&quot;).property(&quot;time&quot;, &quot;now&quot;);</b>
<b class="nc">&nbsp;        IteratorUtils.asList(traversal);</b>
<b class="nc">&nbsp;        this.sqlgGraph.tx().rollback();</b>
&nbsp;    }
&nbsp;
&nbsp;    @Test
&nbsp;    public void testAddColumns(){
&nbsp;    	//Create Schema
<b class="nc">&nbsp;        Topology topology = sqlgGraph.getTopology();</b>
<b class="nc">&nbsp;        topology.ensureSchemaExist(&quot;TEST&quot;);</b>
&nbsp;
<b class="nc">&nbsp;        Map&lt;String, Object&gt; columns = new HashMap&lt;&gt;();</b>
<b class="nc">&nbsp;        columns.put(&quot;Test1&quot;, &quot;&quot;);</b>
<b class="nc">&nbsp;        columns.put(&quot;Test2&quot;, &quot;&quot;);</b>
&nbsp;
&nbsp;        //Add a vertex and remove to create columns
<b class="nc">&nbsp;        Vertex v = sqlgGraph.addVertex(&quot;TEST&quot; + &quot;.&quot; + &quot;TEST_Table&quot;, columns);</b>
<b class="nc">&nbsp;        v.remove();</b>
<b class="nc">&nbsp;        sqlgGraph.tx().commit();</b>
&nbsp;
<b class="nc">&nbsp;        columns = new HashMap&lt;&gt;();</b>
<b class="nc">&nbsp;        columns.put(&quot;Test1&quot;, &quot;T1&quot;);</b>
<b class="nc">&nbsp;        columns.put(&quot;Test2&quot;, &quot;T2&quot;);</b>
&nbsp;
&nbsp;        //Add the data
<b class="nc">&nbsp;        sqlgGraph.addVertex(&quot;TEST&quot; + &quot;.&quot; + &quot;TEST_Table&quot;, columns);</b>
<b class="nc">&nbsp;        sqlgGraph.tx().commit();</b>
&nbsp;
&nbsp;        //Simulating second load
&nbsp;        //Remove the whole table label
<b class="nc">&nbsp;        Optional&lt;VertexLabel&gt; tableVertexLabel = sqlgGraph.getTopology().getVertexLabel(&quot;TEST&quot;, &quot;TEST_Table&quot;);</b>
<b class="nc">&nbsp;        tableVertexLabel.ifPresent(vertexLabel -&gt; vertexLabel.remove(false));</b>
&nbsp;
<b class="nc">&nbsp;        columns = new HashMap&lt;&gt;();</b>
<b class="nc">&nbsp;        columns.put(&quot;Test1&quot;, &quot;&quot;);</b>
<b class="nc">&nbsp;        columns.put(&quot;Test2&quot;, &quot;&quot;);</b>
<b class="nc">&nbsp;        columns.put(&quot;Test3&quot;, &quot;&quot;);</b>
&nbsp;
&nbsp;        //Add a vertex with more columns than previously had
<b class="nc">&nbsp;        v = sqlgGraph.addVertex(&quot;TEST&quot; + &quot;.&quot; + &quot;TEST_Table&quot;, columns);</b>
<b class="nc">&nbsp;        v.remove();</b>
<b class="nc">&nbsp;        sqlgGraph.tx().commit();</b>
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2025-06-23 10:13</div>
</div>
</body>
</html>
